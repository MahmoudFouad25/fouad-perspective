<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استثمر في رحلتك - منظور الفؤاد المتكامل</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://mahmoudfouad25.github.io/fouad-perspective/media/logos/fouad-icon.png">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* ===== متغيرات الألوان الأساسية ===== */
        :root {
            --dark-bg: #0F0F0F;
            --dark-surface: #1A1A1A;
            --dark-card: #242424;
            --gold-primary: #FFD700;
            --gold-secondary: #FFA500;
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --border-color: rgba(255, 215, 0, 0.2);
            --success-color: #22C55E;
            --danger-color: #EF4444;
            --info-color: #3B82F6;
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* ===== إعدادات عامة ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ===== حاوي الصفحة الرئيسي ===== */
        .investment-page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* ===== شريط التنقل العلوي ===== */
        .investment-header {
            background: linear-gradient(135deg, var(--dark-surface) 0%, var(--dark-card) 100%);
            border-bottom: 1px solid var(--border-color);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            margin: -20px -20px 30px -20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            color: var(--gold-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .back-btn:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateX(5px);
        }

        .course-title-header {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--gold-primary), var(--gold-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ===== تحميل البيانات ===== */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            gap: 30px;
        }

        .loading-heart {
            width: 100px;
            height: 100px;
            position: relative;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        .loading-heart::before,
        .loading-heart::after {
            content: '';
            position: absolute;
            width: 52px;
            height: 80px;
            background: var(--gold-primary);
            border-radius: 50px 50px 0 0;
        }

        .loading-heart::before {
            transform: rotate(-45deg);
            transform-origin: 0 100%;
            left: 50px;
        }

        .loading-heart::after {
            transform: rotate(45deg);
            transform-origin: 100% 100%;
            left: 0;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
            animation: fadeInOut 2s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* ===== تخطيط الأعمدة للصفحة ===== */
        .investment-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            align-items: start;
        }

        /* ===== القسم الرئيسي ===== */
        .main-investment-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* ===== الشريط الجانبي الثابت ===== */
        .investment-sidebar {
            position: sticky;
            top: 120px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ===== تصميم الموبايل ===== */
        @media (max-width: 1024px) {
            .investment-content {
                grid-template-columns: 1fr;
            }

            .investment-sidebar {
                position: relative;
                top: 0;
                order: -1;
            }

            .investment-header {
                padding: 15px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .course-title-header {
                font-size: 1.2rem;
            }

            .back-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 640px) {
            .investment-page-container {
                padding: 10px;
            }

            .course-title-header {
                font-size: 1rem;
            }
        }

        /* ========================================
  قسم الاستثمار - التصميم الكامل
  ======================================== */

/* المتغيرات الأساسية */
:root {
   /* الألوان الأساسية */
   --primary-gold: #FFD700;
   --deep-blue: #1E3A8A;
   --pure-white: #FFFFFF;
   --soft-black: #1a1a1a;
   
   /* ألوان الأشواق التسعة */
   --longing-1: #8B1A1A;  /* أحمر قرمزي */
   --longing-2: #FF69B4;  /* وردي دافئ */
   --longing-3: #FF8C00;  /* برتقالي مشع */
   --longing-4: #9370DB;  /* بنفسجي عميق */
   --longing-5: #228B22;  /* أخضر زمردي */
   --longing-6: #87CEEB;  /* أزرق سماوي */
   --longing-7: #FFD700;  /* أصفر مضيء */
   --longing-8: #DC143C;  /* أحمر ياقوتي */
   --longing-9: #40E0D0;  /* فيروزي هادئ */
   
   /* الظلال والتدرجات */
   --shadow-soft: 0 2px 10px rgba(0,0,0,0.1);
   --shadow-medium: 0 5px 20px rgba(0,0,0,0.15);
   --shadow-deep: 0 10px 40px rgba(0,0,0,0.2);
   --shadow-glow: 0 0 30px rgba(255,215,0,0.3);
   
   /* الحركات */
   --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
   --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
   
   /* المسافات */
   --spacing-xs: 0.5rem;
   --spacing-sm: 1rem;
   --spacing-md: 2rem;
   --spacing-lg: 3rem;
   --spacing-xl: 4rem;
}

/* الحاوي الرئيسي */
.investment-container {
   width: 100%;
   max-width: 1400px;
   margin: 0 auto;
   padding: var(--spacing-lg);
   background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
   border-radius: 20px;
   position: relative;
   overflow: hidden;
}

/* خلفية متحركة */
.investment-container::before {
   content: '';
   position: absolute;
   top: -50%;
   left: -50%;
   width: 200%;
   height: 200%;
   background: radial-gradient(circle, rgba(255,215,0,0.05) 0%, transparent 70%);
   animation: rotate-slow 30s linear infinite;
}

@keyframes rotate-slow {
   from { transform: rotate(0deg); }
   to { transform: rotate(360deg); }
}

/* ========================================
  الهيدر مع القلب النابض
  ======================================== */

.investment-header {
   text-align: center;
   margin-bottom: var(--spacing-xl);
   position: relative;
   z-index: 10;
}

.heart-logo-container {
   display: inline-block;
   margin-bottom: var(--spacing-md);
   position: relative;
}

.heart-logo {
   filter: drop-shadow(0 0 20px rgba(255,215,0,0.4));
}

/* أنيميشن النبض للقلب */
.heart-logo.pulsing .central-heart {
   animation: heartbeat 1.5s ease-in-out infinite;
}

@keyframes heartbeat {
   0%, 100% { transform: scale(1); }
   25% { transform: scale(1.1); }
   50% { transform: scale(1); }
   75% { transform: scale(1.05); }
}

/* الخطوط المتحركة */
.longing-lines path {
   stroke-dasharray: 100;
   stroke-dashoffset: 100;
   animation: draw-line 2s ease-out forwards;
   animation-delay: calc(var(--line-index) * 0.1s);
}

.longing-line.line-1 { --line-index: 1; }
.longing-line.line-2 { --line-index: 2; }
.longing-line.line-3 { --line-index: 3; }
.longing-line.line-4 { --line-index: 4; }
.longing-line.line-5 { --line-index: 5; }
.longing-line.line-6 { --line-index: 6; }
.longing-line.line-7 { --line-index: 7; }
.longing-line.line-8 { --line-index: 8; }
.longing-line.line-9 { --line-index: 9; }

@keyframes draw-line {
   to { stroke-dashoffset: 0; }
}

/* القلوب الصغيرة */
.longing-hearts circle {
   opacity: 0;
   transform: scale(0);
   animation: pop-in 0.5s ease-out forwards;
   animation-delay: calc(1.5s + var(--heart-index) * 0.1s);
}

.longing-heart.heart-1 { --heart-index: 1; }
.longing-heart.heart-2 { --heart-index: 2; }
.longing-heart.heart-3 { --heart-index: 3; }
.longing-heart.heart-4 { --heart-index: 4; }
.longing-heart.heart-5 { --heart-index: 5; }
.longing-heart.heart-6 { --heart-index: 6; }
.longing-heart.heart-7 { --heart-index: 7; }
.longing-heart.heart-8 { --heart-index: 8; }
.longing-heart.heart-9 { --heart-index: 9; }

@keyframes pop-in {
   to { 
       opacity: 1;
       transform: scale(1);
   }
}

/* العنوان مع تأثير الكتابة */
.investment-title-container {
   opacity: 0;
   animation: fade-in-up 1s ease-out 2.5s forwards;
}

@keyframes fade-in-up {
   to {
       opacity: 1;
       transform: translateY(0);
   }
}

.investment-title {
   font-size: 2.5rem;
   font-weight: 700;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
   position: relative;
   display: inline-block;
}

.investment-title.typing-effect {
   overflow: hidden;
   white-space: nowrap;
   border-left: 3px solid var(--primary-gold);
   animation: typing 3s steps(30, end) 2.5s forwards,
              blink-caret 0.75s step-end infinite;
}

@keyframes typing {
   from { width: 0; }
   to { width: 100%; }
}

@keyframes blink-caret {
   from, to { border-color: transparent; }
   50% { border-color: var(--primary-gold); }
}

.investment-subtitle {
   font-size: 1.25rem;
   color: #666;
   opacity: 0;
   animation: fade-in 1s ease-out 5.5s forwards;
}

@keyframes fade-in {
   to { opacity: 1; }
}

/* ========================================
  البطاقات التفاعلية الثلاث
  ======================================== */

.journey-cards-container {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
   gap: var(--spacing-md);
   margin-bottom: var(--spacing-xl);
   opacity: 0;
   animation: fade-in-up 1s ease-out 6s forwards;
}

.journey-card {
   background: white;
   border-radius: 15px;
   padding: var(--spacing-lg);
   text-align: center;
   position: relative;
   overflow: hidden;
   cursor: pointer;
   transition: var(--transition-smooth);
   box-shadow: var(--shadow-soft);
}

.journey-card::before {
   content: '';
   position: absolute;
   top: 0;
   left: 0;
   right: 0;
   height: 5px;
   background: linear-gradient(90deg, var(--primary-gold), var(--deep-blue));
   transform: scaleX(0);
   transition: transform 0.3s ease;
}

.journey-card:hover {
   transform: translateY(-10px);
   box-shadow: var(--shadow-deep);
}

.journey-card:hover::before {
   transform: scaleX(1);
}

/* أيقونات البطاقات */
.card-icon {
   width: 80px;
   height: 80px;
   margin: 0 auto var(--spacing-md);
   background: linear-gradient(135deg, var(--primary-gold), var(--deep-blue));
   border-radius: 50%;
   display: flex;
   align-items: center;
   justify-content: center;
   position: relative;
}

.card-icon svg {
   width: 50px;
   height: 50px;
   color: white;
}

.card-icon::after {
   content: '';
   position: absolute;
   inset: -10px;
   background: inherit;
   border-radius: 50%;
   opacity: 0.3;
   filter: blur(20px);
   z-index: -1;
}

.card-title {
   font-size: 1.5rem;
   font-weight: 700;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
}

.card-description {
   color: #666;
   margin-bottom: var(--spacing-md);
}

.card-preview {
   font-size: 0.9rem;
   color: var(--primary-gold);
   margin-bottom: var(--spacing-md);
   font-weight: 600;
}

.price-amount,
.discount-amount {
   font-size: 1.2em;
   font-weight: 700;
}

/* أزرار البطاقات */
.card-select-btn {
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
   border: none;
   padding: 12px 30px;
   border-radius: 25px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
   position: relative;
   overflow: hidden;
}

.card-select-btn::before {
   content: '';
   position: absolute;
   top: 50%;
   left: 50%;
   width: 0;
   height: 0;
   background: rgba(255,255,255,0.3);
   border-radius: 50%;
   transform: translate(-50%, -50%);
   transition: width 0.6s, height 0.6s;
}

.card-select-btn:hover {
   transform: scale(1.05);
   box-shadow: 0 5px 20px rgba(255,215,0,0.4);
}

.card-select-btn:active::before {
   width: 300px;
   height: 300px;
}

/* ========================================
  قسم التفاصيل الديناميكي
  ======================================== */

.journey-details-container {
   background: white;
   border-radius: 20px;
   padding: var(--spacing-lg);
   margin-bottom: var(--spacing-lg);
   box-shadow: var(--shadow-medium);
}

.journey-details {
   display: none;
   animation: slide-in 0.5s ease-out;
}

@keyframes slide-in {
   from {
       opacity: 0;
       transform: translateX(-20px);
   }
   to {
       opacity: 1;
       transform: translateX(0);
   }
}

.section-title {
   font-size: 1.5rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-md);
   display: flex;
   align-items: center;
   gap: 10px;
}

.section-title::before {
   content: '';
   width: 5px;
   height: 30px;
   background: var(--primary-gold);
   border-radius: 3px;
}

/* ========================================
  شريط العروض الزمنية
  ======================================== */

.time-offers-slider {
   display: flex;
   gap: var(--spacing-sm);
   overflow-x: auto;
   padding: var(--spacing-sm) 0;
   scroll-snap-type: x mandatory;
}

.offer-option {
   flex: 0 0 200px;
   background: #f8f9fa;
   border: 2px solid transparent;
   border-radius: 15px;
   padding: var(--spacing-md);
   text-align: center;
   cursor: pointer;
   transition: var(--transition-smooth);
   scroll-snap-align: center;
}

.offer-option.active {
   background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(30,58,138,0.1));
   border-color: var(--primary-gold);
   transform: scale(1.05);
}

.offer-icon {
   font-size: 2rem;
   margin-bottom: var(--spacing-sm);
}

.offer-name {
   font-weight: 600;
   color: var(--deep-blue);
   margin-bottom: 5px;
}

.offer-discount {
   color: #e74c3c;
   font-weight: 700;
}

.offer-price {
   font-size: 1.2rem;
   color: var(--primary-gold);
   font-weight: 700;
   margin-top: var(--spacing-sm);
}

/* ========================================
  عجلة طرق الدفع
  ======================================== */

.payment-wheel {
   position: relative;
   width: 300px;
   height: 300px;
   margin: 0 auto;
}

.wheel-container {
   position: relative;
   width: 100%;
   height: 100%;
   animation: rotate-gentle 20s linear infinite;
   animation-play-state: paused;
}

.wheel-container:hover {
   animation-play-state: running;
}

@keyframes rotate-gentle {
   from { transform: rotate(0deg); }
   to { transform: rotate(360deg); }
}

.payment-option {
   position: absolute;
   width: 120px;
   height: 120px;
   background: white;
   border: 3px solid #e0e0e0;
   border-radius: 15px;
   display: flex;
   flex-direction: column;
   align-items: center;
   justify-content: center;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.payment-option.cash-payment {
   top: 0;
   left: 50%;
   transform: translateX(-50%);
}

.payment-option.installment-3 {
   top: 50%;
   right: 0;
   transform: translateY(-50%);
}

.payment-option.installment-6 {
   bottom: 0;
   left: 50%;
   transform: translateX(-50%);
}

.payment-option.installment-12 {
   top: 50%;
   left: 0;
   transform: translateY(-50%);
}

.payment-option.active {
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   border-color: var(--primary-gold);
   transform: scale(1.1) translateX(-50%) !important;
   box-shadow: var(--shadow-glow);
}

.payment-option.active .option-title,
.payment-option.active .option-discount {
   color: white;
}

.option-icon {
   font-size: 2rem;
   margin-bottom: 5px;
}

.option-title {
   font-weight: 600;
   color: var(--deep-blue);
   font-size: 0.9rem;
}

.option-discount {
   color: #27ae60;
   font-size: 0.8rem;
   font-weight: 700;
}

.option-description {
   font-size: 0.7rem;
   color: #666;
}

/* ========================================
  ملخص الخطة
  ======================================== */

.plan-summary {
   background: linear-gradient(135deg, #f5f7fa, #e9ecef);
   border-radius: 15px;
   padding: var(--spacing-lg);
   margin-top: var(--spacing-lg);
}

.summary-title {
   font-size: 1.3rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-md);
   display: flex;
   align-items: center;
   gap: 10px;
}

.summary-box {
   background: white;
   border-radius: 10px;
   padding: var(--spacing-md);
   box-shadow: var(--shadow-soft);
}

.price-breakdown {
   margin-bottom: var(--spacing-md);
}

.price-line {
   display: flex;
   justify-content: space-between;
   align-items: center;
   padding: var(--spacing-sm) 0;
}

.price-line.original .value {
   text-decoration: line-through;
   color: #999;
}

.price-line.discount {
   color: #e74c3c;
   font-weight: 600;
}

.price-line.total {
   font-size: 1.2rem;
   font-weight: 700;
   color: var(--deep-blue);
}

.divider {
   height: 1px;
   background: #e0e0e0;
   margin: var(--spacing-sm) 0;
}

/* خيارات الدفع في الملخص */
.payment-options-summary h5 {
   font-size: 1rem;
   color: #666;
   margin-bottom: var(--spacing-sm);
}

.options-list {
   display: grid;
   gap: var(--spacing-sm);
}

.option {
   display: flex;
   align-items: center;
   gap: 10px;
   padding: var(--spacing-sm);
   background: #f8f9fa;
   border-radius: 8px;
   transition: var(--transition-smooth);
}

.option:hover {
   background: #e9ecef;
}

.option input[type="radio"] {
   width: 20px;
   height: 20px;
   accent-color: var(--primary-gold);
}

.option label {
   flex: 1;
   cursor: pointer;
   display: flex;
   justify-content: space-between;
   align-items: center;
}

.save-badge {
   background: #27ae60;
   color: white;
   padding: 4px 10px;
   border-radius: 15px;
   font-size: 0.8rem;
   font-weight: 600;
}

/* أزرار الإجراءات */
.action-buttons {
   display: flex;
   gap: var(--spacing-sm);
   margin-top: var(--spacing-md);
}

.btn-primary,
.btn-secondary {
   flex: 1;
   padding: 15px 30px;
   border: none;
   border-radius: 25px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
   display: flex;
   align-items: center;
   justify-content: center;
   gap: 10px;
}

.btn-primary {
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
}

.btn-primary:hover {
   transform: translateY(-2px);
   box-shadow: 0 5px 20px rgba(255,215,0,0.4);
}

.btn-secondary {
   background: white;
   color: var(--deep-blue);
   border: 2px solid var(--deep-blue);
}

.btn-secondary:hover {
   background: var(--deep-blue);
   color: white;
}

/* ========================================
  تفاصيل الرحلة الجماعية
  ======================================== */

.group-slider-container {
   max-width: 500px;
   margin: 0 auto;
}

.slider-labels {
   display: flex;
   justify-content: space-between;
   margin-bottom: var(--spacing-sm);
   font-size: 0.9rem;
   color: #666;
}

.current-label {
   font-weight: 600;
   color: var(--deep-blue);
}

.group-size-slider {
   width: 100%;
   height: 10px;
   -webkit-appearance: none;
   background: #e0e0e0;
   border-radius: 5px;
   outline: none;
}

.group-size-slider::-webkit-slider-thumb {
   -webkit-appearance: none;
   width: 30px;
   height: 30px;
   background: var(--primary-gold);
   border-radius: 50%;
   cursor: pointer;
   box-shadow: var(--shadow-soft);
   transition: var(--transition-smooth);
}

.group-size-slider::-webkit-slider-thumb:hover {
   transform: scale(1.2);
   box-shadow: var(--shadow-glow);
}

.group-discount-info {
   text-align: center;
   margin-top: var(--spacing-md);
}

.discount-badge {
   display: inline-block;
   background: linear-gradient(135deg, #27ae60, #2ecc71);
   color: white;
   padding: 10px 20px;
   border-radius: 25px;
   font-weight: 600;
   margin-bottom: var(--spacing-sm);
   animation: pulse-badge 2s ease-in-out infinite;
}

@keyframes pulse-badge {
   0%, 100% { transform: scale(1); }
   50% { transform: scale(1.05); }
}

.discount-message {
   color: #666;
   font-style: italic;
}

/* محاكي التوفير الجماعي */
.group-savings-simulator {
   background: #f8f9fa;
   border-radius: 15px;
   padding: var(--spacing-md);
   margin-top: var(--spacing-lg);
}

.savings-list {
   display: grid;
   gap: var(--spacing-sm);
   margin-bottom: var(--spacing-md);
}

.savings-item {
   display: flex;
   justify-content: space-between;
   align-items: center;
   padding: var(--spacing-sm);
   background: white;
   border-radius: 8px;
   transition: var(--transition-smooth);
}

.savings-item:hover {
   transform: translateX(5px);
   box-shadow: var(--shadow-soft);
}

.savings-item.highlight {
   background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(30,58,138,0.1));
   border: 2px solid var(--primary-gold);
}

.total-savings {
   text-align: center;
   font-size: 1.5rem;
   font-weight: 700;
   color: #27ae60;
   padding: var(--spacing-md);
   background: white;
   border-radius: 10px;
   box-shadow: var(--shadow-soft);
}

/* ========================================
  تفاصيل رحلة الدعم
  ======================================== */

.support-welcome {
   text-align: center;
   margin-bottom: var(--spacing-lg);
}

.welcome-title {
   font-size: 1.8rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
}

.welcome-message {
   color: #666;
   font-size: 1.1rem;
}

/* خيارات الدعم الأولية */
.support-options-initial {
   display: grid;
   gap: var(--spacing-sm);
   margin-bottom: var(--spacing-lg);
}

.support-option {
   display: flex;
   align-items: center;
   gap: var(--spacing-md);
   padding: var(--spacing-md);
   background: white;
   border: 2px solid #e0e0e0;
   border-radius: 15px;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.support-option:hover {
   border-color: var(--primary-gold);
   transform: translateX(10px);
   box-shadow: var(--shadow-soft);
}

.support-option .option-icon {
   font-size: 2rem;
}

.support-option .option-text {
   font-size: 1.1rem;
   color: var(--deep-blue);
   font-weight: 600;
}

/* بطاقات أنواع الدعم */
.support-type-cards {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
   gap: var(--spacing-md);
}

.support-card {
   background: white;
   border: 2px solid #e0e0e0;
   border-radius: 15px;
   padding: var(--spacing-md);
   text-align: center;
   transition: var(--transition-smooth);
}

.support-card:hover {
   border-color: var(--primary-gold);
   transform: translateY(-5px);
   box-shadow: var(--shadow-medium);
}

.card-header {
   display: flex;
   align-items: center;
   justify-content: center;
   gap: 10px;
   margin-bottom: var(--spacing-sm);
}

.card-icon {
   font-size: 2rem;
}

.card-title {
   font-size: 1.2rem;
   color: var(--deep-blue);
   font-weight: 600;
}

.card-description {
   color: #666;
   margin-bottom: var(--spacing-md);
}

.apply-btn {
   width: 100%;
   padding: 12px;
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
   border: none;
   border-radius: 8px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.apply-btn:hover {
   transform: scale(1.05);
   box-shadow: 0 3px 15px rgba(255,215,0,0.4);
}

/* معلومات المنح المتاحة */
.grants-availability {
   background: linear-gradient(135deg, #f5f7fa, #e9ecef);
   border-radius: 15px;
   padding: var(--spacing-md);
   margin-top: var(--spacing-lg);
}

.availability-title {
   font-size: 1.2rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-md);
   text-align: center;
}

.grants-stats {
   display: flex;
   justify-content: space-around;
   flex-wrap: wrap;
   gap: var(--spacing-md);
}

.stat-item {
   text-align: center;
   background: white;
   padding: var(--spacing-md);
   border-radius: 10px;
   box-shadow: var(--shadow-soft);
   min-width: 120px;
}

.stat-number {
   display: block;
   font-size: 2rem;
   font-weight: 700;
   color: var(--primary-gold);
   margin-bottom: 5px;
}

.stat-label {
   font-size: 0.9rem;
   color: #666;
}

/* ========================================
  الحاسبة الذكية الموحدة
  ======================================== */

.smart-calculator-section {
   background: white;
   border-radius: 20px;
   padding: var(--spacing-lg);
   margin: var(--spacing-xl) 0;
   box-shadow: var(--shadow-medium);
}

.calculator-title {
   font-size: 1.5rem;
   color: var(--deep-blue);
   text-align: center;
   margin-bottom: var(--spacing-lg);
}

.calculator-container {
   max-width: 600px;
   margin: 0 auto;
}

.calculator-step {
   margin-bottom: var(--spacing-md);
   padding: var(--spacing-md);
   background: #f8f9fa;
   border-radius: 10px;
}

.step-label {
   display: block;
   font-weight: 600;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
}

/* إدخال الكوبون */
.coupon-input-group {
   display: flex;
   gap: var(--spacing-sm);
}

.coupon-input {
   flex: 1;
   padding: 10px 15px;
   border: 2px solid #e0e0e0;
   border-radius: 8px;
   font-size: 1rem;
   transition: var(--transition-smooth);
}

.coupon-input:focus {
   border-color: var(--primary-gold);
   outline: none;
   box-shadow: 0 0 0 3px rgba(255,215,0,0.1);
}

.apply-coupon-btn {
   padding: 10px 20px;
   background: var(--deep-blue);
   color: white;
   border: none;
   border-radius: 8px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.apply-coupon-btn:hover {
   background: #2d4a9e;
   transform: translateY(-2px);
}

.coupon-feedback {
   margin-top: var(--spacing-sm);
   padding: 10px;
   border-radius: 8px;
   font-size: 0.9rem;
}

.coupon-feedback.success {
   background: #d4edda;
   color: #155724;
   border: 1px solid #c3e6cb;
}

.coupon-feedback.error {
   background: #f8d7da;
   color: #721c24;
   border: 1px solid #f5c6cb;
}

/* أزرار نوع الدفع */
.payment-type-buttons {
   display: grid;
   grid-template-columns: 1fr 1fr;
   gap: var(--spacing-sm);
}

.payment-type-btn {
   padding: 15px;
   background: white;
   border: 2px solid #e0e0e0;
   border-radius: 10px;
   cursor: pointer;
   transition: var(--transition-smooth);
   display: flex;
   flex-direction: column;
   align-items: center;
   gap: 5px;
}

.payment-type-btn.active {
   background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(30,58,138,0.1));
   border-color: var(--primary-gold);
}

.payment-type-btn:hover {
   border-color: var(--primary-gold);
   transform: translateY(-2px);
}

.payment-type-btn .icon {
   font-size: 1.5rem;
}

.payment-type-btn .text {
   font-weight: 600;
   color: var(--deep-blue);
}

.payment-type-btn .discount {
   font-size: 0.8rem;
   color: #27ae60;
   font-weight: 700;
}

/* خيارات الأقساط */
.installments-options {
   display: grid;
   grid-template-columns: repeat(4, 1fr) auto;
   gap: var(--spacing-sm);
   align-items: center;
}

.installment-btn {
   padding: 10px;
   background: white;
   border: 2px solid #e0e0e0;
   border-radius: 8px;
   font-weight: 600;
   color: var(--deep-blue);
   cursor: pointer;
   transition: var(--transition-smooth);
}

.installment-btn:hover,
.installment-btn.active {
   background: var(--primary-gold);
   border-color: var(--primary-gold);
   color: white;
}

.custom-installment {
   display: flex;
   align-items: center;
   gap: 10px;
}

.custom-installment label {
   font-size: 0.9rem;
   color: #666;
}

.custom-months {
   width: 80px;
   padding: 8px;
   border: 2px solid #e0e0e0;
   border-radius: 6px;
   text-align: center;
}

/* تاريخ البدء */
.start-date-input {
   width: 100%;
   padding: 10px 15px;
   border: 2px solid #e0e0e0;
   border-radius: 8px;
   font-size: 1rem;
   transition: var(--transition-smooth);
}

.start-date-input:focus {
   border-color: var(--primary-gold);
   outline: none;
}

/* نتيجة الحاسبة */
.calculator-result {
   margin-top: var(--spacing-lg);
}

.result-box {
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: white;
   padding: var(--spacing-lg);
   border-radius: 15px;
   text-align: center;
   box-shadow: var(--shadow-glow);
}

.result-title {
   font-size: 1.2rem;
   margin-bottom: var(--spacing-sm);
}

.result-amount {
   font-size: 2.5rem;
   font-weight: 700;
   margin-bottom: var(--spacing-md);
}

.amount-value {
   font-size: 1.2em;
}

.amount-currency {
   font-size: 0.8em;
}

.confirm-plan-btn {
   background: white;
   color: var(--deep-blue);
   padding: 15px 40px;
   border: none;
   border-radius: 25px;
   font-weight: 600;
   font-size: 1.1rem;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.confirm-plan-btn:hover {
   transform: scale(1.05);
   box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

/* ========================================
  الجدول المقارن الشامل
  ======================================== */

.comprehensive-pricing-table {
   background: white;
   border-radius: 20px;
   padding: var(--spacing-lg);
   margin: var(--spacing-xl) 0;
   box-shadow: var(--shadow-medium);
}

.table-title {
   font-size: 1.5rem;
   color: var(--deep-blue);
   text-align: center;
   margin-bottom: var(--spacing-sm);
}

.table-subtitle {
   text-align: center;
   color: #666;
   margin-bottom: var(--spacing-lg);
}

.table-container {
   overflow-x: auto;
   border-radius: 10px;
   box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}

.pricing-comparison-table {
   width: 100%;
   min-width: 800px;
   border-collapse: separate;
   border-spacing: 0;
   background: white;
}

.pricing-comparison-table th,
.pricing-comparison-table td {
   padding: 15px;
   text-align: center;
   border: 1px solid #e0e0e0;
}

.pricing-comparison-table thead th {
   background: linear-gradient(135deg, var(--deep-blue), #2d4a9e);
   color: white;
   font-weight: 600;
   position: sticky;
   top: 0;
   z-index: 10;
}

.main-header th {
   border-bottom: 2px solid rgba(255,255,255,0.3);
}

.time-column {
   background: var(--deep-blue) !important;
   font-weight: 700;
}

.individual-header,
.group-header {
   font-size: 1.1rem;
}

.payment-method {
   font-size: 0.9rem;
   font-weight: 400;
}

.pricing-comparison-table tbody tr {
   transition: var(--transition-smooth);
}

.pricing-comparison-table tbody tr:hover {
   background: rgba(255,215,0,0.05);
}

.pricing-comparison-table tbody tr:nth-child(even) {
   background: #f8f9fa;
}

.pricing-comparison-table tbody td:first-child {
   font-weight: 600;
   text-align: right;
   background: #f8f9fa;
   position: sticky;
   right: 0;
   z-index: 5;
}

/* أسعار في الجدول */
.price-cell {
   font-weight: 600;
   color: var(--deep-blue);
   font-size: 1.1rem;
}

.price-cell.discounted {
   color: #27ae60;
}

.price-cell.best-offer {
   background: rgba(255,215,0,0.2);
   position: relative;
}

.price-cell.best-offer::after {
   content: '⭐';
   position: absolute;
   top: 5px;
   left: 5px;
   font-size: 0.8rem;
}

/* شرح الجدول */
.table-legend {
   display: flex;
   justify-content: center;
   gap: var(--spacing-lg);
   margin-top: var(--spacing-md);
   flex-wrap: wrap;
}

.legend-item {
   display: flex;
   align-items: center;
   gap: 10px;
   font-size: 0.9rem;
   color: #666;
}

.legend-icon {
   font-size: 1.2rem;
}

/* ========================================
  العروض المفاجئة
  ======================================== */

.surprise-offers-section {
   margin: var(--spacing-lg) 0;
}

/* عرض الوقت المحدود */
.limited-time-offer {
   background: linear-gradient(135deg, #e74c3c, #c0392b);
   color: white;
   border-radius: 15px;
   padding: var(--spacing-md);
   text-align: center;
   margin-bottom: var(--spacing-md);
   position: relative;
   overflow: hidden;
}

.limited-time-offer::before {
   content: '';
   position: absolute;
   top: -50%;
   right: -50%;
   width: 200%;
   height: 200%;
   background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
   animation: rotate-slow 15s linear infinite;
}

.offer-container {
   position: relative;
   z-index: 1;
}

.offer-title {
   font-size: 1.5rem;
   font-weight: 700;
   margin-bottom: var(--spacing-sm);
   animation: flash 1s ease-in-out infinite;
}

@keyframes flash {
   0%, 100% { opacity: 1; }
   50% { opacity: 0.8; }
}

.offer-description {
   font-size: 1.1rem;
   margin-bottom: var(--spacing-md);
}

.countdown-timer {
   display: inline-flex;
   align-items: center;
   gap: 10px;
   background: rgba(0,0,0,0.2);
   padding: 10px 20px;
   border-radius: 25px;
   font-size: 1.5rem;
   font-weight: 700;
   margin-bottom: var(--spacing-md);
}

.timer-value {
   font-family: 'Courier New', monospace;
}

.claim-offer-btn {
   background: white;
   color: #e74c3c;
   padding: 12px 30px;
   border: none;
   border-radius: 25px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
   animation: pulse-button 2s ease-in-out infinite;
}

@keyframes pulse-button {
   0%, 100% { transform: scale(1); }
   50% { transform: scale(1.05); }
}

.claim-offer-btn:hover {
   transform: scale(1.1);
   box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

/* عرض الحظ */
.lucky-offer {
   background: linear-gradient(135deg, #9b59b6, #8e44ad);
   color: white;
   border-radius: 15px;
   padding: var(--spacing-md);
   text-align: center;
   position: relative;
   overflow: hidden;
}

.lucky-container {
   position: relative;
   z-index: 1;
}

.lucky-title {
   font-size: 1.5rem;
   font-weight: 700;
   margin-bottom: var(--spacing-md);
}

.spin-wheel-btn {
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
   padding: 15px 40px;
   border: none;
   border-radius: 25px;
   font-weight: 600;
   font-size: 1.1rem;
   cursor: pointer;
   transition: var(--transition-smooth);
   position: relative;
   overflow: hidden;
}

.spin-wheel-btn::before {
   content: '🎰';
   position: absolute;
   top: 50%;
   right: -30px;
   transform: translateY(-50%);
   font-size: 1.5rem;
   animation: slide-emoji 2s ease-in-out infinite;
}

@keyframes slide-emoji {
   0% { right: -30px; }
   50% { right: 15px; }
   100% { right: -30px; }
}

.spin-wheel-btn:hover {
   transform: scale(1.05);
   box-shadow: var(--shadow-glow);
}

.lucky-result {
   margin-top: var(--spacing-md);
   padding: var(--spacing-md);
   background: rgba(255,255,255,0.2);
   border-radius: 10px;
   animation: zoom-in 0.5s ease-out;
}

@keyframes zoom-in {
   from {
       opacity: 0;
       transform: scale(0.5);
   }
   to {
       opacity: 1;
       transform: scale(1);
   }
}

.result-icon {
   font-size: 3rem;
   display: block;
   margin-bottom: var(--spacing-sm);
}

.result-text {
   font-size: 1.2rem;
   font-weight: 600;
}

/* ========================================
  الإثبات الاجتماعي
  ======================================== */

.social-proof-section {
   background: white;
   border-radius: 15px;
   padding: var(--spacing-md);
   margin: var(--spacing-lg) 0;
   box-shadow: var(--shadow-soft);
}

.proof-title {
   font-size: 1.2rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-md);
   text-align: center;
}

.recent-enrollments {
   display: grid;
   gap: var(--spacing-sm);
}

.enrollment-item {
   display: grid;
   grid-template-columns: 2fr 1fr 1fr;
   gap: var(--spacing-sm);
   padding: var(--spacing-sm);
   background: #f8f9fa;
   border-radius: 8px;
   align-items: center;
   animation: slide-in-right 0.5s ease-out;
}

@keyframes slide-in-right {
   from {
       opacity: 0;
       transform: translateX(20px);
   }
   to {
       opacity: 1;
       transform: translateX(0);
   }
}

.enrollment-item:nth-child(even) {
   background: #e9ecef;
}

.student-name {
   font-weight: 600;
   color: var(--deep-blue);
}

.enrollment-time {
   color: #666;
   font-size: 0.9rem;
}

.enrollment-type {
   color: #27ae60;
   font-size: 0.9rem;
   font-style: italic;
}

.update-notice {
   text-align: center;
   color: #666;
   font-size: 0.8rem;
   margin-top: var(--spacing-sm);
   opacity: 0.7;
}

/* ========================================
  مؤشر المقاعد المتبقية
  ======================================== */

.seats-indicator {
   text-align: center;
   margin: var(--spacing-lg) 0;
}

.seats-title {
   font-size: 1.2rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
}

.seats-hearts {
   display: flex;
   justify-content: center;
   gap: 10px;
   margin-bottom: var(--spacing-sm);
}

.seat-heart {
   font-size: 2rem;
   transition: var(--transition-smooth);
}

.seat-heart.available {
   color: var(--primary-gold);
   animation: heartbeat 1.5s ease-in-out infinite;
   animation-delay: calc(var(--heart-index) * 0.1s);
}

.seat-heart.taken {
   color: #e0e0e0;
   opacity: 0.5;
}

.seats-text {
   color: #666;
}

.available-seats,
.total-seats {
   font-weight: 700;
   color: var(--deep-blue);
}

/* ========================================
  الرسائل التحفيزية
  ======================================== */

.motivational-messages {
   text-align: center;
   margin: var(--spacing-lg) 0;
   height: 60px;
   display: flex;
   align-items: center;
   justify-content: center;
   position: relative;
   overflow: hidden;
}

.message {
   position: absolute;
   width: 100%;
   font-size: 1.1rem;
   color: var(--deep-blue);
   font-style: italic;
   opacity: 0;
   transform: translateY(20px);
   transition: all 0.5s ease-out;
}

.message.active {
   opacity: 1;
   transform: translateY(0);
}

/* ========================================
  ختم الثقة والضمانات
  ======================================== */

.trust-badges {
   background: linear-gradient(135deg, #f5f7fa, #e9ecef);
   border-radius: 15px;
   padding: var(--spacing-lg);
   margin: var(--spacing-lg) 0;
}

.badges-title {
   font-size: 1.3rem;
   color: var(--deep-blue);
   text-align: center;
   margin-bottom: var(--spacing-md);
}

.badges-list {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
   gap: var(--spacing-md);
}

.badge-item {
   display: flex;
   align-items: center;
   gap: 15px;
   padding: var(--spacing-sm);
   background: white;
   border-radius: 10px;
   box-shadow: var(--shadow-soft);
   transition: var(--transition-smooth);
}

.badge-item:hover {
   transform: translateY(-3px);
   box-shadow: var(--shadow-medium);
}

.badge-icon {
   width: 40px;
   height: 40px;
   background: var(--primary-gold);
   color: white;
   border-radius: 50%;
   display: flex;
   align-items: center;
   justify-content: center;
   font-weight: 700;
   flex-shrink: 0;
}

.badge-text {
   color: var(--deep-blue);
   font-weight: 600;
}

/* ========================================
  أزرار الإجراءات الرئيسية
  ======================================== */

.main-action-buttons {
   display: flex;
   gap: var(--spacing-md);
   justify-content: center;
   margin: var(--spacing-xl) 0;
   flex-wrap: wrap;
}

.main-book-btn,
.main-grant-btn,
.main-waiting-btn {
   padding: 20px 40px;
   border: none;
   border-radius: 30px;
   font-size: 1.2rem;
   font-weight: 700;
   cursor: pointer;
   transition: var(--transition-smooth);
   display: flex;
   align-items: center;
   gap: 15px;
   position: relative;
   overflow: hidden;
}

.main-book-btn {
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
   box-shadow: 0 5px 20px rgba(255,215,0,0.3);
}

.main-grant-btn {
   background: linear-gradient(135deg, #27ae60, #2ecc71);
   color: white;
   box-shadow: 0 5px 20px rgba(39,174,96,0.3);
}

.main-waiting-btn {
   background: linear-gradient(135deg, #3498db, #2980b9);
   color: white;
   box-shadow: 0 5px 20px rgba(52,152,219,0.3);
}

.main-book-btn:hover,
.main-grant-btn:hover,
.main-waiting-btn:hover {
   transform: translateY(-5px) scale(1.05);
   box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

/* تأثير الموجة عند الضغط */
.main-book-btn::after,
.main-grant-btn::after,
.main-waiting-btn::after {
   content: '';
   position: absolute;
   top: 50%;
   left: 50%;
   width: 0;
   height: 0;
   border-radius: 50%;
   background: rgba(255,255,255,0.5);
   transform: translate(-50%, -50%);
   transition: width 0.6s, height 0.6s;
}

.main-book-btn:active::after,
.main-grant-btn:active::after,
.main-waiting-btn:active::after {
   width: 400px;
   height: 400px;
}

.btn-icon {
   font-size: 1.5rem;
}

.btn-text {
   font-size: 1.1rem;
}

/* ========================================
  نافذة طلب المنحة
  ======================================== */

.grant-application-modal {
   position: fixed;
   top: 0;
   left: 0;
   right: 0;
   bottom: 0;
   z-index: 1000;
   display: flex;
   align-items: center;
   justify-content: center;
   padding: var(--spacing-md);
}

.modal-overlay {
   position: absolute;
   inset: 0;
   background: rgba(0,0,0,0.7);
   backdrop-filter: blur(5px);
   animation: fade-in 0.3s ease-out;
}

.modal-content {
   background: white;
   border-radius: 20px;
   max-width: 600px;
   width: 100%;
   max-height: 90vh;
   overflow-y: auto;
   position: relative;
   z-index: 1;
   animation: slide-up 0.3s ease-out;
}

@keyframes slide-up {
   from {
       opacity: 0;
       transform: translateY(50px);
   }
   to {
       opacity: 1;
       transform: translateY(0);
   }
}

.close-modal-btn {
   position: absolute;
   top: 20px;
   left: 20px;
   width: 40px;
   height: 40px;
   background: #f8f9fa;
   border: none;
   border-radius: 50%;
   font-size: 1.5rem;
   cursor: pointer;
   transition: var(--transition-smooth);
   display: flex;
   align-items: center;
   justify-content: center;
}

.close-modal-btn:hover {
   background: #e74c3c;
   color: white;
   transform: rotate(90deg);
}

.modal-header {
   background: linear-gradient(135deg, var(--deep-blue), #2d4a9e);
   color: white;
   padding: var(--spacing-lg);
   text-align: center;
   border-radius: 20px 20px 0 0;
}

.modal-title {
   font-size: 1.8rem;
   margin-bottom: var(--spacing-sm);
}

.modal-subtitle {
   font-size: 1.1rem;
   opacity: 0.9;
}

.modal-body {
   padding: var(--spacing-lg);
}

.grant-philosophy {
   background: #f8f9fa;
   border-radius: 10px;
   padding: var(--spacing-md);
   margin-bottom: var(--spacing-md);
}

.grant-philosophy p {
   margin: var(--spacing-sm) 0;
   color: var(--deep-blue);
   font-weight: 500;
}

.grant-availability-modal h4 {
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
}

.availability-list {
   list-style: none;
   padding: 0;
}

.availability-list li {
   padding: var(--spacing-sm) 0;
   color: #666;
}

.modal-actions {
   display: flex;
   gap: var(--spacing-sm);
   margin-top: var(--spacing-lg);
}

.start-application-btn {
   flex: 1;
   padding: 15px;
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
   border: none;
   border-radius: 10px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.not-now-btn {
   flex: 1;
   padding: 15px;
   background: white;
   color: var(--deep-blue);
   border: 2px solid var(--deep-blue);
   border-radius: 10px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.start-application-btn:hover {
   transform: translateY(-2px);
   box-shadow: 0 5px 20px rgba(255,215,0,0.4);
}

.not-now-btn:hover {
   background: var(--deep-blue);
   color: white;
}

/* ========================================
  استمارة طلب المنحة
  ======================================== */

.grant-form-container {
   position: fixed;
   top: 0;
   left: 0;
   right: 0;
   bottom: 0;
   background: white;
   z-index: 1100;
   overflow-y: auto;
   animation: slide-in-right 0.3s ease-out;
}

/* شريط التقدم */
.form-progress {
   background: #f8f9fa;
   padding: var(--spacing-md);
   position: sticky;
   top: 0;
   z-index: 100;
   box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.progress-bar {
   height: 10px;
   background: #e0e0e0;
   border-radius: 5px;
   margin-bottom: var(--spacing-md);
   overflow: hidden;
}

.progress-fill {
   height: 100%;
   background: linear-gradient(90deg, var(--primary-gold), var(--deep-blue));
   transition: width 0.5s ease-out;
}

.progress-steps {
   display: flex;
   justify-content: space-between;
}

.step {
   display: flex;
   flex-direction: column;
   align-items: center;
   gap: 5px;
   opacity: 0.5;
   transition: var(--transition-smooth);
}

.step.active {
   opacity: 1;
}

.step-number {
   width: 40px;
   height: 40px;
   background: white;
   border: 3px solid #e0e0e0;
   border-radius: 50%;
   display: flex;
   align-items: center;
   justify-content: center;
   font-weight: 700;
   color: #666;
   transition: var(--transition-smooth);
}

.step.active .step-number {
   background: var(--primary-gold);
   border-color: var(--primary-gold);
   color: white;
}

.step-name {
   font-size: 0.8rem;
   color: #666;
   text-align: center;
}

/* نموذج المنحة */
.grant-form {
   max-width: 800px;
   margin: 0 auto;
   padding: var(--spacing-lg);
}

.form-step {
   display: none;
   animation: fade-in 0.5s ease-out;
}

.form-step.active {
   display: block;
}

.step-title {
   font-size: 1.8rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
}

.step-description {
   color: #666;
   margin-bottom: var(--spacing-lg);
}

/* حقول النموذج */
.form-row {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
   gap: var(--spacing-md);
   margin-bottom: var(--spacing-md);
}

.form-group {
   margin-bottom: var(--spacing-md);
}

.form-group label {
   display: block;
   margin-bottom: var(--spacing-sm);
   color: var(--deep-blue);
   font-weight: 600;
}

.required {
   color: #e74c3c;
}

.form-input,
.form-select,
.form-textarea {
   width: 100%;
   padding: 12px 15px;
   border: 2px solid #e0e0e0;
   border-radius: 8px;
   font-size: 1rem;
   transition: var(--transition-smooth);
   background: white;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
   border-color: var(--primary-gold);
   outline: none;
   box-shadow: 0 0 0 3px rgba(255,215,0,0.1);
}

.form-textarea {
   resize: vertical;
   min-height: 100px;
}

.form-textarea.large {
   min-height: 150px;
}

.textarea-prompt {
   background: #f8f9fa;
   border-radius: 8px;
   padding: var(--spacing-sm);
   margin-bottom: var(--spacing-sm);
   color: #666;
   font-style: italic;
}

/* عداد الأحرف */
.char-counter {
   text-align: left;
   font-size: 0.8rem;
   color: #666;
   margin-top: 5px;
}
/* تكملة عداد الأحرف */
.char-counter .current-chars {
   font-weight: 600;
   color: var(--deep-blue);
}

.char-counter.exceeded .current-chars {
   color: #e74c3c;
}

/* مربعات الاختيار */
.checkbox-label,
.radio-label {
   display: flex;
   align-items: center;
   gap: 10px;
   padding: 10px;
   margin-bottom: var(--spacing-sm);
   background: #f8f9fa;
   border-radius: 8px;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.checkbox-label:hover,
.radio-label:hover {
   background: #e9ecef;
}

.checkbox-label input[type="checkbox"],
.radio-label input[type="radio"] {
   width: 20px;
   height: 20px;
   flex-shrink: 0;
   accent-color: var(--primary-gold);
}

.checkbox-text,
.radio-text {
   color: var(--deep-blue);
}

/* الالتزامات المالية */
.financial-obligations {
   background: #f8f9fa;
   border-radius: 10px;
   padding: var(--spacing-md);
}

.obligation-item {
   display: flex;
   align-items: center;
   gap: 10px;
   margin-bottom: var(--spacing-sm);
}

.obligation-item label {
   display: flex;
   align-items: center;
   gap: 10px;
   margin-bottom: 0;
}

.amount-input {
   width: 100px;
   padding: 8px;
   border: 2px solid #e0e0e0;
   border-radius: 6px;
   text-align: center;
   font-weight: 600;
}

.obligation-total {
   margin-top: var(--spacing-md);
   padding-top: var(--spacing-md);
   border-top: 2px solid #e0e0e0;
   display: flex;
   justify-content: space-between;
   align-items: center;
   font-weight: 700;
   color: var(--deep-blue);
}

.total-amount {
   font-size: 1.2rem;
   color: var(--primary-gold);
}

/* شريط المبلغ المتاح */
.slider-container {
   margin-top: var(--spacing-sm);
}

.amount-slider {
   width: 100%;
   height: 10px;
   -webkit-appearance: none;
   background: #e0e0e0;
   border-radius: 5px;
   outline: none;
   position: relative;
}

.amount-slider::-webkit-slider-thumb {
   -webkit-appearance: none;
   width: 25px;
   height: 25px;
   background: var(--primary-gold);
   border-radius: 50%;
   cursor: pointer;
   box-shadow: var(--shadow-soft);
}

.amount-slider::-webkit-slider-thumb:hover {
   transform: scale(1.2);
   box-shadow: var(--shadow-glow);
}

.slider-labels {
   display: flex;
   justify-content: space-between;
   margin-top: var(--spacing-sm);
   font-size: 0.9rem;
   color: #666;
}

.slider-labels .current-value {
   position: absolute;
   left: 50%;
   transform: translateX(-50%);
   background: var(--primary-gold);
   color: white;
   padding: 5px 15px;
   border-radius: 20px;
   font-weight: 600;
}

/* خيارات الدعم */
.support-options {
   display: grid;
   gap: var(--spacing-sm);
}

.support-option-label {
   display: block;
   padding: var(--spacing-md);
   background: white;
   border: 2px solid #e0e0e0;
   border-radius: 10px;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.support-option-label:hover {
   border-color: var(--primary-gold);
}

.support-option-label input[type="checkbox"]:checked + .option-content {
   background: rgba(255,215,0,0.05);
}

.option-content {
   padding: 10px;
}

.option-title {
   font-weight: 600;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-sm);
}

.reason-input,
.custom-plan-input {
   width: 100%;
   padding: 10px;
   border: 2px solid #e0e0e0;
   border-radius: 6px;
   margin-top: var(--spacing-sm);
}

.percentage-input,
.months-input,
.defer-input {
   display: flex;
   align-items: center;
   gap: 10px;
   margin-top: var(--spacing-sm);
}

.percentage-input input,
.months-input input,
.defer-input input {
   width: 80px;
   padding: 8px;
   border: 2px solid #e0e0e0;
   border-radius: 6px;
   text-align: center;
}

/* خيارات المهارات */
.services-options {
   margin-top: var(--spacing-sm);
}

.skills-checkboxes {
   margin-right: 30px;
   margin-top: var(--spacing-sm);
   padding: var(--spacing-sm);
   background: #f8f9fa;
   border-radius: 8px;
}

.other-skills-input {
   width: 200px;
   padding: 5px 10px;
   border: 1px solid #e0e0e0;
   border-radius: 6px;
   margin-right: 10px;
}

/* الملخص والمراجعة */
.summary-section {
   margin-bottom: var(--spacing-lg);
}

.summary-section h4 {
   color: var(--deep-blue);
   margin-bottom: var(--spacing-md);
}

.summary-box {
   background: #f8f9fa;
   border-radius: 10px;
   padding: var(--spacing-md);
}

.summary-item {
   display: grid;
   grid-template-columns: 150px 1fr;
   gap: var(--spacing-sm);
   padding: var(--spacing-sm) 0;
   border-bottom: 1px solid #e0e0e0;
}

.summary-item:last-child {
   border-bottom: none;
}

.summary-label {
   font-weight: 600;
   color: #666;
}

.summary-value {
   color: var(--deep-blue);
   font-weight: 500;
}

/* الموافقات */
.agreements-section {
   margin-bottom: var(--spacing-lg);
}

.agreement-checkboxes {
   background: #fff3cd;
   border: 1px solid #ffeaa7;
   border-radius: 10px;
   padding: var(--spacing-md);
}

.agreement-checkboxes .checkbox-label {
   background: white;
}

/* إشعار الخصوصية */
.privacy-notice {
   display: flex;
   align-items: center;
   gap: 10px;
   padding: var(--spacing-md);
   background: #d1ecf1;
   border: 1px solid #bee5eb;
   border-radius: 10px;
   margin-bottom: var(--spacing-md);
}

.notice-icon {
   font-size: 1.5rem;
}

.notice-text {
   color: #0c5460;
}

/* أزرار التنقل في النموذج */
.form-navigation {
   display: flex;
   gap: var(--spacing-sm);
   margin-top: var(--spacing-lg);
   padding-top: var(--spacing-lg);
   border-top: 1px solid #e0e0e0;
}

.prev-step-btn,
.next-step-btn,
.submit-application-btn,
.cancel-form-btn {
   flex: 1;
   padding: 15px;
   border: none;
   border-radius: 10px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.prev-step-btn,
.cancel-form-btn {
   background: white;
   color: var(--deep-blue);
   border: 2px solid var(--deep-blue);
}

.next-step-btn,
.submit-application-btn {
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
}

.prev-step-btn:hover,
.cancel-form-btn:hover {
   background: var(--deep-blue);
   color: white;
}

.next-step-btn:hover,
.submit-application-btn:hover {
   transform: translateY(-2px);
   box-shadow: 0 5px 20px rgba(255,215,0,0.4);
}

/* رسائل النجاح والخطأ */
.application-messages {
   position: fixed;
   top: 0;
   left: 0;
   right: 0;
   bottom: 0;
   background: rgba(0,0,0,0.7);
   backdrop-filter: blur(5px);
   display: flex;
   align-items: center;
   justify-content: center;
   z-index: 1200;
   padding: var(--spacing-md);
}

.success-message,
.error-message {
   background: white;
   border-radius: 20px;
   padding: var(--spacing-xl);
   max-width: 500px;
   width: 100%;
   text-align: center;
   animation: bounce-in 0.5s ease-out;
}

@keyframes bounce-in {
   0% {
       opacity: 0;
       transform: scale(0.5);
   }
   70% {
       transform: scale(1.05);
   }
   100% {
       opacity: 1;
       transform: scale(1);
   }
}

.message-icon {
   font-size: 4rem;
   margin-bottom: var(--spacing-md);
}

.message-title {
   font-size: 1.5rem;
   color: var(--deep-blue);
   margin-bottom: var(--spacing-md);
}

.message-content {
   color: #666;
   margin-bottom: var(--spacing-lg);
}

.message-content h4 {
   color: var(--deep-blue);
   margin: var(--spacing-md) 0 var(--spacing-sm);
}

.message-content ol {
   text-align: right;
   padding-right: 20px;
}

.message-content .tip {
   background: #f8f9fa;
   padding: var(--spacing-sm);
   border-radius: 8px;
   margin-top: var(--spacing-md);
}

.application-number {
   font-weight: 700;
   color: var(--primary-gold);
   font-size: 1.2em;
}

.close-success-btn,
.retry-btn {
   padding: 15px 40px;
   background: linear-gradient(135deg, var(--primary-gold), #f0c000);
   color: var(--deep-blue);
   border: none;
   border-radius: 25px;
   font-weight: 600;
   cursor: pointer;
   transition: var(--transition-smooth);
}

.close-success-btn:hover,
.retry-btn:hover {
   transform: translateY(-2px);
   box-shadow: 0 5px 20px rgba(255,215,0,0.4);
}

.error-text {
   color: #e74c3c;
   font-weight: 500;
}

/* ========================================
  التجاوب (Responsive)
  ======================================== */

/* شاشات التابلت */
@media (max-width: 768px) {
   .investment-container {
       padding: var(--spacing-md);
   }
   
   .investment-title {
       font-size: 2rem;
   }
   
   .journey-cards-container {
       grid-template-columns: 1fr;
   }
   
   .payment-wheel {
       width: 250px;
       height: 250px;
   }
   
   .payment-option {
       width: 100px;
       height: 100px;
   }
   
   .table-container {
       border-radius: 0;
   }
   
   .form-row {
       grid-template-columns: 1fr;
   }
   
   .main-action-buttons {
       flex-direction: column;
   }
   
   .main-book-btn,
   .main-grant-btn,
   .main-waiting-btn {
       width: 100%;
   }
}

/* شاشات الموبايل */
@media (max-width: 480px) {
   :root {
       --spacing-sm: 0.75rem;
       --spacing-md: 1.5rem;
       --spacing-lg: 2rem;
       --spacing-xl: 3rem;
   }
   
   .investment-title {
       font-size: 1.5rem;
   }
   
   .investment-subtitle {
       font-size: 1rem;
   }
   
   .heart-logo {
       width: 60px;
       height: 60px;
   }
   
   .card-icon {
       width: 60px;
       height: 60px;
   }
   
   .card-icon svg {
       width: 35px;
       height: 35px;
   }
   
   .payment-wheel {
       width: 200px;
       height: 200px;
   }
   
   .payment-option {
       width: 80px;
       height: 80px;
       font-size: 0.8rem;
   }
   
   .option-icon {
       font-size: 1.5rem;
   }
   
   .time-offers-slider {
       gap: var(--spacing-sm);
   }
   
   .offer-option {
       flex: 0 0 150px;
   }
   
   .pricing-comparison-table {
       font-size: 0.9rem;
   }
   
   .pricing-comparison-table th,
   .pricing-comparison-table td {
       padding: 10px 5px;
   }
   
   .progress-steps {
       gap: 5px;
   }
   
   .step-number {
       width: 30px;
       height: 30px;
       font-size: 0.9rem;
   }
   
   .step-name {
       font-size: 0.7rem;
   }
   
   .modal-content {
       border-radius: 15px;
   }
   
   .modal-title {
       font-size: 1.5rem;
   }
   
   .step-title {
       font-size: 1.5rem;
   }
   
   .amount-input {
       width: 80px;
   }
   
   .summary-item {
       grid-template-columns: 120px 1fr;
   }
}

/* تحسينات الطباعة */
@media print {
   .investment-container {
       background: white;
       box-shadow: none;
   }
   
   .heart-logo-container,
   .surprise-offers-section,
   .social-proof-section,
   .motivational-messages,
   .modal-overlay,
   .form-navigation,
   .main-action-buttons {
       display: none !important;
   }
   
   .pricing-comparison-table {
       break-inside: avoid;
   }
}

/* ========================================
  حركات إضافية وتأثيرات خاصة
  ======================================== */

/* تأثير التموج */
@keyframes ripple {
   to {
       transform: scale(4);
       opacity: 0;
   }
}

.ripple-effect {
   position: absolute;
   border-radius: 50%;
   background: rgba(255,255,255,0.5);
   transform: scale(0);
   animation: ripple 0.6s ease-out;
}

/* تأثير النبض المستمر */
@keyframes continuous-pulse {
   0%, 100% {
       box-shadow: 0 0 0 0 rgba(255,215,0,0.4);
   }
   50% {
       box-shadow: 0 0 0 20px rgba(255,215,0,0);
   }
}

.pulse-continuous {
   animation: continuous-pulse 2s ease-in-out infinite;
}

/* تأثير اللمعان */
@keyframes shimmer {
   0% {
       background-position: -1000px 0;
   }
   100% {
       background-position: 1000px 0;
   }
}

.shimmer-effect {
   background: linear-gradient(
       90deg,
       transparent,
       rgba(255,255,255,0.3),
       transparent
   );
   background-size: 1000px 100%;
   animation: shimmer 3s infinite;
}

/* تأثير الاهتزاز */
@keyframes shake {
   0%, 100% { transform: translateX(0); }
   25% { transform: translateX(-5px); }
   75% { transform: translateX(5px); }
}

.shake-animation {
   animation: shake 0.5s ease-in-out;
}

/* تأثير التوهج */
@keyframes glow {
   0%, 100% {
       filter: brightness(1);
   }
   50% {
       filter: brightness(1.2) drop-shadow(0 0 20px rgba(255,215,0,0.5));
   }
}

.glow-effect {
   animation: glow 2s ease-in-out infinite;
}

/* ========================================
  حالات خاصة وتعديلات نهائية
  ======================================== */

/* عند تعطيل JavaScript */
.no-js .investment-container {
   display: block !important;
}

.no-js .journey-details-container,
.no-js .smart-calculator-section,
.no-js .comprehensive-pricing-table,
.no-js .surprise-offers-section {
   display: block !important;
}

.no-js .journey-details {
   display: block !important;
}

/* طباعة الأسعار بالعربية */
.price-rtl {
   direction: rtl;
   font-family: 'Cairo', sans-serif;
}

/* تحسين الألوان للوضع الليلي (إن أردت إضافته لاحقاً) */
@media (prefers-color-scheme: dark) {
   /* يمكن إضافة أنماط الوضع الليلي هنا */
}

        /* ===== Toast Notifications ===== */
.success-toast,
.error-toast {
   position: fixed;
   top: 20px;
   right: 20px;
   padding: 15px 25px;
   border-radius: 10px;
   color: white;
   font-weight: 600;
   opacity: 0;
   transform: translateX(100%);
   transition: all 0.3s ease;
   z-index: 9999;
}

.success-toast {
   background: #27ae60;
}

.error-toast {
   background: #e74c3c;
}

.success-toast.show,
.error-toast.show {
   opacity: 1;
   transform: translateX(0);
}

.investment-error-message {
   text-align: center;
   padding: 50px;
}

.error-icon {
   font-size: 4rem;
   margin-bottom: 20px;
}

.error-text {
   font-size: 1.2rem;
   color: #666;
   margin-bottom: 30px;
}

.retry-button {
   padding: 12px 30px;
   background: var(--primary-gold);
   color: var(--deep-blue);
   border: none;
   border-radius: 25px;
   font-weight: 600;
   cursor: pointer;
   transition: all 0.3s ease;
}

.retry-button:hover {
   transform: scale(1.05);
   box-shadow: 0 5px 20px rgba(255,215,0,0.4);
}

/* نهاية ملف CSS لقسم الاستثمار */

        
        /* [CSS SECTION END] */
    </style>
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <header class="investment-header">
        <div class="header-content">
            <a href="#" class="back-btn" id="backToCourse">
                <i class="fas fa-arrow-right"></i>
                <span>العودة للدورة</span>
            </a>
            <h1 class="course-title-header" id="courseHeaderTitle">جاري التحميل...</h1>
        </div>
    </header>

   <!-- الحاوي الرئيسي للصفحة -->
    <div class="investment-page-container">
        
        <!-- شاشة التحميل الأولية -->
        <div class="loading-container" id="loadingScreen">
            <div class="loading-heart"></div>
            <p class="loading-text">جاري تحضير رحلتك الاستثمارية...</p>
        </div>

        <!-- المحتوى الرئيسي -->
        <div class="investment-wrapper" id="mainContent" style="display: none;">
            
            <!-- قسم الاستثمار الرئيسي -->
            <div class="investment-container">
                
                <!-- الهيدر الرئيسي مع القلب النابض -->
                <div class="investment-header-section">
                    <div class="heart-logo-container">
                        <svg class="heart-logo pulsing" width="120" height="120" viewBox="0 0 200 200">
                            <!-- القلب المركزي -->
                            <circle cx="100" cy="100" r="35" class="central-heart" fill="#FFD700">
                                <animate attributeName="r" values="35;40;35" dur="1.5s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- الخطوط التسعة للأشواق -->
                            <g class="longing-lines">
                                <path d="M100,70 Q120,40 150,30" class="longing-line line-1" stroke="#8B1A1A" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="0s" repeatCount="indefinite"/>
                                </path>
                                <path d="M130,85 Q160,75 180,80" class="longing-line line-2" stroke="#FF69B4" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="0.3s" repeatCount="indefinite"/>
                                </path>
                                <path d="M130,115 Q160,125 180,120" class="longing-line line-3" stroke="#FF8C00" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="0.6s" repeatCount="indefinite"/>
                                </path>
                                <path d="M100,130 Q120,160 150,170" class="longing-line line-4" stroke="#9370DB" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="0.9s" repeatCount="indefinite"/>
                                </path>
                                <path d="M70,130 Q50,160 20,170" class="longing-line line-5" stroke="#228B22" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="1.2s" repeatCount="indefinite"/>
                                </path>
                                <path d="M40,115 Q10,125 0,120" class="longing-line line-6" stroke="#87CEEB" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="1.5s" repeatCount="indefinite"/>
                                </path>
                                <path d="M40,85 Q10,75 0,80" class="longing-line line-7" stroke="#FFD700" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="1.8s" repeatCount="indefinite"/>
                                </path>
                                <path d="M70,70 Q50,40 20,30" class="longing-line line-8" stroke="#DC143C" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="2.1s" repeatCount="indefinite"/>
                                </path>
                                <path d="M100,100 Q100,50 100,20" class="longing-line line-9" stroke="#40E0D0" stroke-width="3" fill="none" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="3s" begin="2.4s" repeatCount="indefinite"/>
                                </path>
                            </g>
                            
                            <!-- دوائر الأشواق -->
                            <g class="longing-hearts">
                                <circle cx="150" cy="30" r="12" class="longing-heart heart-1" fill="#8B1A1A" opacity="0.8"/>
                                <circle cx="180" cy="80" r="12" class="longing-heart heart-2" fill="#FF69B4" opacity="0.8"/>
                                <circle cx="180" cy="120" r="12" class="longing-heart heart-3" fill="#FF8C00" opacity="0.8"/>
                                <circle cx="150" cy="170" r="12" class="longing-heart heart-4" fill="#9370DB" opacity="0.8"/>
                                <circle cx="20" cy="170" r="12" class="longing-heart heart-5" fill="#228B22" opacity="0.8"/>
                                <circle cx="0" cy="120" r="12" class="longing-heart heart-6" fill="#87CEEB" opacity="0.8"/>
                                <circle cx="0" cy="80" r="12" class="longing-heart heart-7" fill="#FFD700" opacity="0.8"/>
                                <circle cx="20" cy="30" r="12" class="longing-heart heart-8" fill="#DC143C" opacity="0.8"/>
                                <circle cx="100" cy="20" r="12" class="longing-heart heart-9" fill="#40E0D0" opacity="0.8"/>
                            </g>
                        </svg>
                    </div>
                    
                    <div class="investment-title-container">
                        <h2 class="investment-title typing-effect">رحلتك التحويلية تبدأ بقرار واحد...</h2>
                        <p class="investment-subtitle fade-in">اختر الطريق الذي يناسبك</p>
                    </div>
                </div>

                <!-- البطاقات التفاعلية الثلاث -->
                <div class="journey-cards-container" id="journeyCards">
                    <!-- بطاقة الرحلة الفردية -->
                    <div class="journey-card individual-journey" data-journey="individual">
                        <div class="card-glow"></div>
                        <div class="card-icon">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" fill="currentColor"/>
                            </svg>
                        </div>
                        <h3 class="card-title">رحلتي الفردية</h3>
                        <p class="card-description">ابدأ رحلتك الشخصية نحو النور</p>
                        <div class="card-preview">
                            <span class="preview-price">يبدأ من <span class="price-amount" id="individualPrice">0</span> ج.م</span>
                        </div>
                        <button class="card-select-btn" data-journey="individual">اختر هذا المسار</button>
                    </div>

                    <!-- بطاقة الرحلة الجماعية -->
                    <div class="journey-card group-journey" data-journey="group">
                        <div class="card-glow"></div>
                        <div class="card-icon">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" fill="currentColor"/>
                            </svg>
                        </div>
                        <h3 class="card-title">رحلتنا الجماعية</h3>
                        <p class="card-description">انضم مع أصدقائك ووفروا معاً</p>
                        <div class="card-preview">
                            <span class="preview-discount">خصومات تصل إلى <span class="discount-amount">40%</span></span>
                        </div>
                        <button class="card-select-btn" data-journey="group">اختر هذا المسار</button>
                    </div>

                    <!-- بطاقة رحلة الدعم -->
                    <div class="journey-card support-journey" data-journey="support">
                        <div class="card-glow"></div>
                        <div class="card-icon">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                                <path d="M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5zM4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25H4.34zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12zm0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7zm7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44zM15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35z" fill="currentColor"/>
                            </svg>
                        </div>
                        <h3 class="card-title">رحلة بالدعم</h3>
                        <p class="card-description">لا يُحرم أحد من النور بسبب المال</p>
                        <div class="card-preview">
                            <span class="preview-support">منح ودعم مرن</span>
                        </div>
                        <button class="card-select-btn" data-journey="support">اختر هذا المسار</button>
                    </div>
                </div>

                <!-- قسم التفاصيل الديناميكي -->
                <div class="journey-details-container" id="journeyDetails" style="display: none;">
                    <!-- سيتم ملؤه ديناميكياً حسب الاختيار -->
                </div>

                <!-- الحاسبة الذكية الموحدة -->
                <div class="smart-calculator-section" id="smartCalculator" style="display: none;">
                    <h3 class="calculator-title">
                        <i class="fas fa-calculator"></i>
                        صمم خطتك المثالية
                    </h3>
                    
                    <div class="calculator-container">
                        <!-- إدخال الكوبون -->
                        <div class="calculator-step coupon-step">
                            <label class="step-label">هل معك كوبون؟</label>
                            <div class="coupon-input-group">
                                <input type="text" class="coupon-input" id="couponInput" placeholder="أدخل الكود" maxlength="20">
                                <button class="apply-coupon-btn" id="applyCouponBtn">
                                    <i class="fas fa-check"></i>
                                    تطبيق
                                </button>
                            </div>
                            <div class="coupon-feedback" id="couponFeedback" style="display: none;"></div>
                        </div>

                        <!-- اختيار طريقة الدفع -->
                        <div class="calculator-step payment-type-step">
                            <label class="step-label">تريد الدفع:</label>
                            <div class="payment-type-buttons">
                                <button class="payment-type-btn active" data-type="cash">
                                    <span class="icon">⚡</span>
                                    <span class="text">فوري</span>
                                    <span class="discount">(-<span class="cash-discount">16</span>%)</span>
                                </button>
                                <button class="payment-type-btn" data-type="installments">
                                    <span class="icon">📅</span>
                                    <span class="text">أقساط</span>
                                </button>
                            </div>
                        </div>

                        <!-- اختيار عدد الأقساط -->
                        <div class="calculator-step installments-step" id="installmentsStep" style="display: none;">
                            <label class="step-label">كم شهر يناسبك؟</label>
                            <div class="installments-options">
                                <button class="installment-btn" data-months="3">3</button>
                                <button class="installment-btn" data-months="6">6</button>
                                <button class="installment-btn" data-months="9">9</button>
                                <button class="installment-btn" data-months="12">12</button>
                                <div class="custom-installment">
                                    <label>مخصص:</label>
                                    <input type="number" class="custom-months" id="customMonths" min="2" max="24" placeholder="عدد الشهور">
                                </div>
                            </div>
                        </div>

                        <!-- النتيجة -->
                        <div class="calculator-result">
                            <div class="result-box">
                                <h4 class="result-title">استثمارك الشهري:</h4>
                                <div class="result-amount">
                                    <span class="amount-value" id="monthlyAmount">0</span>
                                    <span class="amount-currency">ج.م فقط!</span>
                                </div>
                                <button class="confirm-plan-btn" id="confirmPlanBtn">
                                    <i class="fas fa-check-circle"></i>
                                    هذه خطتي - احجز الآن
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- الجدول المقارن الشامل -->
                <div class="comprehensive-pricing-table" id="pricingTable" style="display: none;">
                    <h3 class="table-title">جدول المقارنة الشامل</h3>
                    <p class="table-subtitle">كل الخيارات المتاحة في مكان واحد</p>
                    
                    <div class="table-container">
                        <div id="dynamicPricingTable">
                            <!-- سيتم بناء الجدول ديناميكياً -->
                        </div>
                    </div>
                    
                    <div class="table-legend">
                        <p class="legend-item"><span class="legend-icon">💰</span> جميع الأسعار بالجنيه المصري</p>
                        <p class="legend-item"><span class="legend-icon">📅</span> الأقساط بدون فوائد</p>
                        <p class="legend-item"><span class="legend-icon">🎁</span> العروض قابلة للجمع</p>
                    </div>
                </div>

                <!-- العروض المفاجئة -->
                <div class="surprise-offers-section" id="surpriseOffers">
                    <!-- عرض الوقت المحدود -->
                    <div class="limited-time-offer" id="limitedOffer" style="display: none;">
                        <div class="offer-container">
                            <h4 class="offer-title">⚡ عرض خاص لمدة 15 دقيقة!</h4>
                            <p class="offer-description">خصم إضافي 10% على أي خطة</p>
                            <div class="countdown-timer">
                                <span class="timer-value" id="offerTimer">14:32</span>
                                <span class="timer-icon">⏰</span>
                            </div>
                            <button class="claim-offer-btn" id="claimOfferBtn">احجز قبل انتهاء الوقت</button>
                        </div>
                    </div>

                    <!-- عرض الحظ -->
                    <div class="lucky-offer" id="luckyOffer">
                        <div class="lucky-container">
                            <h4 class="lucky-title">🎰 جرب حظك!</h4>
                            <div class="lucky-wheel">
                                <button class="spin-wheel-btn" id="spinWheelBtn">اضغط للكشف عن عرضك الخاص</button>
                                <div class="lucky-result" id="luckyResult" style="display: none;">
                                    <span class="result-icon">🎉</span>
                                    <span class="result-text"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- الإثبات الاجتماعي -->
                <div class="social-proof-section">
                    <h4 class="proof-title">آخر من انضم للرحلة:</h4>
                    <div class="recent-enrollments" id="recentEnrollments">
                        <div class="enrollment-item">
                            <span class="student-name">محمد من القاهرة</span>
                            <span class="enrollment-time">منذ 3 ساعات</span>
                            <span class="enrollment-type">اختار خطة 6 أقساط</span>
                        </div>
                        <div class="enrollment-item">
                            <span class="student-name">فاطمة من الإسكندرية</span>
                            <span class="enrollment-time">منذ 5 ساعات</span>
                            <span class="enrollment-type">حصلت على منحة جزئية 50%</span>
                        </div>
                        <div class="enrollment-item">
                            <span class="student-name">أحمد و4 أصدقاء</span>
                            <span class="enrollment-time">منذ يوم</span>
                            <span class="enrollment-type">وفروا 40% كمجموعة!</span>
                        </div>
                    </div>
                    <p class="update-notice">🔄 تحديث مباشر كل دقيقة</p>
                </div>

                <!-- مؤشر المقاعد المتبقية -->
                <div class="seats-indicator">
                    <h4 class="seats-title">المقاعد المتاحة:</h4>
                    <div class="seats-hearts" id="seatsHearts">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                    <p class="seats-text">
                        <span class="available-seats" id="availableSeats">0</span> 
                        مقاعد متاحة من 
                        <span class="total-seats" id="totalSeats">0</span>
                    </p>
                </div>

                <!-- الرسائل التحفيزية -->
                <div class="motivational-messages">
                    <p class="message active">"استثمارك في نفسك لا يُقدر بثمن"</p>
                    <p class="message">"الرحلة تبدأ بخطوة واحدة"</p>
                    <p class="message">"انضم لأكثر من 500 متحول للنور"</p>
                    <p class="message">"كل لحظة تأخير هي لحظة ضائعة من النور"</p>
                </div>

                <!-- ختم الثقة والضمانات -->
                <div class="trust-badges">
                    <h4 class="badges-title">🛡️ ضمانات منظور الفؤاد:</h4>
                    <div class="badges-list">
                        <div class="badge-item">
                            <span class="badge-icon">✓</span>
                            <span class="badge-text">إلغاء مجاني خلال 48 ساعة</span>
                        </div>
                        <div class="badge-item">
                            <span class="badge-icon">✓</span>
                            <span class="badge-text">تجميد الاشتراك عند الحاجة</span>
                        </div>
                        <div class="badge-item">
                            <span class="badge-icon">✓</span>
                            <span class="badge-text">دعم مدى الحياة</span>
                        </div>
                        <div class="badge-item">
                            <span class="badge-icon">✓</span>
                            <span class="badge-text">مجتمع داعم ومحب</span>
                        </div>
                    </div>
                </div>

                <!-- أزرار الإجراءات الرئيسية -->
                <div class="main-action-buttons">
                    <button class="btn-primary main-book-btn" id="mainBookBtn">
                        <span class="btn-icon">💎</span>
                        <span class="btn-text">احجز مقعدك الآن</span>
                    </button>
                    <button class="btn-secondary main-grant-btn" id="mainGrantBtn">
                        <span class="btn-icon">🤲</span>
                        <span class="btn-text">تقدم بطلب منحة</span>
                    </button>
                    <button class="btn-waiting main-waiting-btn" id="mainWaitingBtn" style="display: none;">
                        <span class="btn-icon">📋</span>
                        <span class="btn-text">انضم لقائمة الانتظار</span>
                    </button>
                </div>

            </div>

            <!-- الشريط الجانبي الثابت -->
            <aside class="investment-sidebar">
                <!-- ملخص الدورة -->
                <div class="sidebar-card course-summary-card">
                    <h4 class="sidebar-title">ملخص الدورة</h4>
                    <div class="course-info">
                        <div class="info-item">
                            <i class="fas fa-book"></i>
                            <span id="courseTitleSidebar">جاري التحميل...</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-clock"></i>
                            <span id="courseDuration">-- ساعة</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-layer-group"></i>
                            <span id="courseModules">-- وحدة</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-certificate"></i>
                            <span>شهادة معتمدة</span>
                        </div>
                    </div>
                </div>

                <!-- ملخص الاستثمار -->
                <div class="sidebar-card investment-summary-card">
                    <h4 class="sidebar-title">استثمارك</h4>
                    <div class="price-summary">
                        <div class="price-row">
                            <span>السعر الأصلي:</span>
                            <span class="original-price" id="sidebarOriginalPrice">0 ج.م</span>
                        </div>
                        <div class="price-row" id="sidebarDiscountRow" style="display: none;">
                            <span>الخصم:</span>
                            <span class="discount-value" id="sidebarDiscount">0%</span>
                        </div>
                        <div class="divider"></div>
                        <div class="price-row total">
                            <span>المجموع:</span>
                            <span class="total-price" id="sidebarTotalPrice">0 ج.م</span>
                        </div>
                    </div>
                    <button class="sidebar-book-btn" id="sidebarBookBtn">
                        احجز الآن
                    </button>
                </div>

                <!-- العرض الخاص -->
                <div class="sidebar-card special-offer-card">
                    <div class="offer-badge">عرض محدود</div>
                    <h4 class="sidebar-title">عرض اليوم الخاص</h4>
                    <div class="offer-content">
                        <p class="offer-text">احجز الآن واحصل على:</p>
                        <ul class="offer-list">
                            <li>خصم إضافي 10%</li>
                            <li>جلسة استشارية مجانية</li>
                            <li>دخول مجاني للورشة القادمة</li>
                        </ul>
                    </div>
                    <div class="offer-countdown">
                        <i class="fas fa-clock"></i>
                        <span id="sidebarCountdown">23:59:59</span>
                    </div>
                </div>

                <!-- المساعدة السريعة -->
                <div class="sidebar-card help-card">
                    <h4 class="sidebar-title">تحتاج مساعدة؟</h4>
                    <div class="help-options">
                        <a href="https://wa.me/201024584537" target="_blank" class="help-btn whatsapp-btn">
                            <i class="fab fa-whatsapp"></i>
                            واتساب
                        </a>
                        <button class="help-btn faq-btn" id="faqBtn">
                            <i class="fas fa-question-circle"></i>
                            الأسئلة الشائعة
                        </button>
                    </div>
                </div>
            </aside>

        </div>

        <!-- نوافذ منبثقة -->
        
        <!-- نافذة طلب المنحة -->
        <div class="modal grant-modal" id="grantModal" style="display: none;">
            <div class="modal-overlay" id="grantModalOverlay"></div>
            <div class="modal-content">
                <button class="close-modal-btn" id="closeGrantModal">×</button>
                
                <div class="modal-header">
                    <h3 class="modal-title">🌟 برنامج المنح الدراسية</h3>
                    <p class="modal-subtitle">"لا نريد أن يحرم أحد من النور بسبب الظروف المالية"</p>
                </div>

                <div class="modal-body">
                    <div class="grant-philosophy">
                        <p>• المنح ليست صدقة بل استثمار</p>
                        <p>• نؤمن أن كل إنسان يستحق الفرصة</p>
                        <p>• معاً نبني مجتمع النور</p>
                    </div>
                    
                    <div class="grant-availability">
                        <h4>متاح حالياً:</h4>
                        <ul class="availability-list">
                            <li><span class="full-grants">5</span> منح كاملة (100%)</li>
                            <li><span class="partial-grants">10</span> منح جزئية (50-90%)</li>
                            <li>خطط دفع مرنة حسب الحاجة</li>
                        </ul>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn-primary start-application-btn" id="startGrantApplication">
                            ابدأ رحلة التقديم
                        </button>
                        <button class="btn-secondary not-now-btn" id="notNowBtn">
                            ليس الآن
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- استمارة المنحة متعددة المراحل -->
        <div class="grant-form-container" id="grantFormContainer" style="display: none;">
            <div class="form-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 20%;"></div>
                </div>
                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <span class="step-number">1</span>
                        <span class="step-name">البيانات</span>
                    </div>
                    <div class="step" data-step="2">
                        <span class="step-number">2</span>
                        <span class="step-name">القصة</span>
                    </div>
                    <div class="step" data-step="3">
                        <span class="step-number">3</span>
                        <span class="step-name">المالية</span>
                    </div>
                    <div class="step" data-step="4">
                        <span class="step-number">4</span>
                        <span class="step-name">الخطة</span>
                    </div>
                    <div class="step" data-step="5">
                        <span class="step-number">5</span>
                        <span class="step-name">المراجعة</span>
                    </div>
                </div>
            </div>

            <!-- الاستمارة سيتم إضافتها ديناميكياً -->
            <form id="grantApplicationForm" class="grant-form">
                <!-- محتوى الاستمارة سيتم إضافته بواسطة JavaScript -->
            </form>
        </div>

        <!-- رسائل النجاح والخطأ -->
        <div class="application-messages">
            <!-- رسالة النجاح -->
            <div class="success-message" id="successMessage" style="display: none;">
                <div class="message-icon">✅</div>
                <h3 class="message-title">تم استلام طلبك بنجاح!</h3>
                <div class="message-content">
                    <p>رقم الطلب: <span class="application-number">#2024-000</span></p>
                    <h4>ماذا يحدث الآن؟</h4>
                    <ol>
                        <li>سنراجع طلبك خلال 24-48 ساعة</li>
                        <li>قد نتواصل معك لمعلومات إضافية</li>
                        <li>ستصلك النتيجة على الواتساب</li>
                    </ol>
                    <p class="tip">💡 نصيحة: احرص على متابعة الواتساب</p>
                </div>
                <button class="btn-primary close-success-btn" id="closeSuccessBtn">حسناً</button>
            </div>

            <!-- رسالة الخطأ -->
            <div class="error-message" id="errorMessage" style="display: none;">
                <div class="message-icon">❌</div>
                <h3 class="message-title">عذراً، حدث خطأ</h3>
                <div class="message-content">
                    <p class="error-text">لم نتمكن من إرسال طلبك. يرجى المحاولة مرة أخرى.</p>
                </div>
                <button class="btn-primary retry-btn" id="retryBtn">إعادة المحاولة</button>
            </div>
        </div>

    </div>
    <!-- Scripts -->
    <script>
        // ===== Firebase Configuration =====
        const firebaseConfig = {
            apiKey: "AIzaSyDHg0VrivE3C9A7jvzRu7lQgudLvcD_Fxk",
            authDomain: "fouad-perspective.firebaseapp.com",
            projectId: "fouad-perspective",
            storageBucket: "fouad-perspective.appspot.com",
            messagingSenderId: "564654107574",
            appId: "1:564654107574:web:baebb660288b22f16213e6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ===== متغيرات عامة =====
        let currentCourse = null;
        let courseId = null;
        let selectedScenario = null;
        let appliedCoupon = null;
// المتغيرات العامة
let currentCourseData = null;
let selectedJourney = null;
let selectedTimeOffer = null;
let selectedPaymentMethod = 'cash';
let selectedGroupSize = 1;
let grantFormData = {};
let currentFormStep = 1;
        // ===== دوال مساعدة أساسية =====
        
        // استخراج معرف الدورة من URL
        function getCourseIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('course');
        }

        // استخراج الإجراء من URL
        function getActionFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('action');
        }

        // تحديث رابط العودة
        function updateBackButton() {
            const backBtn = document.getElementById('backToCourse');
            if (backBtn && courseId) {
                backBtn.href = `https://mahmoudfouad25.github.io/fouad-perspective/product-category/course-discover.html?course=${courseId}`;
            }
        }

        // عرض رسائل الخطأ
        function showError(message) {
            Swal.fire({
                icon: 'error',
                title: 'عذراً',
                text: message,
                confirmButtonText: 'حسناً',
                confirmButtonColor: '#FFD700',
                background: '#1A1A1A',
                color: '#FFFFFF'
            });
        }

        // عرض رسائل النجاح
        function showSuccess(message) {
            Swal.fire({
                icon: 'success',
                title: 'رائع!',
                text: message,
                confirmButtonText: 'حسناً',
                confirmButtonColor: '#22C55E',
                background: '#1A1A1A',
                color: '#FFFFFF'
            });
        }

        // ===== تحميل بيانات الدورة =====
        async function loadCourseData() {
            try {
                courseId = getCourseIdFromURL();
                
                if (!courseId) {
                    showError('لم يتم تحديد الدورة');
                    return;
                }

                const doc = await db.collection('courses').doc(courseId).get();
                
                if (!doc.exists) {
                    showError('الدورة غير موجودة');
                    return;
                }

                currentCourse = doc.data();
                currentCourse.id = courseId;

                // تحديث العنوان
                document.getElementById('courseHeaderTitle').textContent = currentCourse.title || 'دورة تدريبية';
                
                // تحديث رابط العودة
                updateBackButton();

                // إخفاء شاشة التحميل وعرض المحتوى
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('mainContent').style.display = 'grid';

                // تهيئة الصفحة
                initializePage();

            } catch (error) {
                console.error('Error loading course:', error);
                showError('حدث خطأ في تحميل بيانات الدورة');
            }
        }

        // ===== تهيئة الصفحة =====
        function initializePage() {
            // التحقق من الإجراء المطلوب
            const action = getActionFromURL();
            if (action === 'grant') {
                // فتح نموذج المنحة مباشرة
                setTimeout(() => {
                    const grantBtn = document.querySelector('.grant-btn');
                    if (grantBtn) grantBtn.click();
                }, 500);
            }

            // استدعاء باقي دوال التهيئة من الجزء الثالث
            initializeInvestmentSection();
        }

/* ========================================
  قسم الاستثمار - JavaScript الكامل
  ======================================== */



// ========================================
// تحميل البيانات من Firebase
// ========================================

async function loadInvestmentData(courseId) {
    console.log('Loading course ID:', courseId); // للتأكد من وجود ID
   try {
       // جلب بيانات الدورة من Firebase
       const courseDoc = await db.collection('courses').doc(courseId).get();
       
       if (!courseDoc.exists) {
           console.error('الدورة غير موجودة');
           return;
       }
       
       currentCourseData = courseDoc.data();
if (currentCourseData) {
    currentCourseData.id = courseId;
    console.log('Course data loaded:', currentCourseData);
}
       // تأكد من وجود البيانات قبل التهيئة
if (currentCourseData) {
    initializeInvestmentSection();
} else {
    console.error('No course data to initialize');
    showErrorMessage('لم يتم تحميل بيانات الدورة');
    return;
}
       // تهيئة قسم الاستثمار
       initializeInvestmentSection();
       
   } catch (error) {
       console.error('خطأ في تحميل بيانات الاستثمار:', error);
       showErrorMessage('حدث خطأ في تحميل البيانات. يرجى المحاولة مرة أخرى.');
   }
}

// ========================================
// تهيئة قسم الاستثمار
// ========================================

function initializeInvestmentSection() {
    if (!currentCourseData) {
        console.error('No course data available');
        return;
    }

   
   // إظهار/إخفاء القسم حسب نوع التسعير
   const investmentSection = document.getElementById('investment-section');
   
   if (currentCourseData.priceType === 'free') {
       investmentSection.style.display = 'none';
       return;
   }
   
   investmentSection.style.display = 'block';
   
   // تهيئة العناصر
   initializeHeartAnimation();
   initializeJourneyCards();
   updatePricePreview();
   initializeTimeOffers();
   initializePaymentWheel();
   initializeGroupSlider();
   initializeSmartCalculator();
   initializePricingTable();
   initializeSurpriseOffers();
   initializeSocialProof();
   initializeSeatsIndicator();
   initializeMotivationalMessages();
   initializeMainActionButtons();
   initializeGrantApplication();
}

// ========================================
// أنيميشن القلب النابض
// ========================================

function initializeHeartAnimation() {
   const heartLogo = document.querySelector('.heart-logo');
   if (!heartLogo) return;
   
   // بدء الأنيميشن بعد التحميل
   setTimeout(() => {
       heartLogo.classList.add('pulsing');
   }, 500);
   
   // أنيميشن امتلاء القلب
   const centralHeart = heartLogo.querySelector('.central-heart');
   let fillAmount = 0;
   
   const fillInterval = setInterval(() => {
       fillAmount += 5;
       centralHeart.style.fill = `url(#heartGradient)`;
       centralHeart.style.fillOpacity = fillAmount / 100;
       
       if (fillAmount >= 100) {
           clearInterval(fillInterval);
       }
   }, 50);
}

// ========================================
// البطاقات التفاعلية
// ========================================

function initializeJourneyCards() {
   const cards = document.querySelectorAll('.journey-card');
   
   cards.forEach(card => {
       card.addEventListener('click', function() {
           const journey = this.dataset.journey;
           selectJourney(journey);
       });
       
       // تحديث معاينة السعر
       updateCardPreview(card);
   });
}

function updateCardPreview(card) {
   const journey = card.dataset.journey;
   
   if (journey === 'individual') {
       const priceAmount = card.querySelector('.price-amount');
       const basePrice = currentCourseData.salePrice || currentCourseData.price;
       priceAmount.textContent = formatPrice(basePrice);
   } else if (journey === 'group') {
       const discountAmount = card.querySelector('.discount-amount');
       const maxDiscount = Math.max(...(currentCourseData.groupDiscounts?.map(g => g.percentage) || [0]));
       discountAmount.textContent = maxDiscount;
   }
}

function selectJourney(journey) {
   selectedJourney = journey;
   
   // إخفاء كل التفاصيل
   document.querySelectorAll('.journey-details').forEach(detail => {
       detail.style.display = 'none';
   });
   
   // إظهار حاوي التفاصيل
   document.querySelector('.journey-details-container').style.display = 'block';
   
   // إظهار التفاصيل المناسبة
   const detailsElement = document.querySelector(`.${journey}-details`);
   if (detailsElement) {
       detailsElement.style.display = 'block';
       
       // تهيئة العناصر الخاصة بكل رحلة
       if (journey === 'individual') {
           initializeIndividualJourney();
       } else if (journey === 'group') {
           initializeGroupJourney();
       } else if (journey === 'support') {
           initializeSupportJourney();
       }
   }
   
   // تمرير سلس للأسفل
   smoothScrollTo('.journey-details-container');
}

// ========================================
// الرحلة الفردية
// ========================================

function initializeIndividualJourney() {
   updateTimeOffersSlider();
   updatePaymentMethodSelection();
   updatePlanSummary();
}

function initializeTimeOffers() {
   const container = document.querySelector('.time-offers-slider');
   if (!container) return;
   
   // إضافة العرض العادي أولاً
   let html = `
       <div class="offer-option active" data-discount="0" data-offer-id="regular">
           <div class="offer-icon">⏰</div>
           <div class="offer-name">السعر العادي</div>
           <div class="offer-discount">بدون خصم</div>
           <div class="offer-price">${formatPrice(currentCourseData.salePrice || currentCourseData.price)} ج.م</div>
       </div>
   `;
   
   // إضافة العروض الزمنية النشطة
   const activeDiscounts = getActiveTimeDiscounts();
   activeDiscounts.forEach(discount => {
       const priceAfterDiscount = calculatePriceAfterDiscount(
           currentCourseData.salePrice || currentCourseData.price,
           discount.percentage
       );
       
       html += `
           <div class="offer-option" data-discount="${discount.percentage}" data-offer-id="${discount.id}">
               <div class="offer-icon">🔥</div>
               <div class="offer-name">${discount.name}</div>
               <div class="offer-discount">خصم ${discount.percentage}%</div>
               <div class="offer-price">${formatPrice(priceAfterDiscount)} ج.م</div>
               <div class="offer-countdown" data-end-date="${discount.endDate}"></div>
           </div>
       `;
   });
   
   container.innerHTML = html;
   
   // إضافة أحداث النقر
   container.querySelectorAll('.offer-option').forEach(option => {
       option.addEventListener('click', function() {
           selectTimeOffer(this);
       });
   });
   
   // بدء العد التنازلي
   startOfferCountdowns();
}

function getActiveTimeDiscounts() {
   if (!currentCourseData.discounts) return [];
   
   const now = new Date();
   return currentCourseData.discounts.filter(discount => {
       if (!discount.startDate || !discount.endDate) return false;
       
       const start = new Date(discount.startDate);
       const end = new Date(discount.endDate);
       end.setHours(23, 59, 59); // نهاية اليوم
       
       return now >= start && now <= end;
   });
}

function selectTimeOffer(optionElement) {
   // إزالة التحديد السابق
   document.querySelectorAll('.offer-option').forEach(opt => {
       opt.classList.remove('active');
   });
   
   // تحديد العرض الجديد
   optionElement.classList.add('active');
   selectedTimeOffer = {
       id: optionElement.dataset.offerId,
       discount: parseInt(optionElement.dataset.discount) || 0
   };
   
   // تحديث الملخص
   updatePlanSummary();
}

function startOfferCountdowns() {
   const countdowns = document.querySelectorAll('.offer-countdown');
   
   countdowns.forEach(countdown => {
       const endDate = new Date(countdown.dataset.endDate);
       endDate.setHours(23, 59, 59);
       
       updateCountdown(countdown, endDate);
       setInterval(() => updateCountdown(countdown, endDate), 1000);
   });
}

function updateCountdown(element, endDate) {
   const now = new Date();
   const diff = endDate - now;
   
   if (diff <= 0) {
       element.textContent = 'انتهى العرض';
       element.parentElement.style.opacity = '0.5';
       element.parentElement.style.pointerEvents = 'none';
       return;
   }
   
   const days = Math.floor(diff / (1000 * 60 * 60 * 24));
   const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
   const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
   const seconds = Math.floor((diff % (1000 * 60)) / 1000);
   
   let text = '';
   if (days > 0) text += `${days} يوم `;
   if (hours > 0) text += `${hours} ساعة `;
   if (days === 0) text += `${minutes} دقيقة `;
   if (days === 0 && hours === 0) text += `${seconds} ثانية`;
   
   element.textContent = `⏱️ متبقي: ${text}`;
}

// ========================================
// عجلة طرق الدفع
// ========================================

function initializePaymentWheel() {
   const paymentOptions = document.querySelectorAll('.payment-option');
   
   paymentOptions.forEach(option => {
       option.addEventListener('click', function() {
           selectPaymentMethod(this);
       });
   });
   
   // تحديث نسبة الخصم النقدي
   if (currentCourseData.cashDiscount?.enabled) {
       document.querySelectorAll('.cash-discount-percent').forEach(el => {
           el.textContent = currentCourseData.cashDiscount.percentage;
       });
   }
}

function selectPaymentMethod(optionElement) {
   // إزالة التحديد السابق
   document.querySelectorAll('.payment-option').forEach(opt => {
       opt.classList.remove('active');
   });
   
   // تحديد الطريقة الجديدة
   optionElement.classList.add('active');
   selectedPaymentMethod = optionElement.dataset.method;
   
   // تحديث الملخص
   updatePlanSummary();
}

// ========================================
// ملخص الخطة
// ========================================

function updatePlanSummary() {
   const basePrice = currentCourseData.salePrice || currentCourseData.price;
   let finalPrice = basePrice;
   
   // تطبيق الخصم الزمني
   if (selectedTimeOffer && selectedTimeOffer.discount > 0) {
       finalPrice = calculatePriceAfterDiscount(finalPrice, selectedTimeOffer.discount);
       
       // إظهار سطر الخصم
       document.querySelector('.price-line.discount').style.display = 'flex';
       document.querySelector('.discount-amount').textContent = formatPrice(basePrice - finalPrice);
       document.querySelector('.discount-percent').textContent = selectedTimeOffer.discount;
   } else {
       document.querySelector('.price-line.discount').style.display = 'none';
   }
   
   // تحديث الأسعار في الملخص
   document.querySelector('.original-price').textContent = formatPrice(basePrice);
   document.querySelector('.total-price').textContent = formatPrice(finalPrice);
   
   // تحديث خيارات السداد
   updatePaymentOptions(finalPrice);
}

function updatePaymentOptions(basePrice) {
   const optionsList = document.querySelector('.options-list');
   let html = '';
   
   // خيار الدفع النقدي
   if (currentCourseData.cashDiscount?.enabled) {
       const cashPrice = calculatePriceAfterDiscount(basePrice, currentCourseData.cashDiscount.percentage);
       const savings = basePrice - cashPrice;
       
       html += `
           <div class="option cash-option">
               <input type="radio" name="payment-final" id="final-cash" value="cash" checked>
               <label for="final-cash">
                   نقداً: ${formatPrice(cashPrice)} ج.م
                   <span class="save-badge">وفر ${formatPrice(savings)} ج.م إضافية!</span>
               </label>
           </div>
       `;
       
       document.querySelector('.cash-final-price').textContent = formatPrice(cashPrice);
       document.querySelector('.cash-save').textContent = formatPrice(savings);
   } else {
       html += `
           <div class="option cash-option">
               <input type="radio" name="payment-final" id="final-cash" value="cash" checked>
               <label for="final-cash">
                   نقداً: ${formatPrice(basePrice)} ج.م
               </label>
           </div>
       `;
   }
   
   // خيارات الأقساط
   if (currentCourseData.paymentPlans) {
       currentCourseData.paymentPlans.forEach((plan, index) => {
           const monthlyAmount = Math.ceil(basePrice / plan.installments);
           
           html += `
               <div class="option installment-option">
                   <input type="radio" name="payment-final" id="final-installment-${plan.installments}" 
                          value="installment-${plan.installments}">
                   <label for="final-installment-${plan.installments}">
                       ${plan.installments} أقساط: ${formatPrice(monthlyAmount)} ج.م شهرياً
                   </label>
               </div>
           `;
       });
   }
   
   optionsList.innerHTML = html;
}

// ========================================
// الرحلة الجماعية
// ========================================

function initializeGroupJourney() {
   const slider = document.querySelector('.group-size-slider');
   if (!slider) return;
   
   slider.addEventListener('input', function() {
       updateGroupSize(parseInt(this.value));
   });
   
   // أزرار الإجراءات
   document.querySelector('.copy-invite-link')?.addEventListener('click', copyInviteLink);
   document.querySelector('.book-as-group')?.addEventListener('click', bookAsGroup);
}

function initializeGroupSlider() {
   // تم دمجها مع initializeGroupJourney
}

function updateGroupSize(size) {
   selectedGroupSize = size;
   const friendsCount = size - 1;
   
   // تحديث العرض
   document.querySelector('.friends-count').textContent = friendsCount;
   
   // حساب الخصم المناسب
   const applicableDiscount = getApplicableGroupDiscount(size);
   
   if (applicableDiscount) {
       document.querySelector('.group-discount-percent').textContent = applicableDiscount.percentage;
       
       const basePrice = currentCourseData.salePrice || currentCourseData.price;
       const discountedPrice = calculatePriceAfterDiscount(basePrice, applicableDiscount.percentage);
       const savings = basePrice - discountedPrice;
       
       document.querySelector('.group-save-amount').textContent = formatPrice(savings);
       
       // تحديث محاكي التوفير
       updateGroupSavingsSimulator(size, basePrice, discountedPrice);
   } else {
       document.querySelector('.group-discount-percent').textContent = '0';
       document.querySelector('.group-save-amount').textContent = '0';
   }
}

function getApplicableGroupDiscount(groupSize) {
   if (!currentCourseData.groupDiscounts) return null;
   
   // البحث عن أفضل خصم متاح للحجم المحدد
   let bestDiscount = null;
   
   currentCourseData.groupDiscounts.forEach(discount => {
       if (groupSize >= discount.minSize) {
           if (!bestDiscount || discount.percentage > bestDiscount.percentage) {
               bestDiscount = discount;
           }
       }
   });
   
   return bestDiscount;
}

function updateGroupSavingsSimulator(size, originalPrice, discountedPrice) {
   const savingsList = document.querySelector('.savings-list');
   const totalSavings = (originalPrice - discountedPrice) * size;
   
   let html = '';
   for (let i = 0; i < size; i++) {
       const personLabel = i === 0 ? 'أنت' : `صديق ${i}`;
       html += `
           <div class="savings-item ${i === 0 ? 'highlight' : ''}">
               <span class="person-name">${personLabel}:</span>
               <span class="price-change">${formatPrice(originalPrice)} → ${formatPrice(discountedPrice)} ج.م ✅</span>
           </div>
       `;
   }
   
   savingsList.innerHTML = html;
   document.querySelector('.total-group-savings').textContent = formatPrice(totalSavings);
}

function copyInviteLink() {
   const courseUrl = window.location.href;
   const inviteText = `انضم معي في دورة "${currentCourseData.title}" واحصل على خصم المجموعة!\n${courseUrl}`;
   
   navigator.clipboard.writeText(inviteText).then(() => {
       showSuccessToast('تم نسخ رابط الدعوة!');
   }).catch(() => {
       // فتح نافذة مشاركة بديلة
       if (navigator.share) {
           navigator.share({
               title: currentCourseData.title,
               text: inviteText,
               url: courseUrl
           });
       }
   });
}

function bookAsGroup() {
   // فتح نموذج حجز المجموعة
   openGroupBookingForm();
}

// ========================================
// رحلة الدعم
// ========================================

function initializeSupportJourney() {
   // عرض معلومات المنح المتاحة
   updateGrantsAvailability();
   
   // أحداث الأزرار
   document.querySelectorAll('.support-option').forEach(option => {
       option.addEventListener('click', function() {
           selectSupportType(this.dataset.supportType);
       });
   });
   
   document.querySelectorAll('.apply-btn').forEach(btn => {
       btn.addEventListener('click', function() {
           openGrantApplication(this.dataset.grantType);
       });
   });
}

function updateGrantsAvailability() {
   if (!currentCourseData.grants?.enabled) return;
   
   const grants = currentCourseData.grants;
   document.querySelector('.grants-full-available').textContent = grants.seats || 0;
   document.querySelector('.grants-partial-available').textContent = 
       (grants.totalSeats || 0) - (grants.seats || 0);
   document.querySelector('.grants-total-seats').textContent = grants.totalSeats || 0;
}

function selectSupportType(type) {
   // إظهار تفاصيل نوع الدعم
   document.querySelector('.support-types-details').style.display = 'block';
   
   // تمرير سلس
   smoothScrollTo('.support-types-details');
}

// ========================================
// الحاسبة الذكية
// ========================================

function initializeSmartCalculator() {
   // إدخال الكوبون
   document.querySelector('.apply-coupon-btn')?.addEventListener('click', applyCouponCode);
   
   // نوع الدفع
   document.querySelectorAll('.payment-type-btn').forEach(btn => {
       btn.addEventListener('click', function() {
           selectCalculatorPaymentType(this.dataset.type);
       });
   });
   
   // الأقساط
   document.querySelectorAll('.installment-btn').forEach(btn => {
       btn.addEventListener('click', function() {
           selectInstallmentPeriod(parseInt(this.dataset.months));
       });
   });
   
   // الأقساط المخصصة
   document.querySelector('.custom-months')?.addEventListener('input', function() {
       if (this.value) {
           selectInstallmentPeriod(parseInt(this.value));
       }
   });
   
   // تاريخ البدء
   const startDateInput = document.querySelector('.start-date-input');
   if (startDateInput) {
       // تعيين الحد الأدنى لليوم الحالي
       startDateInput.min = new Date().toISOString().split('T')[0];
       startDateInput.value = startDateInput.min;
   }
   
   // زر التأكيد
   document.querySelector('.confirm-plan-btn')?.addEventListener('click', confirmCalculatorPlan);
}

function applyCouponCode() {
   const couponInput = document.querySelector('.coupon-input');
   const couponCode = couponInput.value.trim().toUpperCase();
   
   if (!couponCode) return;
   
   // البحث عن الكوبون
   const coupon = currentCourseData.coupons?.find(c => c.code === couponCode);
   
   const feedbackElement = document.querySelector('.coupon-feedback');
   
   if (!coupon) {
       feedbackElement.textContent = 'الكوبون غير صحيح';
       feedbackElement.className = 'coupon-feedback error';
       feedbackElement.style.display = 'block';
       return;
   }
   
   // التحقق من صلاحية الكوبون
   if (coupon.limit && coupon.used >= coupon.limit) {
       feedbackElement.textContent = 'الكوبون مستنفذ';
       feedbackElement.className = 'coupon-feedback error';
       feedbackElement.style.display = 'block';
       return;
   }
   
   // تطبيق الكوبون
   appliedCoupon = coupon;
   feedbackElement.textContent = `تم تطبيق الكوبون! خصم ${
       coupon.type === 'percentage' ? coupon.value + '%' : formatPrice(coupon.value)
   }`;
   feedbackElement.className = 'coupon-feedback success';
   feedbackElement.style.display = 'block';
   
   // تعطيل الإدخال
   couponInput.disabled = true;
   document.querySelector('.apply-coupon-btn').disabled = true;
   
   // تحديث الحسابات
   updateCalculatorResult();
}

function selectCalculatorPaymentType(type) {
   // تحديث الأزرار
   document.querySelectorAll('.payment-type-btn').forEach(btn => {
       btn.classList.toggle('active', btn.dataset.type === type);
   });
   
   // إظهار/إخفاء خيارات الأقساط
   const installmentsStep = document.querySelector('.installments-step');
   installmentsStep.style.display = type === 'installments' ? 'block' : 'none';
   
   // تحديث النتيجة
   updateCalculatorResult();
}

function selectInstallmentPeriod(months) {
   // تحديث الأزرار
   document.querySelectorAll('.installment-btn').forEach(btn => {
       btn.classList.toggle('active', parseInt(btn.dataset.months) === months);
   });
   
   // تحديث النتيجة
   updateCalculatorResult();
}

function updateCalculatorResult() {
   let basePrice = currentCourseData.salePrice || currentCourseData.price;
   
   // تطبيق الخصومات النشطة
   if (selectedTimeOffer && selectedTimeOffer.discount > 0) {
       basePrice = calculatePriceAfterDiscount(basePrice, selectedTimeOffer.discount);
   }
   
   // تطبيق خصم المجموعة إن وجد
   if (selectedJourney === 'group' && selectedGroupSize > 1) {
       const groupDiscount = getApplicableGroupDiscount(selectedGroupSize);
       if (groupDiscount) {
           basePrice = calculatePriceAfterDiscount(basePrice, groupDiscount.percentage);
       }
   }
   
   // تطبيق الكوبون
   if (appliedCoupon) {
       if (appliedCoupon.type === 'percentage') {
           basePrice = calculatePriceAfterDiscount(basePrice, appliedCoupon.value);
       } else {
           basePrice = Math.max(0, basePrice - appliedCoupon.value);
       }
   }
   
   // حساب السعر النهائي حسب طريقة الدفع
   let finalAmount = basePrice;
   const paymentType = document.querySelector('.payment-type-btn.active')?.dataset.type;
   
   if (paymentType === 'cash' && currentCourseData.cashDiscount?.enabled) {
       finalAmount = calculatePriceAfterDiscount(basePrice, currentCourseData.cashDiscount.percentage);
   } else if (paymentType === 'installments') {
       const months = document.querySelector('.installment-btn.active')?.dataset.months || 
                     document.querySelector('.custom-months')?.value || 3;
       finalAmount = Math.ceil(basePrice / parseInt(months));
   }
   
   // عرض النتيجة
   document.querySelector('.amount-value').textContent = formatPrice(finalAmount);
   
   // إظهار قسم النتيجة
   document.querySelector('.calculator-result').style.display = 'block';
}

function confirmCalculatorPlan() {
   // جمع تفاصيل الخطة
   const planDetails = {
       basePrice: currentCourseData.salePrice || currentCourseData.price,
       timeDiscount: selectedTimeOffer,
       groupDiscount: selectedJourney === 'group' ? getApplicableGroupDiscount(selectedGroupSize) : null,
       coupon: appliedCoupon,
       paymentType: document.querySelector('.payment-type-btn.active')?.dataset.type,
       installments: document.querySelector('.installment-btn.active')?.dataset.months,
       startDate: document.querySelector('.start-date-input')?.value
   };
   
   // الانتقال لصفحة الحجز مع التفاصيل
   proceedToBooking(planDetails);
}

// ========================================
// الجدول المقارن الشامل
// ========================================

function initializePricingTable() {
   buildComprehensivePricingTable();
}

function buildComprehensivePricingTable() {
   const container = document.querySelector('.pricing-comparison-table');
   if (!container) return;
   
   const basePrice = currentCourseData.salePrice || currentCourseData.price;
   const discounts = getTimeDiscountsForTable();
   const groupDiscounts = currentCourseData.groupDiscounts || [];
   const paymentPlans = currentCourseData.paymentPlans || [];
   const cashDiscountEnabled = currentCourseData.cashDiscount?.enabled || false;
   const cashDiscountPercent = currentCourseData.cashDiscount?.percentage || 0;
   
   // بناء رأس الجدول
   let headerHTML = buildTableHeader(groupDiscounts, paymentPlans, cashDiscountEnabled);
   
   // بناء صفوف الجدول
   let bodyHTML = buildTableBody(
       basePrice,
       discounts,
       groupDiscounts,
       paymentPlans,
       cashDiscountEnabled,
       cashDiscountPercent
   );
   
   container.innerHTML = `
       <thead>${headerHTML}</thead>
       <tbody>${bodyHTML}</tbody>
   `;
}

function getTimeDiscountsForTable() {
   const discounts = [];
   
   // إضافة السعر العادي
   discounts.push({
       name: 'السعر العادي',
       percentage: 0,
       isActive: true
   });
   
   // إضافة العروض الزمنية
   if (currentCourseData.discounts) {
       const activeDiscounts = getActiveTimeDiscounts();
       activeDiscounts.forEach(discount => {
           discounts.push({
               ...discount,
               isActive: true
           });
       });
   }
   
   return discounts;
}

function buildTableHeader(groupDiscounts, paymentPlans, cashDiscountEnabled) {
   let html = `
       <tr class="main-header">
           <th rowspan="2" class="time-column">وقت التسجيل</th>
           <th colspan="${cashDiscountEnabled ? paymentPlans.length + 1 : paymentPlans.length + 1}" 
               class="individual-header">الفرد</th>
   `;
   
   // أعمدة المجموعات
   groupDiscounts.forEach(group => {
       const colspan = cashDiscountEnabled ? paymentPlans.length + 1 : paymentPlans.length + 1;
       html += `<th colspan="${colspan}" class="group-header">${group.name} (${group.minSize}+)</th>`;
   });
   
   html += `</tr><tr class="sub-header">`;
   
   // أعمدة فرعية للفرد
   html += `<th class="payment-method">السعر الأساسي</th>`;
   if (cashDiscountEnabled) {
       html += `<th class="payment-method">دفع نقدي</th>`;
   }
   paymentPlans.forEach(plan => {
       html += `<th class="payment-method">${plan.name}</th>`;
   });
   
   // أعمدة فرعية للمجموعات
   groupDiscounts.forEach(() => {
       html += `<th class="payment-method">السعر الأساسي</th>`;
       if (cashDiscountEnabled) {
           html += `<th class="payment-method">دفع نقدي</th>`;
       }
       paymentPlans.forEach(plan => {
           html += `<th class="payment-method">${plan.name}</th>`;
       });
   });
   
   html += `</tr>`;
   return html;
}

function buildTableBody(basePrice, discounts, groupDiscounts, paymentPlans, cashDiscountEnabled, cashDiscountPercent) {
   let html = '';
   
   discounts.forEach((discount, index) => {
       const priceAfterDiscount = calculatePriceAfterDiscount(basePrice, discount.percentage);
       const rowClass = discount.isActive ? 'active-offer' : 'expired-offer';
       
       html += `<tr class="${rowClass}">`;
       
       // عمود الوقت
       html += `<td class="time-cell">`;
       html += `<div class="offer-name">${discount.name}</div>`;
       if (discount.percentage > 0) {
           html += `<div class="offer-badge">خصم ${discount.percentage}%</div>`;
       }
       if (discount.endDate) {
           html += `<div class="offer-deadline">حتى ${formatDate(discount.endDate)}</div>`;
       }
       html += `</td>`;
       
       // أسعار الفرد
       html += buildPriceCells(priceAfterDiscount, paymentPlans, cashDiscountEnabled, cashDiscountPercent);
       
       // أسعار المجموعات
       groupDiscounts.forEach(group => {
           const groupPrice = calculatePriceAfterDiscount(priceAfterDiscount, group.percentage);
           html += buildPriceCells(groupPrice, paymentPlans, cashDiscountEnabled, cashDiscountPercent);
       });
       
       html += `</tr>`;
   });
   
   return html;
}

function buildPriceCells(basePrice, paymentPlans, cashDiscountEnabled, cashDiscountPercent) {
   let html = '';
   
   // السعر الأساسي
   html += `<td class="price-cell">${formatPrice(basePrice)}</td>`;
   
   // السعر النقدي
   if (cashDiscountEnabled) {
       const cashPrice = calculatePriceAfterDiscount(basePrice, cashDiscountPercent);
       html += `<td class="price-cell discounted">${formatPrice(cashPrice)}</td>`;
   }
   
   // أسعار الأقساط
   paymentPlans.forEach(plan => {
       const monthlyAmount = Math.ceil(basePrice / plan.installments);
       html += `<td class="price-cell">${formatPrice(monthlyAmount)}</td>`;
   });
   
   return html;
}

// ========================================
// العروض المفاجئة
// ========================================

function initializeSurpriseOffers() {
   // عرض الوقت المحدود
   if (shouldShowLimitedTimeOffer()) {
       showLimitedTimeOffer();
   }
   
   // عرض الحظ
   document.querySelector('.spin-wheel-btn')?.addEventListener('click', spinLuckyWheel);
}

function shouldShowLimitedTimeOffer() {
   // عرض العرض بعد 30 ثانية من فتح الصفحة
   const pageOpenTime = sessionStorage.getItem('pageOpenTime');
   if (!pageOpenTime) {
       sessionStorage.setItem('pageOpenTime', Date.now());
       return false;
   }
   
   const timePassed = Date.now() - parseInt(pageOpenTime);
   return timePassed > 30000; // 30 ثانية
}

function showLimitedTimeOffer() {
   const offerSection = document.querySelector('.limited-time-offer');
   if (!offerSection) return;
   
   offerSection.style.display = 'block';
   
   // بدء العد التنازلي (15 دقيقة)
   let timeLeft = 15 * 60; // 15 دقيقة بالثواني
   const timerElement = document.querySelector('.timer-value');
   
   const timerInterval = setInterval(() => {
       timeLeft--;
       
       const minutes = Math.floor(timeLeft / 60);
       const seconds = timeLeft % 60;
       
       timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
       
       if (timeLeft <= 0) {
           clearInterval(timerInterval);
           offerSection.style.display = 'none';
       }
   }, 1000);
   
   // حدث زر المطالبة
   document.querySelector('.claim-offer-btn')?.addEventListener('click', () => {
       applyLimitedTimeOffer();
       clearInterval(timerInterval);
       offerSection.style.display = 'none';
   });
}

function applyLimitedTimeOffer() {
   // تطبيق خصم إضافي 10%
   appliedCoupon = {
       code: 'LIMITED10',
       type: 'percentage',
       value: 10
   };
   
   showSuccessToast('تم تطبيق العرض المحدود! خصم إضافي 10%');
   updatePlanSummary();
}

function spinLuckyWheel() {
   const button = document.querySelector('.spin-wheel-btn');
   const resultDiv = document.querySelector('.lucky-result');
   const resultIcon = resultDiv.querySelector('.result-icon');
   const resultText = resultDiv.querySelector('.result-text');
   
   // تعطيل الزر
   button.disabled = true;
   button.textContent = 'جاري الدوران...';
   
   // أنيميشن الدوران
   setTimeout(() => {
       // اختيار عشوائي للجائزة
       const prizes = [
           { icon: '🎁', text: 'خصم إضافي 5%', value: 5 },
           { icon: '🎊', text: 'خصم إضافي 10%', value: 10 },
           { icon: '🎉', text: 'خصم إضافي 15%', value: 15 },
           { icon: '📚', text: 'كتاب مجاني مع الدورة', value: 'book' },
           { icon: '⏰', text: 'شهر إضافي للوصول', value: 'month' }
       ];
       
       const prize = prizes[Math.floor(Math.random() * prizes.length)];
       
       // عرض النتيجة
       resultIcon.textContent = prize.icon;
       resultText.textContent = prize.text;
       resultDiv.style.display = 'block';
       
       // تطبيق الجائزة
       if (typeof prize.value === 'number') {
           appliedCoupon = {
               code: 'LUCKY' + prize.value,
               type: 'percentage',
               value: prize.value
           };
           updatePlanSummary();
       }
       
       // إخفاء الزر
       button.style.display = 'none';
       
       showSuccessToast('مبروك! ' + prize.text);
   }, 2000);
}

// ========================================
// الإثبات الاجتماعي
// ========================================

function initializeSocialProof() {
   // تحديث الإثبات الاجتماعي كل دقيقة
   updateSocialProof();
   setInterval(updateSocialProof, 60000);
}

function updateSocialProof() {
   const container = document.querySelector('.recent-enrollments');
   if (!container) return;
   
   // بيانات وهمية للعرض (في الإنتاج ستأتي من قاعدة البيانات)
   const recentEnrollments = generateRecentEnrollments();
   
   let html = '';
   recentEnrollments.forEach(enrollment => {
       html += `
           <div class="enrollment-item">
               <span class="student-name">${enrollment.name}</span>
               <span class="enrollment-time">${enrollment.time}</span>
               <span class="enrollment-type">${enrollment.type}</span>
           </div>
       `;
   });
   
   container.innerHTML = html;
}

function generateRecentEnrollments() {
   const names = ['محمد', 'فاطمة', 'أحمد', 'مريم', 'عبدالله', 'نور', 'يوسف', 'زينب'];
   const cities = ['القاهرة', 'الإسكندرية', 'الجيزة', 'أسوان', 'المنصورة', 'طنطا'];
   const types = [
       'اختار خطة 6 أقساط',
       'حصل على منحة جزئية 50%',
       'انضم مع 3 أصدقاء',
       'دفع نقداً وحصل على خصم',
       'استفاد من العرض المبكر'
   ];
   
   const enrollments = [];
   for (let i = 0; i < 3; i++) {
       enrollments.push({
           name: names[Math.floor(Math.random() * names.length)] + ' من ' + 
                 cities[Math.floor(Math.random() * cities.length)],
           time: `منذ ${Math.floor(Math.random() * 24) + 1} ساعة`,
           type: types[Math.floor(Math.random() * types.length)]
       });
   }
   
   return enrollments;
}

// ========================================
// مؤشر المقاعد
// ========================================

function initializeSeatsIndicator() {
   updateSeatsIndicator();
}

function updateSeatsIndicator() {
   const container = document.querySelector('.seats-hearts');
   const totalSeats = currentCourseData.maxStudents || 30;
   const enrolledStudents = currentCourseData.enrollments || 0;
   const availableSeats = totalSeats - enrolledStudents;
   
   // تحديث الأرقام
   document.querySelector('.available-seats').textContent = availableSeats;
   document.querySelector('.total-seats').textContent = totalSeats;
   
   // عرض القلوب
   let html = '';
   for (let i = 0; i < totalSeats && i < 10; i++) {
       const isAvailable = i < availableSeats;
       html += `<span class="seat-heart ${isAvailable ? 'available' : 'taken'}" 
                      style="--heart-index: ${i}">💛</span>`;
   }
   
   container.innerHTML = html;
}

// ========================================
// الرسائل التحفيزية
// ========================================

function initializeMotivationalMessages() {
   const messages = document.querySelectorAll('.motivational-messages .message');
   let currentIndex = 0;
   
   setInterval(() => {
       // إخفاء الرسالة الحالية
       messages[currentIndex].classList.remove('active');
       
       // الانتقال للرسالة التالية
       currentIndex = (currentIndex + 1) % messages.length;
       messages[currentIndex].classList.add('active');
   }, 5000);
}

// ========================================
// أزرار الإجراءات الرئيسية
// ========================================

function initializeMainActionButtons() {
   // تحديد الأزرار المناسبة للعرض
   const availableSeats = (currentCourseData.maxStudents || 30) - (currentCourseData.enrollments || 0);
   
   if (availableSeats > 0) {
       document.querySelector('.main-book-btn').style.display = 'flex';
       document.querySelector('.main-grant-btn').style.display = 
           currentCourseData.grants?.enabled ? 'flex' : 'none';
   } else {
       document.querySelector('.main-waiting-btn').style.display = 'flex';
   }
   
   // أحداث الأزرار
   document.querySelector('.main-book-btn')?.addEventListener('click', proceedToBooking);
   document.querySelector('.main-grant-btn')?.addEventListener('click', () => openGrantModal());
   document.querySelector('.main-waiting-btn')?.addEventListener('click', joinWaitingList);
}

// ========================================
// نظام المنح
// ========================================

function initializeGrantApplication() {
   // نافذة المنحة
   document.querySelector('.close-modal-btn')?.addEventListener('click', closeGrantModal);
   document.querySelector('.modal-overlay')?.addEventListener('click', closeGrantModal);
   document.querySelector('.start-application-btn')?.addEventListener('click', startGrantApplication);
   document.querySelector('.not-now-btn')?.addEventListener('click', closeGrantModal);
   
   // نموذج المنحة
   initializeGrantForm();
}

function openGrantModal() {
   document.querySelector('.grant-application-modal').style.display = 'flex';
   document.body.style.overflow = 'hidden';
   
   // تحديث معلومات المنح المتاحة
   const grants = currentCourseData.grants;
   if (grants) {
       document.querySelector('.full-grants').textContent = grants.seats || 0;
       document.querySelector('.partial-grants').textContent = 
           (grants.totalSeats || 0) - (grants.seats || 0);
   }
}

function closeGrantModal() {
   document.querySelector('.grant-application-modal').style.display = 'none';
   document.body.style.overflow = '';
}

function startGrantApplication() {
   closeGrantModal();
   document.querySelector('.grant-form-container').style.display = 'block';
   document.body.style.overflow = 'hidden';
}

function initializeGrantForm() {
   const form = document.getElementById('grantApplicationForm');
   if (!form) return;
   
   // أزرار التنقل
   document.querySelectorAll('.next-step-btn').forEach(btn => {
       btn.addEventListener('click', () => navigateGrantForm('next'));
   });
   
   document.querySelectorAll('.prev-step-btn').forEach(btn => {
       btn.addEventListener('click', () => navigateGrantForm('prev'));
   });
   
   document.querySelector('.cancel-form-btn')?.addEventListener('click', cancelGrantApplication);
   
   // إرسال النموذج
   form.addEventListener('submit', submitGrantApplication);
   
   // تفاعلات خاصة
   initializeFormInteractions();
}

function initializeFormInteractions() {
   // عداد الأحرف
   document.querySelectorAll('textarea[minlength]').forEach(textarea => {
       const counter = textarea.parentElement.querySelector('.char-counter');
       if (!counter) return;
       
       const currentCharsSpan = counter.querySelector('.current-chars');
       const maxChars = parseInt(textarea.getAttribute('maxlength'));
       
       textarea.addEventListener('input', function() {
           const currentLength = this.value.length;
           currentCharsSpan.textContent = currentLength;
           
           counter.classList.toggle('exceeded', currentLength > maxChars);
       });
   });
   
   // إظهار/إخفاء عدد الأطفال
   document.getElementById('maritalStatus')?.addEventListener('change', function() {
       const kidsCount = document.querySelector('.kids-count');
       kidsCount.style.display = this.value === 'married-with-kids' ? 'block' : 'none';
   });
   
   // حساب الالتزامات المالية
   const obligationInputs = document.querySelectorAll('.amount-input');
   obligationInputs.forEach(input => {
       input.addEventListener('input', calculateTotalObligations);
   });
   
   // شريط المبلغ المتاح
   const availableSlider = document.getElementById('availableAmount');
   if (availableSlider) {
       availableSlider.addEventListener('input', function() {
           document.querySelector('.current-value').textContent = this.value + ' ج.م';
       });
   }
   
   // خيارات الدعم
   document.querySelectorAll('.support-option-label input').forEach(checkbox => {
       checkbox.addEventListener('change', function() {
           const relatedInput = this.parentElement.querySelector('.reason-input, .percentage-input, .months-input, .defer-input, .custom-plan-input');
           if (relatedInput) {
               relatedInput.style.display = this.checked ? 'block' : 'none';
           }
       });
   });
   
   // المساهمة بالخدمات
   document.querySelectorAll('input[name="canContribute"]').forEach(radio => {
       radio.addEventListener('change', function() {
           const skillsSection = document.querySelector('.skills-checkboxes');
           skillsSection.style.display = this.value === 'yes' ? 'block' : 'none';
       });
   });
}

function calculateTotalObligations() {
   let total = 0;
   document.querySelectorAll('.obligation-item input[type="number"]').forEach(input => {
       if (input.value) {
           total += parseInt(input.value);
       }
   });
   
   document.querySelector('.total-amount').textContent = formatPrice(total);
}

function navigateGrantForm(direction) {
   const currentStep = document.querySelector(`.form-step[data-step="${currentFormStep}"]`);
   
   // التحقق من صحة البيانات قبل الانتقال للأمام
   if (direction === 'next' && !validateFormStep(currentStep)) {
       return;
   }
   
   // حفظ البيانات الحالية
   saveStepData(currentStep);
   
   // تحديد الخطوة التالية
   if (direction === 'next' && currentFormStep < 5) {
       currentFormStep++;
   } else if (direction === 'prev' && currentFormStep > 1) {
       currentFormStep--;
   }
   
   // إخفاء الخطوة الحالية
   currentStep.classList.remove('active');
   
   // إظهار الخطوة الجديدة
   const newStep = document.querySelector(`.form-step[data-step="${currentFormStep}"]`);
   newStep.classList.add('active');
   
   // تحديث شريط التقدم
   updateFormProgress();
   
   // إذا كانت خطوة المراجعة، عرض الملخص
   if (currentFormStep === 5) {
       displayFormSummary();
   }
}

function validateFormStep(stepElement) {
   const requiredFields = stepElement.querySelectorAll('[required]');
   let isValid = true;
   
   requiredFields.forEach(field => {
       if (!field.value.trim()) {
           field.classList.add('error');
           isValid = false;
       } else {
           field.classList.remove('error');
       }
   });
   
   if (!isValid) {
       showErrorToast('يرجى ملء جميع الحقول المطلوبة');
   }
   
   return isValid;
}

function saveStepData(stepElement) {
   const inputs = stepElement.querySelectorAll('input, select, textarea');
   
   inputs.forEach(input => {
       if (input.type === 'checkbox' || input.type === 'radio') {
           if (input.checked) {
               if (!grantFormData[input.name]) {
                   grantFormData[input.name] = [];
               }
               if (input.type === 'checkbox') {
                   grantFormData[input.name].push(input.value);
               } else {
                   grantFormData[input.name] = input.value;
               }
           }
       } else {
           grantFormData[input.name] = input.value;
       }
   });
}

function updateFormProgress() {
   // تحديث شريط التقدم
   const progressFill = document.querySelector('.progress-fill');
   progressFill.style.width = (currentFormStep / 5 * 100) + '%';
   
   // تحديث الخطوات
   document.querySelectorAll('.step').forEach((step, index) => {
       step.classList.toggle('active', index + 1 <= currentFormStep);
   });
}

function displayFormSummary() {
   // عرض ملخص البيانات
   document.getElementById('summaryName').textContent = grantFormData.fullName || '-';
   document.getElementById('summaryCourse').textContent = currentCourseData.title || '-';
   
   // نوع الدعم
   let supportTypes = [];
   if (grantFormData.supportType) {
       grantFormData.supportType.forEach(type => {
           switch(type) {
               case 'full-grant': supportTypes.push('منحة كاملة'); break;
               case 'partial-grant': supportTypes.push('منحة جزئية'); break;
               case 'installments': supportTypes.push('تقسيط ميسر'); break;
               case 'deferred': supportTypes.push('تأجيل السداد'); break;
               case 'custom': supportTypes.push('خطة مخصصة'); break;
           }
       });
   }
   document.getElementById('summarySupport').textContent = supportTypes.join(', ') || '-';
   
   // الخطة المقترحة
   document.getElementById('summaryPlan').textContent = grantFormData.suggestedPlan || '-';
   
   // المساهمة
   document.getElementById('summaryContribution').textContent = 
       grantFormData.canContribute === 'yes' ? 'نعم' : 'لا';
}

async function submitGrantApplication(event) {
   event.preventDefault();
   
   // حفظ بيانات الخطوة الأخيرة
   const lastStep = document.querySelector(`.form-step[data-step="5"]`);
   saveStepData(lastStep);
   
   // التحقق من الموافقات
   const agreements = document.querySelectorAll('input[name="agreements[]"]:checked');
   if (agreements.length < 4) {
       showErrorToast('يجب الموافقة على جميع الشروط');
       return;
   }
   
   try {
       // إضافة معلومات إضافية
       grantFormData.courseId = currentCourseData.id;
       grantFormData.courseTitle = currentCourseData.title;
       grantFormData.submittedAt = new Date().toISOString();
       grantFormData.applicationNumber = generateApplicationNumber();
       grantFormData.status = 'pending';
       
       // حفظ في Firebase
       await db.collection('grantApplications').add(grantFormData);
       
       // إرسال إشعار للأدمن (يمكن إضافة Cloud Function)
       
       // عرض رسالة النجاح
       showGrantSuccessMessage(grantFormData.applicationNumber);
       
   } catch (error) {
       console.error('خطأ في إرسال طلب المنحة:', error);
       showGrantErrorMessage();
   }
}

function generateApplicationNumber() {
   const year = new Date().getFullYear();
   const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
   return `#${year}-${random}`;
}

function showGrantSuccessMessage(applicationNumber) {
   document.querySelector('.grant-form-container').style.display = 'none';
   document.querySelector('.application-messages').style.display = 'flex';
   document.querySelector('.success-message').style.display = 'block';
   document.querySelector('.application-number').textContent = applicationNumber;
   
   document.querySelector('.close-success-btn').addEventListener('click', () => {
       document.querySelector('.application-messages').style.display = 'none';
       document.body.style.overflow = '';
       
       // إعادة تعيين النموذج
       document.getElementById('grantApplicationForm').reset();
       currentFormStep = 1;
       grantFormData = {};
   });
}

function showGrantErrorMessage() {
   document.querySelector('.application-messages').style.display = 'flex';
   document.querySelector('.error-message').style.display = 'block';
   
   document.querySelector('.retry-btn').addEventListener('click', () => {
       document.querySelector('.application-messages').style.display = 'none';
       document.querySelector('.error-message').style.display = 'none';
   });
}

function cancelGrantApplication() {
   if (confirm('هل أنت متأكد من إلغاء طلب المنحة؟')) {
       document.querySelector('.grant-form-container').style.display = 'none';
       document.body.style.overflow = '';
       
       // إعادة تعيين النموذج
       document.getElementById('grantApplicationForm').reset();
       currentFormStep = 1;
       grantFormData = {};
   }
}

// ========================================
// وظائف الحجز
// ========================================

function proceedToBooking(planDetails = null) {
   // جمع كل التفاصيل المطلوبة للحجز
   const bookingData = {
       courseId: currentCourseData.id,
       courseTitle: currentCourseData.title,
       basePrice: currentCourseData.salePrice || currentCourseData.price,
       journey: selectedJourney,
       timeOffer: selectedTimeOffer,
       groupSize: selectedGroupSize,
       paymentMethod: selectedPaymentMethod,
       coupon: appliedCoupon,
       planDetails: planDetails,
       timestamp: new Date().toISOString()
   };
   
   // حفظ البيانات في sessionStorage للاستخدام في صفحة الحجز
   sessionStorage.setItem('bookingData', JSON.stringify(bookingData));
   
   // الانتقال لصفحة الحجز
   window.location.href = `/booking?course=${currentCourseData.id}`;
}

function openGroupBookingForm() {
   // فتح نموذج خاص لحجز المجموعات
   const bookingData = {
       courseId: currentCourseData.id,
       courseTitle: currentCourseData.title,
       groupSize: selectedGroupSize,
       groupDiscount: getApplicableGroupDiscount(selectedGroupSize)
   };
   
   sessionStorage.setItem('groupBookingData', JSON.stringify(bookingData));
   window.location.href = `/group-booking?course=${currentCourseData.id}`;
}

function joinWaitingList() {
   // فتح نموذج قائمة الانتظار
   window.location.href = `/waiting-list?course=${currentCourseData.id}`;
}

// ========================================
// وظائف مساعدة
// ========================================

function calculatePriceAfterDiscount(price, discountPercentage) {
   return Math.round(price * (1 - discountPercentage / 100));
}

function formatPrice(price) {
   return new Intl.NumberFormat('ar-EG').format(Math.round(price));
}

function formatDate(dateString) {
   const date = new Date(dateString);
   return date.toLocaleDateString('ar-EG', {
       year: 'numeric',
       month: 'long',
       day: 'numeric'
   });
}

function smoothScrollTo(selector) {
   const element = document.querySelector(selector);
   if (element) {
       element.scrollIntoView({
           behavior: 'smooth',
           block: 'start'
       });
   }
}

function showSuccessToast(message) {
   // يمكن استخدام مكتبة مثل Toastify
   const toast = document.createElement('div');
   toast.className = 'success-toast';
   toast.textContent = message;
   document.body.appendChild(toast);
   
   setTimeout(() => {
       toast.classList.add('show');
   }, 100);
   
   setTimeout(() => {
       toast.classList.remove('show');
       setTimeout(() => toast.remove(), 300);
   }, 3000);
}

function showErrorToast(message) {
   const toast = document.createElement('div');
   toast.className = 'error-toast';
   toast.textContent = message;
   document.body.appendChild(toast);
   
   setTimeout(() => {
       toast.classList.add('show');
   }, 100);
   
   setTimeout(() => {
       toast.classList.remove('show');
       setTimeout(() => toast.remove(), 300);
   }, 3000);
}

function showErrorMessage(message) {
   // عرض رسالة خطأ في القسم
   const errorDiv = document.createElement('div');
   errorDiv.className = 'investment-error-message';
   errorDiv.innerHTML = `
       <div class="error-icon">❌</div>
       <div class="error-text">${message}</div>
       <button class="retry-button" onclick="location.reload()">إعادة المحاولة</button>
   `;
   
   const container = document.getElementById('investment-section');
   container.innerHTML = '';
   container.appendChild(errorDiv);
}

// ========================================
// التهيئة عند تحميل الصفحة
// ========================================

document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('course');
    
    if (courseId) {
        loadInvestmentData(courseId);
    } else {
        console.error('No course ID in URL');
        showError('لم يتم تحديد الدورة');
    }
});


// ========================================
// دوال إضافية للتكامل مع course-builder.html
// ========================================

/**
* ربط البيانات مع صفحة تصميم الدورة
*/
function syncWithCourseBuilder() {
   // التحقق من وجود بيانات محفوظة من course-builder
   const savedCourseData = localStorage.getItem('currentCourseDesign');
   
   if (savedCourseData) {
       try {
           const parsedData = JSON.parse(savedCourseData);
           // دمج البيانات المحفوظة مع البيانات الحالية
           currentCourseData = { ...currentCourseData, ...parsedData };
           
           // إعادة تهيئة القسم بالبيانات الجديدة
           initializeInvestmentSection();
       } catch (error) {
           console.error('خطأ في قراءة بيانات التصميم:', error);
       }
   }
}

/**
* تحديث الأسعار في الوقت الفعلي
*/
function setupRealtimePriceSync() {
   // الاستماع لتغييرات الأسعار من Firebase
   if (currentCourseData?.id) {
       db.collection('courses').doc(currentCourseData.id)
           .onSnapshot((doc) => {
               if (doc.exists) {
                   const updatedData = doc.data();
                   
                   // التحقق من تغيير الأسعار
                   if (updatedData.price !== currentCourseData.price ||
                       updatedData.salePrice !== currentCourseData.salePrice ||
                       JSON.stringify(updatedData.discounts) !== JSON.stringify(currentCourseData.discounts)) {
                       
                       currentCourseData = { ...currentCourseData, ...updatedData };
                       
                       // تحديث العناصر المتأثرة
                       updatePriceElements();
                       buildComprehensivePricingTable();
                       showInfoToast('تم تحديث الأسعار');
                   }
               }
           });
   }
}

/**
* تحديث عناصر الأسعار دون إعادة تحميل الصفحة
*/
function updatePriceElements() {
   // تحديث معاينات البطاقات
   document.querySelectorAll('.journey-card').forEach(card => {
       updateCardPreview(card);
   });
   
   // تحديث العروض الزمنية
   initializeTimeOffers();
   
   // تحديث الملخص الحالي
   updatePlanSummary();
   
   // تحديث الحاسبة
   updateCalculatorResult();
}

/**
* حفظ حالة القسم للعودة إليها
*/
function saveInvestmentState() {
   const state = {
       selectedJourney,
       selectedTimeOffer,
       selectedPaymentMethod,
       selectedGroupSize,
       appliedCoupon,
       scrollPosition: window.scrollY
   };
   
   sessionStorage.setItem('investmentState', JSON.stringify(state));
}

/**
* استرجاع حالة القسم المحفوظة
*/
function restoreInvestmentState() {
   const savedState = sessionStorage.getItem('investmentState');
   
   if (savedState) {
       try {
           const state = JSON.parse(savedState);
           
           // استرجاع القيم
           selectedJourney = state.selectedJourney;
           selectedTimeOffer = state.selectedTimeOffer;
           selectedPaymentMethod = state.selectedPaymentMethod;
           selectedGroupSize = state.selectedGroupSize;
           appliedCoupon = state.appliedCoupon;
           
           // تطبيق الحالة
           if (selectedJourney) {
               selectJourney(selectedJourney);
           }
           
           // استرجاع موضع التمرير
           window.scrollTo(0, state.scrollPosition);
           
       } catch (error) {
           console.error('خطأ في استرجاع الحالة:', error);
       }
   }
}

/**
* التحقق من صلاحية العروض بشكل دوري
*/
function startOffersValidation() {
   // التحقق كل دقيقة
   setInterval(() => {
       const activeDiscounts = getActiveTimeDiscounts();
       const currentActiveCount = document.querySelectorAll('.offer-option:not([style*="opacity: 0.5"])').length - 1;
       
       // إذا تغير عدد العروض النشطة
       if (activeDiscounts.length !== currentActiveCount) {
           initializeTimeOffers();
           showInfoToast('تم تحديث العروض المتاحة');
       }
   }, 60000);
}

/**
* تتبع التحليلات
*/
function trackInvestmentAnalytics(action, details = {}) {
   // إرسال أحداث التتبع (يمكن ربطها مع Google Analytics أو Mixpanel)
   if (typeof gtag !== 'undefined') {
       gtag('event', action, {
           event_category: 'Investment',
           event_label: currentCourseData?.title,
           value: details.value,
           ...details
       });
   }
   
   // حفظ في Firebase للتحليل
   db.collection('investmentAnalytics').add({
       courseId: currentCourseData?.id,
       action,
       details,
       timestamp: firebase.firestore.FieldValue.serverTimestamp(),
       userId: firebase.auth().currentUser?.uid || 'anonymous'
   }).catch(console.error);
}

/**
* معالجة الأخطاء المركزية
*/
window.addEventListener('error', function(event) {
   if (event.filename?.includes('investment')) {
       console.error('خطأ في قسم الاستثمار:', event.error);
       
       // إرسال تقرير الخطأ
       db.collection('errorReports').add({
           page: 'investment',
           error: event.error.toString(),
           stack: event.error.stack,
           timestamp: firebase.firestore.FieldValue.serverTimestamp()
       }).catch(console.error);
   }
});

/**
* تنظيف الموارد عند مغادرة الصفحة
*/
window.addEventListener('beforeunload', function() {
   // حفظ الحالة الحالية
   saveInvestmentState();
   
   // إلغاء المؤقتات
   if (typeof offerCountdownIntervals !== 'undefined') {
       offerCountdownIntervals.forEach(interval => clearInterval(interval));
   }
});

// ========================================
// دوال خاصة بالأداء والتحسين
// ========================================

/**
* تحميل كسول للصور
*/
function setupLazyLoading() {
   const images = document.querySelectorAll('.investment-container img[data-src]');
   
   const imageObserver = new IntersectionObserver((entries, observer) => {
       entries.forEach(entry => {
           if (entry.isIntersecting) {
               const img = entry.target;
               img.src = img.dataset.src;
               img.removeAttribute('data-src');
               observer.unobserve(img);
           }
       });
   });
   
   images.forEach(img => imageObserver.observe(img));
}

/**
* تحسين أداء الأنيميشن
*/
function optimizeAnimations() {
   // إيقاف الأنيميشن غير المرئية
   const animatedElements = document.querySelectorAll('.pulsing, .rotating, .floating');
   
   const animationObserver = new IntersectionObserver((entries) => {
       entries.forEach(entry => {
           if (entry.isIntersecting) {
               entry.target.style.animationPlayState = 'running';
           } else {
               entry.target.style.animationPlayState = 'paused';
           }
       });
   });
   
   animatedElements.forEach(el => animationObserver.observe(el));
}

/**
* تقليل عدد عمليات إعادة الحساب
*/
const debounce = (func, wait) => {
   let timeout;
   return function executedFunction(...args) {
       const later = () => {
           clearTimeout(timeout);
           func(...args);
       };
       clearTimeout(timeout);
       timeout = setTimeout(later, wait);
   };
};

// استخدام debounce للدوال المكلفة
const debouncedUpdateCalculator = debounce(updateCalculatorResult, 300);
const debouncedUpdateGroupSize = debounce(updateGroupSize, 200);

// ========================================
// دوال الربط مع واجهات برمجة التطبيقات الخارجية
// ========================================

/**
* إرسال تنبيه WhatsApp للمنح
*/
async function sendWhatsAppNotification(applicationData) {
   // يمكن استخدام WhatsApp Business API
   const phoneNumber = applicationData.whatsappNumber;
   const message = `طلب منحة جديد!
الاسم: ${applicationData.fullName}
الدورة: ${applicationData.courseTitle}
رقم الطلب: ${applicationData.applicationNumber}`;
   
   // فتح WhatsApp Web
   const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
   window.open(whatsappUrl, '_blank');
}

/**
* تكامل مع بوابات الدفع
*/
async function initializePaymentGateway(paymentDetails) {
   // مثال للتكامل مع PayMob أو Fawry
   const paymentData = {
       amount: paymentDetails.amount,
       currency: 'EGP',
       orderId: generateOrderId(),
       customerEmail: paymentDetails.email,
       customerPhone: paymentDetails.phone,
       courseId: currentCourseData.id,
       courseTitle: currentCourseData.title
   };
   
   // استدعاء API الدفع
   try {
       const response = await fetch('/api/create-payment', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           body: JSON.stringify(paymentData)
       });
       
       const result = await response.json();
       
       if (result.success) {
           // توجيه لصفحة الدفع
           window.location.href = result.paymentUrl;
       } else {
           showErrorToast('حدث خطأ في معالجة الدفع');
       }
   } catch (error) {
       console.error('خطأ في الدفع:', error);
       showErrorToast('تعذر الاتصال بخدمة الدفع');
   }
}

function generateOrderId() {
   return 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
}

// ========================================
// التهيئة النهائية
// ========================================

/**
* التهيئة الكاملة عند التحميل
*/
function initializeCompleteInvestmentSystem() {
   // التحقق من الدعم
   if (!checkBrowserSupport()) {
       showBrowserWarning();
       return;
   }
   
   // تحميل البيانات
   const urlParams = new URLSearchParams(window.location.search);
   const courseId = urlParams.get('course');
   
   if (courseId) {
       // تحميل البيانات الأساسية
       loadInvestmentData(courseId).then(() => {
           // تهيئة الميزات الإضافية
           syncWithCourseBuilder();
           setupRealtimePriceSync();
           restoreInvestmentState();
           startOffersValidation();
           setupLazyLoading();
           optimizeAnimations();
           
           // تتبع فتح الصفحة
           trackInvestmentAnalytics('page_view', {
               courseId: currentCourseData.id
           });
       });
   } else {
       showErrorMessage('لم يتم تحديد الدورة');
   }
}

/**
* التحقق من دعم المتصفح
*/
function checkBrowserSupport() {
   const features = [
       'IntersectionObserver' in window,
       'localStorage' in window,
       'sessionStorage' in window,
       'Promise' in window,
       'fetch' in window
   ];
   
   return features.every(feature => feature);
}

/**
* عرض تحذير للمتصفحات القديمة
*/
function showBrowserWarning() {
   const warning = document.createElement('div');
   warning.className = 'browser-warning';
   warning.innerHTML = `
       <p>متصفحك قديم وقد لا يدعم جميع ميزات الموقع.</p>
       <p>يرجى تحديث متصفحك للحصول على أفضل تجربة.</p>
   `;
   
   document.body.insertBefore(warning, document.body.firstChild);
}

// بدء التهيئة عند تحميل DOM
if (document.readyState === 'loading') {
   document.addEventListener('DOMContentLoaded', initializeCompleteInvestmentSystem);
} else {
   initializeCompleteInvestmentSystem();
}

// ========================================
// تصدير الدوال للاستخدام الخارجي
// ========================================

window.InvestmentSystem = {
   loadData: loadInvestmentData,
   updatePrices: updatePriceElements,
   trackEvent: trackInvestmentAnalytics,
   getCurrentState: () => ({
       course: currentCourseData,
       journey: selectedJourney,
       selections: {
           timeOffer: selectedTimeOffer,
           paymentMethod: selectedPaymentMethod,
           groupSize: selectedGroupSize,
           coupon: appliedCoupon
       }
   }),
   calculateFinalPrice: () => {
       let price = currentCourseData?.salePrice || currentCourseData?.price || 0;
       
       // تطبيق جميع الخصومات
       if (selectedTimeOffer?.discount) {
           price = calculatePriceAfterDiscount(price, selectedTimeOffer.discount);
       }
       
       if (selectedJourney === 'group' && selectedGroupSize > 1) {
           const groupDiscount = getApplicableGroupDiscount(selectedGroupSize);
           if (groupDiscount) {
               price = calculatePriceAfterDiscount(price, groupDiscount.percentage);
           }
       }
       
       if (appliedCoupon) {
           if (appliedCoupon.type === 'percentage') {
               price = calculatePriceAfterDiscount(price, appliedCoupon.value);
           } else {
               price = Math.max(0, price - appliedCoupon.value);
           }
       }
       
       if (selectedPaymentMethod === 'cash' && currentCourseData?.cashDiscount?.enabled) {
           price = calculatePriceAfterDiscount(price, currentCourseData.cashDiscount.percentage);
       }
       
       return price;
   }
};

// نهاية ملف JavaScript لقسم الاستثمار


        // ===== تشغيل الصفحة عند التحميل =====
        document.addEventListener('DOMContentLoaded', function() {
            loadCourseData();
        });
    </script>
</body>
</html>
