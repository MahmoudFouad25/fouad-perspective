<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- الترميز العربي -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استثمر في رحلتك - منصة فؤاد</title>
    
    <!-- الخطوط -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- الأيقونات -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Bootstrap للتصميم السريع -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- SweetAlert للتنبيهات الجميلة -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- الستايل الأساسي -->
    <style>
        /* المتغيرات الأساسية */
        :root {
            /* الألوان الذهبية */
            --gold-primary: #FFD700;
            --gold-light: #FFF3CD;
            --gold-dark: #D4AF37;
            
            /* الألوان الداكنة */
            --dark-bg: #0A1628;
            --dark-lighter: #1E3A5F;
            --dark-card: #152238;
            
            /* ألوان الأشواق التسعة */
            --longing-1: #E11D48;
            --longing-2: #EC4899;
            --longing-3: #F97316;
            --longing-4: #9333EA;
            --longing-5: #22C55E;
            --longing-6: #3B82F6;
            --longing-7: #FBBF24;
            --longing-8: #7F1D1D;
            --longing-9: #14B8A6;
        }
        
        /* الإعدادات الأساسية */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: var(--dark-bg);
            color: white;
            overflow-x: hidden;
        }
        
        /* شاشة التحميل */
        .preloader {
            position: fixed;
            width: 100%;
            height: 100vh;
            background: var(--dark-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        
        .preloader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .preloader-heart {
            font-size: 60px;
            color: var(--gold-primary);
            animation: heartbeat 1s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* الهيرو سكشن */
        .hero-section {
            min-height: 100vh;
            padding: 100px 0 50px;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--dark-lighter) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .hero-title {
            font-size: 3rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(90deg, var(--gold-primary), var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* القلب النابض */
        .dynamic-heart-container {
            width: 300px;
            height: 300px;
            margin: 0 auto 40px;
            position: relative;
        }
        
        .heart-svg {
            width: 100%;
            height: 100%;
        }
        
        /* البطاقات */
        .journey-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        
        .journey-card {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .journey-card:hover {
            transform: translateY(-10px);
            border-color: var(--gold-primary);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
        
        .journey-card .icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--gold-primary);
        }
        
        .journey-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .journey-card p {
            color: #94a3b8;
            margin-bottom: 20px;
        }
        
        .journey-card .price {
            font-size: 1.2rem;
            color: var(--gold-primary);
            font-weight: bold;
        }
        
       /* المحتوى الديناميكي الجديد */
.content-area {
    animation: fadeIn 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* بطاقة السعر */
.price-card {
    background: var(--dark-card);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    border: 2px solid rgba(255, 215, 0, 0.2);
}

.price-header h3 {
    color: #94a3b8;
    margin-bottom: 20px;
}

.original-price {
    text-decoration: line-through;
    color: #64748b;
    font-size: 1.2rem;
}

.sale-price {
    font-size: 3rem;
    color: var(--gold-primary);
    font-weight: bold;
    margin: 20px 0;
}

.savings-badge {
    display: inline-block;
    background: var(--longing-5);
    color: white;
    padding: 5px 20px;
    border-radius: 20px;
    font-weight: bold;
}

/* خيارات الدفع */
.payment-options {
    margin-top: 40px;
}

.options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.payment-option {
    background: rgba(255, 215, 0, 0.1);
    border: 2px solid transparent;
    border-radius: 15px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s;
}

.payment-option:hover {
    border-color: var(--gold-primary);
    transform: translateY(-5px);
}

.payment-option i {
    font-size: 2rem;
    color: var(--gold-primary);
    margin-bottom: 10px;
}

.payment-option h5 {
    margin: 10px 0;
}

.payment-option .price {
    font-size: 1.3rem;
    color: var(--gold-primary);
    font-weight: bold;
    margin: 5px 0;
}

/* زر الحجز */
.btn-book-now {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--dark-bg);
    border: none;
    padding: 15px 40px;
    font-size: 1.2rem;
    font-weight: bold;
    border-radius: 50px;
    margin-top: 30px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-book-now:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
}

/* محاكي المجموعات */
.simulator-card {
    background: var(--dark-card);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
}

.group-slider {
    width: 100%;
    margin: 30px 0;
}

.slider-value {
    font-size: 2rem;
    color: var(--gold-primary);
    font-weight: bold;
}

.people-icons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 30px 0;
}

.person-icon {
    font-size: 2rem;
    color: var(--gold-primary);
    animation: fadeIn 0.3s;
}

.savings-calculation {
    background: rgba(255, 215, 0, 0.1);
    border-radius: 15px;
    padding: 30px;
    margin: 30px 0;
}

.calc-item {
    margin: 10px 0;
}

.calc-item label {
    color: #94a3b8;
    display: block;
}

.calc-item span {
    font-size: 1.5rem;
    font-weight: bold;
}

.highlight {
    color: var(--gold-primary);
}

.total-savings {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid rgba(255, 215, 0, 0.3);
}

.savings-amount {
    font-size: 2.5rem;
    color: var(--longing-5);
    font-weight: bold;
}

.btn-share-group {
    background: var(--longing-6);
    color: white;
    border: none;
    padding: 15px 30px;
    font-size: 1.1rem;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-share-group:hover {
    transform: scale(1.05);
}

/* بطاقات الدعم */
.support-card {
    background: var(--dark-card);
    border-radius: 15px;
    padding: 30px;
    text-align: center;
    margin-bottom: 20px;
    transition: all 0.3s;
}

.support-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
}

.support-card i {
    font-size: 3rem;
    color: var(--gold-primary);
    margin-bottom: 20px;
}

.btn-apply {
    background: var(--gold-primary);
    color: var(--dark-bg);
    border: none;
    padding: 10px 25px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-apply:hover {
    transform: scale(1.1);
}

/* بطاقات الهدايا */
.gift-card {
    background: var(--dark-card);
    border-radius: 20px;
    padding: 40px;
}

.gift-types {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.gift-type {
    background: rgba(255, 215, 0, 0.1);
    border-radius: 15px;
    padding: 25px;
    cursor: pointer;
    transition: all 0.3s;
}

.gift-type:hover {
    transform: translateY(-5px);
    background: rgba(255, 215, 0, 0.2);
}

.gift-type i {
    font-size: 2.5rem;
    color: var(--gold-primary);
    margin-bottom: 15px;
}
        
        /* الفوتر */
        footer {
            background: var(--dark-card);
            padding: 30px 0;
            text-align: center;
            margin-top: 100px;
        }

        /* شريط العروض */
.time-offers-bar {
    background: linear-gradient(135deg, var(--dark-card), var(--dark-lighter));
    padding: 40px 0;
    margin: 50px 0;
    position: relative;
    overflow: hidden;
}

.time-offers-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    to { left: 100%; }
}

.offers-header {
    text-align: center;
    margin-bottom: 30px;
}

.offers-header h3 {
    color: var(--gold-primary);
    font-size: 2rem;
}

.offers-header i {
    animation: fire 1s infinite;
}

@keyframes fire {
    0%, 100% { color: var(--gold-primary); }
    50% { color: var(--longing-3); }
}

.offers-slider {
    display: flex;
    gap: 30px;
    justify-content: center;
    flex-wrap: wrap;
}

.offer-card {
    background: var(--dark-card);
    border-radius: 20px;
    padding: 25px;
    min-width: 250px;
    text-align: center;
    position: relative;
    border: 2px solid transparent;
    transition: all 0.3s;
}

.offer-card.urgent {
    border-color: var(--longing-1);
    animation: pulse-red 2s infinite;
}

.offer-card.active {
    border-color: var(--longing-5);
}

.offer-card.upcoming {
    opacity: 0.7;
    border-color: var(--longing-7);
}

@keyframes pulse-red {
    0%, 100% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.4); }
    50% { box-shadow: 0 0 20px 10px rgba(225, 29, 72, 0.4); }
}

.offer-badge {
    position: absolute;
    top: -10px;
    right: 20px;
    background: var(--gold-primary);
    color: var(--dark-bg);
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
}

.offer-card h4 {
    margin: 20px 0 15px;
    color: white;
}

.offer-discount {
    font-size: 2.5rem;
    font-weight: bold;
    color: var(--gold-primary);
    margin: 15px 0;
}

.offer-timer {
    display: flex;
    justify-content: center;
    gap: 5px;
    font-size: 1.2rem;
    color: #94a3b8;
}

.offer-timer span {
    color: white;
    font-weight: bold;
}

/* الإشعارات المباشرة */
.live-notifications {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 1000;
    max-width: 350px;
}

.notification {
    background: var(--dark-card);
    border-right: 3px solid var(--gold-primary);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
    animation: slideInLeft 0.5s, fadeOut 0.5s 4.5s;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

@keyframes slideInLeft {
    from { transform: translateX(-100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeOut {
    to { opacity: 0; transform: translateX(-20px); }
}

.notification i {
    font-size: 1.5rem;
    color: var(--gold-primary);
}

/* مؤشر المقاعد */
.seats-indicator-floating {
    position: fixed;
    top: 100px;
    left: 20px;
    background: var(--longing-1);
    color: white;
    padding: 10px 20px;
    border-radius: 30px;
    z-index: 999;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

/* قسم الشهادات */
.testimonials-section {
    padding: 80px 0;
    background: var(--dark-lighter);
}

.testimonials-carousel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-bottom: 60px;
}

.testimonial-card {
    background: var(--dark-card);
    border-radius: 20px;
    padding: 30px;
    position: relative;
}

.testimonial-card::before {
    content: '"';
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 4rem;
    color: rgba(255, 215, 0, 0.2);
}

.stars {
    color: var(--gold-primary);
    margin-bottom: 20px;
}

.testimonial-text {
    color: #e2e8f0;
    font-style: italic;
    margin-bottom: 20px;
    line-height: 1.8;
}

.testimonial-author {
    display: flex;
    align-items: center;
    gap: 15px;
}

.testimonial-author img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 2px solid var(--gold-primary);
}

.testimonial-author h5 {
    margin: 0;
    color: white;
}

.testimonial-author small {
    color: #94a3b8;
}

/* الإحصائيات */
.stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 30px;
    text-align: center;
}

.stat-item {
    background: var(--dark-card);
    border-radius: 15px;
    padding: 30px 20px;
}

.stat-number {
    font-size: 3rem;
    font-weight: bold;
    color: var(--gold-primary);
}

.stat-label {
    color: #94a3b8;
    margin-top: 10px;
}

/* تحسينات للموبايل */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2rem;
    }
    
    .offers-slider {
        flex-direction: column;
        align-items: center;
    }
    
    /* مؤشر المقاعد - ثابت في الأعلى على الموبايل */
    .seats-indicator-floating {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        right: auto;
        bottom: auto;
        z-index: 9999;
        font-size: 0.9rem;
        padding: 8px 15px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { 
            transform: translateX(-50%) scale(1);
            box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.7);
        }
        50% { 
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 0 15px 5px rgba(225, 29, 72, 0);
        }
    }
    
    /* الإشعارات - تظهر في الأسفل */
    .live-notifications {
        position: fixed;
        bottom: 20px;
        left: 10px;
        right: 10px;
        max-width: none;
        z-index: 1000;
    }
    
    .notification {
        background: var(--dark-card);
        border-right: 3px solid var(--gold-primary);
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.9rem;
        box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        animation: slideUp 0.5s, fadeOut 0.5s 4.5s;
    }
    
    @keyframes slideUp {
        from { 
            transform: translateY(100%); 
            opacity: 0; 
        }
        to { 
            transform: translateY(0); 
            opacity: 1; 
        }
    }
    
    .notification i {
        font-size: 1.2rem;
    }
    
    /* تعديلات إضافية للموبايل */
    .journey-cards {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .journey-card {
        padding: 25px;
    }
    
    .dynamic-heart-container {
        width: 200px;
        height: 200px;
    }
    
    .offer-card {
        min-width: 100%;
        margin: 0 10px;
    }
    
    .testimonials-carousel {
        grid-template-columns: 1fr;
    }
    
    .stats-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    .stat-number {
        font-size: 2rem;
    }
    
    /* تحسين المحتوى الديناميكي */
    .price-card {
        padding: 25px;
    }
    
    .sale-price {
        font-size: 2rem;
    }
    
    .options-grid {
        grid-template-columns: 1fr;
    }
    
    /* زر WhatsApp عائم */
    .whatsapp-float {
        position: fixed;
        bottom: 80px;
        left: 20px;
        background: #25D366;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        z-index: 999;
        box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
    }
}

/* للشاشات الصغيرة جداً */
@media (max-width: 480px) {
    .hero-title {
        font-size: 1.5rem;
        padding: 0 10px;
    }
    
    .seats-indicator-floating {
        font-size: 0.8rem;
        padding: 6px 12px;
    }
    
    .notification {
        font-size: 0.85rem;
        padding: 10px;
    }
}
   /* الحاسبة الذكية */
.smart-calculator-section {
    padding: 80px 0;
    background: var(--dark-lighter);
}

.calculator-wrapper {
    background: var(--dark-card);
    border-radius: 30px;
    padding: 40px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.calculator-inputs, .calculator-results {
    background: rgba(255, 215, 0, 0.05);
    border-radius: 20px;
    padding: 30px;
    height: 100%;
}

.calculator-inputs h4, .calculator-results h4 {
    color: var(--gold-primary);
    margin-bottom: 25px;
    font-weight: bold;
}

.input-group {
    margin-bottom: 25px;
}

.input-group label {
    display: block;
    margin-bottom: 10px;
    color: #94a3b8;
    font-weight: 600;
}

.form-select, .form-range {
    background: var(--dark-bg);
    color: white;
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    padding: 10px;
}

.form-select:focus {
    border-color: var(--gold-primary);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.range-value {
    display: inline-block;
    margin-left: 15px;
    font-size: 1.5rem;
    color: var(--gold-primary);
    font-weight: bold;
}

.payment-methods {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}

.payment-method {
    background: var(--dark-bg);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    padding: 10px;
    cursor: pointer;
    transition: all 0.3s;
}

.payment-method:hover {
    border-color: var(--gold-primary);
}

.payment-method input[type="radio"] {
    margin-right: 5px;
}

.payment-method input[type="radio"]:checked + span {
    color: var(--gold-primary);
    font-weight: bold;
}

.coupon-input {
    display: flex;
    gap: 10px;
}

.coupon-input input {
    flex: 1;
    background: var(--dark-bg);
    color: white;
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    padding: 10px;
}

.coupon-input button {
    background: var(--gold-primary);
    color: var(--dark-bg);
    border: none;
    border-radius: 10px;
    padding: 10px 20px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.coupon-input button:hover {
    transform: scale(1.05);
}

/* نتائج الحاسبة */
.price-breakdown {
    background: var(--dark-bg);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
}

.price-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-size: 1.1rem;
}

.discount-row {
    color: var(--longing-5);
}

.total-row {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--gold-primary);
    margin-top: 10px;
}

.installment-row {
    color: var(--longing-6);
    font-size: 1.2rem;
}

.savings-badge {
    background: linear-gradient(135deg, var(--longing-5), var(--longing-6));
    color: white;
    border-radius: 20px;
    padding: 15px;
    text-align: center;
    margin-bottom: 20px;
}

.btn-calculate-book {
    width: 100%;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--dark-bg);
    border: none;
    border-radius: 50px;
    padding: 15px;
    font-size: 1.2rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-calculate-book:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
}

/* الجدول الشامل */
.comprehensive-table-section {
    padding: 80px 0;
    background: var(--dark-bg);
}

.table-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
}

.table-btn {
    background: var(--dark-card);
    color: white;
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 25px;
    padding: 10px 30px;
    cursor: pointer;
    transition: all 0.3s;
}

.table-btn.active {
    background: var(--gold-primary);
    color: var(--dark-bg);
    border-color: var(--gold-primary);
}

.pricing-table {
    width: 100%;
    background: var(--dark-card);
    border-radius: 20px;
    overflow: hidden;
}

.pricing-table thead {
    background: linear-gradient(135deg, var(--longing-4), var(--longing-6));
}

.pricing-table th {
    padding: 20px;
    color: white;
    font-weight: bold;
    text-align: center;
}

.pricing-table td {
    padding: 20px;
    text-align: center;
    color: #e2e8f0;
    border-bottom: 1px solid rgba(255, 215, 0, 0.1);
}

.pricing-table tbody tr:hover {
    background: rgba(255, 215, 0, 0.05);
}

.old-price {
    text-decoration: line-through;
    color: #64748b;
}

.offer-price {
    color: var(--gold-primary);
    font-weight: bold;
    font-size: 1.2rem;
}

.cash-price {
    color: var(--longing-5);
    font-weight: bold;
}

.individual-row td:first-child {
    color: var(--longing-6);
}

.group-row td:first-child {
    color: var(--longing-4);
}

.support-row td:first-child {
    color: var(--longing-5);
}

.table-notes {
    margin-top: 30px;
    text-align: center;
}

.table-notes p {
    color: #94a3b8;
    margin: 10px 0;
}

.table-notes i {
    color: var(--gold-primary);
    margin-right: 10px;
}

/* تحسينات الموبايل للحاسبة والجدول */
@media (max-width: 768px) {
    .calculator-wrapper {
        padding: 20px;
    }
    
    .calculator-inputs, .calculator-results {
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .payment-methods {
        grid-template-columns: 1fr;
    }
    
    .table-controls {
        flex-direction: column;
        align-items: stretch;
    }
    
    .pricing-table {
        font-size: 0.9rem;
    }
    
    .pricing-table th, .pricing-table td {
        padding: 10px 5px;
    }
} 

        /* تحسينات الجدول للأقساط */
.pricing-table td small {
    color: #94a3b8;
    font-size: 0.85rem;
}

.pricing-table td strong {
    color: var(--longing-6);
    font-size: 1.1rem;
}

/* تحسين عرض الأقساط في الحاسبة */
.installment-row span {
    font-size: 1rem !important;
    line-height: 1.5;
}

/* تحسينات العروض النشطة */
.offers-slider {
    display: flex;
    gap: 20px;
    overflow-x: auto;
    padding: 20px 0;
    scroll-snap-type: x mandatory;
}

.offer-card {
    min-width: 280px;
    background: var(--dark-card);
    border-radius: 20px;
    padding: 25px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    scroll-snap-align: start;
}

.offer-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
}

/* بطاقة السعر */
.offer-card.price-card {
    border-color: var(--gold-primary);
    background: linear-gradient(135deg, var(--dark-card), rgba(255, 215, 0, 0.05));
}

.price-display {
    text-align: center;
    padding: 20px 0;
}

.price-original {
    color: #94a3b8;
    text-decoration: line-through;
    font-size: 1.2rem;
    margin-bottom: 5px;
}

.price-current {
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 5px;
    margin: 10px 0;
}

.price-current.solo {
    margin: 20px 0;
}

.price-number {
    font-size: 2.5rem;
    font-weight: bold;
    color: var(--gold-primary);
}

.price-currency {
    font-size: 1.2rem;
    color: var(--gold-light);
}

.savings-badge {
    display: inline-block;
    background: var(--longing-5);
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    margin-top: 10px;
}

/* بطاقة الدفع النقدي */
.offer-card.cash-card {
    border-color: var(--longing-5);
    background: linear-gradient(135deg, var(--dark-card), rgba(34, 197, 94, 0.05));
}

.cash-details {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 15px 0;
}

.discount-percentage {
    text-align: center;
}

.big-number {
    font-size: 3rem;
    font-weight: bold;
    color: var(--longing-5);
    display: block;
}

.cash-price {
    text-align: center;
}

.final-price {
    font-size: 1.8rem;
    font-weight: bold;
    color: white;
    display: block;
}

.instead-of {
    color: #94a3b8;
    font-size: 0.9rem;
}

/* بطاقة الأقساط */
.offer-card.installments-card {
    border-color: var(--longing-6);
    background: linear-gradient(135deg, var(--dark-card), rgba(59, 130, 246, 0.05));
}

.plans-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 15px;
}

.plan-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 10px;
    border-right: 3px solid var(--longing-6);
}

.plan-name {
    color: var(--longing-6);
    font-weight: bold;
    margin-bottom: 5px;
}

.plan-details {
    display: flex;
    align-items: baseline;
    gap: 5px;
    flex-wrap: wrap;
}

.first-payment {
    color: var(--gold-primary);
    font-weight: bold;
}

.monthly {
    color: white;
    font-size: 1.2rem;
    font-weight: bold;
}

/* بطاقة المجموعات */
.offer-card.groups-card {
    border-color: var(--longing-4);
    background: linear-gradient(135deg, var(--dark-card), rgba(147, 51, 234, 0.05));
}

.groups-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 15px;
}

.group-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 10px;
}

.group-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
}

.group-name {
    color: var(--longing-4);
    font-weight: bold;
}

.group-size {
    color: #94a3b8;
    font-size: 0.9rem;
}

.group-pricing {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.per-person {
    color: white;
    font-weight: bold;
}

/* بطاقة العروض الزمنية */
.offer-card.time-offer {
    min-width: 320px;
}

.offer-card.active-offer {
    border-color: var(--longing-1);
    animation: pulse-border 2s infinite;
}

@keyframes pulse-border {
    0%, 100% { border-color: var(--longing-1); }
    50% { border-color: var(--gold-primary); }
}

.time-offer-details {
    display: flex;
    gap: 20px;
    align-items: center;
    padding: 15px 0;
}

.discount-circle {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--longing-1), var(--longing-3));
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.discount-circle .percentage {
    font-size: 1.8rem;
    font-weight: bold;
    color: white;
}

.discount-circle .label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.9);
}

.dates {
    flex: 1;
}

.date-row {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #94a3b8;
    margin: 5px 0;
}

.date-row i {
    color: var(--gold-primary);
    width: 20px;
}

/* العداد التنازلي المحسن */
.offer-timer {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
    padding: 10px;
    background: rgba(255, 215, 0, 0.1);
    border-radius: 10px;
}

.timer-item {
    text-align: center;
}

.timer-item span:first-child {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--gold-primary);
    display: block;
}

.timer-item .label {
    font-size: 0.8rem;
    color: #94a3b8;
}

/* الأيقونات */
.offer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.offer-icon {
    font-size: 2rem;
    opacity: 0.3;
}

/* الشارات */
.offer-badge {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
}

.offer-badge.pulse {
    background: var(--gold-primary);
    color: var(--dark-bg);
    animation: pulse 2s infinite;
}

.offer-badge.cash {
    background: var(--longing-5);
    color: white;
}

.offer-badge.installments {
    background: var(--longing-6);
    color: white;
}

.offer-badge.groups {
    background: var(--longing-4);
    color: white;
}

.offer-badge.urgent {
    background: var(--longing-1);
    color: white;
    animation: pulse 1s infinite;
}

.offer-badge.soon {
    background: var(--longing-7);
    color: var(--dark-bg);
}

/* Responsive */
@media (max-width: 768px) {
    .offers-slider {
        padding: 10px;
    }
    
    .offer-card {
        min-width: 85vw;
    }
    
    .time-offer-details {
        flex-direction: column;
        text-align: center;
    }
}

        /* تحسينات إضافية */
.no-interest-badge {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid var(--longing-5);
    color: var(--longing-5);
    padding: 8px 15px;
    border-radius: 10px;
    margin-top: 15px;
    text-align: center;
    font-size: 0.9rem;
}

.limited-time {
    background: rgba(225, 29, 72, 0.1);
    border: 1px solid var(--longing-1);
    color: var(--longing-1);
    padding: 8px 15px;
    border-radius: 10px;
    margin-top: 15px;
    text-align: center;
    animation: pulse 2s infinite;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.9rem;
    font-weight: 500;
}

/* تأكيد المحاذاة على الموبايل */
@media (max-width: 768px) {
    .limited-time {
        text-align: center !important;
        justify-content: center !important;
        align-items: center !important;
        display: flex !important;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
    }
    
    .cash-details {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }
    
    .cash-details > * {
        width: 100%;
        text-align: center;
    }
}

/* تحسين العرض الكامل لبطاقة الدفع النقدي على الموبايل */
@media (max-width: 768px) {
    .offer-card.cash-card {
        text-align: center;
    }
    
    .offer-card.cash-card .cash-details {
        align-items: center;
        justify-content: center;
        width: 100%;
    }
    
    .offer-card.cash-card .discount-percentage,
    .offer-card.cash-card .cash-price {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    
    .offer-card.cash-card .big-number,
    .offer-card.cash-card .final-price,
    .offer-card.cash-card .instead-of {
        text-align: center;
        width: 100%;
    }
}

/* تحسين الأنيميشن للنبض */
@keyframes pulse {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.9;
        transform: scale(1.02);
    }
}

.group-features {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.group-features .feature {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--longing-5);
    margin: 5px 0;
    font-size: 0.9rem;
}

.offer-extra-info {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--longing-5);
    margin-top: 10px;
    font-size: 0.9rem;
    padding: 5px 10px;
    background: rgba(34, 197, 94, 0.1);
    border-radius: 8px;
}

.offer-price {
    margin-top: 10px;
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--gold-primary);
}
/* ترتيب العروض في صفوف */
.offers-row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding: 10px 0;
}

.time-offers-row {
    scroll-snap-type: x mandatory;
}

.main-offers-row {
    justify-content: flex-start;
}

.group-offers-row {
    justify-content: flex-start;
}

/* تحسينات العداد */
.offer-timer {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 15px;
    padding: 15px;
    background: rgba(255, 215, 0, 0.1);
    border-radius: 10px;
    border: 1px solid rgba(255, 215, 0, 0.3);
}

.timer-item {
    text-align: center;
    min-width: 50px;
}

.timer-item span:first-child {
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--gold-primary);
    display: block;
    line-height: 1;
}

.timer-item .label {
    font-size: 0.75rem;
    color: #94a3b8;
    margin-top: 3px;
}

/* تاريخ انتهاء العرض في بطاقة السعر */
.active-until {
    margin-top: 10px;
    padding: 8px 12px;
    background: rgba(225, 29, 72, 0.1);
    border-radius: 8px;
    color: var(--longing-1);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
}

/* ميزات العرض */
.offer-features {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

/* Responsive للترتيب */
@media (min-width: 1024px) {
    .offers-slider {
        display: block !important;
    }
    
    .offers-row {
        display: flex !important;
        flex-wrap: nowrap;
        justify-content: center;
    }
    
    .time-offers-row {
        justify-content: center;
        margin-bottom: 30px;
    }
    
    .main-offers-row .offer-card,
    .group-offers-row .offer-card {
        flex: 1;
        max-width: 350px;
    }
}

@media (max-width: 1023px) {
    .offers-slider {
        display: flex !important;
        flex-direction: column;
        gap: 15px;
    }
    
    .offers-row {
        display: contents;
    }
    
    .offer-card {
        width: 100%;
        max-width: none;
    }
}
        /* تحسينات الحاسبة الجديدة */
.journey-selector {
    background: rgba(255, 215, 0, 0.05);
    padding: 30px;
    border-radius: 20px;
    margin-bottom: 30px;
}

.journey-options {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.journey-option {
    background: var(--dark-card);
    border: 2px solid transparent;
    border-radius: 15px;
    padding: 20px 40px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
    min-width: 150px;
}

.journey-option:hover {
    transform: translateY(-5px);
    border-color: var(--gold-primary);
}

.journey-option.active {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--dark-bg);
    border-color: var(--gold-primary);
}

.journey-option i {
    font-size: 2rem;
    display: block;
    margin-bottom: 10px;
}

/* بطاقات المجموعات */
.group-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.group-card {
    background: var(--dark-bg);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 15px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.group-card:hover {
    border-color: var(--longing-4);
    transform: translateY(-3px);
}

.group-card.active {
    background: linear-gradient(135deg, var(--longing-4), var(--longing-6));
    border-color: var(--longing-4);
    color: white;
}

.group-card h5 {
    margin: 10px 0 5px;
    font-size: 1.1rem;
}

.group-card .discount {
    color: var(--gold-primary);
    font-weight: bold;
    font-size: 1.3rem;
}

.group-card .size {
    color: #94a3b8;
    font-size: 0.9rem;
}

/* بطاقات الإهداء */
.gift-options-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.gift-option-card {
    background: var(--dark-bg);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 15px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.gift-option-card:hover {
    border-color: var(--longing-2);
    transform: translateY(-3px);
}

.gift-option-card.active {
    background: linear-gradient(135deg, var(--longing-2), var(--longing-3));
    border-color: var(--longing-2);
    color: white;
}

.gift-option-card i {
    font-size: 2rem;
    margin-bottom: 10px;
    display: block;
}

.gift-option-card h5 {
    margin: 10px 0 5px;
    font-size: 1rem;
}

.gift-option-card small {
    font-size: 0.8rem;
    opacity: 0.8;
}

/* بطاقات الدفع */
.payment-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
}

.payment-card {
    background: var(--dark-bg);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 15px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.payment-card:hover {
    border-color: var(--gold-primary);
    transform: translateY(-3px);
}

.payment-card.active {
    background: rgba(255, 215, 0, 0.1);
    border-color: var(--gold-primary);
}

.payment-card i {
    font-size: 1.5rem;
    color: var(--gold-primary);
    margin-bottom: 8px;
    display: block;
}

.payment-card h6 {
    margin: 5px 0;
    font-size: 0.95rem;
}

.payment-card small {
    color: var(--longing-5);
    font-weight: bold;
}

/* العرض النشط */
.active-offer-card {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.05));
    border: 2px solid var(--longing-5);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    text-align: center;
}

.active-offer-card .badge {
    margin-bottom: 10px;
}

.active-offer-card h5 {
    color: white;
    margin: 10px 0;
}

.active-offer-card .discount-badge {
    background: var(--longing-5);
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: bold;
    display: inline-block;
}

/* أزرار الإجراءات */
.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 30px;
}

.btn-primary-action {
    width: 100%;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--dark-bg);
    border: none;
    border-radius: 50px;
    padding: 15px;
    font-size: 1.2rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary-action:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
}

.btn-secondary-action {
    width: 100%;
    background: transparent;
    color: var(--longing-5);
    border: 2px solid var(--longing-5);
    border-radius: 50px;
    padding: 12px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-secondary-action:hover {
    background: var(--longing-5);
    color: white;
    transform: scale(1.02);
}

/* رسالة الدعم */
.support-message {
    background: rgba(34, 197, 94, 0.1);
    border-right: 3px solid var(--longing-5);
    border-radius: 10px;
    padding: 15px;
    margin-top: 20px;
}

.support-message p {
    margin: 0;
    color: #e2e8f0;
    font-size: 0.95rem;
}

.support-message i {
    color: var(--longing-5);
    margin-left: 5px;
}

/* تفاصيل الأقساط المحسنة */
.installment-info {
    background: rgba(59, 130, 246, 0.1);
    border-right: 3px solid var(--longing-6);
    border-radius: 10px;
    padding: 15px;
    margin-top: 15px;
}

.installment-info i {
    color: var(--longing-6);
    margin-left: 5px;
}

/* رسالة التوفير المحسنة */
.savings-message {
    margin-top: 20px;
}

.savings-badge {
    background: linear-gradient(135deg, var(--longing-5), var(--longing-6));
    color: white;
    border-radius: 20px;
    padding: 15px;
    text-align: center;
    font-size: 1.1rem;
}

/* Responsive للموبايل */
@media (max-width: 768px) {
    .journey-options {
        flex-direction: column;
    }
    
    .journey-option {
        width: 100%;
    }
    
    .group-cards {
        grid-template-columns: 1fr;
    }
    
    .payment-cards {
        grid-template-columns: 1fr;
    }
    
    .gift-options-cards {
        grid-template-columns: 1fr;
    }
}
        .voucher-message {
    background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(236, 72, 153, 0.1));
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    text-align: center;
}

.voucher-message h5 {
    color: var(--gold-primary);
    margin-bottom: 10px;
}

.voucher-message p {
    color: #e2e8f0;
    margin: 0;
}
        
    </style>
</head>
<body>
    <!-- شاشة التحميل -->
    <div class="preloader" id="preloader">
        <div class="preloader-heart">
            <i class="fas fa-heart"></i>
        </div>
    </div>
    
    <!-- القسم الرئيسي -->
    <section class="hero-section">
        <div class="container">
            <!-- العنوان -->
            <h1 class="hero-title">استثمر في رحلتك نحو نور الحياة الطيبة</h1>
            
            <!-- القلب النابض -->
            <div class="dynamic-heart-container">
                <svg class="heart-svg" id="dynamicHeart" viewBox="0 0 300 300">
                    <!-- قلب بسيط SVG -->
                    <path d="M150,250 C50,150 50,50 150,100 C250,50 250,150 150,250" 
                          fill="none" 
                          stroke="#FFD700" 
                          stroke-width="3"
                          opacity="0.3">
                        <animate attributeName="opacity" 
                                 values="0.3;1;0.3" 
                                 dur="2s" 
                                 repeatCount="indefinite"/>
                    </path>
                    
                    <!-- القلب الأساسي -->
                    <path d="M150,220 C70,140 70,70 150,110 C230,70 230,140 150,220" 
                          fill="#FFD700" 
                          opacity="0.8">
                        <animateTransform attributeName="transform"
                                        type="scale"
                                        values="1;1.1;1"
                                        dur="1s"
                                        repeatCount="indefinite"
                                        additive="sum"/>
                    </path>
                </svg>
            </div>
            
            <!-- السؤال -->
            <h2 class="text-center mb-5">كيف تفضل أن تبدأ رحلتك؟</h2>
            
            <!-- البطاقات -->
            <div class="journey-cards">
                <!-- بطاقة الفرد -->
                <div class="journey-card" data-journey="individual">
                    <div class="icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <h3>رحلتي الفردية</h3>
                    <p>ابدأ رحلتك الشخصية نحو النور</p>
                    <div class="price">يبدأ من <span id="individualPrice">----</span> ج.م</div>
                </div>
                
                <!-- بطاقة المجموعة -->
                <div class="journey-card" data-journey="group">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>رحلتنا الجماعية</h3>
                    <p>وفر أكثر مع أصدقائك وعائلتك</p>
                    <div class="price">وفر حتى <span id="groupDiscount">--</span>%</div>
                </div>
                
                <!-- بطاقة الدعم -->
                <div class="journey-card" data-journey="support">
                    <div class="icon">
                        <i class="fas fa-hands-helping"></i>
                    </div>
                    <h3>رحلة بالدعم</h3>
                    <p>خيارات مرنة للجميع</p>
                    <div class="price"><span id="grantsAvailable">--</span> منحة متاحة</div>
                </div>
                
                <!-- بطاقة الإهداء -->
                <div class="journey-card" data-journey="gift">
                    <div class="icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h3>أهدِ الرحلة</h3>
                    <p>اهدِ النور لمن تحب</p>
                    <div class="price">بطاقات هدايا متاحة</div>
                </div>
            </div>
        </div>
    </section>

    <!-- شريط العروض الزمنية -->
<section class="time-offers-bar" id="timeOffers">
    <div class="container">
        <div class="offers-header">
            <h3><i class="fas fa-fire"></i> العروض النشطة</h3>
        </div>
        <div class="offers-slider">
            <div class="offer-card urgent">
                <div class="offer-badge">ينتهي قريباً</div>
                <h4>خصم الحجز المبكر</h4>
                <div class="offer-discount">30%</div>
                <div class="offer-timer" data-end="2024-12-31">
                    <span class="days">--</span> يوم
                    <span class="hours">--</span>:
                    <span class="minutes">--</span>:
                    <span class="seconds">--</span>
                </div>
            </div>
            
            <div class="offer-card active">
                <div class="offer-badge">نشط الآن</div>
                <h4>عرض نهاية العام</h4>
                <div class="offer-discount">20%</div>
                <div class="offer-timer" data-end="2024-12-25">
                    <span class="days">--</span> يوم
                    <span class="hours">--</span>:
                    <span class="minutes">--</span>:
                    <span class="seconds">--</span>
                </div>
            </div>
            
            <div class="offer-card upcoming">
                <div class="offer-badge">قادم</div>
                <h4>عرض رأس السنة</h4>
                <div class="offer-discount">25%</div>
                <div class="offer-date">يبدأ في 1 يناير</div>
            </div>
        </div>
    </div>
</section>

<!-- الإثبات الاجتماعي المباشر -->
<div class="live-notifications" id="liveNotifications">
    <!-- ستظهر الإشعارات هنا -->
</div>

<!-- مؤشر المقاعد المتبقية -->
<div class="seats-indicator-floating">
    <div class="seats-content">
        <i class="fas fa-users"></i>
        <span>باقي <span id="remainingSeats">7</span> مقاعد فقط!</span>
    </div>
</div>
    
    <!-- المحتوى الديناميكي -->
<section class="dynamic-content" id="dynamicContent">
    <div class="container">
        <!-- قسم الرحلة الفردية -->
        <div class="content-area" id="individualContent" style="display:none;">
            <h2 class="text-center mb-5" style="color: var(--gold-primary);">
                <i class="fas fa-user"></i> رحلتك الفردية
            </h2>
            
            <!-- عرض السعر الأساسي -->
            <div class="price-display">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="price-card">
                            <div class="price-header">
                                <h3>السعر الأساسي</h3>
                                <div class="original-price" id="originalPrice">1500 ج.م</div>
                                <div class="sale-price" id="salePrice">1200 ج.م</div>
                                <div class="savings-badge">وفر 300 ج.م</div>
                            </div>
                            
                            <!-- خيارات الدفع -->
                            <div class="payment-options mt-4">
                                <h4>اختر طريقة الدفع:</h4>
                                <div class="options-grid">
                                    <div class="payment-option" data-payment="cash">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <h5>دفع نقدي</h5>
                                        <p class="price">1080 ج.م</p>
                                        <small>خصم إضافي 10%</small>
                                    </div>
                                    <div class="payment-option" data-payment="3months">
                                        <i class="fas fa-calendar-alt"></i>
                                        <h5>3 أقساط</h5>
                                        <p class="price">400 ج.م/شهر</p>
                                        <small>بدون فوائد</small>
                                    </div>
                                    <div class="payment-option" data-payment="6months">
                                        <i class="fas fa-calendar-check"></i>
                                        <h5>6 أقساط</h5>
                                        <p class="price">200 ج.م/شهر</p>
                                        <small>بدون فوائد</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- زر الحجز -->
                            <button class="btn-book-now">
                                احجز مقعدك الآن
                                <i class="fas fa-arrow-left mr-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- قسم الرحلة الجماعية -->
        <div class="content-area" id="groupContent" style="display:none;">
            <h2 class="text-center mb-5" style="color: var(--gold-primary);">
                <i class="fas fa-users"></i> رحلتكم الجماعية
            </h2>
            
            <!-- محاكي المجموعات -->
            <div class="group-simulator">
                <div class="row justify-content-center">
                    <div class="col-md-10">
                        <div class="simulator-card">
                            <h3>كم عدد أفراد مجموعتك؟</h3>
                            
                            <!-- سلايدر العدد -->
                            <div class="group-slider-container">
                                <input type="range" 
                                       id="groupSize" 
                                       min="2" 
                                       max="10" 
                                       value="3" 
                                       class="group-slider">
                                <div class="slider-value">
                                    <span id="groupSizeDisplay">3</span> أشخاص
                                </div>
                            </div>
                            
                            <!-- عرض الأشخاص -->
                            <div class="people-icons" id="peopleIcons">
                                <i class="fas fa-user person-icon"></i>
                                <i class="fas fa-user person-icon"></i>
                                <i class="fas fa-user person-icon"></i>
                            </div>
                            
                            <!-- حساب التوفير -->
                            <div class="savings-calculation">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="calc-item">
                                            <label>السعر الأصلي للفرد:</label>
                                            <span id="groupOriginalPrice">1500 ج.م</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="calc-item">
                                            <label>السعر بعد الخصم:</label>
                                            <span id="groupDiscountedPrice" class="highlight">1050 ج.م</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="total-savings">
                                    <h4>إجمالي التوفير للمجموعة:</h4>
                                    <div class="savings-amount">1350 ج.م</div>
                                </div>
                            </div>
                            
                            <!-- زر المشاركة -->
                            <button class="btn-share-group">
                                <i class="fas fa-share-alt"></i>
                                شارك رابط المجموعة
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- قسم رحلة الدعم -->
        <div class="content-area" id="supportContent" style="display:none;">
            <h2 class="text-center mb-5" style="color: var(--gold-primary);">
                <i class="fas fa-hands-helping"></i> رحلة بالدعم
            </h2>
            
            <div class="support-options">
                <div class="row">
                    <div class="col-md-4">
                        <div class="support-card">
                            <i class="fas fa-percentage"></i>
                            <h4>منحة جزئية</h4>
                            <p>خصم 50-75%</p>
                            <button class="btn-apply">تقدم الآن</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="support-card">
                            <i class="fas fa-hourglass-half"></i>
                            <h4>تقسيط ميسر</h4>
                            <p>حتى 24 شهر</p>
                            <button class="btn-apply">تقدم الآن</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="support-card">
                            <i class="fas fa-gift"></i>
                            <h4>منحة كاملة</h4>
                            <p>100% مجاناً</p>
                            <button class="btn-apply">تقدم الآن</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- قسم الإهداء -->
        <div class="content-area" id="giftContent" style="display:none;">
            <h2 class="text-center mb-5" style="color: var(--gold-primary);">
                <i class="fas fa-gift"></i> أهدِ الرحلة
            </h2>
            
            <div class="gift-options">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="gift-card">
                            <h3>اختر نوع الهدية</h3>
                            <div class="gift-types">
                                <div class="gift-type">
                                    <i class="fas fa-user-check"></i>
                                    <h5>لشخص محدد</h5>
                                    <p>أدخل بيانات المُهدى إليه</p>
                                </div>
                                <div class="gift-type">
                                    <i class="fas fa-question-circle"></i>
                                    <h5>هدية مجهولة</h5>
                                    <p>دع النظام يختار محتاج</p>
                                </div>
                                <div class="gift-type">
                                    <i class="fas fa-credit-card"></i>
                                    <h5>بطاقة هدية</h5>
                                    <p>قيمة مفتوحة للاستخدام</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- الحاسبة الذكية المتطورة V2 -->
<section class="smart-calculator-section" id="smartCalculator">
    <div class="container">
        <h2 class="text-center mb-5" style="color: var(--gold-primary);">
            <i class="fas fa-calculator"></i> احسب استثمارك بدقة
        </h2>
        
        <div class="calculator-wrapper">
            <!-- اختيار نوع الرحلة -->
            <div class="journey-selector mb-4">
                <h4 class="text-center mb-3">اختر نوع رحلتك:</h4>
                <div class="journey-options">
                    <div class="journey-option active" data-journey="individual">
                        <i class="fas fa-user"></i>
                        <span>رحلة فردية</span>
                    </div>
                    <div class="journey-option" data-journey="group">
                        <i class="fas fa-users"></i>
                        <span>رحلة جماعية</span>
                    </div>
                    <div class="journey-option" data-journey="gift">
                        <i class="fas fa-gift"></i>
                        <span>إهداء الرحلة</span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- الجانب الأيسر - الإدخالات -->
                <div class="col-lg-6">
                    <div class="calculator-inputs">
                        <h4>خصص عرضك</h4>
                        
                        <!-- قسم المجموعات (يظهر فقط عند اختيار رحلة جماعية) -->
                        <div class="group-selection-area" id="calcGroupArea" style="display:none;">
                            <label class="mb-3">اختر عرض المجموعة:</label>
                            <div class="group-cards">
                                <!-- سيتم ملؤها ديناميكياً -->
                            </div>
                        </div>
                        
                        <!-- قسم الإهداء (يظهر فقط عند اختيار إهداء) -->
<div class="gift-selection-area" id="calcGiftArea" style="display:none;">
    <label class="mb-3">نوع الإهداء:</label>
    <div class="gift-options-cards">
        <div class="gift-option-card active" data-gift="specific">
            <i class="fas fa-user-check"></i>
            <h5>لشخص محدد</h5>
            <small>حدد اسم المستفيد</small>
        </div>
        <div class="gift-option-card" data-gift="anonymous">
            <i class="fas fa-question-circle"></i>
            <h5>هدية مجهولة</h5>
            <small>نختار محتاج لك</small>
        </div>
        <div class="gift-option-card" data-gift="voucher">
            <i class="fas fa-ticket-alt"></i>
            <h5>قسيمة هدية</h5>
            <small>قيمة مفتوحة</small>
        </div>
    </div>
    
    <!-- تفاصيل الإهداء -->
    <div class="gift-details mt-4">
        <!-- للهدية المحددة -->
        <div class="gift-specific-details" id="giftSpecificDetails" style="display:none;">
            <div class="mb-3">
                <label>اسم المستفيد من الهدية:</label>
                <input type="text" class="form-control" id="giftRecipientName" placeholder="أدخل اسم المستفيد" required>
            </div>
            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="revealGifterName">
                <label class="form-check-label" for="revealGifterName">
                    إظهار اسمي للمستفيد
                </label>
            </div>
        </div>
        
        <!-- للهدية المجهولة -->
        <div class="gift-anonymous-details" id="giftAnonymousDetails" style="display:none;">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                سنختار لك أحد المحتاجين من مجتمعنا وسنرسل لك تقرير عن المستفيد
            </div>
        </div>
        
        <!-- للقسيمة المفتوحة -->
<div class="gift-voucher-details" id="giftVoucherDetails" style="display:none;">
    <div class="voucher-message">
        <h5>💝 كل مساهمة تصنع فرقاً</h5>
        <p>مساهمتك الكريمة ستمكن أحد أفراد مجتمعنا من الاستفادة من رحلة التعلم</p>
    </div>
    <div class="mb-3">
        <label>قيمة دعمك الكريم:</label>
        <div class="voucher-amount-input">
            <input type="number" class="form-control" id="voucherAmount" 
                   placeholder="أدخل المبلغ الذي تود التبرع به" min="50" step="50">
            <span class="currency-label">ج.م</span>
        </div>
        <small class="text-muted">الحد الأدنى 50 ج.م - كل جنيه يحدث فرقاً</small>
    </div>
    <div class="alert alert-success">
        <i class="fas fa-hands-helping"></i>
        <strong>أنت تصنع الأمل!</strong><br>
        دعمك سيفتح أبواب المعرفة لمن يحتاجها. سنرسل لك تقريراً دورياً عن أثر مساهمتك الكريمة.
    </div>
</div>
        
        <!-- معلومات المُهدي (مشتركة) -->
        <div class="gifter-info mt-3" id="gifterInfo">
            <div class="mb-3">
                <label>اسمك (اختياري):</label>
                <input type="text" class="form-control" id="gifterName" 
                       placeholder="اسمك إذا أردت إضافته">
            </div>
            <div class="mb-3">
                <label>رسالة مع الهدية (اختياري):</label>
                <textarea class="form-control" id="giftMessage" rows="2" 
                          placeholder="رسالة قصيرة للمستفيد"></textarea>
            </div>
        </div>
    </div>
</div>
                        
                        <!-- العرض الزمني النشط -->
                        <div class="active-offer-display" id="calcActiveOffer" style="display:none;">
                            <div class="active-offer-card">
                                <span class="badge bg-success">عرض نشط</span>
                                <h5 id="activeOfferName">--</h5>
                                <span class="discount-badge" id="activeOfferDiscount">--</span>
                            </div>
                        </div>
                        
                        <!-- طريقة الدفع -->
                        <div class="payment-selection mt-4">
                            <label>طريقة الدفع:</label>
                            <div class="payment-cards" id="calcPaymentCards">
                                <!-- سيتم ملؤها ديناميكياً -->
                            </div>
                        </div>
                        
                        <!-- كود الخصم -->
                        <div class="coupon-section mt-4">
                            <label>كود خصم (اختياري):</label>
                            <div class="coupon-input">
                                <input type="text" id="calcCoupon" placeholder="أدخل الكود">
                                <button id="applyCouponCalc">تطبيق</button>
                            </div>
                            <div id="calcCouponMessage" class="coupon-message mt-2"></div>
                        </div>
                    </div>
                </div>
                
                <!-- الجانب الأيمن - النتائج -->
                <div class="col-lg-6">
                    <div class="calculator-results">
                        <h4>تفاصيل الاستثمار في الرحلة</h4>
                        
                        <div class="price-breakdown">
                            <!-- السعر الأساسي -->
                            <div class="price-row">
                                <span>الاستثمار الأساسي:</span>
                                <span id="calcBase">0 ج.م</span>
                            </div>
                            
                            <!-- الخصومات -->
                            <div class="price-row discount-row" id="calcTimeDiscountRow" style="display:none;">
                                <span id="calcTimeDiscountLabel">خصم العرض:</span>
                                <span id="calcTimeDiscount" class="discount-value">-0 ج.م</span>
                            </div>
                            
                            <div class="price-row discount-row" id="calcGroupDiscountRow" style="display:none;">
                                <span>خصم المجموعة:</span>
                                <span id="calcGroupDiscount" class="discount-value">-0 ج.م</span>
                            </div>
                            
                            <div class="price-row discount-row" id="calcCashDiscountRow" style="display:none;">
                                <span>خصم الدفع الكامل:</span>
                                <span id="calcCashDiscount" class="discount-value">-0 ج.م</span>
                            </div>
                            
                            <div class="price-row discount-row" id="calcCouponDiscountRow" style="display:none;">
                                <span>كود الخصم:</span>
                                <span id="calcCouponDiscount" class="discount-value">-0 ج.م</span>
                            </div>
                            
                            <hr>
                            
                            <!-- الإجمالي -->
                            <div class="price-row total-row">
                                <span id="calcTotalLabel">الإجمالي:</span>
                                <span id="calcTotal" class="total-price">0 ج.م</span>
                            </div>
                            
                            <!-- تفاصيل الأقساط -->
                            <div class="installment-details" id="calcInstallmentDetails" style="display:none;">
                                <div class="installment-info">
                                    <i class="fas fa-info-circle"></i>
                                    <span id="calcInstallmentPlan"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- رسالة التوفير -->
                        <div class="savings-message" id="calcSavings" style="display:none;">
                            <div class="savings-badge">
                                <i class="fas fa-piggy-bank"></i>
                                <span>وفرت <strong id="calcSavingsAmount">0</strong> ج.م!</span>
                            </div>
                        </div>
                        
                     <!-- أزرار الإجراءات -->
<div class="action-buttons">
    <button class="btn-primary-action" id="calcBookBtn">
        🛒 احجز بهذا السعر
    </button>
    
    <button class="btn-secondary-action grant-btn" id="calcGrantBtn" onclick="smartCalculator.handleGrantRequest()">
        🤲 أحتاج دعم أكبر
    </button>
</div>
                        
                        <!-- رسالة الدعم -->
<div class="support-message" id="calcSupportMessage" style="display:none;">
    <p>
        <i class="fas fa-heart"></i>
        <strong>لا نجعل المال عائقاً لرحلة التعلم</strong><br>
        لدينا خيارات دعم مرنة تناسب الجميع. 
        اضغط على "أحتاج دعم أكبر" لاستكشاف الخيارات المتاحة.
    </p>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- الجدول الشامل للأسعار -->
<section class="comprehensive-table-section" id="pricingTableSection">
    <div class="container">
        <h2 class="text-center mb-5" style="color: var(--gold-primary);">
            <i class="fas fa-table"></i> جدول الأسعار الشامل
        </h2>
        
        <!-- أزرار التحكم -->
        <div class="table-controls">
            <button class="table-btn active" data-view="simple">عرض بسيط</button>
            <button class="table-btn" data-view="detailed">عرض تفصيلي</button>
            <button class="table-btn" data-view="comparison">مقارنة</button>
        </div>
        
        <!-- الجدول -->
        <div class="table-responsive">
            <table class="pricing-table" id="mainTable">
                <thead>
                    <tr>
                        <th>نوع الرحلة</th>
                        <th>السعر الأساسي</th>
                        <th>مع العرض الحالي</th>
                        <th>دفع نقدي</th>
                        <th>3 أقساط</th>
                        <th>6 أقساط</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="individual-row">
                        <td>
                            <i class="fas fa-user"></i>
                            رحلة فردية
                        </td>
                        <td class="old-price">1500 ج.م</td>
                        <td class="offer-price">1200 ج.م</td>
                        <td class="cash-price">1080 ج.م</td>
                        <td>
    <small>480 ج.م مقدم</small><br>
    <strong>300 ج.م × 2</strong>
</td>
<td>
    <small>360 ج.م مقدم</small><br>
    <strong>170 ج.م × 5</strong>
</td>
                    </tr>
                    <tr class="group-row">
                        <td>
                            <i class="fas fa-users"></i>
                            مجموعة (3 أشخاص)
                        </td>
                        <td class="old-price">1500 ج.م</td>
                        <td class="offer-price">1050 ج.م</td>
                        <td class="cash-price">945 ج.م</td>
                        <td>
    <small>420 ج.م مقدم</small><br>
    <strong>260 ج.م × 2</strong>
</td>
<td>
    <small>320 ج.م مقدم</small><br>
    <strong>125 ج.م × 5</strong>
</td>
                    </tr>
                    <tr class="group-row">
                        <td>
                            <i class="fas fa-users"></i>
                            مجموعة (5 أشخاص)
                        </td>
                        <td class="old-price">1500 ج.م</td>
                        <td class="offer-price">900 ج.م</td>
                        <td class="cash-price">810 ج.م</td>
                        <td>
    <small>360 ج.م مقدم</small><br>
    <strong>225 ج.م × 2</strong>
</td>
<td>
    <small>270 ج.م مقدم</small><br>
    <strong>108 ج.م × 5</strong>
</td>
                    </tr>
                    <tr class="support-row">
                        <td>
                            <i class="fas fa-hands-helping"></i>
                            منحة جزئية 50%
                        </td>
                        <td class="old-price">1500 ج.م</td>
                        <td class="offer-price">750 ج.م</td>
                        <td class="cash-price">750 ج.م</td>
                        <td>
    <small>300 ج.م مقدم</small><br>
    <strong>225 ج.م × 2</strong>
</td>
<td>
    <small>225 ج.م مقدم</small><br>
    <strong>105 ج.م × 5</strong>
</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- ملاحظات -->
        <div class="table-notes">
            <p><i class="fas fa-info-circle"></i> جميع الأسعار بالجنيه المصري</p>
            <p><i class="fas fa-check-circle"></i> الأقساط بدون فوائد</p>
            <p><i class="fas fa-shield-alt"></i> ضمان استرجاع 14 يوم</p>
        </div>
    </div>
</section>

    <!-- قسم الشهادات والثقة -->
<section class="testimonials-section" id="testimonials">
    <div class="container">
        <h2 class="text-center mb-5" style="color: var(--gold-primary);">
            <i class="fas fa-star"></i> ماذا يقول طلابنا
        </h2>
        
        <div class="testimonials-carousel">
            <div class="testimonial-card">
                <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <p class="testimonial-text">
                    "رحلة غيرت حياتي بالكامل، اكتشفت معنى الحياة الطيبة الحقيقي"
                </p>
                <div class="testimonial-author">
                    <img src="https://ui-avatars.com/api/?name=أحمد+محمد&background=FFD700&color=0A1628" alt="أحمد">
                    <div>
                        <h5>أحمد محمد</h5>
                        <small>خريج الدفعة 15</small>
                    </div>
                </div>
            </div>
            
            <div class="testimonial-card">
                <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <p class="testimonial-text">
                    "المحتوى عميق والمتابعة ممتازة، استثمار حقيقي في النفس"
                </p>
                <div class="testimonial-author">
                    <img src="https://ui-avatars.com/api/?name=سارة+أحمد&background=FFD700&color=0A1628" alt="سارة">
                    <div>
                        <h5>سارة أحمد</h5>
                        <small>خريجة الدفعة 14</small>
                    </div>
                </div>
            </div>
            
            <div class="testimonial-card">
                <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <p class="testimonial-text">
                    "أفضل قرار اتخذته في حياتي، الرحلة فتحت لي آفاق جديدة"
                </p>
                <div class="testimonial-author">
                    <img src="https://ui-avatars.com/api/?name=محمد+علي&background=FFD700&color=0A1628" alt="محمد">
                    <div>
                        <h5>محمد علي</h5>
                        <small>خريج الدفعة 13</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- الإحصائيات -->
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-number" data-target="543">0</div>
                <div class="stat-label">متعلم سعيد</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" data-target="4.8">0</div>
                <div class="stat-label">متوسط التقييم</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" data-target="96">0</div>
                <div class="stat-label">% نسبة الإكمال</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" data-target="15">0</div>
                <div class="stat-label">دفعة تخرجت</div>
            </div>
        </div>
    </div>
</section>

    <!-- زر WhatsApp العائم -->
<a href="https://wa.me/201224938330?text=السلام عليكم، أريد الاستفسار عن الدورة" 
   class="whatsapp-float" 
   target="_blank"
   aria-label="تواصل معنا على WhatsApp">
    <i class="fab fa-whatsapp"></i>
</a>
    <!-- الفوتر -->
    <footer>
        <div class="container">
            <p>&copy; 2024 منصة فؤاد - جميع الحقوق محفوظة</p>
        </div>
    </footer>
    
    <!-- السكريبت الأساسي -->
    <script>
        // إعدادات Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDHg0VrivE3C9A7jvzRu7lQgudLvcD_Fxk",
            authDomain: "fouad-perspective.firebaseapp.com",
            projectId: "fouad-perspective",
            storageBucket: "fouad-perspective.appspot.com",
            messagingSenderId: "564654107574",
            appId: "1:564654107574:web:baebb660288b22f16213e6"
        };
        
        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // متغيرات عامة
        let courseData = null;
        let courseId = null;
        
        // جلب معرف الدورة من الرابط
        function getCourseId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('course') || 'default-course';
        }
        // انتظار تحميل الصفحة بالكامل
document.addEventListener('DOMContentLoaded', function() {
    console.log('الصفحة جاهزة');
    
    // تأخير بسيط للتأكد من تحميل Firebase
    setTimeout(() => {
        if (typeof db !== 'undefined') {
            loadCourseData();
        } else {
            console.error('Firebase لم يتم تحميله');
            showFallbackContent();
        }
    }, 1000);
});
        // جلب بيانات الدورة
        // جلب بيانات الدورة من Firebase
// جلب بيانات الدورة من Firebase
async function loadCourseData() {
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('course');
    
    if (!courseId) {
        console.log('معرف الدورة مفقود - استخدام البيانات الافتراضية');
        showFallbackContent();
        return;
    }
    
    try {
        // انتظار Firebase
        if (typeof db === 'undefined') {
            console.log('انتظار تحميل Firebase...');
            setTimeout(() => loadCourseData(), 500);
            return;
        }
        
        console.log('جاري جلب بيانات الدورة:', courseId);
        const courseRef = db.collection('courses').doc(courseId);
        const doc = await courseRef.get();
        
        if (!doc.exists) {
            console.log('الدورة غير موجودة - استخدام البيانات الافتراضية');
            showFallbackContent();
            return;
        }
        
        const courseData = doc.data();
        console.log('البيانات المستلمة:', courseData);
        
        // تصحيح الأسعار إذا كانت خاطئة
        if (courseData.price < 100) {
            courseData.price = courseData.price * 1000;
        }
        if (courseData.salePrice && courseData.salePrice < 100) {
            courseData.salePrice = courseData.salePrice * 1000;
        }
        
        window.currentCourseData = courseData;
        console.log('بيانات الكورس من Firebase:', courseData);
console.log('الكوبونات في Firebase:', courseData.coupons);

        // تحديث كل شيء
        updatePageWithData(courseData);
        
    } catch (error) {
        console.error('خطأ في جلب البيانات:', error);
        showFallbackContent();
    }
}

// دالة تحديث الصفحة بالبيانات
function updatePageWithData(courseData) {
    console.log('تحديث الصفحة بالبيانات:', courseData);
    
    // تحديث العنوان
    const titleElement = document.querySelector('.hero-title');
    if (titleElement && courseData.title) {
        titleElement.textContent = courseData.title;
    }
    
    // تحديد السيناريو
    const scenario = detectActiveScenario(courseData);
    console.log('السيناريو النشط:', scenario);
    
    // تحديث العروض النشطة
    updateActiveOffers(courseData, scenario);
    
    // تحديث الحاسبة
    if (typeof updateCalculatorOptions === 'function') {
        updateCalculatorOptions(courseData, scenario);
    }
    
    // تحديث الجدول
    if (typeof buildDynamicPricingTable === 'function') {
        buildDynamicPricingTable(courseData, scenario);
    }
    
    // تحديث الأسعار
    if (typeof updateAllPrices === 'function') {
        updateAllPrices(courseData, scenario);
    }
    // تحديث الحاسبة الذكية
if (typeof updateCalculatorFromFirebase === 'function') {
    updateCalculatorFromFirebase();
}
}

// الدالة الأولى - البيانات الرئيسية
function showMainDefaultContent() {
    const defaultData = {
        title: 'استثمر في رحلتك نحو نور الحياة الطيبة',
        price: 10000,
        salePrice: 8000,
        currency: 'EGP',
        priceType: 'paid',
        cashDiscount: {
            enabled: true,
            percentage: 15
        },
        paymentPlans: [
            {
                name: '3 شهور',
                installments: 3,
                firstPaymentPercent: 40,
                frequency: 'monthly'
            },
            {
                name: '6 شهور', 
                installments: 6,
                firstPaymentPercent: 30,
                frequency: 'monthly'
            }
        ],
        groupDiscounts: [
            {
                name: 'الصحاب',
                minSize: 3,
                percentage: 30
            }
        ],
        discounts: []
    };
    
    window.currentCourseData = defaultData;
    updatePageWithData(defaultData);
}

// الدالة الثانية - البيانات الاحتياطية
function showFallbackContent() {
    const courseData = {
        title: 'الدورة التجريبية',
        price: 1000,
        salePrice: 800,
        currency: 'EGP',
        priceType: 'paid',
        cashDiscount: { 
            enabled: true, 
            percentage: 15 
        },
        paymentPlans: [
            { 
                name: '3 شهور', 
                installments: 3, 
                firstPaymentPercent: 40, 
                frequency: 'monthly' 
            },
            { 
                name: '6 شهور', 
                installments: 6, 
                firstPaymentPercent: 30, 
                frequency: 'monthly' 
            }
        ],
        groupDiscounts: [
            { 
                name: 'الصحاب', 
                minSize: 3, 
                percentage: 30 
            }
        ],
        discounts: []
    };
    
    window.currentCourseData = courseData;
    updateUIBasedOnScenario(courseData, 'DEFAULT');
}

// الاستخدام:
// showMainDefaultContent();  - للبيانات الرئيسية
// showFallbackContent();     - للبيانات الاحتياطية

// دالة محسنة للتحقق من الخيارات
function updateCalculatorOptions(data, scenario) {
    // التحقق من وجود العناصر أولاً
    const journeySelect = document.getElementById('journey');
    const paymentSelect = document.getElementById('payment-method');
    const groupSizeInput = document.getElementById('group-size');
    
    if (!journeySelect || !paymentSelect) {
        console.warn('عناصر الحاسبة غير موجودة بعد');
        return;
    }
    
    // تحديث خيارات الدفع
    paymentSelect.innerHTML = '<option value="">اختر طريقة الدفع</option>';
    
    // إضافة الدفع النقدي إذا كان متاحاً
    if (data.cashDiscount && data.cashDiscount.enabled) {
        paymentSelect.innerHTML += `
            <option value="cash">دفعة واحدة (خصم ${data.cashDiscount.percentage}% لفترة محدودة)</option>
        `;
    } else {
        paymentSelect.innerHTML += '<option value="full">دفعة واحدة</option>';
    }
    
    // إضافة خطط الأقساط
    if (data.paymentPlans && data.paymentPlans.length > 0) {
        data.paymentPlans.forEach((plan, index) => {
            paymentSelect.innerHTML += `
                <option value="plan_${index}">${plan.name} (بدون فوائد)</option>
            `;
        });
    }
    
    // تحديث خيارات المجموعات
    if (data.groupDiscounts && data.groupDiscounts.length > 0 && groupSizeInput) {
        groupSizeInput.max = 10;
        groupSizeInput.min = 1;
    }
    
    // حساب السعر الأولي
    updateCalculatedPrice();
}

// دالة محسنة لتحديث الأسعار
function updateAllPrices(data, scenario) {
    // التحقق من وجود العناصر
    const elements = {
        originalPrice: document.querySelector('.original-price'),
        currentPrice: document.querySelector('.current-price'),
        quickPrice: document.querySelector('.quick-price'),
        heroPrice: document.querySelector('.hero-price')
    };
    
    // حساب السعر الحالي
    let currentPrice = data.price;
    
    // تطبيق العرض الزمني النشط
    if (data.discounts && data.discounts.length > 0) {
        const now = new Date();
        const activeDiscount = data.discounts.find(d => {
            if (!d.startDate || !d.endDate) return false;
            const start = new Date(d.startDate);
            const end = new Date(d.endDate);
            return now >= start && now <= end;
        });
        
        if (activeDiscount && activeDiscount.percentage > 0) {
            currentPrice = Math.round(data.price * (1 - activeDiscount.percentage / 100));
        }
    } else if (data.salePrice && data.salePrice < data.price) {
        currentPrice = data.salePrice;
    }
    
    // تحديث الأسعار في كل الأماكن
    Object.keys(elements).forEach(key => {
        if (elements[key]) {
            if (key === 'originalPrice' && currentPrice < data.price) {
                elements[key].textContent = `${data.price.toLocaleString('ar-EG')} ج.م`;
                elements[key].style.display = 'block';
            } else if (key === 'currentPrice' || key === 'quickPrice' || key === 'heroPrice') {
                elements[key].textContent = `${currentPrice.toLocaleString('ar-EG')} ج.م`;
            }
        }
    });
}

// دالة جديدة: كشف السيناريو النشط
// دالة محسنة: كشف السيناريو النشط
function detectActiveScenario(data) {
    const hasDiscounts = data.discounts && data.discounts.length > 0;
    const hasPaymentPlans = data.paymentPlans && data.paymentPlans.length > 0;
    const hasCashDiscount = data.cashDiscount && data.cashDiscount.enabled === true; // تحقق صريح
    const hasGroups = data.groupDiscounts && data.groupDiscounts.length > 0;
    const hasSalePrice = data.salePrice && data.salePrice < data.price;
    
    console.log('معطيات السيناريو:', {
        hasDiscounts,
        hasPaymentPlans,
        hasCashDiscount,
        hasGroups,
        hasSalePrice,
        cashDiscountData: data.cashDiscount
    });
    
    // السيناريو يعتمد على كل العناصر المفعلة
    let scenario = [];
    
    if (hasDiscounts) scenario.push('DISCOUNTS');
    if (hasPaymentPlans) scenario.push('PLANS');
    if (hasCashDiscount) scenario.push('CASH');
    if (hasGroups) scenario.push('GROUPS');
    if (hasSalePrice && !hasDiscounts) scenario.push('SALE');
    
    return scenario.length > 0 ? scenario.join('_') : 'SIMPLE_PRICE';
}

// دالة جديدة: تحديث الواجهة حسب السيناريو
function updateUIBasedOnScenario(data, scenario) {
    // 1. تحديث العروض النشطة
    updateActiveOffers(data, scenario);
    
    // 2. تحديث الحاسبة
    updateCalculatorOptions(data, scenario);
    
    // 3. بناء الجدول
    buildDynamicPricingTable(data, scenario);
    
    // 4. تحديث الأسعار في كل مكان
    updateAllPrices(data, scenario);
}

// البيانات الافتراضية


// تحديث كل البيانات في الصفحة
function updateAllPricing() {
    // 1. تحديث البطاقات
    updateCards();
    
    // 2. تحديث العروض الزمنية
    updateTimeOffers();
    
    // 3. تحديث الحاسبة
    updateCalculator();
    
    // 4. بناء الجدول الديناميكي
    buildDynamicTable();
    
    // 5. تحديث المنح
    updateGrants();
}

        // تحديث البطاقات الرئيسية
function updateCards() {
    // السعر الفردي
    const individualPrice = courseData.salePrice || courseData.price;
    document.getElementById('individualPrice').textContent = 
        individualPrice.toLocaleString('ar-EG');
    
    // خصم المجموعة الأكبر
    const maxGroupDiscount = courseData.groupDiscounts?.reduce((max, g) => 
        Math.max(max, g.percentage), 0) || 30;
    document.getElementById('groupDiscount').textContent = maxGroupDiscount;
    
    // المنح المتاحة
    const grantsAvailable = courseData.grants?.seats || 5;
    document.getElementById('grantsAvailable').textContent = grantsAvailable;
}

// تحديث العروض الزمنية
function updateTimeOffers() {
    const container = document.querySelector('.offers-slider');
    if (!container || !courseData.discounts) return;
    
    container.innerHTML = '';
    
    courseData.discounts.forEach((discount, index) => {
        const isActive = checkIfActive(discount);
        const cardClass = index === 0 ? 'urgent' : isActive ? 'active' : 'upcoming';
        
        container.innerHTML += `
            <div class="offer-card ${cardClass}">
                <div class="offer-badge">${isActive ? 'نشط الآن' : 'قادم'}</div>
                <h4>${discount.name}</h4>
                <div class="offer-discount">${discount.percentage}%</div>
                ${discount.endDate ? `
                    <div class="offer-timer" data-end="${discount.endDate}">
                        <span class="days">--</span> يوم
                        <span class="hours">--</span>:
                        <span class="minutes">--</span>:
                        <span class="seconds">--</span>
                    </div>
                ` : ''}
            </div>
        `;
    });
    
    // إعادة تشغيل العدادات
    updateCountdowns();
}

// التحقق من العرض النشط
function checkIfActive(discount) {
    if (!discount.startDate || !discount.endDate) return false;
    const now = new Date();
    const start = new Date(discount.startDate);
    const end = new Date(discount.endDate);
    return now >= start && now <= end;
}

// تحديث الحاسبة
// تحديث الحاسبة
function updateCalculator() {
    if (!calculator || !courseData) return;
    
    // تحديث السعر الأساسي
    calculator.basePrice = courseData.price || 1500;
    
    // تحديث العرض الحالي
    const activeDiscount = courseData.discounts?.find(d => checkIfActive(d));
    calculator.currentOffer = activeDiscount ? activeDiscount.percentage / 100 : 0;
    
    // تحديث خطط الدفع
    calculator.paymentPlans = courseData.paymentPlans || [];
    
    // تحديث خصم النقدي
    if (courseData.cashDiscount) {
        calculator.cashDiscountPercent = courseData.cashDiscount.percentage || 10;
    } else {
        calculator.cashDiscountPercent = 10; // قيمة افتراضية
    }
    
    // إعادة الحساب
    if (calculator.calculate) {
        calculator.calculate();
    }
}

// بناء الجدول الديناميكي
function buildDynamicTable() {
    const tableBody = document.querySelector('.pricing-table tbody');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    // السعر الأساسي مع العروض
    const basePrice = courseData.price;
    const salePrice = courseData.salePrice || basePrice;
    const activeDiscount = courseData.discounts?.find(d => checkIfActive(d));
    const currentPrice = activeDiscount ? 
        basePrice * (1 - activeDiscount.percentage/100) : salePrice;
    
    // صف الأفراد
    const individualRow = createTableRow(
        'رحلة فردية',
        'fa-user',
        basePrice,
        currentPrice,
        'individual'
    );
    tableBody.innerHTML += individualRow;
    
    // صفوف المجموعات
    courseData.groupDiscounts?.forEach(group => {
        const groupPrice = currentPrice * (1 - group.percentage/100);
        const groupRow = createTableRow(
            `${group.name} (${group.minSize}+ أشخاص)`,
            'fa-users',
            basePrice,
            groupPrice,
            'group'
        );
        tableBody.innerHTML += groupRow;
    });
    
    // صف المنح
    if (courseData.grants?.enabled) {
        const grantRow = createTableRow(
            'منحة جزئية 50%',
            'fa-hands-helping',
            basePrice,
            basePrice * 0.5,
            'support'
        );
        tableBody.innerHTML += grantRow;
    }
}

// إنشاء صف في الجدول
function createTableRow(name, icon, originalPrice, currentPrice, type) {
    const cashPrice = currentPrice * 0.9; // خصم نقدي 10%
    
    // حساب الأقساط
    let installment3 = '', installment6 = '';
    
    if (courseData.paymentPlans) {
        const plan3 = courseData.paymentPlans.find(p => p.installments === 3);
        const plan6 = courseData.paymentPlans.find(p => p.installments === 6);
        
        if (plan3) {
            const firstPayment3 = Math.round(currentPrice * (plan3.firstPaymentPercent/100) / 10) * 10;
            const monthly3 = Math.round((currentPrice - firstPayment3) / 2 / 10) * 10;
            installment3 = `
                <small>${firstPayment3} ج.م مقدم</small><br>
                <strong>${monthly3} ج.م × 2</strong>
            `;
        }
        
        if (plan6) {
            const firstPayment6 = Math.round(currentPrice * (plan6.firstPaymentPercent/100) / 10) * 10;
            const monthly6 = Math.round((currentPrice - firstPayment6) / 5 / 10) * 10;
            installment6 = `
                <small>${firstPayment6} ج.م مقدم</small><br>
                <strong>${monthly6} ج.م × 5</strong>
            `;
        }
    }
    
    return `
        <tr class="${type}-row">
            <td>
                <i class="fas ${icon}"></i>
                ${name}
            </td>
            <td class="old-price">${Math.round(originalPrice)} ج.م</td>
            <td class="offer-price">${Math.round(currentPrice)} ج.م</td>
            <td class="cash-price">${Math.round(cashPrice)} ج.م</td>
            <td>${installment3}</td>
            <td>${installment6}</td>
        </tr>
    `;
}

// تحديث المنح
function updateGrants() {
    if (!courseData.grants) return;
    
    // تحديث عدد المنح
    const grantsElement = document.getElementById('grantsAvailable');
    if (grantsElement) {
        grantsElement.textContent = courseData.grants.seats || 0;
    }
    
    // تحديث قسم المنح
    const supportContent = document.getElementById('supportContent');
    if (supportContent && courseData.grantPlans) {
        // هنا ممكن نحدث خطط المنح الديناميكية
        console.log('خطط المنح:', courseData.grantPlans);
    }
}
        
        // تحديث الواجهة
        function updateUI() {
            // تحديث الأسعار في البطاقات
            const individualPrice = courseData.salePrice || courseData.price || 1500;
            document.getElementById('individualPrice').textContent = individualPrice.toLocaleString('ar-EG');
            
            const groupDiscount = courseData.groupDiscounts?.[0]?.percentage || 30;
            document.getElementById('groupDiscount').textContent = groupDiscount;
            
            const grantsAvailable = courseData.grants?.seats || 5;
            document.getElementById('grantsAvailable').textContent = grantsAvailable;
        }
        
        // التعامل مع نقرات البطاقات
document.querySelectorAll('.journey-card').forEach(card => {
    card.addEventListener('click', function() {
        const journey = this.dataset.journey;
        console.log('تم اختيار:', journey);
        
        // إزالة الحالة النشطة من كل البطاقات
        document.querySelectorAll('.journey-card').forEach(c => {
            c.style.borderColor = 'transparent';
        });
        
        // إضافة الحالة النشطة للبطاقة المختارة
        this.style.borderColor = 'var(--gold-primary)';
        
        // إخفاء كل المحتوى
        document.querySelectorAll('.content-area').forEach(area => {
            area.style.display = 'none';
        });
        
        // عرض قسم المحتوى الديناميكي
        document.getElementById('dynamicContent').classList.add('active');
        
        // عرض المحتوى المناسب
        const contentId = journey + 'Content';
        const content = document.getElementById(contentId);
        if (content) {
            content.style.display = 'block';
            
            // التمرير للمحتوى
            content.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
    });
});

// التعامل مع سلايدر المجموعات
const groupSlider = document.getElementById('groupSize');
if (groupSlider) {
    groupSlider.addEventListener('input', function() {
        const size = this.value;
        document.getElementById('groupSizeDisplay').textContent = size;
        
        // تحديث عدد الأيقونات
        const iconsContainer = document.getElementById('peopleIcons');
        iconsContainer.innerHTML = '';
        for (let i = 0; i < size; i++) {
            iconsContainer.innerHTML += '<i class="fas fa-user person-icon"></i>';
        }
        
        // حساب الخصم
        const basePrice = 1500;
        const discount = Math.min(size * 10, 30); // خصم 10% لكل شخص، بحد أقصى 30%
        const discountedPrice = basePrice * (1 - discount/100);
        const totalSavings = (basePrice - discountedPrice) * size;
        
        document.getElementById('groupDiscountedPrice').textContent = Math.round(discountedPrice) + ' ج.م';
        document.querySelector('.savings-amount').textContent = Math.round(totalSavings) + ' ج.م';
    });
}

// التعامل مع خيارات الدفع
document.querySelectorAll('.payment-option').forEach(option => {
    option.addEventListener('click', function() {
        // إزالة التحديد من الكل
        document.querySelectorAll('.payment-option').forEach(o => {
            o.style.borderColor = 'transparent';
            o.style.background = 'rgba(255, 215, 0, 0.1)';
        });
        
        // تحديد المختار
        this.style.borderColor = 'var(--gold-primary)';
        this.style.background = 'rgba(255, 215, 0, 0.2)';
        
        const paymentType = this.dataset.payment;
        console.log('تم اختيار طريقة الدفع:', paymentType);
    });
});

// أزرار الحجز والتقديم
document.querySelectorAll('.btn-book-now, .btn-apply, .btn-share-group').forEach(btn => {
    btn.addEventListener('click', function() {
        Swal.fire({
            title: 'رائع!',
            text: 'جاري تحضير الخطوة التالية...',
            icon: 'success',
            timer: 2000,
            showConfirmButton: false,
            background: '#152238',
            color: '#fff'
        });
    });
});
        
        // إخفاء شاشة التحميل
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('preloader').classList.add('hidden');
            }, 1500);
            
            // تحميل البيانات
            loadCourseData();
        });
        // العداد التنازلي للعروض
function updateCountdowns() {
    document.querySelectorAll('.offer-timer').forEach(timer => {
        const endDate = new Date(timer.dataset.end);
        const now = new Date();
        const diff = endDate - now;
        
        if (diff > 0) {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            timer.querySelector('.days').textContent = days;
            timer.querySelector('.hours').textContent = String(hours).padStart(2, '0');
            timer.querySelector('.minutes').textContent = String(minutes).padStart(2, '0');
            timer.querySelector('.seconds').textContent = String(seconds).padStart(2, '0');
        }
    });
}

// تحديث كل ثانية
setInterval(updateCountdowns, 1000);
updateCountdowns();

// الإشعارات المباشرة
const notifications = [
    { icon: 'fa-user-check', text: 'أحمد من القاهرة انضم للرحلة' },
    { icon: 'fa-users', text: 'مجموعة من الإسكندرية (3 أشخاص) سجلوا' },
    { icon: 'fa-gift', text: 'سارة حصلت على منحة جزئية' },
    { icon: 'fa-star', text: 'محمد أكمل الوحدة الأولى بنجاح' },
    { icon: 'fa-heart', text: 'منى أهدت الدورة لصديقتها' }
];

// الإشعارات المباشرة مع التحكم الذكي
let notificationIndex = 0;
let activeNotifications = [];

function showNotification() {
    const container = document.getElementById('liveNotifications');
    const notification = notifications[notificationIndex % notifications.length];
    
    // إزالة الإشعارات القديمة على الموبايل
    if (window.innerWidth <= 768) {
        // على الموبايل - إشعار واحد فقط
        container.innerHTML = '';
        activeNotifications = [];
    }
    
    const notifElement = document.createElement('div');
    notifElement.className = 'notification';
    notifElement.innerHTML = `
        <i class="fas ${notification.icon}"></i>
        <div>
            <small style="color: #94a3b8;">منذ لحظات</small>
            <div>${notification.text}</div>
        </div>
    `;
    
    container.appendChild(notifElement);
    activeNotifications.push(notifElement);
    
    // إزالة بعد 5 ثواني
    setTimeout(() => {
        notifElement.remove();
        activeNotifications = activeNotifications.filter(n => n !== notifElement);
    }, 5000);
    
    notificationIndex++;
}

// تعديل التوقيت حسب الجهاز
const notificationInterval = window.innerWidth <= 768 ? 15000 : 10000;
setInterval(showNotification, notificationInterval);
setTimeout(showNotification, 3000);

// تحديث المقاعد مع تأثير على الإشعارات
// تحديث المقاعد المتبقية - نسخة محسنة
function updateSeats() {
    const seats = document.getElementById('remainingSeats');
    const current = parseInt(seats.textContent);
    
    if (current > 3) {
        // نقص مقعد كل فترة عشوائية
        const nextUpdate = Math.random() * 40000 + 20000; // بين 20-60 ثانية
        
        setTimeout(() => {
            const newCount = current - 1;
            seats.textContent = newCount;
            
            // إضافة تأثير للفت الانتباه
            const indicator = document.querySelector('.seats-indicator-floating');
            if (indicator) {
                indicator.style.animation = 'none';
                setTimeout(() => {
                    indicator.style.animation = window.innerWidth <= 768 ? 
                        'pulse 2s infinite' : 'bounce 2s infinite';
                }, 10);
            }
            
            // عرض إشعار عند نقص المقاعد
            if (newCount === 5) {
                // إشعار خاص عند 5 مقاعد
                Swal.fire({
                    title: 'عجّل!',
                    text: 'باقي 5 مقاعد فقط!',
                    icon: 'warning',
                    timer: 3000,
                    showConfirmButton: false,
                    position: 'top',
                    background: '#152238',
                    color: '#fff'
                });
            }
            
            // استمرار التحديث
            updateSeats();
        }, nextUpdate);
    } else if (current === 3) {
        // آخر 3 مقاعد - تحذير نهائي
        const indicator = document.querySelector('.seats-indicator-floating');
        if (indicator) {
            indicator.style.background = '#dc2626';
            indicator.style.animation = 'pulse 1s infinite';
        }
    }
}

// بدء تحديث المقاعد
updateSeats();

// التحقق من حجم الشاشة عند تغيير الحجم
window.addEventListener('resize', () => {
    if (window.innerWidth <= 768) {
        // تنظيف الإشعارات الزائدة على الموبايل
        const container = document.getElementById('liveNotifications');
        while (container.children.length > 1) {
            container.firstChild.remove();
        }
    }
});

// أنيميشن للأرقام في الإحصائيات
function animateNumbers() {
    document.querySelectorAll('.stat-number').forEach(stat => {
        const target = parseFloat(stat.dataset.target);
        const duration = 2000;
        const step = target / (duration / 16);
        let current = 0;
        
        const update = () => {
            current += step;
            if (current < target) {
                stat.textContent = Math.round(current * 10) / 10;
                requestAnimationFrame(update);
            } else {
                stat.textContent = target;
            }
        };
        
        // بدء الأنيميشن عند الوصول للقسم
        const observer = new IntersectionObserver(entries => {
            if (entries[0].isIntersecting) {
                update();
                observer.disconnect();
            }
        });
        
        observer.observe(stat);
    });
}
animateNumbers();

       // الحاسبة الذكية المحدثة
// الحاسبة الذكية المتطورة - النسخة الكاملة
// الحاسبة الذكية المتطورة V2
// الحاسبة الذكية المتطورة V3 - النسخة المصححة
const smartCalculator = {
    courseData: null,
    selectedJourney: 'individual',
    selectedGroup: null,
    selectedGift: 'specific',
    appliedCoupon: null,
    
    init() {
    console.log('تهيئة الحاسبة الذكية V3');
    this.bindEvents();
    this.updateFromFirebase();
    
    // التأكد من ظهور زر الدعم للرحلة الفردية
    setTimeout(() => {
        if (this.selectedJourney === 'individual') {
            document.getElementById('calcGrantBtn').style.display = 'block';
            document.getElementById('calcSupportMessage').style.display = 'block';
        }
    }, 500);
},
    
    bindEvents() {
        // اختيار نوع الرحلة
        document.querySelectorAll('.journey-option').forEach(option => {
            option.addEventListener('click', (e) => {
                document.querySelectorAll('.journey-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                this.handleJourneyChange(option.dataset.journey);
            });
        });
        
        // اختيار نوع الإهداء
        document.querySelectorAll('.gift-option-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.gift-option-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                this.handleGiftTypeChange(card.dataset.gift);
            });
        });
        
        // تغيير قيمة القسيمة
        const voucherInput = document.getElementById('voucherAmount');
        if (voucherInput) {
            voucherInput.addEventListener('input', () => this.calculate());
        }
        
        // تطبيق الكوبون
        const applyCouponBtn = document.getElementById('applyCouponCalc');
        if (applyCouponBtn) {
            applyCouponBtn.addEventListener('click', () => this.applyCoupon());
        }
        
        // زر الإجراء الرئيسي
        const bookBtn = document.getElementById('calcBookBtn');
        if (bookBtn) {
            bookBtn.addEventListener('click', () => this.handleMainAction());
        }
        
        // زر طلب الدعم
        const grantBtn = document.getElementById('calcGrantBtn');
        if (grantBtn) {
            grantBtn.addEventListener('click', () => this.handleGrantRequest());
        }
    },
    
    updateFromFirebase() {
    this.courseData = window.currentCourseData || {
        price: 10000,
        salePrice: 8000,
        currency: 'EGP',
        cashDiscount: { enabled: true, percentage: 15 },
        paymentPlans: [
            { name: '3 شهور', installments: 3, firstPaymentPercent: 40 },
            { name: '6 شهور', installments: 6, firstPaymentPercent: 30 }
        ],
        groupDiscounts: [
            { name: 'الصحاب', minSize: 3, percentage: 30 }
        ],
        discounts: [],
        coupons: []
    };
    
    this.coupons = this.courseData.coupons || [];
    console.log('الكوبونات المحملة من Firebase:', this.coupons);
    
    this.updateGroupOptions();
    this.updatePaymentOptions();
    this.updateActiveOffer();
    this.calculate();
},
    
    handleJourneyChange(journey) {
    this.selectedJourney = journey;
    
    // إخفاء كل الأقسام أولاً
    document.getElementById('calcGroupArea').style.display = 'none';
    document.getElementById('calcGiftArea').style.display = 'none';
    document.getElementById('calcGrantBtn').style.display = 'none';
    document.getElementById('calcSupportMessage').style.display = 'none';
    
    // تحديث زر الإجراء الرئيسي
    const bookBtn = document.getElementById('calcBookBtn');
    bookBtn.className = 'btn-primary-action';
    
    // عرض القسم المناسب وتحديث الزر
    if (journey === 'group') {
        document.getElementById('calcGroupArea').style.display = 'block';
        bookBtn.innerHTML = '<i class="fas fa-users"></i> احجز للمجموعة';
    } else if (journey === 'gift') {
        document.getElementById('calcGiftArea').style.display = 'block';
        bookBtn.className = 'btn-primary-action btn-gift-action';
        bookBtn.innerHTML = '<i class="fas fa-gift"></i> أكمل الإهداء';
        // عرض تفاصيل الإهداء الافتراضية
        this.handleGiftTypeChange('specific');
    } else if (journey === 'individual') {
        // رحلة فردية - عرض زر الدعم مباشرة
        setTimeout(() => {
            document.getElementById('calcGrantBtn').style.display = 'block';
            document.getElementById('calcSupportMessage').style.display = 'block';
        }, 100);
        bookBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> احجز مقعدك';
    }
    
    this.calculate();
},
    
    handleGiftTypeChange(giftType) {
    this.selectedGift = giftType;
    
    // إخفاء كل التفاصيل
    document.getElementById('giftSpecificDetails').style.display = 'none';
    document.getElementById('giftAnonymousDetails').style.display = 'none';
    document.getElementById('giftVoucherDetails').style.display = 'none';
    
    const bookBtn = document.getElementById('calcBookBtn');
    const gifterInfo = document.getElementById('gifterInfo');
    const activeOfferSection = document.getElementById('calcActiveOffer');
    
    // عرض التفاصيل المناسبة
    if (giftType === 'specific') {
        document.getElementById('giftSpecificDetails').style.display = 'block';
        gifterInfo.style.display = 'block';
        // عرض العرض النشط للهدية المحددة
        if (activeOfferSection && this.getActiveTimeOffer()) {
            activeOfferSection.style.display = 'block';
        }
        bookBtn.innerHTML = '<i class="fas fa-gift"></i> أكمل إهداء الرحلة';
    } else if (giftType === 'anonymous') {
        document.getElementById('giftAnonymousDetails').style.display = 'block';
        gifterInfo.style.display = 'block';
        // عرض العرض النشط للهدية المجهولة
        if (activeOfferSection && this.getActiveTimeOffer()) {
            activeOfferSection.style.display = 'block';
        }
        bookBtn.innerHTML = '<i class="fas fa-heart"></i> ساهم بهدية مجهولة';
    } else if (giftType === 'voucher') {
        document.getElementById('giftVoucherDetails').style.display = 'block';
        gifterInfo.style.display = 'block';
        // إخفاء العرض النشط للقسيمة المفتوحة
        if (activeOfferSection) {
            activeOfferSection.style.display = 'none';
        }
        bookBtn.className = 'btn-primary-action btn-voucher-action';
        bookBtn.innerHTML = '<i class="fas fa-hand-holding-heart"></i> ادعم المجتمع';
    }
    
    this.calculate();
},
    
    updateGroupOptions() {
        const container = document.querySelector('.group-cards');
        if (!container || !this.courseData.groupDiscounts) return;
        
        let html = '';
        this.courseData.groupDiscounts.forEach((group, index) => {
            html += `
                <div class="group-card" data-group="${index}">
                    <i class="fas fa-users"></i>
                    <h5>${group.name}</h5>
                    <div class="discount">${group.percentage}%</div>
                    <div class="size">${group.minSize}+ أشخاص</div>
                </div>
            `;
        });
        
        container.innerHTML = html;
        
        container.querySelectorAll('.group-card').forEach(card => {
            card.addEventListener('click', () => {
                container.querySelectorAll('.group-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                this.selectedGroup = parseInt(card.dataset.group);
                this.calculate();
            });
        });
        
        // اختيار الأول افتراضياً
        if (container.querySelector('.group-card')) {
            container.querySelector('.group-card').click();
        }
    },
    
    updatePaymentOptions() {
        const container = document.getElementById('calcPaymentCards');
        if (!container) return;
        
        let html = '';
        
        // الدفع النقدي
        if (this.courseData.cashDiscount?.enabled) {
            html += `
                <div class="payment-card active" data-payment="cash">
                    <i class="fas fa-money-bill-wave"></i>
                    <h6>دفعة واحدة</h6>
                    <small>خصم ${this.courseData.cashDiscount.percentage}%</small>
                </div>
            `;
        } else {
            html += `
                <div class="payment-card active" data-payment="full">
                    <i class="fas fa-credit-card"></i>
                    <h6>دفعة واحدة</h6>
                </div>
            `;
        }
        
        // خطط الأقساط
        if (this.courseData.paymentPlans?.length > 0) {
            this.courseData.paymentPlans.forEach((plan, index) => {
                html += `
                    <div class="payment-card" data-payment="plan_${index}">
                        <i class="fas fa-calendar-alt"></i>
                        <h6>${plan.name}</h6>
                        <small>بدون فوائد</small>
                    </div>
                `;
            });
        }
        
        container.innerHTML = html;
        
        container.querySelectorAll('.payment-card').forEach(card => {
            card.addEventListener('click', () => {
                container.querySelectorAll('.payment-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                this.calculate();
            });
        });
    },
    
    updateActiveOffer() {
        const section = document.getElementById('calcActiveOffer');
        const activeOffer = this.getActiveTimeOffer();
        
        if (activeOffer) {
            section.style.display = 'block';
            document.getElementById('activeOfferName').textContent = activeOffer.name;
            document.getElementById('activeOfferDiscount').textContent = `خصم ${activeOffer.percentage}%`;
        } else {
            section.style.display = 'none';
        }
    },
    
    getActiveTimeOffer() {
        if (!this.courseData.discounts) return null;
        
        const now = new Date();
        return this.courseData.discounts.find(d => {
            if (!d.startDate || !d.endDate) return false;
            const start = new Date(d.startDate);
            const end = new Date(d.endDate);
            return now >= start && now <= end && d.percentage > 0;
        });
    },
    
   calculate() {
    if (!this.courseData) return;
    
    const paymentCard = document.querySelector('.payment-card.active');
    const paymentMethod = paymentCard?.dataset.payment || 'full';
    
    let basePrice = this.courseData.price || 10000;
    let currentPrice = basePrice;
    let discounts = [];
    
    // حالة القسيمة المفتوحة - معالجة خاصة
    if (this.selectedJourney === 'gift' && this.selectedGift === 'voucher') {
        const voucherAmount = parseInt(document.getElementById('voucherAmount')?.value) || 0;
        // إخفاء العرض النشط أيضاً
    const activeOfferSection = document.getElementById('calcActiveOffer');
    if (activeOfferSection) {
        activeOfferSection.style.display = 'none';
    }
        // إخفاء كل عناصر التسعير العادية
        document.getElementById('calcBase').parentElement.style.display = 'none';
        document.getElementById('calcTimeDiscountRow').style.display = 'none';
        document.getElementById('calcGroupDiscountRow').style.display = 'none';
        document.getElementById('calcCashDiscountRow').style.display = 'none';
        document.getElementById('calcCouponDiscountRow').style.display = 'none';
        document.getElementById('calcInstallmentDetails').style.display = 'none';
        document.getElementById('calcSavings').style.display = 'none';
        
        // إخفاء قسم طريقة الدفع والكوبون
        const paymentSection = document.querySelector('.payment-selection');
        const couponSection = document.querySelector('.coupon-section');
        if (paymentSection) paymentSection.style.display = 'none';
        if (couponSection) couponSection.style.display = 'none';
        
        // تحديث العنوان والقيمة
        document.getElementById('calcTotalLabel').textContent = 'قيمة دعمك الكريم:';
        
        if (voucherAmount >= 50) {
            document.getElementById('calcTotal').textContent = `${voucherAmount.toLocaleString('ar-EG')} ج.م`;
        } else {
            document.getElementById('calcTotal').textContent = '0 ج.م';
        }
        
        return; // توقف هنا للقسيمة
    } 
    
    // إظهار العناصر العادية للحالات الأخرى
    document.getElementById('calcBase').parentElement.style.display = 'flex';
    const paymentSection = document.querySelector('.payment-selection');
    const couponSection = document.querySelector('.coupon-section');
    if (paymentSection) paymentSection.style.display = 'block';
    if (couponSection) couponSection.style.display = 'block';
    
    // حالة الإهداء العادي - نفس حسابات الفردي
    if (this.selectedJourney === 'gift' && this.selectedGift !== 'voucher') {
        document.getElementById('calcTotalLabel').textContent = 'قيمة الهدية:';
        
        // نطبق نفس العروض والخصومات
        const activeOffer = this.getActiveTimeOffer();
        if (activeOffer) {
            const discount = basePrice * (activeOffer.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'time', amount: discount, name: activeOffer.name });
        } else if (this.courseData.salePrice && this.courseData.salePrice < basePrice) {
            const discount = basePrice - this.courseData.salePrice;
            currentPrice = this.courseData.salePrice;
            discounts.push({ type: 'sale', amount: discount, name: 'تخفيض' });
        }
        
        // خصم الدفع النقدي ينطبق على الهدايا أيضاً
        if (paymentMethod === 'cash' && this.courseData.cashDiscount?.enabled) {
            const discount = currentPrice * (this.courseData.cashDiscount.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'cash', amount: discount, name: 'دفع كامل' });
        }
    } 
    // الرحلات العادية (فردية أو جماعية)
    else {
        document.getElementById('calcTotalLabel').textContent = 'إجمالي الاستثمار:';
        
        // العروض الزمنية
        const activeOffer = this.getActiveTimeOffer();
        if (activeOffer) {
            const discount = basePrice * (activeOffer.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'time', amount: discount, name: activeOffer.name });
        } else if (this.courseData.salePrice && this.courseData.salePrice < basePrice) {
            const discount = basePrice - this.courseData.salePrice;
            currentPrice = this.courseData.salePrice;
            discounts.push({ type: 'sale', amount: discount, name: 'تخفيض' });
        }
        
        // خصم المجموعة
        if (this.selectedJourney === 'group' && this.selectedGroup !== null) {
            const group = this.courseData.groupDiscounts[this.selectedGroup];
            if (group) {
                const discount = currentPrice * (group.percentage / 100);
                currentPrice -= discount;
                discounts.push({ type: 'group', amount: discount, name: group.name });
            }
        }
        
        // خصم الدفع النقدي
        if (paymentMethod === 'cash' && this.courseData.cashDiscount?.enabled) {
            const discount = currentPrice * (this.courseData.cashDiscount.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'cash', amount: discount, name: 'دفع كامل' });
        }
    }
    
    // كود الخصم (يعمل مع كل الأنواع ما عدا القسيمة المفتوحة)
    if (this.appliedCoupon && !(this.selectedJourney === 'gift' && this.selectedGift === 'voucher')) {
        let discount = 0;
        if (this.appliedCoupon.type === 'percentage') {
            discount = currentPrice * (this.appliedCoupon.value / 100);
        } else {
            discount = Math.min(this.appliedCoupon.value, currentPrice);
        }
        currentPrice -= discount;
        discounts.push({ type: 'coupon', amount: discount, name: this.appliedCoupon.code });
    }
    
    this.updateDisplay(basePrice, currentPrice, discounts, paymentMethod);
},
    
    updateDisplay(basePrice, finalPrice, discounts, paymentMethod) {
        // تقريب
        basePrice = Math.round(basePrice / 10) * 10;
        finalPrice = Math.round(finalPrice / 10) * 10;
        
        // السعر الأساسي
        document.getElementById('calcBase').textContent = `${basePrice.toLocaleString('ar-EG')} ج.م`;
        
        // إخفاء كل الخصومات
        document.getElementById('calcTimeDiscountRow').style.display = 'none';
        document.getElementById('calcGroupDiscountRow').style.display = 'none';
        document.getElementById('calcCashDiscountRow').style.display = 'none';
        document.getElementById('calcCouponDiscountRow').style.display = 'none';
        
        // عرض الخصومات النشطة
        discounts.forEach(discount => {
            const amount = Math.round(discount.amount / 10) * 10;
            
            if (discount.type === 'time' || discount.type === 'sale') {
                document.getElementById('calcTimeDiscountRow').style.display = 'flex';
                document.getElementById('calcTimeDiscountLabel').textContent = 
                    discount.type === 'time' ? `خصم ${discount.name}:` : 'خصم:';
                document.getElementById('calcTimeDiscount').textContent = `-${amount.toLocaleString('ar-EG')} ج.م`;
            }
            if (discount.type === 'group') {
                document.getElementById('calcGroupDiscountRow').style.display = 'flex';
                document.getElementById('calcGroupDiscount').textContent = `-${amount.toLocaleString('ar-EG')} ج.م`;
            }
            if (discount.type === 'cash') {
                document.getElementById('calcCashDiscountRow').style.display = 'flex';
                document.getElementById('calcCashDiscount').textContent = `-${amount.toLocaleString('ar-EG')} ج.م`;
            }
            if (discount.type === 'coupon') {
                document.getElementById('calcCouponDiscountRow').style.display = 'flex';
                document.getElementById('calcCouponDiscount').textContent = `-${amount.toLocaleString('ar-EG')} ج.م`;
            }
        });
        
        // الإجمالي
        document.getElementById('calcTotal').textContent = `${finalPrice.toLocaleString('ar-EG')} ج.م`;
        
        // الأقساط (لا تظهر للقسيمة المفتوحة)
        const installmentDetails = document.getElementById('calcInstallmentDetails');
        if (paymentMethod.startsWith('plan_') && 
            !(this.selectedJourney === 'gift' && this.selectedGift === 'voucher')) {
            const planIndex = parseInt(paymentMethod.split('_')[1]);
            const plan = this.courseData.paymentPlans[planIndex];
            
            if (plan) {
                const installmentText = this.calculateInstallments(finalPrice, plan);
                document.getElementById('calcInstallmentPlan').innerHTML = installmentText;
                installmentDetails.style.display = 'block';
            }
        } else {
            installmentDetails.style.display = 'none';
        }
        
        // التوفير (لا يظهر للقسيمة المفتوحة)
        const savings = basePrice - finalPrice;
        if (savings > 0 && !(this.selectedJourney === 'gift' && this.selectedGift === 'voucher')) {
            document.getElementById('calcSavings').style.display = 'block';
            document.getElementById('calcSavingsAmount').textContent = savings.toLocaleString('ar-EG');
        } else {
            document.getElementById('calcSavings').style.display = 'none';
        }
    },
    
    calculateInstallments(total, plan) {
        const installments = plan.installments || 3;
        const firstPercent = plan.firstPaymentPercent || 0;
        
        total = Math.round(total / 10) * 10;
        
        if (firstPercent > 0) {
            const firstPayment = Math.round(total * firstPercent / 100 / 10) * 10;
            const remaining = total - firstPayment;
            const monthlyAmount = Math.round(remaining / (installments - 1) / 10) * 10;
            
            return `دفعة أولى: ${firstPayment.toLocaleString('ar-EG')} ج.م + ${installments - 1} أقساط × ${monthlyAmount.toLocaleString('ar-EG')} ج.م`;
        } else {
            const monthlyAmount = Math.round(total / installments / 10) * 10;
            return `${installments} أقساط × ${monthlyAmount.toLocaleString('ar-EG')} ج.م شهرياً`;
        }
    },
    
    applyCoupon() {
    const couponInput = document.getElementById('calcCoupon');
    const couponCode = couponInput.value.trim().toUpperCase();
    
    if (!couponCode) {
        Swal.fire({
            icon: 'warning',
            title: 'كود فارغ',
            text: 'الرجاء إدخال كود الخصم',
            confirmButtonColor: '#FFD700'
        });
        return;
    }
    
    // البحث عن الكوبون
    const validCoupon = this.coupons.find(c => c.code === couponCode);
    
    if (!validCoupon) {
        Swal.fire({
            icon: 'error',
            title: 'كود غير صحيح',
            text: 'هذا الكود غير موجود أو منتهي الصلاحية',
            confirmButtonColor: '#E11D48'
        });
        return;
    }
    
    // التحقق من الاستخدام
    if (validCoupon.maxUses && validCoupon.used >= validCoupon.maxUses) {
        Swal.fire({
            icon: 'error',
            title: 'كود مستخدم',
            text: 'تم استخدام هذا الكود العدد الأقصى من المرات',
            confirmButtonColor: '#E11D48'
        });
        return;
    }
    
    // تطبيق الكوبون
    this.appliedCoupon = validCoupon;
    
    // تحديث الواجهة
    couponInput.disabled = true;
    document.getElementById('applyCouponCalc').style.display = 'none';
    
    // إضافة زر إزالة
    const couponSection = document.querySelector('.coupon-section');
    if (!document.querySelector('.coupon-remove-btn')) {
        const removeBtn = document.createElement('button');
        removeBtn.className = 'coupon-remove-btn';
        removeBtn.innerHTML = '<i class="fas fa-times"></i> إزالة الكود';
        removeBtn.onclick = () => this.removeCoupon();
        couponSection.appendChild(removeBtn);
    }
    
    // رسالة نجاح
    Swal.fire({
        icon: 'success',
        title: 'تم التطبيق!',
        text: `كود ${couponCode} تم تطبيقه بنجاح`,
        confirmButtonColor: '#22C55E',
        timer: 2000
    });
    
    // إعادة حساب
    this.calculate();
},

removeCoupon() {
    this.appliedCoupon = null;
    
    const couponInput = document.getElementById('calcCoupon');
    couponInput.value = '';
    couponInput.disabled = false;
    
    document.getElementById('applyCouponCalc').style.display = 'inline-block';
    document.querySelector('.coupon-remove-btn')?.remove();
    
    this.calculate();
},

    // أضف هذه الدالة الجديدة
getDisplayedValues() {
    return {
        basePrice: parseInt(document.getElementById('calcBase').textContent.replace(/[^\d]/g, '')) || 0,
        finalPrice: parseInt(document.getElementById('calcTotal').textContent.replace(/[^\d]/g, '')) || 0,
        discounts: this.getDisplayedDiscounts(),
        paymentMethod: document.querySelector('.payment-card.active')?.dataset.payment || 'full',
        installmentDetails: this.getDisplayedInstallments(),
        coupon: this.appliedCoupon,
        activeOffer: this.getActiveTimeOffer()
    };
},

getDisplayedDiscounts() {
    const discounts = [];
    
    // خصم العرض الزمني
    if (document.getElementById('calcTimeDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcTimeDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        const label = document.getElementById('calcTimeDiscountLabel').textContent;
        discounts.push({
            type: 'عرض زمني',
            name: label.replace(':', ''),
            amount: amount
        });
    }
    
    // خصم المجموعة
    if (document.getElementById('calcGroupDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcGroupDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        discounts.push({
            type: 'خصم مجموعة',
            name: 'خصم المجموعة',
            amount: amount
        });
    }
    
    // خصم النقدي
    if (document.getElementById('calcCashDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcCashDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        discounts.push({
            type: 'خصم نقدي',
            name: 'دفع كامل',
            amount: amount
        });
    }
    
    // كود الخصم
    if (document.getElementById('calcCouponDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcCouponDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        discounts.push({
            type: 'كود خصم',
            name: this.appliedCoupon?.code || 'كوبون',
            amount: amount
        });
    }
    
    return discounts;
},

getDisplayedInstallments() {
    const installmentDetails = document.getElementById('calcInstallmentDetails');
    if (installmentDetails.style.display === 'none') return null;
    
    const text = document.getElementById('calcInstallmentPlan').innerHTML;
    return {
        planText: text,
        isActive: true
    };
},

    
    
handleMainAction() {
    const journey = this.selectedJourney;
    
    // ✅ الحل الجذري: نأخذ القيم المعروضة بالضبط
    const displayedData = this.getDisplayedValues();
    
    const fullBookingData = {
        type: journey,
        courseId: this.courseData.courseId || 'default',
        courseName: this.courseData.title || 'ملاذ الحياري',
        
        // ✅ نقل البيانات المعروضة بالضبط (بدون إعادة حساب)
        basePrice: displayedData.basePrice,
        finalPrice: displayedData.finalPrice,
        discounts: displayedData.discounts,
        paymentMethod: displayedData.paymentMethod,
        installmentDetails: displayedData.installmentDetails,
        coupon: displayedData.coupon,
        activeOffer: displayedData.activeOffer,
        
        // البيانات الإضافية
        groupData: journey === 'group' ? this.getGroupData() : null,
        giftData: journey === 'gift' ? this.getGiftData() : null
    };
    
    // ✅ نقل مباشر بدون معالجة إضافية
    const params = new URLSearchParams();
    params.append('data', encodeURIComponent(JSON.stringify(fullBookingData)));
    
    window.location.href = `booking-page.html?${params.toString()}`;
},
    
    getGroupData() {
    if (this.selectedGroup === null) return null;
    const group = this.courseData.groupDiscounts[this.selectedGroup];
    return {
        name: group.name,
        minSize: group.minSize,
        percentage: group.percentage
    };
},

getGiftData() {
    const data = {
        type: this.selectedGift
    };
    
    if (this.selectedGift === 'voucher') {
        data.voucherAmount = parseInt(document.getElementById('voucherAmount')?.value) || 0;
    } else if (this.selectedGift === 'specific') {
        data.recipientName = document.getElementById('giftRecipientName')?.value || '';
    }
    
    return data;
},
    
    handleGiftAction(total) {
        const giftType = this.selectedGift;
        
        if (giftType === 'specific') {
            this.handleSpecificGift(total);
        } else if (giftType === 'anonymous') {
            this.handleAnonymousGift(total);
        } else if (giftType === 'voucher') {
            this.handleVoucherGift();
        }
    },
    
    handleSpecificGift(total) {
        const recipientName = document.getElementById('giftRecipientName').value;
        const gifterName = document.getElementById('gifterName').value || 'مجهول';
        const revealName = document.getElementById('revealGifterName').checked;
        const message = document.getElementById('giftMessage').value;
        
        if (!recipientName) {
            Swal.fire({
                title: 'تنبيه',
                text: 'الرجاء إدخال اسم المستفيد من الهدية',
                icon: 'warning',
                background: '#152238',
                color: '#fff'
            });
            return;
        }
        
        Swal.fire({
            title: 'تأكيد الإهداء',
            html: `
                <div style="text-align: right;">
                    <p><strong>نوع الهدية:</strong> رحلة كاملة</p>
                    <p><strong>المستفيد:</strong> ${recipientName}</p>
                    <p><strong>من:</strong> ${revealName ? gifterName : 'مُهدي كريم'}</p>
                    <p><strong>القيمة:</strong> ${total}</p>
                    ${message ? `<p><strong>رسالة:</strong> ${message}</p>` : ''}
                    <hr>
                    <p>سيتم إرسال بطاقة هدية إلكترونية للمستفيد</p>
                </div>
            `,
            icon: 'gift',
            showCancelButton: true,
            confirmButtonText: 'تأكيد الإهداء',
            cancelButtonText: 'إلغاء',
            confirmButtonColor: '#EC4899',
            background: '#152238',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                // معالجة الإهداء
                console.log('معالجة الإهداء...');
                
                Swal.fire({
                    title: 'تم الإهداء بنجاح!',
                    html: `
                        <p>سيتم إرسال بطاقة الهدية إلى ${recipientName}</p>
                        <p>شكراً لك على هذه اللفتة الكريمة</p>
                    `,
                    icon: 'success',
                    background: '#152238',
                    color: '#fff'
                });
            }
        });
    },
    
    handleAnonymousGift(total) {
        const gifterName = document.getElementById('gifterName').value || 'محسن كريم';
        const message = document.getElementById('giftMessage').value;
        
        Swal.fire({
            title: 'هدية مجهولة',
            html: `
                <div style="text-align: right;">
                    <p><strong>نوع الهدية:</strong> رحلة كاملة لمحتاج</p>
                    <p><strong>القيمة:</strong> ${total}</p>
                    <p><strong>المُهدي:</strong> ${gifterName}</p>
                    ${message ? `<p><strong>رسالتك:</strong> ${message}</p>` : ''}
                    <hr>
                    <p>سنختار أحد المحتاجين من مجتمعنا وسنرسل لك تقرير عن المستفيد</p>
                </div>
            `,
            icon: 'heart',
            showCancelButton: true,
            confirmButtonText: 'تأكيد المساهمة',
            cancelButtonText: 'إلغاء',
            confirmButtonColor: '#22C55E',
            background: '#152238',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'شكراً لك!',
                    html: `
                        <p>مساهمتك ستغير حياة شخص ما</p>
                        <p>سنرسل لك تقرير عن المستفيد قريباً</p>
                    `,
                    icon: 'success',
                    background: '#152238',
                    color: '#fff'
                });
            }
        });
    },
    
    handleVoucherGift() {
    const amount = document.getElementById('voucherAmount').value;
    const gifterName = document.getElementById('gifterName').value || 'محسن كريم';
    const message = document.getElementById('giftMessage').value;
    
    if (!amount || amount < 50) {
        Swal.fire({
            title: 'تنبيه',
            text: 'الحد الأدنى للمساهمة 50 ج.م',
            icon: 'warning',
            background: '#152238',
            color: '#fff'
        });
        return;
    }
    
    Swal.fire({
        title: '💝 قسيمة دعم التعلم',
        html: `
            <div style="text-align: right;">
                <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(20, 184, 166, 0.1)); 
                            padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <p style="margin: 0; font-size: 1.1em;">
                        <strong>قيمة دعمك الكريم:</strong> 
                        <span style="color: #FFD700; font-size: 1.3em;">${amount} ج.م</span>
                    </p>
                </div>
                
                <p><strong>الداعم الكريم:</strong> ${gifterName}</p>
                ${message ? `<p><strong>رسالتك:</strong> ${message}</p>` : ''}
                
                <hr style="border-color: rgba(255, 215, 0, 0.3);">
                
                <div style="background: rgba(255, 215, 0, 0.05); padding: 15px; border-radius: 10px;">
                    <p style="margin: 5px 0;">✨ <strong>أثر مساهمتك:</strong></p>
                    <ul style="text-align: right; margin: 10px 0;">
                        <li>ستمكن متعلم من الانضمام لرحلة التعلم</li>
                        <li>ستحصل على تقرير شهري عن المستفيدين</li>
                        <li>اسمك سيُذكر في قائمة الداعمين (إذا رغبت)</li>
                    </ul>
                </div>
            </div>
        `,
        icon: 'heart',
        showCancelButton: true,
        confirmButtonText: '✨ تأكيد المساهمة',
        cancelButtonText: 'إلغاء',
        confirmButtonColor: '#14B8A6',
        background: '#152238',
        color: '#fff'
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: '🌟 أنت نجم مضيء!',
                html: `
                    <div style="text-align: center;">
                        <p style="font-size: 1.2em; margin: 20px 0;">
                            شكراً لك من القلب
                        </p>
                        <p>مساهمتك ستغير حياة إنسان</p>
                        <p style="color: #FFD700; margin-top: 15px;">
                            "من فرّج عن مؤمن كربة من كرب الدنيا،<br>
                            فرّج الله عنه كربة من كرب يوم القيامة"
                        </p>
                    </div>
                `,
                icon: 'success',
                confirmButtonText: 'بارك الله فيك',
                confirmButtonColor: '#22C55E',
                background: '#152238',
                color: '#fff'
            });
        }
    });
},
    
    
};

// تهيئة الحاسبة عند التحميل
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        smartCalculator.init();
    }, 1500);
});

// تحديث من Firebase
window.updateCalculatorFromFirebase = function() {
    smartCalculator.updateFromFirebase();
};

// التعامل مع أزرار الجدول
document.querySelectorAll('.table-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // إزالة active من الكل
        document.querySelectorAll('.table-btn').forEach(b => b.classList.remove('active'));
        // إضافة active للمضغوط
        this.classList.add('active');
        
        // هنا ممكن نغير عرض الجدول حسب الزر
        const view = this.dataset.view;
        console.log('تغيير العرض إلى:', view);
    });
});

// زر الحجز من الحاسبة
document.querySelector('.btn-calculate-book').addEventListener('click', () => {
    const total = document.getElementById('calcTotal').textContent;
    Swal.fire({
        title: 'ممتاز!',
        html: `سعرك النهائي: <strong>${total}</strong><br>جاري توجيهك لصفحة الدفع...`,
        icon: 'success',
        timer: 3000,
        showConfirmButton: false,
        background: '#152238',
        color: '#fff'
    });
});

        // تحديث البيانات من Firebase للحاسبة والجدول
async function updatePricingFromFirebase() {
    if (!courseData) return;
    
    // تحديث أسعار الحاسبة
    if (courseData.price) {
        calculator.basePrice = courseData.price;
    }
    
    // تحديث خصم العرض الحالي
    if (courseData.discounts && courseData.discounts.length > 0) {
        // البحث عن عرض نشط
        const today = new Date();
        const activeDiscount = courseData.discounts.find(d => {
            if (!d.startDate || !d.endDate) return false;
            const start = new Date(d.startDate);
            const end = new Date(d.endDate);
            return today >= start && today <= end;
        });
        
        if (activeDiscount) {
            calculator.currentOffer = activeDiscount.percentage / 100;
        }
    }
    
    // تحديث خطط الأقساط إذا كانت موجودة
    if (courseData.paymentPlans && courseData.paymentPlans.length > 0) {
        console.log('خطط الدفع المتاحة:', courseData.paymentPlans);
        
        // هنا ممكن نحدث خيارات الدفع في الحاسبة
        // حسب البيانات الفعلية من Firebase
    }
    
    // إعادة حساب الحاسبة
    calculator.calculate();
}

// استدعاء التحديث بعد تحميل البيانات
const originalLoadCourseData = loadCourseData;
loadCourseData = async function() {
    await originalLoadCourseData();
    await updatePricingFromFirebase();
};
        // تحديث العروض النشطة بناءً على السيناريو
// تحديث العروض النشطة - نسخة محسنة بتصميم جذاب
// تحديث العروض النشطة - نسخة مصححة مع ترتيب أفضل
// تحديث العروض النشطة - النسخة الصحيحة
// تحديث العروض النشطة - النسخة النهائية مع الترتيب الصحيح
function updateActiveOffers(data, scenario) {
    const offersContainer = document.querySelector('.offers-slider');
    if (!offersContainer) return;
    
    // تنظيف العدادات القديمة
    clearAllCountdowns();
    
    offersContainer.innerHTML = '';
    let cardsHTML = '';
    let timeOffersHTML = '';
    let mainOffersHTML = '';
    let groupOffersHTML = '';
    
    // دالة مساعدة لتقريب الأسعار
    function roundPrice(price) {
        return Math.round(price / 10) * 10;
    }
    
    // دالة محسنة لحساب السعر الحالي
    function getCurrentPrice() {
        let price = data.price || 10000;
        let hasActiveTimeDiscount = false;
        let activeDiscount = null;
        
        // تصحيح السعر إذا كان أقل من 100
        if (price < 100) {
            price = price * 1000;
        }
        
        // التحقق من العروض الزمنية النشطة
        if (data.discounts && data.discounts.length > 0) {
            const now = new Date();
            activeDiscount = data.discounts.find(d => {
                if (!d.startDate || !d.endDate) return false;
                try {
                    const start = new Date(d.startDate);
                    const end = new Date(d.endDate);
                    return now >= start && now <= end && d.percentage > 0;
                } catch (e) {
                    return false;
                }
            });
            
            if (activeDiscount) {
                hasActiveTimeDiscount = true;
                price = price * (1 - activeDiscount.percentage / 100);
            }
        }
        
        // التحقق من سعر التخفيض (فقط إذا لم يكن هناك عروض زمنية)
        if (!hasActiveTimeDiscount && data.salePrice && data.salePrice < data.price) {
            let salePrice = data.salePrice;
            if (salePrice < 100) {
                salePrice = salePrice * 1000;
            }
            
            // السيناريو الأول فقط
            if ((!data.discounts || data.discounts.length === 0) && 
                (!data.paymentPlans || data.paymentPlans.length === 0)) {
                price = salePrice;
            }
        }
        
        return {
            current: roundPrice(price),
            hasTimeDiscount: hasActiveTimeDiscount,
            activeDiscount: activeDiscount,
            original: data.price
        };
    }
    
    const priceInfo = getCurrentPrice();
    const currentPrice = priceInfo.current;
    const showOriginal = currentPrice < data.price;
    
    // 1️⃣ العروض الزمنية (أولاً إذا كانت موجودة)
    if (data.discounts && data.discounts.length > 0) {
        const now = new Date();
        
        data.discounts.forEach(offer => {
            if (!offer.startDate || !offer.endDate) return;
            
            const start = new Date(offer.startDate);
            const end = new Date(offer.endDate);
            const isActive = now >= start && now <= end;
            const isUpcoming = now < start;
            
            const offerPrice = offer.percentage > 0 ? 
                roundPrice(data.price * (1 - offer.percentage / 100)) : 
                data.price;
            
            timeOffersHTML += `
                <div class="offer-card time-offer ${isActive ? 'active-offer' : ''} ${isUpcoming ? 'upcoming-offer' : ''}">
                    <div class="offer-header">
                        <div class="offer-badge ${isActive ? 'urgent' : (isUpcoming ? 'soon' : 'ended')}">
                            ${isActive ? '🔥 نشط الآن' : (isUpcoming ? '⏰ قريباً' : '✓ انتهى')}
                        </div>
                        <i class="fas fa-clock offer-icon"></i>
                    </div>
                    <h4>${offer.name || 'عرض زمني'}</h4>
                    ${offer.percentage > 0 ? `
                        <div class="time-offer-details">
                            <div class="discount-circle">
                                <span class="percentage">${offer.percentage}%</span>
                                <span class="label">خصم</span>
                            </div>
                            <div class="dates">
                                <div class="date-row">
                                    <i class="fas fa-calendar-check"></i>
                                    من ${formatDate(offer.startDate)}
                                </div>
                                <div class="date-row">
                                    <i class="fas fa-calendar-times"></i>
                                    إلى ${formatDate(offer.endDate)}
                                </div>
                                <div class="offer-price">
                                    السعر: ${offerPrice.toLocaleString('ar-EG')} ج.م
                                </div>
                            </div>
                        </div>
                        ${isActive ? `
                            <div class="offer-timer" data-end="${offer.endDate}">
                                <span class="timer-item">
                                    <span class="days">--</span>
                                    <span class="label">يوم</span>
                                </span>
                                <span class="timer-item">
                                    <span class="hours">--</span>
                                    <span class="label">ساعة</span>
                                </span>
                                <span class="timer-item">
                                    <span class="minutes">--</span>
                                    <span class="label">دقيقة</span>
                                </span>
                                <span class="timer-item">
                                    <span class="seconds">--</span>
                                    <span class="label">ثانية</span>
                                </span>
                            </div>
                        ` : ''}
                    ` : `
                        <div class="regular-price-period">
                            <span>السعر العادي</span>
                            <div class="dates">
                                من ${formatDate(offer.startDate)} 
                                إلى ${formatDate(offer.endDate)}
                            </div>
                        </div>
                    `}
                    <div class="offer-features">
                        ${data.paymentPlans && data.paymentPlans.length > 0 ? `
                            <div class="offer-extra-info">
                                <i class="fas fa-check-circle"></i>
                                متاح التقسيط بدون فوائد
                            </div>
                        ` : ''}
                        ${data.cashDiscount && data.cashDiscount.enabled ? `
                            <div class="offer-extra-info">
                                <i class="fas fa-check-circle"></i>
                                خصم إضافي ${data.cashDiscount.percentage}% للدفع النقدي
                            </div>
                        ` : ''}
                        ${data.groupDiscounts && data.groupDiscounts.length > 0 ? `
                            <div class="offer-extra-info">
                                <i class="fas fa-check-circle"></i>
                                متاح عروض المجموعات بخصم إضافي
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        });
    }
    
    // 2️⃣ بطاقة السعر الحالي
    mainOffersHTML += `
        <div class="offer-card price-card">
            <div class="offer-header">
                <div class="offer-badge pulse">متاح الآن</div>
                <i class="fas fa-tag offer-icon"></i>
            </div>
            <h4>السعر الحالي</h4>
            <div class="price-display">
                ${showOriginal ? `
                    <div class="price-original">${data.price.toLocaleString('ar-EG')} ج.م</div>
                    <div class="price-current">
                        <span class="price-number">${currentPrice.toLocaleString('ar-EG')}</span>
                        <span class="price-currency">ج.م</span>
                    </div>
                    <div class="savings-badge">
                        وفر ${(data.price - currentPrice).toLocaleString('ar-EG')} ج.م
                    </div>
                ` : `
                    <div class="price-current solo">
                        <span class="price-number">${data.price.toLocaleString('ar-EG')}</span>
                        <span class="price-currency">ج.م</span>
                    </div>
                `}
                ${priceInfo.activeDiscount ? `
                    <div class="active-until">
                        <i class="fas fa-clock"></i>
                        العرض ينتهي: ${formatDate(priceInfo.activeDiscount.endDate)}
                    </div>
                ` : ''}
            </div>
        </div>
    `;
    
    // 3️⃣ بطاقة الأقساط
    if (data.paymentPlans && data.paymentPlans.length > 0) {
        mainOffersHTML += `
            <div class="offer-card installments-card">
                <div class="offer-header">
                    <div class="offer-badge installments">تقسيط ميسر</div>
                    <i class="fas fa-calendar-alt offer-icon"></i>
                </div>
                <h4>خطط السداد بدون فوائد</h4>
                <div class="plans-grid">
                    ${data.paymentPlans.map(plan => {
                        const installments = plan.installments || 3;
                        const firstPercent = plan.firstPaymentPercent || 0;
                        let firstPayment = 0;
                        let monthlyAmount = 0;
                        
                        if (firstPercent > 0) {
                            firstPayment = roundPrice(currentPrice * firstPercent / 100);
                            const remaining = currentPrice - firstPayment;
                            monthlyAmount = roundPrice(remaining / (installments - 1));
                        } else {
                            monthlyAmount = roundPrice(currentPrice / installments);
                        }
                        
                        return `
                            <div class="plan-item">
                                <div class="plan-name">${plan.name}</div>
                                <div class="plan-details">
                                    ${firstPayment > 0 ? `
                                        <span class="first-payment">${firstPayment.toLocaleString('ar-EG')} ج.م مقدم</span>
                                        <span class="then">ثم</span>
                                        <span class="monthly">${monthlyAmount.toLocaleString('ar-EG')} ج.م</span>
                                        <span class="period">× ${installments - 1} شهر</span>
                                    ` : `
                                        <span class="monthly">${monthlyAmount.toLocaleString('ar-EG')} ج.م</span>
                                        <span class="period">× ${installments} شهر</span>
                                    `}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="no-interest-badge">
                    <i class="fas fa-check-circle"></i>
                    بدون أي فوائد أو رسوم إضافية
                </div>
            </div>
        `;
    }
    
    // 4️⃣ بطاقة الدفع النقدي
    if (data.cashDiscount && data.cashDiscount.enabled === true) {
        const cashPrice = roundPrice(currentPrice * (1 - data.cashDiscount.percentage / 100));
        mainOffersHTML += `
            <div class="offer-card cash-card">
                <div class="offer-header">
                    <div class="offer-badge cash">
                        <i class="fas fa-fire"></i>
                        خصم إضافي لفترة محدودة
                    </div>
                    <i class="fas fa-money-bill-wave offer-icon"></i>
                </div>
                <h4>دفع نقدي كامل</h4>
                <div class="cash-details">
                    <div class="discount-percentage">
                        <span class="big-number">${data.cashDiscount.percentage}%</span>
                        <span class="label">خصم فوري</span>
                    </div>
                    <div class="cash-price">
                        <span class="final-price">${cashPrice.toLocaleString('ar-EG')} ج.م</span>
                        <span class="instead-of">بدلاً من ${currentPrice.toLocaleString('ar-EG')} ج.م</span>
                    </div>
                    <div class="limited-time">
                        <i class="fas fa-clock"></i>
                        العرض لفترة محدودة
                    </div>
                </div>
            </div>
        `;
    }
    
    // 5️⃣ بطاقة المجموعات
    if (data.groupDiscounts && data.groupDiscounts.length > 0) {
        groupOffersHTML = `
            <div class="offer-card groups-card">
                <div class="offer-header">
                    <div class="offer-badge groups">عروض المجموعات</div>
                    <i class="fas fa-users offer-icon"></i>
                </div>
                <h4>خصومات خاصة للمجموعات</h4>
                <div class="groups-list">
                    ${data.groupDiscounts.map(group => {
                        const groupPrice = roundPrice(currentPrice * (1 - group.percentage / 100));
                        return `
                            <div class="group-item">
                                <div class="group-header">
                                    <span class="group-name">${group.name}</span>
                                    <span class="group-size">${group.minSize}+ أشخاص</span>
                                </div>
                                <div class="group-pricing">
                                    <span class="discount-badge">${group.percentage}% خصم</span>
                                    <span class="per-person">${groupPrice.toLocaleString('ar-EG')} ج.م للفرد</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="group-features">
                    ${data.paymentPlans && data.paymentPlans.length > 0 ? `
                        <div class="feature">
                            <i class="fas fa-check"></i>
                            متاح التقسيط بنفس الشروط
                        </div>
                    ` : ''}
                    ${data.cashDiscount && data.cashDiscount.enabled ? `
                        <div class="feature">
                            <i class="fas fa-check"></i>
                            خصم ${data.cashDiscount.percentage}% للدفع النقدي
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
    }
    
    // تجميع البطاقات بالترتيب الصحيح
    cardsHTML = `
        ${timeOffersHTML ? `<div class="offers-row time-offers-row">${timeOffersHTML}</div>` : ''}
        ${mainOffersHTML ? `<div class="offers-row main-offers-row">${mainOffersHTML}</div>` : ''}
        ${groupOffersHTML ? `<div class="offers-row group-offers-row">${groupOffersHTML}</div>` : ''}
    `;
    
    // إضافة البطاقات للحاوية
    offersContainer.innerHTML = cardsHTML;
    
    // تشغيل العدادات
    setTimeout(startCountdowns, 100);
}

        // إصلاح زر طلب الدعم
handleGrantRequest() {
    Swal.fire({
        title: '🤲 هل تحتاج دعم إضافي؟',
        html: `
            <div style="text-align: right;">
                <p style="margin-bottom: 20px;">نحن هنا لمساعدتك! يمكننا توفير:</p>
                <ul style="text-align: right; margin: 20px 0; line-height: 2;">
                    <li>💰 <strong>منحة جزئية:</strong> خصم 50-75%</li>
                    <li>📅 <strong>تقسيط مريح:</strong> يصل لـ 24 شهر</li>
                    <li>🎁 <strong>منحة كاملة:</strong> 100% مجاناً</li>
                </ul>
                <p style="background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                    <strong>💚 لا نجعل المال عائقاً لرحلة التعلم</strong><br>
                    سنتواصل معك خلال 24 ساعة لمناقشة الخيارات المناسبة
                </p>
            </div>
        `,
        icon: 'heart',
        showCancelButton: true,
        confirmButtonText: '📝 تقدم للحصول على دعم',
        cancelButtonText: 'إلغاء',
        confirmButtonColor: '#22C55E',
        cancelButtonColor: '#6b7280',
        background: '#152238',
        color: '#fff'
    }).then((result) => {
        if (result.isConfirmed) {
            // إعداد بيانات طلب المنحة
            const grantData = {
                type: 'grant',
                courseId: this.courseData?.courseId || 'default',
                courseName: this.courseData?.title || 'الدورة المختارة',
                originalPrice: this.courseData?.price || 0,
                currentCalculation: this.getDisplayedValues(),
                requestSource: 'calculator_page'
            };
            
            // الانتقال لصفحة طلب المنحة
            const params = new URLSearchParams();
            params.append('data', encodeURIComponent(JSON.stringify(grantData)));
            window.location.href = `booking-page.html?${params.toString()}`;
        }
    });
}

// ربط الزر بالدالة الجديدة
document.addEventListener('DOMContentLoaded', function() {
    const grantBtn = document.getElementById('calcGrantBtn');
    if (grantBtn) {
        grantBtn.onclick = handleGrantRequest;
    }
});
        
// دالة مساعدة: تنسيق التاريخ
function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('ar-EG', {
        day: 'numeric',
        month: 'long'
    });
}
        // تشغيل العدادات التنازلية
// تشغيل العدادات التنازلية - نسخة محسنة
function startCountdowns() {
    const timers = document.querySelectorAll('.offer-timer[data-end]');
    if (!timers || timers.length === 0) return;
    
    timers.forEach(timer => {
        // تنظيف العدادات القديمة
        if (timer.intervalId) {
            clearInterval(timer.intervalId);
        }
        
        const endDate = timer.dataset.end;
        if (!endDate) return;
        
        const updateTimer = () => {
            try {
                const now = new Date().getTime();
                const end = new Date(endDate).getTime();
                const distance = end - now;
                
                if (distance < 0) {
                    timer.innerHTML = '<span style="color: #E11D48">انتهى العرض</span>';
                    if (timer.intervalId) {
                        clearInterval(timer.intervalId);
                    }
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                // التحقق من وجود العناصر قبل التحديث
                const daysEl = timer.querySelector('.days');
                const hoursEl = timer.querySelector('.hours');
                const minutesEl = timer.querySelector('.minutes');
                const secondsEl = timer.querySelector('.seconds');
                
                if (daysEl) daysEl.textContent = days;
                if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
                if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
                if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
            } catch (e) {
                console.log('خطأ في تحديث العداد:', e.message);
            }
        };
        
        updateTimer();
        timer.intervalId = setInterval(updateTimer, 1000);
    });
}

// تنظيف العدادات عند إعادة التحميل
function clearAllCountdowns() {
    const timers = document.querySelectorAll('.offer-timer[data-end]');
    timers.forEach(timer => {
        if (timer.intervalId) {
            clearInterval(timer.intervalId);
        }
    });
}
        // دالة مساعدة للتحقق من الأخطاء
function checkAndFixErrors() {
    // إصلاح startCountdowns إذا لم تكن موجودة
    if (typeof startCountdowns === 'undefined') {
        window.startCountdowns = function() {
            const timers = document.querySelectorAll('.offer-timer[data-end]');
            if (!timers || timers.length === 0) return;
            
            timers.forEach(timer => {
                const endDate = timer.dataset.end;
                if (!endDate) return;
                
                const updateTimer = () => {
                    try {
                        const now = new Date().getTime();
                        const end = new Date(endDate).getTime();
                        const distance = end - now;
                        
                        if (distance < 0) {
                            timer.innerHTML = '<span style="color: #E11D48">انتهى العرض</span>';
                            return;
                        }
                        
                        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        
                        const daysEl = timer.querySelector('.days');
                        const hoursEl = timer.querySelector('.hours');
                        const minutesEl = timer.querySelector('.minutes');
                        
                        if (daysEl) daysEl.textContent = days;
                        if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
                        if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
                    } catch (e) {
                        console.log('خطأ في العداد:', e);
                    }
                };
                
                updateTimer();
                setInterval(updateTimer, 1000);
            });
        };
    }
    
    // إصلاح updateCalculatedPrice
    if (typeof updateCalculatedPrice === 'undefined') {
        window.updateCalculatedPrice = function() {
            console.log('تحديث السعر المحسوب');
        };
    }
    
    // إصلاح showFallbackContent
    if (typeof showFallbackContent === 'undefined') {
        window.showFallbackContent = function() {
            console.log('عرض المحتوى الافتراضي');
        };
    }
}

// إصلاح buildDynamicPricingTable
window.buildDynamicPricingTable = function(data, scenario) {
    console.log('بناء الجدول الديناميكي');
    // سيتم إضافة الكود لاحقاً
};

// تشغيل الإصلاحات
checkAndFixErrors();

// بدء التطبيق عند تحميل الصفحة
window.addEventListener('load', function() {
    console.log('=== بدء تحميل الصفحة ===');
    checkAndFixErrors();
    
    // تأخير بسيط للتأكد من كل شيء
    setTimeout(() => {
        loadCourseData();
    }, 1000);
});
    </script>
</body>
</html>
