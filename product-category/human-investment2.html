<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø­Ø³Ø¨ Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ - Ù…Ù†ØµØ© ÙØ¤Ø§Ø¯</title>
    
    <!-- Dependencies -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --gold-primary: #FFD700;
            --gold-light: #FFF3CD;
            --gold-dark: #D4AF37;
            --dark-bg: #0A1628;
            --dark-lighter: #1E3A5F;
            --dark-card: #152238;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: var(--dark-bg);
            color: white;
            padding-top: 60px;
        }
        
        /* Header Ø¨Ø³ÙŠØ· */
        .page-header {
            background: linear-gradient(135deg, var(--dark-card), var(--dark-lighter));
            padding: 40px 0;
            text-align: center;
            margin-bottom: 50px;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            color: var(--gold-primary);
            font-weight: bold;
        }
        
        /* CSS Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ© ÙÙ‚Ø· */
        .smart-calculator-section {
            padding: 80px 0;
            background: var(--dark-lighter);
        }
        
        .calculator-wrapper {
            background: var(--dark-card);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        /* Ø¨Ø§Ù‚ÙŠ CSS Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ÙƒÙ…Ø§ Ù‡Ùˆ */
        /* ... */
        
        /* Footer Ø¨Ø³ÙŠØ· */
        .simple-footer {
            background: var(--dark-card);
            padding: 30px 0;
            text-align: center;
            margin-top: 100px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="page-header">
        <div class="container">
            <h1>Ø§Ø­Ø³Ø¨ Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…</h1>
            <p>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©</p>
        </div>
    </div>

    <!-- Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ© -->
    <section class="smart-calculator-section" id="smartCalculator">
        <!-- Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø¨Ø§Ù„Ø¶Ø¨Ø· -->
    </section>

    <!-- Footer -->
    <footer class="simple-footer">
        <div class="container">
            <p>Â© 2024 Ù…Ù†ØµØ© ÙØ¤Ø§Ø¯ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>
    </footer>

    <script>
        // Firebase config
   const firebaseConfig = {
            apiKey: "AIzaSyDHg0VrivE3C9A7jvzRu7lQgudLvcD_Fxk",
            authDomain: "fouad-perspective.firebaseapp.com",
            projectId: "fouad-perspective",
            storageBucket: "fouad-perspective.appspot.com",
            messagingSenderId: "564654107574",
            appId: "1:564654107574:web:baebb660288b22f16213e6"
        };
        // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…
// Ù…Ø¹Ø§Ù„Ø¬ Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ù…Ù„
window.addEventListener('error', function(event) {
    // ØªØ¬Ø§Ù‡Ù„ Ø£Ø®Ø·Ø§Ø¡ favicon
    if (event.message && event.message.includes('favicon')) {
        event.preventDefault();
        return false;
    }
    console.warn('Ø®Ø·Ø£ ØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡:', event.error);
});
        // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ - Lazy Loading
document.addEventListener('DOMContentLoaded', function() {
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¨Ø´ÙƒÙ„ ØªØ¯Ø±ÙŠØ¬ÙŠ
    const lazyImages = document.querySelectorAll('img[data-src]');
    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                imageObserver.unobserve(img);
            }
        });
    });
    
    lazyImages.forEach(img => imageObserver.observe(img));
    
    // ØªÙ†Ø¸ÙŠÙ Console
    console.clear();
    console.log('%cğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© ÙØ¤Ø§Ø¯!', 
                'color: #FFD700; font-size: 20px; font-weight: bold;');
    console.log('%cğŸ’¡ Ø§Ø³ØªØ«Ù…Ø± ÙÙŠ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„Ù†ÙˆØ±', 
                'color: #22C55E; font-size: 16px;');
});

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
function initializeFirebaseSafely() {
    try {
        // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Firebase
        if (typeof firebase === 'undefined') {
            console.log('Firebase ØºÙŠØ± Ù…Ø­Ù…Ù„ - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
            showFallbackContent();
            return false;
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        window.db = firebase.firestore();
        
        // ØªØ¹ÙŠÙŠÙ† Ù…Ù‡Ù„Ø© Ù„Ù„Ø§ØªØµØ§Ù„
        db.enablePersistence({ synchronizeTabs: true })
            .catch(err => {
                console.log('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
                showFallbackContent();
            });
            
        return true;
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Firebase - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
        showFallbackContent();
        return false;
    }
}
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let courseData = null;
        let courseId = null;
        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
window.courseName = localStorage.getItem('currentCourseName') || 'Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©';

        // Ø¬Ù„Ø¨ Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        function getCourseId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('course') || 'default-course';
        }
        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
document.addEventListener('DOMContentLoaded', function() {
    console.log('Ø§Ù„ØµÙØ­Ø© Ø¬Ø§Ù‡Ø²Ø©');
        cleanConsole();

    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Firebase
    setTimeout(() => {
        if (typeof db !== 'undefined') {
            loadCourseData();
        } else {
            console.error('Firebase Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡');
            showFallbackContent();
        }
    }, 1000);
});
        function cleanConsole() {
    // Ø¥Ø²Ø§Ù„Ø© console.log ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
    const originalLog = console.log;
    console.log = function(...args) {
        // ØªØµÙÙŠØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‡Ù…Ø©
        const message = args.join(' ');
        if (!message.includes('undefined') && 
            !message.includes('null') &&
            !message.includes('V3')) {
            originalLog.apply(console, args);
        }
    };
}
        
        // Course data loading
async function loadCourseData() {
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('course');
    
    if (!courseId) {
        console.log('Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙˆØ±Ø© Ù…ÙÙ‚ÙˆØ¯ - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
        showFallbackContent();
        return;
    }
    
    try {
        // Ø§Ù†ØªØ¸Ø§Ø± Firebase
        if (typeof db === 'undefined') {
            console.log('Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Firebase...');
            setTimeout(() => loadCourseData(), 500);
            return;
        }
        
        console.log('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø©:', courseId);
        const courseRef = db.collection('courses').doc(courseId);
        const doc = await courseRef.get();
        
        if (!doc.exists) {
            console.log('Ø§Ù„Ø¯ÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
            showFallbackContent();
            return;
        }
        
        const courseData = doc.data();
        console.log('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:', courseData);
        
        // ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø®Ø§Ø·Ø¦Ø©
        if (courseData.price < 100) {
            courseData.price = courseData.price * 1000;
        }
        if (courseData.salePrice && courseData.salePrice < 100) {
            courseData.salePrice = courseData.salePrice * 1000;
        }
        
        window.currentCourseData = courseData;
        // Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø© Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
window.courseName = courseData.title || 'Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©';
localStorage.setItem('currentCourseName', window.courseName);
console.log('ğŸ“š ØªÙ… Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©:', window.courseName);

        console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙˆØ±Ø³ Ù…Ù† Firebase:', courseData);
console.log('Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª ÙÙŠ Firebase:', courseData.coupons);

        // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø´ÙŠØ¡
        updatePageWithData(courseData);
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        showFallbackContent();
    }
   
}            // Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯
        }
        
        // Smart Calculator object
        const smartCalculator = {
    restoreFromStorage() {
    const saved = localStorage.getItem('calculatorState');
    if (saved) {
        try {
            const state = JSON.parse(saved);
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø©
            this.selectedJourney = state.journey || 'individual';
            this.selectedGroup = state.group || null;
            this.selectedGift = state.gift || 'specific';
            this.appliedCoupon = state.coupon || null;
            
            console.log('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©');
            return true;
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
    }
    return false;
},

    // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
restoreCouponUI() {
    if (this.appliedCoupon) {
        console.log('Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…:', this.appliedCoupon.code);
        
        const couponInput = document.getElementById('calcCoupon');
        const applyBtn = document.getElementById('applyCouponCalc');
        const couponSection = document.querySelector('.coupon-section');
        
        if (couponInput && applyBtn && couponSection) {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
            couponInput.value = this.appliedCoupon.code;
            couponInput.disabled = true;
            couponInput.style.background = '#22C55E20';
            couponInput.style.borderColor = '#22C55E';
            
            // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            applyBtn.style.display = 'none';
            
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
            if (!document.querySelector('.coupon-remove-btn')) {
                const removeBtn = document.createElement('button');
                removeBtn.className = 'coupon-remove-btn';
                removeBtn.innerHTML = '<i class="fas fa-times"></i> Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯';
                removeBtn.style.cssText = `
                    background: #E11D48;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 10px;
                    cursor: pointer;
                    margin-right: 10px;
                    transition: all 0.3s;
                `;
                removeBtn.onclick = () => this.removeCoupon();
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø­Ù‚Ù„ Ø§Ù„ÙƒÙˆØ¯
                couponInput.parentElement.appendChild(removeBtn);
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            const messageDiv = document.getElementById('calcCouponMessage');
            if (messageDiv) {
                messageDiv.innerHTML = `
                    <div style="background: rgba(34,197,94,0.1); 
                                border: 1px solid #22C55E; 
                                padding: 10px; 
                                border-radius: 8px; 
                                color: #22C55E;
                                margin-top: 10px;">
                        <i class="fas fa-check-circle"></i>
                        ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… <strong>${this.appliedCoupon.code}</strong> Ù…ÙÙØ¹Ù‘Ù„
                        ${this.appliedCoupon.type === 'percentage' ? 
                          `(Ø®ØµÙ… ${this.appliedCoupon.value}%)` : 
                          `(Ø®ØµÙ… ${this.appliedCoupon.value} Ø¬.Ù…)`}
                    </div>
                `;
            }
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
        this.calculate();
    }
},

saveToStorage() {
    const state = {
        journey: this.selectedJourney,
        group: this.selectedGroup,
        gift: this.selectedGift,
        coupon: this.appliedCoupon,
        lastCalculation: this.lastCalculationState
    };
    localStorage.setItem('calculatorState', JSON.stringify(state));
},
    courseData: null,
    selectedJourney: 'individual',
    selectedGroup: null,
    selectedGift: 'specific',
    appliedCoupon: null,
    
  init() {
    console.log('ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ© V3');
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    this.restoreFromStorage();
    
    this.bindEvents();
    this.updateFromFirebase();
    
    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… Ø¥Ù† ÙˆØ¬Ø¯
    setTimeout(() => {
        this.restoreCouponUI();
    }, 1000);
    
    // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ ÙƒÙ„ ØªØºÙŠÙŠØ±
    setInterval(() => {
        this.saveToStorage();
    }, 1000);
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø²Ø± Ø§Ù„Ø¯Ø¹Ù… Ù„Ù„Ø±Ø­Ù„Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ©
    setTimeout(() => {
        if (this.selectedJourney === 'individual') {
            document.getElementById('calcGrantBtn').style.display = 'block';
            document.getElementById('calcSupportMessage').style.display = 'block';
        }
    }, 500);
},
    
    bindEvents() {
        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©
        document.querySelectorAll('.journey-option').forEach(option => {
            option.addEventListener('click', (e) => {
                document.querySelectorAll('.journey-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                this.handleJourneyChange(option.dataset.journey);
            });
        });
        
        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡
        document.querySelectorAll('.gift-option-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.gift-option-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                this.handleGiftTypeChange(card.dataset.gift);
            });
        });
        
        // ØªØºÙŠÙŠØ± Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³ÙŠÙ…Ø©
        const voucherInput = document.getElementById('voucherAmount');
        if (voucherInput) {
            voucherInput.addEventListener('input', () => this.calculate());
        }
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
        const applyCouponBtn = document.getElementById('applyCouponCalc');
        if (applyCouponBtn) {
            applyCouponBtn.addEventListener('click', () => this.applyCoupon());
        }
        
        // Ø²Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        const bookBtn = document.getElementById('calcBookBtn');
        if (bookBtn) {
            bookBtn.addEventListener('click', () => this.handleMainAction());
        }
        
        // Ø²Ø± Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù…
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø²Ø± Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù…
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø²Ø± Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù… - Ù†Ø³Ø®Ø© Firebase
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø²Ø± Ø·Ù„Ø¨ Ø§Ù„Ø¯Ø¹Ù…
const grantBtn = document.getElementById('calcGrantBtn');
if (grantBtn) {
    grantBtn.onclick = async function() {
        // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
        const currentData = collectCompleteData();
        const courseName = currentData.courseName || getCurrentCourseName();
        const basePrice = currentData.pricing?.basePriceNumber || 10000;
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙˆÙ„ Ø¥Ù† ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯
        const dataDisplayBox = document.getElementById('dataDisplayBox');
        if (dataDisplayBox) {
            dataDisplayBox.style.display = 'none';
        }
        
        // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
        let selectedPercentage = 0;
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ù†Ø³Ø¨Ø©
        window.updatePercentageDisplay = function(value) {
            selectedPercentage = value;
            const display = document.getElementById('percentageDisplay');
            const slider = document.getElementById('percentageSlider');
            const affordableAmount = Math.round(basePrice * (value / 100));
            
            if (display) {
                display.innerHTML = `
                    <span style="font-size: 1.5rem; color: #22C55E; font-weight: bold;">${value}%</span>
                    <span style="color: #6B7280;"> = ${affordableAmount.toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡</span>
                `;
            }
            
            // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø´Ø±ÙŠØ· Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø©
            if (slider) {
                if (value === 0) {
                    slider.style.background = `linear-gradient(to right, #EF4444 0%, #EF4444 ${value}%, #E5E7EB ${value}%, #E5E7EB 100%)`;
                } else if (value <= 25) {
                    slider.style.background = `linear-gradient(to right, #F59E0B 0%, #F59E0B ${value}%, #E5E7EB ${value}%, #E5E7EB 100%)`;
                } else if (value <= 50) {
                    slider.style.background = `linear-gradient(to right, #3B82F6 0%, #3B82F6 ${value}%, #E5E7EB ${value}%, #E5E7EB 100%)`;
                } else {
                    slider.style.background = `linear-gradient(to right, #22C55E 0%, #22C55E ${value}%, #E5E7EB ${value}%, #E5E7EB 100%)`;
                }
            }
        };
        
        // Ø¹Ø±Ø¶ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†Ø­Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
        Swal.fire({
            title: 'ğŸ¤² Ø·Ù„Ø¨ Ù…Ù†Ø­Ø© Ø¯Ø±Ø§Ø³ÙŠØ©',
            html: `
                <div style="text-align: right; direction: rtl; max-height: 500px; overflow-y: auto;">
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© -->
                    <div style="background: linear-gradient(135deg, #10B981, #14B8A6); 
                                padding: 15px; border-radius: 10px; margin-bottom: 20px; color: white;">
                        <h4 style="margin: 0;">
                            <i class="fas fa-graduation-cap"></i> ${courseName}
                        </h4>
                        <p style="margin: 10px 0 5px 0;">
                            Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: <strong style="font-size: 1.3rem;">${basePrice.toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡</strong>
                        </p>
                    </div>
                    
                    <!-- Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
                    <div style="background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(20,184,166,0.1)); 
                                padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-heart" style="font-size: 2.5rem; color: #10B981; margin-bottom: 10px;"></i>
                        <h3 style="color: #065F46; margin-bottom: 10px;">Ù†Ø¤Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø§Ù„ Ù„Ø§ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ø§Ø¦Ù‚Ø§Ù‹</h3>
                        <p style="color: #047857; margin: 0;">
                            Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù… - Ø§Ø´Ø±Ø­ Ù„Ù†Ø§ Ø¸Ø±ÙˆÙÙƒ Ø¨ØµØ¯Ù‚ ÙˆØ³Ù†Ø¬Ø¯ Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                        </p>
                    </div>
                    
                    <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© -->
                    <div style="background: #F9FAFB; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <h4 style="color: #1F2937; margin-bottom: 15px;">
                            <i class="fas fa-user"></i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                        </h4>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                                Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: red;">*</span>
                            </label>
                            <input type="text" id="applicantName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø£Ùˆ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ"
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                          border-radius: 8px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                                Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ <span style="color: red;">*</span>
                            </label>
                            <input type="text" id="applicantWhatsapp" placeholder="Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ"
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                          border-radius: 8px; font-size: 1rem; direction: ltr;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #374151;">
                                Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <input type="email" id="applicantEmail" placeholder="example@email.com"
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                          border-radius: 8px; font-size: 1rem; direction: ltr;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #374151;">
                                Ø§Ù„Ø¹Ù…Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <input type="number" id="applicantAge" placeholder="Ø¹Ù…Ø±Ùƒ Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª" min="10" max="100"
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                          border-radius: 8px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #374151;">
                                Ø§Ù„Ø¨Ù„Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <input type="text" id="applicantCountry" placeholder="Ø¨Ù„Ø¯Ùƒ"
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                          border-radius: 8px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #374151;">
                                Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <input type="text" id="applicantCity" placeholder="Ù…Ø¯ÙŠÙ†ØªÙƒ"
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                          border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„Ù‚ØµØ© ÙˆØ§Ù„Ø¯Ø§ÙØ¹ -->
                    <div style="background: #F0FDF4; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <h4 style="color: #065F46; margin-bottom: 15px;">
                            <i class="fas fa-book-open"></i> Ù‚ØµØªÙƒ ÙˆØ§Ù„Ø¯Ø§ÙØ¹
                        </h4>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #047857; font-weight: bold;">
                                Ù„Ù…Ø§Ø°Ø§ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø­Ù„Ø©ØŸ <span style="color: red;">*</span>
                            </label>
                            <textarea id="whyJoin" rows="4" 
                                      placeholder="Ø§Ø´Ø±Ø­ Ù„Ù†Ø§ Ø¯ÙˆØ§ÙØ¹Ùƒ ÙˆØ£Ù‡Ø¯Ø§ÙÙƒ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©..."
                                      style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                             border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #047857; font-weight: bold;">
                                Ù…Ø§ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªÙˆØ§Ø¬Ù‡Ù‡Ø§ØŸ <span style="color: red;">*</span>
                            </label>
                            <textarea id="challenges" rows="4" 
                                      placeholder="ØµÙ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø£Ùˆ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£Ùˆ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙŠ ØªÙˆØ§Ø¬Ù‡Ù‡Ø§..."
                                      style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                             border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #047857;">
                                ÙƒÙŠÙ Ø³ØªØ³ØªÙÙŠØ¯ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ÙØ±ØµØ©ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <textarea id="howBenefit" rows="3" 
                                      placeholder="ÙƒÙŠÙ Ø³ØªØºÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ±Ø© Ø­ÙŠØ§ØªÙƒ Ø£Ùˆ Ù…Ø³Ø§Ø±Ùƒ Ø§Ù„Ù…Ù‡Ù†ÙŠØŸ"
                                      style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                             border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ -->
                    <div style="background: #FFF7ED; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <h4 style="color: #7C2D12; margin-bottom: 15px;">
                            <i class="fas fa-coins"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ
                        </h4>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #9A3412; font-weight: bold;">
                                Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ <span style="color: red;">*</span>
                            </label>
                            <select id="employmentStatus" 
                                    style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                           border-radius: 8px; font-size: 1rem;">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ --</option>
                                <option value="student">Ø·Ø§Ù„Ø¨</option>
                                <option value="employed">Ù…ÙˆØ¸Ù</option>
                                <option value="freelance">Ø¹Ù…Ù„ Ø­Ø±</option>
                                <option value="unemployed">Ø¨Ø¯ÙˆÙ† Ø¹Ù…Ù„</option>
                                <option value="retired">Ù…ØªÙ‚Ø§Ø¹Ø¯</option>
                                <option value="other">Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; color: #9A3412; font-weight: bold;">
                                Ù†Ø³Ø¨Ø© Ù…Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø¯ÙØ¹Ù‡ Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ <span style="color: red;">*</span>
                            </label>
                            <input type="range" id="percentageSlider" min="0" max="100" value="0" 
                                   oninput="updatePercentageDisplay(this.value)"
                                   style="width: 100%; height: 8px; border-radius: 5px; 
                                          background: #E5E7EB; outline: none; cursor: pointer;">
                            <div id="percentageDisplay" style="text-align: center; margin-top: 15px; 
                                                               padding: 15px; background: white; 
                                                               border-radius: 8px;">
                                <span style="font-size: 1.5rem; color: #EF4444; font-weight: bold;">0%</span>
                                <span style="color: #6B7280;"> = 0 Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px; 
                                        color: #6B7280; font-size: 0.85rem;">
                                <span>Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ø¯ÙØ¹</span>
                                <span>25%</span>
                                <span>50%</span>
                                <span>75%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #9A3412;">
                                Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø¯Ø®Ù„ Ø«Ø§Ø¨ØªØŸ
                            </label>
                            <select id="hasIncome" 
                                    style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                           border-radius: 8px; font-size: 1rem;">
                                <option value="">-- Ø§Ø®ØªÙŠØ§Ø±ÙŠ --</option>
                                <option value="yes">Ù†Ø¹Ù…</option>
                                <option value="no">Ù„Ø§</option>
                                <option value="irregular">Ø¯Ø®Ù„ ØºÙŠØ± Ù…Ù†ØªØ¸Ù…</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #9A3412;">
                                Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„ÙŠÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <input type="number" id="dependents" min="0" placeholder="Ø¹Ø¯Ø¯ Ù…Ù† ØªØ¹ÙˆÙ„Ù‡Ù…"
                                   style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                          border-radius: 8px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #9A3412;">
                                Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† ÙˆØ¶Ø¹Ùƒ Ø§Ù„Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <textarea id="financialNotes" rows="3" 
                                      placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© ØªÙˆØ¯ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§..."
                                      style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                             border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© -->
                    <div style="background: #F3E8FF; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <h4 style="color: #581C87; margin-bottom: 15px;">
                            <i class="fas fa-lightbulb"></i> Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©
                        </h4>
                        
                        <p style="color: #6B21A8; margin-bottom: 15px;">
                            Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬Ù‡ (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø®ÙŠØ§Ø±):
                        </p>
                        
                        <div style="display: grid; gap: 12px;">
                            <label style="display: flex; align-items: start; padding: 15px; 
                                          background: white; border: 2px solid #E9D5FF; 
                                          border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" name="supportType" value="partial" 
                                       style="margin-left: 10px; margin-top: 3px; width: 18px; height: 18px;">
                                <div>
                                    <strong style="color: #581C87;">Ù…Ù†Ø­Ø© Ø¬Ø²Ø¦ÙŠØ©</strong>
                                    <p style="margin: 5px 0 0 0; color: #6B7280; font-size: 0.9rem;">
                                        Ø®ØµÙ… ÙŠØµÙ„ Ø¥Ù„Ù‰ 75% Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
                                    </p>
                                </div>
                            </label>
                            
                            <label style="display: flex; align-items: start; padding: 15px; 
                                          background: white; border: 2px solid #E9D5FF; 
                                          border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" name="supportType" value="installment" 
                                       style="margin-left: 10px; margin-top: 3px; width: 18px; height: 18px;">
                                <div>
                                    <strong style="color: #581C87;">ØªÙ‚Ø³ÙŠØ· Ù…ÙŠØ³Ø±</strong>
                                    <p style="margin: 5px 0 0 0; color: #6B7280; font-size: 0.9rem;">
                                        Ø­ØªÙ‰ 24 Ø´Ù‡Ø± Ø¨Ø¯ÙˆÙ† ÙÙˆØ§Ø¦Ø¯
                                    </p>
                                </div>
                            </label>
                            
                            <label style="display: flex; align-items: start; padding: 15px; 
                                          background: white; border: 2px solid #E9D5FF; 
                                          border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" name="supportType" value="full" 
                                       style="margin-left: 10px; margin-top: 3px; width: 18px; height: 18px;">
                                <div>
                                    <strong style="color: #581C87;">Ù…Ù†Ø­Ø© ÙƒØ§Ù…Ù„Ø©</strong>
                                    <p style="margin: 5px 0 0 0; color: #6B7280; font-size: 0.9rem;">
                                        100% Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø­ØªÙŠØ§Ø¬Ø§Ù‹
                                    </p>
                                </div>
                            </label>
                            
                            <label style="display: flex; align-items: start; padding: 15px; 
                                          background: white; border: 2px solid #E9D5FF; 
                                          border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" name="supportType" value="volunteer" 
                                       style="margin-left: 10px; margin-top: 3px; width: 18px; height: 18px;">
                                <div>
                                    <strong style="color: #581C87;">Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªØ·ÙˆØ¹ÙŠ</strong>
                                    <p style="margin: 5px 0 0 0; color: #6B7280; font-size: 0.9rem;">
                                        Ø³Ø§Ø¹Ø§Øª ØªØ·ÙˆØ¹ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¯ÙˆØ±Ø©
                                    </p>
                                </div>
                            </label>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #6B21A8;">
                                Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø­ÙˆÙ„ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <textarea id="supportNotes" rows="2" 
                                      placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø£Ø®Ø±Ù‰..."
                                      style="width: 100%; padding: 12px; border: 2px solid #E9D5FF; 
                                             border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øª ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª -->
                    <div style="background: #FEF2F2; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <h4 style="color: #991B1B; margin-bottom: 15px;">
                            <i class="fas fa-handshake"></i> Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øª ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
                        </h4>
                        
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: start; cursor: pointer;">
                                <input type="checkbox" id="commitment1" 
                                       style="margin-left: 10px; margin-top: 5px; width: 18px; height: 18px;">
                                <span>Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©</span>
                            </label>
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: start; cursor: pointer;">
                                <input type="checkbox" id="commitment2" 
                                       style="margin-left: 10px; margin-top: 5px; width: 18px; height: 18px;">
                                <span>Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙØ¹Ø§Ù„Ø© ÙˆØ§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©</span>
                            </label>
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: start; cursor: pointer;">
                                <input type="checkbox" id="commitment3" 
                                       style="margin-left: 10px; margin-top: 5px; width: 18px; height: 18px;">
                                <span>Ø£Ù‚Ø± Ø¨Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ØµØ­ÙŠØ­Ø©</span>
                            </label>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: start; cursor: pointer;">
                                <input type="checkbox" id="commitment4" 
                                       style="margin-left: 10px; margin-top: 5px; width: 18px; height: 18px;">
                                <span>Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ù‚ØµØªÙŠ (Ø¨Ø¯ÙˆÙ† Ø°ÙƒØ± Ø§Ù„Ø§Ø³Ù…) Ù„Ø¥Ù„Ù‡Ø§Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</span>
                            </label>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: #991B1B;">
                                ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <textarea id="contribution" rows="3" 
                                      placeholder="ÙƒÙŠÙ Ø³ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¨Ù…Ø§ Ø³ØªØªØ¹Ù„Ù…Ù‡ØŸ"
                                      style="width: 100%; padding: 12px; border: 2px solid #FECACA; 
                                             border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                        </div>
                    </div>
                    
                    <!-- Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ -->
                    <div style="background: #DCFCE7; padding: 15px; border-radius: 10px; 
                                border-right: 3px solid #22C55E;">
                        <p style="color: #14532D; margin: 0; text-align: center;">
                            <i class="fas fa-clock"></i>
                            Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ Ø®Ù„Ø§Ù„ 24-48 Ø³Ø§Ø¹Ø© ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ø¨Ø§Ù„Ù‚Ø±Ø§Ø±
                        </p>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'âœ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†Ø­Ø©',
            cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
            confirmButtonColor: '#10B981',
            cancelButtonColor: '#6B7280',
            width: '900px',
            allowOutsideClick: false,
            allowEscapeKey: false,
            didOpen: () => {
                document.getElementById('applicantName')?.focus();
                // ØªÙ‡ÙŠØ¦Ø© Ø´Ø±ÙŠØ· Ø§Ù„Ù†Ø³Ø¨Ø©
                updatePercentageDisplay(0);
            },
            preConfirm: () => {
                const name = document.getElementById('applicantName').value.trim();
                const whatsapp = document.getElementById('applicantWhatsapp').value.trim();
                const whyJoin = document.getElementById('whyJoin').value.trim();
                const challenges = document.getElementById('challenges').value.trim();
                const employmentStatus = document.getElementById('employmentStatus').value;
                const selectedSupport = document.querySelectorAll('input[name="supportType"]:checked');
                const commitment1 = document.getElementById('commitment1').checked;
                const commitment2 = document.getElementById('commitment2').checked;
                const commitment3 = document.getElementById('commitment3').checked;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                if (!name) {
                    Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');
                    return false;
                }
                
                if (!whatsapp) {
                    Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨Ùƒ');
                    return false;
                }
                
                if (!whyJoin) {
                    Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø´Ø±Ø­ Ù„Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…');
                    return false;
                }
                
                if (!challenges) {
                    Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø´Ø±Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªÙˆØ§Ø¬Ù‡Ù‡Ø§');
                    return false;
                }
                
                if (!employmentStatus) {
                    Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø­Ø¯Ø¯ ÙˆØ¶Ø¹Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ');
                    return false;
                }
                
                if (selectedSupport.length === 0) {
                    Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨');
                    return false;
                }
                
                if (!commitment1 || !commitment2 || !commitment3) {
                    Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                    return false;
                }
                
                return true;
            }
        }).then(async (result) => {
            if (result.isConfirmed) {
                // Ø¬Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                const supportTypes = [];
                document.querySelectorAll('input[name="supportType"]:checked').forEach(checkbox => {
                    supportTypes.push(checkbox.value);
                });
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ·ÙŠØ¹ Ø¯ÙØ¹Ù‡
                const affordableAmount = Math.round(basePrice * (selectedPercentage / 100));
                
                // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const grantData = {
                    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                    applicant: {
                        name: document.getElementById('applicantName').value.trim(),
                        whatsapp: document.getElementById('applicantWhatsapp').value.trim(),
                        email: document.getElementById('applicantEmail').value.trim() || '',
                        age: document.getElementById('applicantAge').value || '',
                        country: document.getElementById('applicantCountry').value.trim() || '',
                        city: document.getElementById('applicantCity').value.trim() || ''
                    },
                    
                    // Ø§Ù„Ù‚ØµØ© ÙˆØ§Ù„Ø¯Ø§ÙØ¹
                    motivation: {
                        whyJoin: document.getElementById('whyJoin').value.trim(),
                        challenges: document.getElementById('challenges').value.trim(),
                        howBenefit: document.getElementById('howBenefit').value.trim() || ''
                    },
                    
                    // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ
                    financial: {
                        employmentStatus: document.getElementById('employmentStatus').value,
                        affordablePercentage: selectedPercentage,
                        affordableAmount: affordableAmount,
                        hasIncome: document.getElementById('hasIncome').value || '',
                        dependents: document.getElementById('dependents').value || '',
                        notes: document.getElementById('financialNotes').value.trim() || ''
                    },
                    
                    // Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                    requestedSupport: {
                        types: supportTypes,
                        notes: document.getElementById('supportNotes').value.trim() || ''
                    },
                    
                    // Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øª
                    commitments: {
                        fullAttendance: document.getElementById('commitment1').checked,
                        activeParticipation: document.getElementById('commitment2').checked,
                        truthfulInfo: document.getElementById('commitment3').checked,
                        shareStory: document.getElementById('commitment4').checked,
                        contribution: document.getElementById('contribution').value.trim() || ''
                    },
                    
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                    courseName: courseName,
                    coursePrice: basePrice,
                    status: 'pending_review',
                    bookingType: 'grant_request',
                    bookingDate: new Date().toISOString(),
                    pricing: currentData.pricing || {}
                };
                
                // Ø­ÙØ¸ ÙÙŠ Firebase
                await saveToFirebaseDirectly(grantData, null);
            }
        });
    };
}
},
    
    updateFromFirebase() {
    this.courseData = window.currentCourseData || {
        price: 10000,
        salePrice: 8000,
        currency: 'EGP',
        cashDiscount: { enabled: true, percentage: 15 },
        paymentPlans: [
            { name: '3 Ø´Ù‡ÙˆØ±', installments: 3, firstPaymentPercent: 40 },
            { name: '6 Ø´Ù‡ÙˆØ±', installments: 6, firstPaymentPercent: 30 }
        ],
        groupDiscounts: [
            { name: 'Ø§Ù„ØµØ­Ø§Ø¨', minSize: 3, percentage: 30 }
        ],
        discounts: [],
        coupons: []
    };
    
    this.coupons = this.courseData.coupons || [];
    console.log('Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ù…Ù† Firebase:', this.coupons);
    
    this.updateGroupOptions();
    this.updatePaymentOptions();
    this.updateActiveOffer();
    this.calculate();
},
    
    handleJourneyChange(journey) {
    this.selectedJourney = journey;
        // ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ø®Ø§Ø±Ø¬ÙŠÙ† Ù…Ù†Ù‡Ø§
    if (this.selectedJourney !== 'gift' || this.selectedGift !== 'voucher') {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ÙÙŠØ©
        document.getElementById('calcBase').parentElement.style.display = 'flex';
        const paymentSection = document.querySelector('.payment-selection');
        if (paymentSection) paymentSection.style.display = 'block';
        const couponSection = document.querySelector('.coupon-section');
        if (couponSection) couponSection.style.display = 'block';
        
        // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø´ÙƒØ± Ø¥Ù† ÙˆØ¬Ø¯Øª
        const thankYouMessage = document.getElementById('voucherThankYou');
        if (thankYouMessage) thankYouMessage.remove();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        document.getElementById('calcTotalLabel').textContent = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:';
    }
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù…
    document.getElementById('currentStep').textContent = '2';
    document.getElementById('step1').style.background = '#22C55E';
    document.getElementById('step2').style.background = '#FFD700';
    
    
    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹
    document.getElementById('calcGroupArea').style.display = 'none';
    document.getElementById('calcGiftArea').style.display = 'none';
    document.getElementById('calcGrantBtn').style.display = 'none';
    document.getElementById('calcSupportMessage').style.display = 'none';
    
    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    const bookBtn = document.getElementById('calcBookBtn');
    bookBtn.className = 'btn-primary-action';
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø±
    if (journey === 'group') {
        document.getElementById('calcGroupArea').style.display = 'block';
        bookBtn.innerHTML = '<i class="fas fa-users"></i> Ø§Ø­Ø¬Ø² Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©';
    } else if (journey === 'gift') {
        document.getElementById('calcGiftArea').style.display = 'block';
        bookBtn.className = 'btn-primary-action btn-gift-action';
        bookBtn.innerHTML = '<i class="fas fa-gift"></i> Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡';
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        this.handleGiftTypeChange('specific');
    } else if (journey === 'individual') {
        // Ø±Ø­Ù„Ø© ÙØ±Ø¯ÙŠØ© - Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„Ø¯Ø¹Ù… Ù…Ø¨Ø§Ø´Ø±Ø©
        setTimeout(() => {
            document.getElementById('calcGrantBtn').style.display = 'block';
            document.getElementById('calcSupportMessage').style.display = 'block';
        }, 100);
        bookBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> Ø§Ø­Ø¬Ø² Ù…Ù‚Ø¹Ø¯Ùƒ';
    }
    
    this.calculate();
},
    
    handleGiftTypeChange(giftType) {
    this.selectedGift = giftType;
    
    // ØªÙ†Ø¸ÙŠÙ Ø¹Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹
    this.cleanupVoucherElements();
    
    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    document.getElementById('giftSpecificDetails').style.display = 'none';
    document.getElementById('giftAnonymousDetails').style.display = 'none';
    document.getElementById('giftVoucherDetails').style.display = 'none';
    
    const bookBtn = document.getElementById('calcBookBtn');
    const activeOfferSection = document.getElementById('calcActiveOffer');
    const paymentSection = document.querySelector('.payment-selection');
    const couponSection = document.querySelector('.coupon-section');
    const scenarioButtons = document.querySelector('.action-buttons').previousElementSibling;
    
    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    if (giftType === 'specific') {
        // Ù‡Ø¯ÙŠØ© Ù„Ø´Ø®Øµ Ù…Ø­Ø¯Ø¯
        document.getElementById('giftSpecificDetails').style.display = 'block';
        
        // Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        if (paymentSection) paymentSection.style.display = 'block';
        if (couponSection) couponSection.style.display = 'block';
        if (scenarioButtons) scenarioButtons.style.display = 'flex';
        if (activeOfferSection && this.getActiveTimeOffer()) {
            activeOfferSection.style.display = 'block';
        }
        
        bookBtn.innerHTML = '<i class="fas fa-gift"></i> Ø£ÙƒÙ…Ù„ Ø¥Ù‡Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©';
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        this.calculate();
        
    } else if (giftType === 'anonymous') {
        // Ù‡Ø¯ÙŠØ© Ù…Ø¬Ù‡ÙˆÙ„Ø©
        document.getElementById('giftAnonymousDetails').style.display = 'block';
        
        // Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        if (paymentSection) paymentSection.style.display = 'block';
        if (couponSection) couponSection.style.display = 'block';
        if (scenarioButtons) scenarioButtons.style.display = 'flex';
        if (activeOfferSection && this.getActiveTimeOffer()) {
            activeOfferSection.style.display = 'block';
        }
        
        bookBtn.innerHTML = '<i class="fas fa-heart"></i> Ø³Ø§Ù‡Ù… Ø¨Ù‡Ø¯ÙŠØ© Ù…Ø¬Ù‡ÙˆÙ„Ø©';
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        this.calculate();
        
    } else if (giftType === 'voucher') {
        // Ù‚Ø³ÙŠÙ…Ø© Ø¯Ø¹Ù… - Ø­Ø§Ù„Ø© Ø®Ø§ØµØ©
        document.getElementById('giftVoucherDetails').style.display = 'block';
        
        // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
        if (activeOfferSection) activeOfferSection.style.display = 'none';
        if (paymentSection) paymentSection.style.display = 'none';
        if (couponSection) couponSection.style.display = 'none';
        if (scenarioButtons) scenarioButtons.style.display = 'none';
        
        bookBtn.className = 'btn-primary-action btn-voucher-action';
        bookBtn.innerHTML = '<i class="fas fa-hand-holding-heart"></i> Ø§Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¬ØªÙ…Ø¹';
        
        // Ø­Ø³Ø§Ø¨ Ø®Ø§Øµ Ù„Ù„Ù‚Ø³ÙŠÙ…Ø©
        this.calculate();
    }
},

// Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªÙ†Ø¸ÙŠÙ
cleanupVoucherElements() {
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ÙÙŠØ©
    const calcBase = document.getElementById('calcBase');
    if (calcBase && calcBase.parentElement) {
        calcBase.parentElement.style.display = 'flex';
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± ØµÙÙˆÙ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
    document.getElementById('calcTimeDiscountRow').style.display = '';
    document.getElementById('calcGroupDiscountRow').style.display = '';
    document.getElementById('calcCashDiscountRow').style.display = '';
    document.getElementById('calcCouponDiscountRow').style.display = '';
    document.getElementById('calcInstallmentDetails').style.display = '';
    document.getElementById('calcSavings').style.display = '';
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„
    const hrElement = document.querySelector('.price-breakdown hr');
    if (hrElement) hrElement.style.display = '';
    
    // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø´ÙƒØ± Ø¥Ù† ÙˆØ¬Ø¯Øª
    const thankYouMessage = document.getElementById('voucherThankYou');
    if (thankYouMessage) thankYouMessage.remove();
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    const totalLabel = document.getElementById('calcTotalLabel');
    if (totalLabel) {
        totalLabel.innerHTML = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:';
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
    const totalElement = document.getElementById('calcTotal');
    if (totalElement) {
        totalElement.style.fontSize = '';
        totalElement.style.color = '';
    }
},
    
    updateGroupOptions() {
        const container = document.querySelector('.group-cards');
        if (!container || !this.courseData.groupDiscounts) return;
        
        let html = '';
        this.courseData.groupDiscounts.forEach((group, index) => {
            html += `
                <div class="group-card" data-group="${index}">
                    <i class="fas fa-users"></i>
                    <h5>${group.name}</h5>
                    <div class="discount">${group.percentage}%</div>
                    <div class="size">${group.minSize}+ Ø£Ø´Ø®Ø§Øµ</div>
                </div>
            `;
        });
        
        container.innerHTML = html;
        
        container.querySelectorAll('.group-card').forEach(card => {
            card.addEventListener('click', () => {
                container.querySelectorAll('.group-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                this.selectedGroup = parseInt(card.dataset.group);
                this.calculate();
            });
        });
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
        if (container.querySelector('.group-card')) {
            container.querySelector('.group-card').click();
        }
    },
    
    updatePaymentOptions() {
        const container = document.getElementById('calcPaymentCards');
        if (!container) return;
        
        let html = '';
        
        // Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
        if (this.courseData.cashDiscount?.enabled) {
            html += `
                <div class="payment-card active" data-payment="cash">
                    <i class="fas fa-money-bill-wave"></i>
                    <h6>Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</h6>
                    <small>Ø®ØµÙ… ${this.courseData.cashDiscount.percentage}%</small>
                </div>
            `;
        } else {
            html += `
                <div class="payment-card active" data-payment="full">
                    <i class="fas fa-credit-card"></i>
                    <h6>Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</h6>
                </div>
            `;
        }
        
        // Ø®Ø·Ø· Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        if (this.courseData.paymentPlans?.length > 0) {
            this.courseData.paymentPlans.forEach((plan, index) => {
                html += `
                    <div class="payment-card" data-payment="plan_${index}">
                        <i class="fas fa-calendar-alt"></i>
                        <h6>${plan.name}</h6>
                        <small>Ø¨Ø¯ÙˆÙ† ÙÙˆØ§Ø¦Ø¯</small>
                    </div>
                `;
            });
        }
        
        container.innerHTML = html;
        
        container.querySelectorAll('.payment-card').forEach(card => {
            card.addEventListener('click', () => {
                container.querySelectorAll('.payment-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                this.calculate();
            });
        });
    },
    
    updateActiveOffer() {
        const section = document.getElementById('calcActiveOffer');
        const activeOffer = this.getActiveTimeOffer();
        
        if (activeOffer) {
            section.style.display = 'block';
            document.getElementById('activeOfferName').textContent = activeOffer.name;
            document.getElementById('activeOfferDiscount').textContent = `Ø®ØµÙ… ${activeOffer.percentage}%`;
        } else {
            section.style.display = 'none';
        }
    },
    
    getActiveTimeOffer() {
        if (!this.courseData.discounts) return null;
        
        const now = new Date();
        return this.courseData.discounts.find(d => {
            if (!d.startDate || !d.endDate) return false;
            const start = new Date(d.startDate);
            const end = new Date(d.endDate);
            return now >= start && now <= end && d.percentage > 0;
        });
    },
    
   calculate() {
    if (!this.courseData) return;
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    let basePrice = this.courseData.price || 10000;
    let currentPrice = basePrice;
    let finalPrice = basePrice;  // Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
    let discounts = [];

    const paymentCard = document.querySelector('.payment-card.active');
    const paymentMethod = paymentCard?.dataset.payment || 'full';
    
    
   // Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø© - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ©
if (this.selectedJourney === 'gift' && this.selectedGift === 'voucher') {
    const voucherAmount = parseInt(document.getElementById('voucherAmount')?.value) || 0;
    
    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
    document.getElementById('calcBase').parentElement.style.display = 'none';
    document.getElementById('calcTimeDiscountRow').style.display = 'none';
    document.getElementById('calcGroupDiscountRow').style.display = 'none';
    document.getElementById('calcCashDiscountRow').style.display = 'none';
    document.getElementById('calcCouponDiscountRow').style.display = 'none';
    document.getElementById('calcInstallmentDetails').style.display = 'none';
    document.getElementById('calcSavings').style.display = 'none';
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„
    const hrElement = document.querySelector('.price-breakdown hr');
    if (hrElement) hrElement.style.display = 'none';
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù‚ÙŠÙ…Ø©
    document.getElementById('calcTotalLabel').innerHTML = 
        '<i class="fas fa-heart" style="color: #E11D48;"></i> Ù‚ÙŠÙ…Ø© Ø¯Ø¹Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…:';
    
    if (voucherAmount >= 50) {
        document.getElementById('calcTotal').innerHTML = `
            <span style="font-size: 2.5rem; color: #FFD700;">
                ${voucherAmount.toLocaleString('ar-EG')}
            </span>
            <span style="font-size: 1.2rem; color: #FFD700;"> Ø¬.Ù…</span>
        `;
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ± ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
        const breakdownDiv = document.querySelector('.price-breakdown');
        if (!document.getElementById('voucherThankYou')) {
            const thankYouMessage = document.createElement('div');
            thankYouMessage.id = 'voucherThankYou';
            thankYouMessage.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(20,184,166,0.1)); 
                            padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
                    <i class="fas fa-hands-helping" style="font-size: 2rem; color: #22C55E; margin-bottom: 10px;"></i>
                    <h4 style="color: #FFD700; margin: 10px 0;">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨!</h4>
                    <p style="color: #e2e8f0; margin: 10px 0;">
                        Ù…Ø³Ø§Ù‡Ù…ØªÙƒ Ø³ØªØºÙŠØ± Ø­ÙŠØ§Ø© Ø¥Ù†Ø³Ø§Ù† ÙˆØªÙØªØ­ Ù„Ù‡ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙØ©
                    </p>
                    <p style="color: #94a3b8; font-size: 0.9rem;">
                        Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ø¯ÙˆØ±ÙŠØ§Ù‹ Ø¹Ù† Ø£Ø«Ø± Ù…Ø³Ø§Ù‡Ù…ØªÙƒ Ø§Ù„ÙƒØ±ÙŠÙ…Ø©
                    </p>
                </div>
            `;
            breakdownDiv.appendChild(thankYouMessage);
        }
    } else {
        document.getElementById('calcTotal').innerHTML = `
            <span style="color: #E11D48;">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 50 Ø¬.Ù…</span>
        `;
        // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø´ÙƒØ± Ø¥Ù† ÙˆØ¬Ø¯Øª
        const thankYouMessage = document.getElementById('voucherThankYou');
        if (thankYouMessage) thankYouMessage.remove();
    }
    
    return; // ØªÙˆÙ‚Ù Ù‡Ù†Ø§ Ù„Ù„Ù‚Ø³ÙŠÙ…Ø©
}
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
    document.getElementById('calcBase').parentElement.style.display = 'flex';
    const paymentSection = document.querySelector('.payment-selection');
    const couponSection = document.querySelector('.coupon-section');
    if (paymentSection) paymentSection.style.display = 'block';
    if (couponSection) couponSection.style.display = 'block';
    
    // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¯ÙŠ - Ù†ÙØ³ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠ
    if (this.selectedJourney === 'gift' && this.selectedGift !== 'voucher') {
        document.getElementById('calcTotalLabel').textContent = 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‡Ø¯ÙŠØ©:';
        
        // Ù†Ø·Ø¨Ù‚ Ù†ÙØ³ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
        const activeOffer = this.getActiveTimeOffer();
        if (activeOffer) {
            const discount = basePrice * (activeOffer.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'time', amount: discount, name: activeOffer.name });
        } else if (this.courseData.salePrice && this.courseData.salePrice < basePrice) {
            const discount = basePrice - this.courseData.salePrice;
            currentPrice = this.courseData.salePrice;
            discounts.push({ type: 'sale', amount: discount, name: 'ØªØ®ÙÙŠØ¶' });
        }
        
        // Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø£ÙŠØ¶Ø§Ù‹
        if (paymentMethod === 'cash' && this.courseData.cashDiscount?.enabled) {
            const discount = currentPrice * (this.courseData.cashDiscount.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'cash', amount: discount, name: 'Ø¯ÙØ¹ ÙƒØ§Ù…Ù„' });
        }
    } 
    // Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (ÙØ±Ø¯ÙŠØ© Ø£Ùˆ Ø¬Ù…Ø§Ø¹ÙŠØ©)
    else {
        document.getElementById('calcTotalLabel').textContent = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:';
        
        // Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø²Ù…Ù†ÙŠØ©
        const activeOffer = this.getActiveTimeOffer();
        if (activeOffer) {
            const discount = basePrice * (activeOffer.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'time', amount: discount, name: activeOffer.name });
        } else if (this.courseData.salePrice && this.courseData.salePrice < basePrice) {
            const discount = basePrice - this.courseData.salePrice;
            currentPrice = this.courseData.salePrice;
            discounts.push({ type: 'sale', amount: discount, name: 'ØªØ®ÙÙŠØ¶' });
        }
        
        // Ø®ØµÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        if (this.selectedJourney === 'group' && this.selectedGroup !== null) {
            const group = this.courseData.groupDiscounts[this.selectedGroup];
            if (group) {
                const discount = currentPrice * (group.percentage / 100);
                currentPrice -= discount;
                discounts.push({ type: 'group', amount: discount, name: group.name });
            }
        }
        
        // Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
        if (paymentMethod === 'cash' && this.courseData.cashDiscount?.enabled) {
            const discount = currentPrice * (this.courseData.cashDiscount.percentage / 100);
            currentPrice -= discount;
            discounts.push({ type: 'cash', amount: discount, name: 'Ø¯ÙØ¹ ÙƒØ§Ù…Ù„' });
        }
    }
    
    // ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… (ÙŠØ¹Ù…Ù„ Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø©)
    if (this.appliedCoupon && !(this.selectedJourney === 'gift' && this.selectedGift === 'voucher')) {
        let discount = 0;
        if (this.appliedCoupon.type === 'percentage') {
            discount = currentPrice * (this.appliedCoupon.value / 100);
        } else {
            discount = Math.min(this.appliedCoupon.value, currentPrice);
        }
        currentPrice -= discount;
        discounts.push({ type: 'coupon', amount: discount, name: this.appliedCoupon.code });
    }
    
    this.updateDisplay(basePrice, currentPrice, discounts, paymentMethod);
       // ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø¯Ø§Ù„Ø© calculateØŒ Ø¨Ø¹Ø¯ this.updateDisplay
this.lastCalculationState = {
    basePrice: basePrice,
    finalPrice: finalPrice,
    discounts: discounts,
    paymentMethod: paymentMethod,
    timestamp: new Date().toISOString()
};

},
    
    updateDisplay(basePrice, finalPrice, discounts, paymentMethod) {
        // ØªÙ‚Ø±ÙŠØ¨
        basePrice = Math.round(basePrice / 10) * 10;
        finalPrice = Math.round(finalPrice / 10) * 10;
        
        // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        document.getElementById('calcBase').textContent = `${basePrice.toLocaleString('ar-EG')} Ø¬.Ù…`;
        
        // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
        document.getElementById('calcTimeDiscountRow').style.display = 'none';
        document.getElementById('calcGroupDiscountRow').style.display = 'none';
        document.getElementById('calcCashDiscountRow').style.display = 'none';
        document.getElementById('calcCouponDiscountRow').style.display = 'none';
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
        discounts.forEach(discount => {
            const amount = Math.round(discount.amount / 10) * 10;
            
            if (discount.type === 'time' || discount.type === 'sale') {
                document.getElementById('calcTimeDiscountRow').style.display = 'flex';
                document.getElementById('calcTimeDiscountLabel').textContent = 
                    discount.type === 'time' ? `Ø®ØµÙ… ${discount.name}:` : 'Ø®ØµÙ…:';
                document.getElementById('calcTimeDiscount').textContent = `-${amount.toLocaleString('ar-EG')} Ø¬.Ù…`;
            }
            if (discount.type === 'group') {
                document.getElementById('calcGroupDiscountRow').style.display = 'flex';
                document.getElementById('calcGroupDiscount').textContent = `-${amount.toLocaleString('ar-EG')} Ø¬.Ù…`;
            }
            if (discount.type === 'cash') {
                document.getElementById('calcCashDiscountRow').style.display = 'flex';
                document.getElementById('calcCashDiscount').textContent = `-${amount.toLocaleString('ar-EG')} Ø¬.Ù…`;
            }
            if (discount.type === 'coupon') {
                document.getElementById('calcCouponDiscountRow').style.display = 'flex';
                document.getElementById('calcCouponDiscount').textContent = `-${amount.toLocaleString('ar-EG')} Ø¬.Ù…`;
            }
        });
        
        // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        document.getElementById('calcTotal').textContent = `${finalPrice.toLocaleString('ar-EG')} Ø¬.Ù…`;
        
        // Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ù„Ø§ ØªØ¸Ù‡Ø± Ù„Ù„Ù‚Ø³ÙŠÙ…Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø©)
        const installmentDetails = document.getElementById('calcInstallmentDetails');
        if (paymentMethod.startsWith('plan_') && 
            !(this.selectedJourney === 'gift' && this.selectedGift === 'voucher')) {
            const planIndex = parseInt(paymentMethod.split('_')[1]);
            const plan = this.courseData.paymentPlans[planIndex];
            
            if (plan) {
                const installmentText = this.calculateInstallments(finalPrice, plan);
                document.getElementById('calcInstallmentPlan').innerHTML = installmentText;
                installmentDetails.style.display = 'block';
            }
        } else {
            installmentDetails.style.display = 'none';
        }
        
        // Ø§Ù„ØªÙˆÙÙŠØ± (Ù„Ø§ ÙŠØ¸Ù‡Ø± Ù„Ù„Ù‚Ø³ÙŠÙ…Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø©)
        const savings = basePrice - finalPrice;
        if (savings > 0 && !(this.selectedJourney === 'gift' && this.selectedGift === 'voucher')) {
            document.getElementById('calcSavings').style.display = 'block';
            document.getElementById('calcSavingsAmount').textContent = savings.toLocaleString('ar-EG');
        } else {
            document.getElementById('calcSavings').style.display = 'none';
        }
            
    },
    
    calculateInstallments(total, plan) {
        const installments = plan.installments || 3;
        const firstPercent = plan.firstPaymentPercent || 0;
        
        total = Math.round(total / 10) * 10;
        
        if (firstPercent > 0) {
            const firstPayment = Math.round(total * firstPercent / 100 / 10) * 10;
            const remaining = total - firstPayment;
            const monthlyAmount = Math.round(remaining / (installments - 1) / 10) * 10;
            
            return `Ø¯ÙØ¹Ø© Ø£ÙˆÙ„Ù‰: ${firstPayment.toLocaleString('ar-EG')} Ø¬.Ù… + ${installments - 1} Ø£Ù‚Ø³Ø§Ø· Ã— ${monthlyAmount.toLocaleString('ar-EG')} Ø¬.Ù…`;
        } else {
            const monthlyAmount = Math.round(total / installments / 10) * 10;
            return `${installments} Ø£Ù‚Ø³Ø§Ø· Ã— ${monthlyAmount.toLocaleString('ar-EG')} Ø¬.Ù… Ø´Ù‡Ø±ÙŠØ§Ù‹`;
        }
    },
    
    applyCoupon() {
    const couponInput = document.getElementById('calcCoupon');
    const couponCode = couponInput.value.trim().toUpperCase();
    
    if (!couponCode) {
        Swal.fire({
            icon: 'warning',
            title: 'ÙƒÙˆØ¯ ÙØ§Ø±Øº',
            text: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…',
            confirmButtonColor: '#FFD700'
        });
        return;
    }
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
    const validCoupon = this.coupons.find(c => c.code === couponCode);
    
    if (!validCoupon) {
        Swal.fire({
            icon: 'error',
            title: 'ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­',
            text: 'Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
            confirmButtonColor: '#E11D48'
        });
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
    if (validCoupon.maxUses && validCoupon.used >= validCoupon.maxUses) {
        Swal.fire({
            icon: 'error',
            title: 'ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…',
            text: 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Øª',
            confirmButtonColor: '#E11D48'
        });
        return;
    }
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
    this.appliedCoupon = validCoupon;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    couponInput.disabled = true;
    document.getElementById('applyCouponCalc').style.display = 'none';
    
    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø¥Ø²Ø§Ù„Ø©
    const couponSection = document.querySelector('.coupon-section');
    if (!document.querySelector('.coupon-remove-btn')) {
        const removeBtn = document.createElement('button');
        removeBtn.className = 'coupon-remove-btn';
        removeBtn.innerHTML = '<i class="fas fa-times"></i> Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯';
        removeBtn.onclick = () => this.removeCoupon();
        couponSection.appendChild(removeBtn);
    }
    
    // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
    Swal.fire({
        icon: 'success',
        title: 'ØªÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚!',
        text: `ÙƒÙˆØ¯ ${couponCode} ØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡ Ø¨Ù†Ø¬Ø§Ø­`,
        confirmButtonColor: '#22C55E',
        timer: 2000
    });

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
const messageDiv = document.getElementById('calcCouponMessage');
if (messageDiv) {
    messageDiv.innerHTML = `
        <div style="background: rgba(34,197,94,0.1); 
                    border: 1px solid #22C55E; 
                    padding: 10px; 
                    border-radius: 8px; 
                    color: #22C55E;
                    margin-top: 10px;">
            <i class="fas fa-check-circle"></i>
            ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… <strong>${couponCode}</strong> Ù…ÙÙØ¹Ù‘Ù„
            ${validCoupon.type === 'percentage' ? 
              `(Ø®ØµÙ… ${validCoupon.value}%)` : 
              `(Ø®ØµÙ… ${validCoupon.value} Ø¬.Ù…)`}
        </div>
    `;
}

// ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø­Ù‚Ù„ Ù„Ù„Ø£Ø®Ø¶Ø±
couponInput.style.background = '#22C55E20';
couponInput.style.borderColor = '#22C55E';

// Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
this.saveToStorage();
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨
    this.calculate();
},

removeCoupon() {
    this.appliedCoupon = null;
    
    const couponInput = document.getElementById('calcCoupon');
    const applyBtn = document.getElementById('applyCouponCalc');
    const messageDiv = document.getElementById('calcCouponMessage');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù‚Ù„
    if (couponInput) {
        couponInput.value = '';
        couponInput.disabled = false;
        couponInput.style.background = '';
        couponInput.style.borderColor = '';
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    if (applyBtn) {
        applyBtn.style.display = 'inline-block';
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ø­Ø°Ù
    const removeBtn = document.querySelector('.coupon-remove-btn');
    if (removeBtn) {
        removeBtn.remove();
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    if (messageDiv) {
        messageDiv.innerHTML = '';
    }
    
    // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    this.saveToStorage();
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
    this.calculate();
    
    // Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
    Swal.fire({
        icon: 'info',
        title: 'ØªÙ… Ø¥Ø²Ø§Ù„Ø© ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…',
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 2000,
        timerProgressBar: true
    });
},

    // Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
getDisplayedValues() {
    const result = {
        basePrice: 0,
        finalPrice: 0,
        discounts: [],
        paymentMethod: '',
        installmentDetails: null,
        coupon: null,
        totalSavings: 0
    };
    
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
    const basePriceEl = document.getElementById('calcBase');
    if (basePriceEl) {
        const text = basePriceEl.textContent || '';
        const numbers = text.match(/[\d,]+/g);
        if (numbers) {
            result.basePrice = parseInt(numbers[0].replace(/,/g, '')) || 0;
        }
    }
    
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    const finalPriceEl = document.getElementById('calcTotal');
    if (finalPriceEl) {
        const text = finalPriceEl.textContent || '';
        const numbers = text.match(/[\d,]+/g);
        if (numbers) {
            result.finalPrice = parseInt(numbers[0].replace(/,/g, '')) || 0;
        }
    }
    
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
    const discountTypes = [
        {id: 'calcTimeDiscountRow', valueId: 'calcTimeDiscount', labelId: 'calcTimeDiscountLabel', type: 'time'},
        {id: 'calcGroupDiscountRow', valueId: 'calcGroupDiscount', type: 'group'},
        {id: 'calcCashDiscountRow', valueId: 'calcCashDiscount', type: 'cash'},
        {id: 'calcCouponDiscountRow', valueId: 'calcCouponDiscount', type: 'coupon'}
    ];
    
    discountTypes.forEach(item => {
        const row = document.getElementById(item.id);
        if (row && row.style.display !== 'none') {
            const valueEl = document.getElementById(item.valueId);
            if (valueEl) {
                const text = valueEl.textContent || '';
                const numbers = text.match(/[\d,]+/g);
                if (numbers) {
                    const amount = parseInt(numbers[0].replace(/,/g, '')) || 0;
                    if (amount > 0) {
                        let label = item.type;
                        if (item.labelId) {
                            const labelEl = document.getElementById(item.labelId);
                            if (labelEl) {
                                label = labelEl.textContent.replace(':', '').trim();
                            }
                        }
                        
                        result.discounts.push({
                            type: item.type,
                            label: label,
                            amount: amount,
                            percentage: this.getDiscountPercentage(item.type)
                        });
                    }
                }
            }
        }
    });
    
    // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
    const activePaymentCard = document.querySelector('.payment-card.active');
    if (activePaymentCard) {
        result.paymentMethod = activePaymentCard.dataset.payment || '';
        
        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        const installmentEl = document.getElementById('calcInstallmentPlan');
        if (installmentEl && document.getElementById('calcInstallmentDetails').style.display !== 'none') {
            result.installmentDetails = installmentEl.innerHTML || '';
        }
    }
    
    // Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
    if (this.appliedCoupon) {
        result.coupon = {
            code: this.appliedCoupon.code,
            type: this.appliedCoupon.type,
            value: this.appliedCoupon.value
        };
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙÙŠØ±
    result.totalSavings = result.basePrice - result.finalPrice;
    
    return result;
},

    getDiscountPercentage(type) {
    switch(type) {
        case 'time':
            const activeOffer = this.getActiveTimeOffer();
            return activeOffer?.percentage || 0;
        case 'group':
            if (this.selectedGroup !== null) {
                return this.courseData.groupDiscounts[this.selectedGroup]?.percentage || 0;
            }
            return 0;
        case 'cash':
            return this.courseData.cashDiscount?.percentage || 0;
        case 'coupon':
            if (this.appliedCoupon) {
                if (this.appliedCoupon.type === 'percentage') {
                    return this.appliedCoupon.value;
                }
            }
            return 0;
        default:
            return 0;
    }
},

getDisplayedDiscounts() {
    const discounts = [];
    
    // Ø®ØµÙ… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø²Ù…Ù†ÙŠ
    if (document.getElementById('calcTimeDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcTimeDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        const label = document.getElementById('calcTimeDiscountLabel').textContent;
        discounts.push({
            type: 'Ø¹Ø±Ø¶ Ø²Ù…Ù†ÙŠ',
            name: label.replace(':', ''),
            amount: amount
        });
    }
    
    // Ø®ØµÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
    if (document.getElementById('calcGroupDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcGroupDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        discounts.push({
            type: 'Ø®ØµÙ… Ù…Ø¬Ù…ÙˆØ¹Ø©',
            name: 'Ø®ØµÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
            amount: amount
        });
    }
    
    // Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø¯ÙŠ
    if (document.getElementById('calcCashDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcCashDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        discounts.push({
            type: 'Ø®ØµÙ… Ù†Ù‚Ø¯ÙŠ',
            name: 'Ø¯ÙØ¹ ÙƒØ§Ù…Ù„',
            amount: amount
        });
    }
    
    // ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…
    if (document.getElementById('calcCouponDiscountRow').style.display !== 'none') {
        const amount = parseInt(document.getElementById('calcCouponDiscount').textContent.replace(/[^\d]/g, '')) || 0;
        discounts.push({
            type: 'ÙƒÙˆØ¯ Ø®ØµÙ…',
            name: this.appliedCoupon?.code || 'ÙƒÙˆØ¨ÙˆÙ†',
            amount: amount
        });
    }
    
    return discounts;
},

getDisplayedInstallments() {
    const installmentDetails = document.getElementById('calcInstallmentDetails');
    if (installmentDetails.style.display === 'none') return null;
    
    const text = document.getElementById('calcInstallmentPlan').innerHTML;
    return {
        planText: text,
        isActive: true
    };
},

    
    
// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
saveCalculationState() {
    const state = {
        journey: this.selectedJourney,
        group: this.selectedGroup,
        gift: this.selectedGift,
        paymentMethod: this.getSelectedPaymentMethod(),
        coupon: this.appliedCoupon,
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
        displayedValues: this.getDisplayedValues(),
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
        courseData: {
            title: this.courseData?.title || 'Ø§Ù„Ø¯ÙˆØ±Ø©',
            price: this.courseData?.price || 10000,
            salePrice: this.courseData?.salePrice,
            cashDiscount: this.courseData?.cashDiscount,
            paymentPlans: this.courseData?.paymentPlans,
            groupDiscounts: this.courseData?.groupDiscounts
        },
        
        // Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ
        timestamp: new Date().toISOString()
    };
    
    // Ø­ÙØ¸ ÙÙŠ Ø¹Ø¯Ø© Ø£Ù…Ø§ÙƒÙ†
    const stateString = JSON.stringify(state);
    localStorage.setItem('calculatorState', stateString);
    sessionStorage.setItem('calculatorState', stateString);
    
    return state;
},

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
getSelectedPaymentMethod() {
    const activeCard = document.querySelector('.payment-card.active');
    if (!activeCard) return 'full';
    
    const method = activeCard.dataset.payment;
    const methodName = activeCard.querySelector('h6')?.textContent || '';
    
    return {
        code: method,
        name: methodName,
        isInstallment: method.startsWith('plan_')
    };
},

    // Ù…ÙŠØ²Ø© Ø­ÙØ¸ ÙˆÙ…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª
saveScenario() {
    const scenarioName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù„Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ (Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø±Ù…Ø¶Ø§Ù† - 3 Ø£Ø´Ø®Ø§Øµ):');
    if (!scenarioName) return;
    
    const scenario = {
        name: scenarioName,
        date: new Date().toLocaleDateString('ar-EG'),
        journey: this.selectedJourney,
        basePrice: document.getElementById('calcBase')?.innerText,
        finalPrice: document.getElementById('calcTotal')?.innerText,
        discounts: this.getDisplayedDiscounts(),
        paymentMethod: document.querySelector('.payment-card.active')?.querySelector('h6')?.innerText
    };
    
    // Ø­ÙØ¸ ÙÙŠ localStorage
    const savedScenarios = JSON.parse(localStorage.getItem('savedScenarios') || '[]');
    savedScenarios.push(scenario);
    localStorage.setItem('savedScenarios', JSON.stringify(savedScenarios));
    
    Swal.fire({
        icon: 'success',
        title: 'ØªÙ… Ø§Ù„Ø­ÙØ¸!',
        text: `ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ "${scenarioName}" Ø¨Ù†Ø¬Ø§Ø­`,
        confirmButtonColor: '#22C55E'
    });
},

showSavedScenarios() {
    const savedScenarios = JSON.parse(localStorage.getItem('savedScenarios') || '[]');
    
    if (savedScenarios.length === 0) {
        Swal.fire({
            icon: 'info',
            title: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©',
            text: 'Ø§Ø­Ø³Ø¨ Ø¹Ø±Ø¶ ÙˆØ§Ø­ÙØ¸Ù‡ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹',
            confirmButtonColor: '#3B82F6'
        });
        return;
    }
    
    let html = '<div style="text-align: right; max-height: 400px; overflow-y: auto;">';
    savedScenarios.forEach((scenario, index) => {
        html += `
            <div style="background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 10px; border-right: 4px solid #FFD700;">
                <h4 style="color: #0A1628; margin-bottom: 10px;">${scenario.name}</h4>
                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${scenario.date}</p>
                <p><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> <span style="color: #22C55E; font-size: 1.2em;">${scenario.finalPrice}</span></p>
                <p><strong>Ø§Ù„Ø¯ÙØ¹:</strong> ${scenario.paymentMethod || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                <button onclick="smartCalculator.deleteScenario(${index})" 
                        style="background: #E11D48; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">
                    Ø­Ø°Ù
                </button>
            </div>
        `;
    });
    html += '</div>';
    
    Swal.fire({
        title: 'Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©',
        html: html,
        width: '600px',
        confirmButtonText: 'Ø¥ØºÙ„Ø§Ù‚',
        confirmButtonColor: '#3B82F6'
    });
},

deleteScenario(index) {
    const savedScenarios = JSON.parse(localStorage.getItem('savedScenarios') || '[]');
    savedScenarios.splice(index, 1);
    localStorage.setItem('savedScenarios', JSON.stringify(savedScenarios));
    Swal.close();
    setTimeout(() => this.showSavedScenarios(), 100);
},
    
handleMainAction() {
    console.log('ğŸ¯ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø¬Ø²');
    
    // Ø­Ø§Ù„Ø© Ø®Ø§ØµØ© Ù„Ù„Ù‚Ø³ÙŠÙ…Ø©
    if (this.selectedJourney === 'gift' && this.selectedGift === 'voucher') {
        this.handleVoucherDonation();
        return;
    }
    // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ Ù„Ø´Ø®Øµ Ù…Ø­Ø¯Ø¯
if (this.selectedJourney === 'gift' && this.selectedGift === 'specific') {
    // Ù†ÙØ³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¹Ø§Ø¯ÙŠ - Ø¹Ø±Ø¶ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙˆÙ„
    if (typeof window.showAllData === 'function') {
        window.showAllData();
    }
    return;
}

// Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ Ù„Ø´Ø®Øµ Ù…Ø³ØªØ­Ù‚ (Ù…Ø¬Ù‡ÙˆÙ„)
if (this.selectedJourney === 'gift' && this.selectedGift === 'anonymous') {
    // Ù†ÙØ³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¹Ø§Ø¯ÙŠ - Ø¹Ø±Ø¶ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙˆÙ„
    if (typeof window.showAllData === 'function') {
        window.showAllData();
    }
    return;
}
    
    // Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© - Ø¹Ø±Ø¶ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠ Ø£ÙˆÙ„Ø§Ù‹
    const finalPrice = document.getElementById('calcTotal')?.innerText;
    if (!finalPrice || finalPrice === '0 Ø¬.Ù…' || finalPrice === 'Ù  Ø¬.Ù…') {
        Swal.fire({
            icon: 'warning',
            title: 'ØªÙ†Ø¨ÙŠÙ‡',
            text: 'Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø£ÙˆÙ„Ø§Ù‹'
        });
        return;
    }
    
    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
    if (typeof window.showAllData === 'function') {
        window.showAllData();
    } else {
        console.error('âŒ Ø¯Ø§Ù„Ø© showAllData ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
    }
},
    
    handleIndividualBooking() {
    const finalPrice = document.getElementById('calcTotal')?.innerText || '0';
    const paymentMethod = document.querySelector('.payment-card.active h6')?.innerText || '';
    
    Swal.fire({
        title: 'ğŸ“‹ ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø²Ùƒ Ø§Ù„ÙØ±Ø¯ÙŠ',
        html: `
            <div style="text-align: right; direction: rtl;">
                <!-- Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
                <div style="background: linear-gradient(135deg, #FFD700, #FFA500); 
                            padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: #0A1628;">Ø±Ø­Ù„Ø© ÙØ±Ø¯ÙŠØ©</h4>
                    <p style="color: #152238;">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <strong>${finalPrice}</strong></p>
                    <p style="color: #152238;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${paymentMethod}</p>
                </div>
                
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #0A1628; margin-bottom: 15px;">
                        <i class="fas fa-user"></i> Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="individualName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ"
                               style="width: 100%; padding: 10px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="individualPhone" placeholder="01xxxxxxxxx"
                               style="width: 100%; padding: 10px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                        </label>
                        <input type="email" id="individualEmail" placeholder="example@email.com"
                               style="width: 100%; padding: 10px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="individualNotes" rows="2" 
                                  placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ©"
                                  style="width: 100%; padding: 10px; border: 2px solid #E5E7EB; 
                                         border-radius: 8px; font-size: 1rem;"></textarea>
                    </div>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#22C55E',
        width: '650px',
        preConfirm: () => {
            const name = document.getElementById('individualName').value;
            const phone = document.getElementById('individualPhone').value;
            
            if (!name || !phone) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return false;
            }
            
            if (!/^01[0-9]{9}$/.test(phone)) {
                Swal.showValidationMessage('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­');
                return false;
            }
            
            return { name, phone };
        }
    }).then(async (result) => {
        if (result.isConfirmed) {
            // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const bookingData = {
                type: 'individual_booking',
                timestamp: new Date().toISOString(),
                journey: 'ÙØ±Ø¯ÙŠ',
                
                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                customer: {
                    name: document.getElementById('individualName').value,
                    phone: document.getElementById('individualPhone').value,
                    email: document.getElementById('individualEmail').value || '',
                    notes: document.getElementById('individualNotes').value || ''
                },
                
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¹Ø±
                pricing: this.getDisplayedValues(),
                
                // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                payment: this.getSelectedPaymentMethod()
            };
            
            try {
                // Ø­ÙØ¸ ÙÙŠ Firebase
                const docRef = await db.collection('tempBookings').add(bookingData);
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„ÙØ±Ø¯ÙŠ:', docRef.id);
                
                // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                await Swal.fire({
                    icon: 'success',
                    title: 'ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!',
                    text: 'Ø¬Ø§Ø±ÙŠ ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹...',
                    timer: 2000
                });
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                window.location.href = `booking-page.html?bookingId=${docRef.id}`;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                Swal.fire('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', 'error');
            }
        }
    });
},
handleGroupBooking() {
    const selectedGroup = document.querySelector('.group-card.active h5')?.innerText || '';
    const groupDiscount = document.querySelector('.group-card.active .discount')?.innerText || '';
    const finalPrice = document.getElementById('calcTotal')?.innerText || '0';
    
    Swal.fire({
        title: 'ğŸ‘¥ ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø² Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
        html: `
            <div style="text-align: right; direction: rtl;">
                <!-- Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
                <div style="background: linear-gradient(135deg, #9333EA, #EC4899); 
                            padding: 15px; border-radius: 10px; margin-bottom: 20px; color: white;">
                    <h4>Ø­Ø¬Ø² Ø¬Ù…Ø§Ø¹ÙŠ - ${selectedGroup}</h4>
                    <p>Ø§Ù„Ø®ØµÙ…: ${groupDiscount}</p>
                    <p>Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ÙØ±Ø¯: <strong>${finalPrice}</strong></p>
                </div>
                
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #9333EA; margin-bottom: 15px;">
                        <i class="fas fa-users"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="groupLeaderName" placeholder="Ø§Ø³Ù… Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©"
                               style="width: 100%; padding: 10px; border: 2px solid #9333EA; 
                                      border-radius: 8px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="groupLeaderPhone" placeholder="01xxxxxxxxx"
                               style="width: 100%; padding: 10px; border: 2px solid #9333EA; 
                                      border-radius: 8px; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯ <span style="color: red;">*</span>
                        </label>
                        <input type="number" id="groupSize" min="3" placeholder="3 Ø£Ø´Ø®Ø§Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
                               style="width: 100%; padding: 10px; border: 2px solid #9333EA; 
                                      border-radius: 8px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø£Ø³Ù…Ø§Ø¡ Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                        </label>
                        <textarea id="groupMembers" rows="3" 
                                  placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙØ±Ø§Ø¯ (ÙƒÙ„ Ø§Ø³Ù… ÙÙŠ Ø³Ø·Ø±)"
                                  style="width: 100%; padding: 10px; border: 2px solid #9333EA; 
                                         border-radius: 8px;"></textarea>
                    </div>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø² Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#9333EA',
        width: '650px',
        preConfirm: () => {
            const name = document.getElementById('groupLeaderName').value;
            const phone = document.getElementById('groupLeaderPhone').value;
            const size = document.getElementById('groupSize').value;
            
            if (!name || !phone || !size) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return false;
            }
            
            if (size < 3) {
                Swal.showValidationMessage('Ø§Ù„Ø¹Ø¯Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø´Ø®Ø§Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return false;
            }
            
            return { name, phone, size };
        }
    }).then(async (result) => {
        if (result.isConfirmed) {
            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const bookingData = {
                type: 'group_booking',
                timestamp: new Date().toISOString(),
                journey: 'Ø¬Ù…Ø§Ø¹ÙŠ',
                
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                group: {
                    name: selectedGroup,
                    leaderName: document.getElementById('groupLeaderName').value,
                    leaderPhone: document.getElementById('groupLeaderPhone').value,
                    size: document.getElementById('groupSize').value,
                    members: document.getElementById('groupMembers').value || '',
                    discount: groupDiscount
                },
                
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¹Ø±
                pricing: this.getDisplayedValues()
            };
            
            try {
                // Ø­ÙØ¸ ÙÙŠ Firebase
                const docRef = await db.collection('tempBookings').add(bookingData);
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø­Ø¬Ø² Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:', docRef.id);
                
                await Swal.fire({
                    icon: 'success',
                    title: 'ØªÙ… Ø­Ø¬Ø² Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©!',
                    timer: 2000
                });
                
                window.location.href = `booking-page.html?bookingId=${docRef.id}`;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                Swal.fire('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', 'error');
            }
        }
    });
},

            // Ø¯Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†Ø­Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©


// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ù„ØªÙˆØ¬ÙŠÙ‡ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø­ Ù„Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            
// Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‚Ø³ÙŠÙ…Ø©
handleVoucherDonation() {
    const amount = parseInt(document.getElementById('voucherAmount')?.value) || 0;
    
    if (amount < 50) {
        Swal.fire({
            icon: 'warning',
            title: 'ØªÙ†Ø¨ÙŠÙ‡',
            text: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø³Ø§Ù‡Ù…Ø© 50 Ø¬Ù†ÙŠÙ‡',
            confirmButtonColor: '#FFD700'
        });
        return;
    }
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©
    let courseName = 'Ø±Ø­Ù„Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…';
    if (window.courseName) {
        courseName = window.courseName;
    } else if (window.currentCourseData && window.currentCourseData.title) {
        courseName = window.currentCourseData.title;
    }
    
    Swal.fire({
        title: 'ğŸ’ Ù‚Ø³ÙŠÙ…Ø© Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¬ØªÙ…Ø¹',
        html: `
            <div style="text-align: right; direction: rtl; max-height: 500px; overflow-y: auto;">
                <!-- Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© -->
                <div style="background: linear-gradient(135deg, #10B981, #059669); 
                            padding: 20px; border-radius: 10px; margin-bottom: 20px; color: white;">
                    <div style="text-align: center;">
                        <i class="fas fa-hand-holding-heart" style="font-size: 3rem; margin-bottom: 10px;"></i>
                        <h3 style="margin: 0;">Ù‚Ø³ÙŠÙ…Ø© Ø¯Ø¹Ù… ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
                        <p style="margin: 10px 0 0 0; opacity: 0.95;">
                            Ù…Ø³Ø§Ù‡Ù…ØªÙƒ ØªÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ù„Ù„Ù…Ø­ØªØ§Ø¬ÙŠÙ†
                        </p>
                    </div>
                </div>
                
                <!-- Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© -->
                <div style="background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(5,150,105,0.1)); 
                            padding: 25px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                    <p style="color: #064E3B; margin: 0 0 10px 0; font-size: 1.1rem;">
                        Ù‚ÙŠÙ…Ø© Ù…Ø³Ø§Ù‡Ù…ØªÙƒ Ø§Ù„ÙƒØ±ÙŠÙ…Ø©
                    </p>
                    <div style="background: white; padding: 20px; border-radius: 10px; 
                                border: 3px solid #10B981;">
                        <span style="color: #10B981; font-size: 3rem; font-weight: bold;">
                            ${amount.toLocaleString('ar-EG')}
                        </span>
                        <span style="color: #059669; font-size: 1.5rem; margin-right: 10px;">
                            Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ
                        </span>
                    </div>
                    <p style="color: #047857; margin: 15px 0 0 0; font-size: 0.95rem;">
                        <i class="fas fa-info-circle"></i>
                        Ø³ØªÙØ³ØªØ®Ø¯Ù… Ù„Ø¯Ø¹Ù… ${courseName || 'Ø±Ø­Ù„Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…'}
                    </p>
                </div>
                
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ -->
                <div style="background: #F9FAFB; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #1F2937; margin-bottom: 15px;">
                        <i class="fas fa-user-heart"></i> Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„ÙƒØ±ÙŠÙ…Ø©
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="voucherDonorName" 
                               placeholder="Ø§Ø³Ù…Ùƒ ÙƒÙ…Ø§ ØªØ­Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´ÙƒØ±"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="voucherDonorPhone" 
                               placeholder="Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙˆØ¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø«Ø±"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                        <small style="color: #6B7280; display: block; margin-top: 5px;">
                            <i class="fas fa-shield-alt"></i> Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© ÙˆÙ„Ù† ØªÙØ´Ø§Ø±Ùƒ Ù…Ø¹ Ø£Ø·Ø±Ø§Ù Ø®Ø§Ø±Ø¬ÙŠØ©
                        </small>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="email" id="voucherDonorEmail" 
                               placeholder="example@email.com"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ù„Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="voucherDonorCountry" 
                               placeholder="Ø¨Ù„Ø¯Ùƒ"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="voucherDonorCity" 
                               placeholder="Ù…Ø¯ÙŠÙ†ØªÙƒ"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© -->
                <div style="background: #F0FDF4; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #065F46; margin-bottom: 15px;">
                        <i class="fas fa-hands-helping"></i> ØªÙØ§ØµÙŠÙ„ Ù…Ø³Ø§Ù‡Ù…ØªÙƒ
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #047857;">
                            Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <select id="voucherPurpose" 
                                style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                       border-radius: 8px; font-size: 1rem;">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØºØ±Ø¶ --</option>
                            <option value="sadaqah">ØµØ¯Ù‚Ø©</option>
                            <option value="zakat">Ø²ÙƒØ§Ø©</option>
                            <option value="gift">Ù‡Ø¯ÙŠØ©</option>
                            <option value="thanks">Ø´ÙƒØ± Ù„Ù„Ù‡</option>
                            <option value="memory">Ø°ÙƒØ±Ù‰ Ø¹Ø²ÙŠØ²</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #047857;">
                            Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="voucherMessage" rows="4" 
                                  placeholder="Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø£Ùˆ Ø¯Ø¹Ø§Ø¡ Ù„Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†..."
                                  style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #047857;">
                            Ø¥Ù‡Ø¯Ø§Ø¡ Ø¨Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="voucherDedication" 
                               placeholder="Ù…Ø«Ø§Ù„: ÙˆØ§Ù„Ø¯ÙŠ Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡ØŒ Ø£Ù…ÙŠ Ø­ÙØ¸Ù‡Ø§ Ø§Ù„Ù„Ù‡..."
                               style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="padding: 15px; background: white; border-radius: 8px; 
                                border-right: 3px solid #10B981;">
                        <label style="display: flex; align-items: center; cursor: pointer; color: #065F46;">
                            <input type="checkbox" id="voucherAnonymous" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <span><strong>Ø£Ø±ÙŠØ¯ Ø£Ù† ØªØ¨Ù‚Ù‰ Ù…Ø³Ø§Ù‡Ù…ØªÙŠ Ù…Ø¬Ù‡ÙˆÙ„Ø©</strong></span>
                        </label>
                        <small style="color: #047857; display: block; margin-top: 5px; margin-right: 28px;">
                            Ø³ÙŠØªÙ… Ø°ÙƒØ±Ùƒ ÙƒÙ€ "Ù…Ø­Ø³Ù† ÙƒØ±ÙŠÙ…" ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†
                        </small>
                    </div>
                </div>
                
                <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹ -->
                <div style="background: #FEF3C7; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #92400E; margin-bottom: 15px;">
                        <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ <span style="color: red;">*</span>
                    </h4>
                    
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="vodafone" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="instapay" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="bank" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="card" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†ÙƒÙŠØ©</strong>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Ù…Ø§Ø°Ø§ Ø³ÙŠØ­Ø¯Ø« Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ -->
                <div style="background: #F3E8FF; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #581C87; margin-bottom: 15px;">
                        <i class="fas fa-sparkles"></i> Ù…Ø§Ø°Ø§ Ø³ÙŠØ­Ø¯Ø« Ø¨Ø¹Ø¯ Ù…Ø³Ø§Ù‡Ù…ØªÙƒØŸ
                    </h4>
                    
                    <div style="display: grid; gap: 12px;">
                        <div style="display: flex; align-items: start;">
                            <i class="fas fa-check-circle" style="color: #10B981; margin-left: 10px; margin-top: 3px;"></i>
                            <div>
                                <strong>Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©:</strong> Ø³Ù†Ø®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ÙŠÙ†
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: start;">
                            <i class="fas fa-check-circle" style="color: #10B981; margin-left: 10px; margin-top: 3px;"></i>
                            <div>
                                <strong>Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©:</strong> Ø³ØªØµÙ„Ùƒ Ø´Ù‡Ø§Ø¯Ø© Ø´ÙƒØ± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: start;">
                            <i class="fas fa-check-circle" style="color: #10B981; margin-left: 10px; margin-top: 3px;"></i>
                            <div>
                                <strong>Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø©:</strong> ØªÙ‚Ø±ÙŠØ± Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† ÙˆÙ‚ØµØµÙ‡Ù…
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: start;">
                            <i class="fas fa-check-circle" style="color: #10B981; margin-left: 10px; margin-top: 3px;"></i>
                            <div>
                                <strong>Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø©:</strong> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø«Ø± ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ± -->
                <div style="background: linear-gradient(135deg, #DCFCE7, #D1FAE5); 
                            padding: 20px; border-radius: 10px; text-align: center;">
                    <i class="fas fa-heart" style="color: #DC2626; font-size: 2rem; margin-bottom: 10px;"></i>
                    <p style="color: #14532D; margin: 0; font-size: 1.1rem; font-weight: bold;">
                        Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ù‚Ù„Ø¨Ùƒ Ø§Ù„Ø·ÙŠØ¨
                    </p>
                    <p style="color: #166534; margin: 10px 0 0 0;">
                        "Ù…Ù† ÙØ·Ù‘Ø± ØµØ§Ø¦Ù…Ø§Ù‹ ÙƒØ§Ù† Ù„Ù‡ Ù…Ø«Ù„ Ø£Ø¬Ø±Ù‡" - ÙˆØ£Ù†Øª ØªÙØ·Ø¹Ù… Ø§Ù„Ø¹Ù‚ÙˆÙ„ Ø¨Ø§Ù„Ø¹Ù„Ù…
                    </p>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#10B981',
        cancelButtonColor: '#6B7280',
        width: '850px',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
            document.getElementById('voucherDonorName')?.focus();
        },
        preConfirm: () => {
            const name = document.getElementById('voucherDonorName').value.trim();
            const phone = document.getElementById('voucherDonorPhone').value.trim();
            const selectedPayments = document.querySelectorAll('input[name="paymentMethod"]:checked');
            
            if (!name) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');
                return false;
            }
            
            if (!phone) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨');
                return false;
            }
            
            if (selectedPayments.length === 0) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return false;
            }
            
            return true;
        }
    }).then(async (result) => {
        if (result.isConfirmed) {
            try {
                // Ø¬Ù…Ø¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
                const selectedPayments = [];
                document.querySelectorAll('input[name="paymentMethod"]:checked').forEach(checkbox => {
                    selectedPayments.push(checkbox.value);
                });
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³ÙŠÙ…Ø©
                const voucherData = {
                    type: 'voucher_donation',
                    timestamp: new Date().toISOString(),
                    status: 'pending',
                    
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø©
                    courseInfo: {
                        name: courseName,
                        courseId: window.currentCourseData?.courseId || 'unknown'
                    },
                    
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ¨Ø±Ø¹
                    donation: {
                        amount: amount,
                        currency: 'EGP'
                    },
                    
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹
                    donor: {
                        name: document.getElementById('voucherDonorName').value.trim(),
                        phone: document.getElementById('voucherDonorPhone').value.trim(),
                        email: document.getElementById('voucherDonorEmail').value.trim() || '',
                        country: document.getElementById('voucherDonorCountry').value.trim() || '',
                        city: document.getElementById('voucherDonorCity').value.trim() || '',
                        anonymous: document.getElementById('voucherAnonymous').checked
                    },
                    
                    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©
                    details: {
                        purpose: document.getElementById('voucherPurpose').value || '',
                        message: document.getElementById('voucherMessage').value.trim() || '',
                        dedication: document.getElementById('voucherDedication').value.trim() || ''
                    },
                    
                    // Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
                    paymentMethods: selectedPayments
                };
                
                console.log('ğŸ’ Ø­ÙØ¸ Ù‚Ø³ÙŠÙ…Ø© Ø§Ù„Ø¯Ø¹Ù…:', voucherData);
                
                // Ø­ÙØ¸ ÙÙŠ Firebase
                const docRef = await db.collection('tempBookings').add(voucherData);
                console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸:', docRef.id);
                
                // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                await Swal.fire({
                    icon: 'success',
                    title: 'ğŸŒŸ Ø£Ù†Øª Ù†Ø¬Ù… Ù…Ø¶ÙŠØ¡!',
                    html: `
                        <div style="text-align: center;">
                            <div style="background: linear-gradient(135deg, #D1FAE5, #F3E8FF); 
                                        padding: 25px; border-radius: 15px; margin: 20px 0;">
                                <h3 style="color: #065F46; margin-bottom: 15px;">
                                    Ø´ÙƒØ±Ø§Ù‹ Ù„Ù‚Ù„Ø¨Ùƒ Ø§Ù„Ø·ÙŠØ¨
                                </h3>
                                <p style="color: #374151; font-size: 1.1rem; margin: 10px 0;">
                                    Ù…Ø³Ø§Ù‡Ù…ØªÙƒ Ø¨Ù‚ÙŠÙ…Ø© <strong style="color: #10B981;">${amount.toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡</strong>
                                    <br>Ø³ØªØºÙŠØ± Ø­ÙŠØ§Ø© Ø¥Ù†Ø³Ø§Ù† ÙˆØªÙØªØ­ Ù„Ù‡ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙØ©
                                </p>
                                <div style="background: white; padding: 15px; border-radius: 10px; 
                                            margin: 15px 0; border-right: 4px solid #FFD700;">
                                    <p style="margin: 0;">
                                        <strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©:</strong>
                                        <span style="color: #10B981; font-size: 1.2rem;">
                                            #${docRef.id.slice(-8).toUpperCase()}
                                        </span>
                                    </p>
                                </div>
                                <p style="color: #64748b; margin: 10px 0;">
                                    Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ø¯ÙˆØ±ÙŠØ§Ù‹ Ø¹Ù† Ø£Ø«Ø± Ù…Ø³Ø§Ù‡Ù…ØªÙƒ Ø§Ù„ÙƒØ±ÙŠÙ…Ø©
                                </p>
                            </div>
                            
                            <p style="color: #64748b; margin-top: 20px;">
                                Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†ØŸ
                            </p>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'ğŸ“™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯ÙˆØ±Ø©',
                    cancelButtonText: 'ğŸ“š ØªØµÙØ­ Ø¯ÙˆØ±Ø§Øª Ø£Ø®Ø±Ù‰',
                    confirmButtonColor: '#10B981',
                    cancelButtonColor: '#9333EA',
                    width: '650px',
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø©
                        const courseUrl = `course-discover.html?course=${courseName}`;
                        window.location.href = courseUrl;
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        // ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                        window.location.href = 'master.html';
                    }
                });
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Ø®Ø·Ø£!',
                    text: 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.',
                    confirmButtonColor: '#E11D48'
                });
            }
        }
    });
},


// Ø¯Ø§Ù„Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
proceedWithOldMethod() {
    const currentState = this.saveCalculationState();
    const bookingPackage = {
        version: '2.0',
        source: 'calculator',
        data: currentState
    };
    
    localStorage.setItem('bookingPackage', JSON.stringify(bookingPackage));
    
    Swal.fire({
        icon: 'success',
        title: 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        text: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„...',
        timer: 2000
    });
    
    setTimeout(() => {
        window.location.href = 'booking-page.html';
    }, 2000);
},

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ checksum Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
generateChecksum(data) {
    const str = JSON.stringify(data);
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return Math.abs(hash).toString(16);
},
    
getAdditionalInfo() {
    const info = {};
    
    if (this.selectedJourney === 'group' && this.selectedGroup !== null) {
        const group = this.courseData.groupDiscounts[this.selectedGroup];
        info.group = {
            name: group?.name,
            size: group?.minSize,
            discount: group?.percentage
        };
    }
    
    if (this.selectedJourney === 'gift') {
        info.gift = {
            type: this.selectedGift,
            recipientName: document.getElementById('giftRecipientName')?.value || '',
            gifterName: document.getElementById('gifterName')?.value || '',
            message: document.getElementById('giftMessage')?.value || '',
            voucherAmount: parseInt(document.getElementById('voucherAmount')?.value) || 0
        };
    }
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø´Ø·
    const activeOffer = this.getActiveTimeOffer();
    if (activeOffer) {
        info.activeOffer = {
            name: activeOffer.name,
            percentage: activeOffer.percentage,
            endDate: activeOffer.endDate
        };
    }
    
    return info;
},

validateDataBeforeSending() {
    const data = this.getDisplayedValues();
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    if (!data.finalPrice || data.finalPrice <= 0) {
        console.error('Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');
        return false;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
    if (!data.paymentMethod) {
        console.error('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹');
        return false;
    }
    
    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ£ÙƒØ¯
    console.log('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', data);
    
    return true;
},
    
    getGroupData() {
    if (this.selectedGroup === null) return null;
    const group = this.courseData.groupDiscounts[this.selectedGroup];
    return {
        name: group.name,
        minSize: group.minSize,
        percentage: group.percentage
    };
},

getGiftData() {
    const data = {
        type: this.selectedGift
    };
    
    if (this.selectedGift === 'voucher') {
        data.voucherAmount = parseInt(document.getElementById('voucherAmount')?.value) || 0;
    } else if (this.selectedGift === 'specific') {
        data.recipientName = document.getElementById('giftRecipientName')?.value || '';
    }
    
    return data;
},
    
    handleGiftAction(total) {
        const giftType = this.selectedGift;
        
        if (giftType === 'specific') {
            this.handleSpecificGift(total);
        } else if (giftType === 'anonymous') {
            this.handleAnonymousGift(total);
        } else if (giftType === 'voucher') {
            this.handleVoucherGift();
        }
    },
    
    handleSpecificGift(total) {
        const recipientName = document.getElementById('giftRecipientName').value;
        const gifterName = document.getElementById('gifterName').value || 'Ù…Ø¬Ù‡ÙˆÙ„';
        const revealName = document.getElementById('revealGifterName').checked;
        const message = document.getElementById('giftMessage').value;
        
        if (!recipientName) {
            Swal.fire({
                title: 'ØªÙ†Ø¨ÙŠÙ‡',
                text: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ù…Ù† Ø§Ù„Ù‡Ø¯ÙŠØ©',
                icon: 'warning',
                background: '#152238',
                color: '#fff'
            });
            return;
        }
        
        Swal.fire({
            title: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡',
            html: `
                <div style="text-align: right;">
                    <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø¯ÙŠØ©:</strong> Ø±Ø­Ù„Ø© ÙƒØ§Ù…Ù„Ø©</p>
                    <p><strong>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯:</strong> ${recipientName}</p>
                    <p><strong>Ù…Ù†:</strong> ${revealName ? gifterName : 'Ù…ÙÙ‡Ø¯ÙŠ ÙƒØ±ÙŠÙ…'}</p>
                    <p><strong>Ø§Ù„Ù‚ÙŠÙ…Ø©:</strong> ${total}</p>
                    ${message ? `<p><strong>Ø±Ø³Ø§Ù„Ø©:</strong> ${message}</p>` : ''}
                    <hr>
                    <p>Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø·Ø§Ù‚Ø© Ù‡Ø¯ÙŠØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù„Ù„Ù…Ø³ØªÙÙŠØ¯</p>
                </div>
            `,
            icon: 'gift',
            showCancelButton: true,
            confirmButtonText: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡',
            cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
            confirmButtonColor: '#EC4899',
            background: '#152238',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡
                console.log('Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡...');
                
                Swal.fire({
                    title: 'ØªÙ… Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!',
                    html: `
                        <p>Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡Ø¯ÙŠØ© Ø¥Ù„Ù‰ ${recipientName}</p>
                        <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙØªØ© Ø§Ù„ÙƒØ±ÙŠÙ…Ø©</p>
                    `,
                    icon: 'success',
                    background: '#152238',
                    color: '#fff'
                });
            }
        });
    },
    
    handleAnonymousGift(total) {
        const gifterName = document.getElementById('gifterName').value || 'Ù…Ø­Ø³Ù† ÙƒØ±ÙŠÙ…';
        const message = document.getElementById('giftMessage').value;
        
        Swal.fire({
            title: 'Ù‡Ø¯ÙŠØ© Ù…Ø¬Ù‡ÙˆÙ„Ø©',
            html: `
                <div style="text-align: right;">
                    <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø¯ÙŠØ©:</strong> Ø±Ø­Ù„Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù…Ø­ØªØ§Ø¬</p>
                    <p><strong>Ø§Ù„Ù‚ÙŠÙ…Ø©:</strong> ${total}</p>
                    <p><strong>Ø§Ù„Ù…ÙÙ‡Ø¯ÙŠ:</strong> ${gifterName}</p>
                    ${message ? `<p><strong>Ø±Ø³Ø§Ù„ØªÙƒ:</strong> ${message}</p>` : ''}
                    <hr>
                    <p>Ø³Ù†Ø®ØªØ§Ø± Ø£Ø­Ø¯ Ø§Ù„Ù…Ø­ØªØ§Ø¬ÙŠÙ† Ù…Ù† Ù…Ø¬ØªÙ…Ø¹Ù†Ø§ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ ØªÙ‚Ø±ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</p>
                </div>
            `,
            icon: 'heart',
            showCancelButton: true,
            confirmButtonText: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©',
            cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
            confirmButtonColor: '#22C55E',
            background: '#152238',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!',
                    html: `
                        <p>Ù…Ø³Ø§Ù‡Ù…ØªÙƒ Ø³ØªØºÙŠØ± Ø­ÙŠØ§Ø© Ø´Ø®Øµ Ù…Ø§</p>
                        <p>Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ ØªÙ‚Ø±ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
                    `,
                    icon: 'success',
                    background: '#152238',
                    color: '#fff'
                });
            }
        });
    },
    
    handleVoucherGift() {
    const amount = parseInt(document.getElementById('voucherAmount').value) || 0;
    const gifterName = document.getElementById('gifterName')?.value || 'Ù…Ø­Ø³Ù† ÙƒØ±ÙŠÙ…';
    const message = document.getElementById('giftMessage')?.value || '';
    
    if (!amount || amount < 50) {
        Swal.fire({
            title: 'ØªÙ†Ø¨ÙŠÙ‡',
            text: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø³Ø§Ù‡Ù…Ø© 50 Ø¬.Ù…',
            icon: 'warning',
            confirmButtonColor: '#FFD700'
        });
        return;
    }
    
    // Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ù…Ø®ØªÙ„ÙØ© Ù„Ù„Ù‚Ø³ÙŠÙ…Ø©
    Swal.fire({
        title: 'ğŸ’ ØªØ£ÙƒÙŠØ¯ Ù‚Ø³ÙŠÙ…Ø© Ø§Ù„Ø¯Ø¹Ù…',
        html: `
            <div style="text-align: right; direction: rtl;">
                <div style="background: linear-gradient(135deg, #D1FAE5, #DBEAFE); 
                            padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="color: #065F46; margin-bottom: 15px;">
                        <i class="fas fa-hand-holding-heart"></i> Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„ÙƒØ±ÙŠÙ…Ø©
                    </h3>
                    
                    <div style="margin: 15px 0;">
                        <label style="color: #065F46; font-weight: bold;">Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…:</label>
                        <input type="text" id="confirmGifterName" value="${gifterName}" 
                               style="width: 100%; padding: 10px; border: 2px solid #22C55E; 
                                      border-radius: 8px; margin-top: 5px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label style="color: #065F46; font-weight: bold;">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <input type="text" id="confirmPhone" placeholder="01xxxxxxxxx" 
                               style="width: 100%; padding: 10px; border: 2px solid #22C55E; 
                                      border-radius: 8px; margin-top: 5px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label style="color: #065F46; font-weight: bold;">Ø±Ø³Ø§Ù„ØªÙƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <textarea id="confirmMessage" rows="3" 
                                  style="width: 100%; padding: 10px; border: 2px solid #22C55E; 
                                         border-radius: 8px; margin-top: 5px; font-size: 1rem;">${message}</textarea>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 10px; 
                                border-right: 4px solid #FFD700;">
                        <p style="margin: 0; font-size: 1.1rem;">
                            <strong>Ù‚ÙŠÙ…Ø© Ø¯Ø¹Ù…Ùƒ:</strong> 
                            <span style="color: #22C55E; font-size: 1.5rem; font-weight: bold;">
                                ${amount.toLocaleString('ar-EG')} Ø¬.Ù…
                            </span>
                        </p>
                    </div>
                </div>
                
                <div style="background: #FEF2F2; padding: 15px; border-radius: 10px; 
                            border-right: 3px solid #E11D48;">
                    <p style="color: #991B1B; margin: 0;">
                        <i class="fas fa-info-circle"></i>
                        Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©" Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„ØµÙØ­Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹
                    </p>
                </div>
            </div>
        `,
        icon: 'heart',
        showCancelButton: true,
        confirmButtonText: 'âœ¨ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#22C55E',
        cancelButtonColor: '#6b7280',
        width: '600px',
        customClass: {
            popup: 'swal-rtl'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            const finalData = {
                type: 'voucher_donation',
                amount: amount,
                gifterName: document.getElementById('confirmGifterName').value,
                phone: document.getElementById('confirmPhone').value,
                message: document.getElementById('confirmMessage').value,
                timestamp: new Date().toISOString()
            };
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            localStorage.setItem('voucherData', JSON.stringify(finalData));
            
            // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            Swal.fire({
                title: 'ğŸŒŸ Ø£Ù†Øª Ù†Ø¬Ù… Ù…Ø¶ÙŠØ¡!',
                html: `
                    <p style="font-size: 1.2em;">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨</p>
                    <p>Ø¬Ø§Ø±ÙŠ ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©...</p>
                `,
                icon: 'success',
                timer: 2000,
                showConfirmButton: false
            }).then(() => {
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
                window.location.href = `booking-page.html?type=voucher&amount=${amount}`;
            });
        }
    });
},
    
    handleGrantRequest() {
    Swal.fire({
        title: 'ğŸ¤² Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ø¯Ø¹Ù… Ø¥Ø¶Ø§ÙÙŠØŸ',
        html: `
            <div style="text-align: right;">
                <p style="margin-bottom: 20px;">Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ! ÙŠÙ…ÙƒÙ†Ù†Ø§ ØªÙˆÙÙŠØ±:</p>
                <ul style="text-align: right; margin: 20px 0; line-height: 2;">
                    <li>ğŸ’° <strong>Ù…Ù†Ø­Ø© Ø¬Ø²Ø¦ÙŠØ©:</strong> Ø®ØµÙ… 50-75%</li>
                    <li>ğŸ“… <strong>ØªÙ‚Ø³ÙŠØ· Ù…Ø±ÙŠØ­:</strong> ÙŠØµÙ„ Ù„Ù€ 24 Ø´Ù‡Ø±</li>
                    <li>ğŸ <strong>Ù…Ù†Ø­Ø© ÙƒØ§Ù…Ù„Ø©:</strong> 100% Ù…Ø¬Ø§Ù†Ø§Ù‹</li>
                </ul>
                <p style="background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                    <strong>ğŸ’š Ù„Ø§ Ù†Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø§Ù„ Ø¹Ø§Ø¦Ù‚Ø§Ù‹ Ù„Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…</strong><br>
                    Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ù„Ù…Ù†Ø§Ù‚Ø´Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
                </p>
            </div>
        `,
        icon: 'heart',
        showCancelButton: true,
        confirmButtonText: 'ğŸ“ ØªÙ‚Ø¯Ù… Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¯Ø¹Ù…',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
        confirmButtonColor: '#22C55E',
        cancelButtonColor: '#6b7280',
        background: '#152238',
        color: '#fff'
    }).then((result) => {
        if (result.isConfirmed) {
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†Ø­Ø©
            const grantData = {
                type: 'grant',
                courseId: this.courseData?.courseId || 'default',
                courseName: this.courseData?.title || 'Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©',
                originalPrice: this.courseData?.price || 0,
                currentCalculation: this.getDisplayedValues(),
                requestSource: 'calculator_page'
            };
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†Ø­Ø©
            const params = new URLSearchParams();
            params.append('data', encodeURIComponent(JSON.stringify(grantData)));
            window.location.href = `booking-page.html?${params.toString()}`;
        }
    });
},
    cleanupOldCode() {
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    const oldElements = [
        'V3-end-placeholder',
        'undefined-elements',
        'test-button-old'
    ];
    
    oldElements.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.remove();
            console.log(`ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…: ${id}`);
        }
    });
},
    // Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Firebase
saveToFirebase: async function() {
    console.log('ğŸ’¾ Ø­ÙØ¸ ÙÙŠ Firebase...');
    
    const bookingData = {
        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©
        journeyType: this.selectedJourney,
        journeyText: document.querySelector('.journey-option.active span')?.innerText || '',
        
        // Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
        basePrice: parseInt(document.getElementById('calcBase')?.innerText?.replace(/[^\d]/g, '')) || 0,
        finalPrice: parseInt(document.getElementById('calcTotal')?.innerText?.replace(/[^\d]/g, '')) || 0,
        
        // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
        paymentMethod: document.querySelector('.payment-card.active')?.dataset.payment || '',
        paymentText: document.querySelector('.payment-card.active h6')?.innerText || '',
        
        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
        timestamp: new Date().toISOString(),
        status: 'pending',
        source: 'calculator'
    };
    
    // Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
    if (this.selectedJourney === 'group' && this.selectedGroup !== null) {
        const group = this.courseData.groupDiscounts[this.selectedGroup];
        bookingData.groupInfo = {
            name: group.name,
            size: group.minSize,
            discount: group.percentage
        };
    }
    
    // Ù„Ù„Ø¥Ù‡Ø¯Ø§Ø¡
    if (this.selectedJourney === 'gift') {
        bookingData.giftType = this.selectedGift;
        if (this.selectedGift === 'voucher') {
            bookingData.voucherAmount = parseInt(document.getElementById('voucherAmount')?.value) || 0;
        }
    }
    
    // Ù„Ù„ÙƒÙˆØ¨ÙˆÙ†
    if (this.appliedCoupon) {
        bookingData.coupon = {
            code: this.appliedCoupon.code,
            type: this.appliedCoupon.type,
            value: this.appliedCoupon.value
        };
    }
    
    try {
        const docRef = await db.collection('tempBookings').add(bookingData);
        console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸:', docRef.id);
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©
        window.location.href = `booking-page.html?bookingId=${docRef.id}`;
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
    }
},
};
        
        
        // Data collection functions
        window.collectCompleteData = function() {
            
    console.log('ğŸ” Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©...');
    
    const fullData = {
        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆÙ‚Øª
        timestamp: new Date().toISOString(),
        // Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©
        courseName: getCurrentCourseName(),
        courseId: new URLSearchParams(window.location.search).get('course') || 'unknown',
        // 1. Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        pricing: {
            basePrice: document.getElementById('calcBase')?.innerText || '0',
            basePriceNumber: parseInt(document.getElementById('calcBase')?.innerText?.replace(/[^\d]/g, '')) || 0,
            finalPrice: document.getElementById('calcTotal')?.innerText || '0',
            finalPriceNumber: parseInt(document.getElementById('calcTotal')?.innerText?.replace(/[^\d]/g, '')) || 0,
        },

               
        // 2. ÙƒÙ„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø¨Ø§Ù„ØªÙØµÙŠÙ„
        discounts: [],
        
        // 3. Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù†Ø´Ø·
        activeOffer: null,
        
        // 4. Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        payment: {
            method: null,
            code: null,
            installmentDetails: null,
            installmentHTML: null
        },
        
        // 5. Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©
        journey: {
            type: null,
            text: null,
            groupName: null,
            groupSize: null,
            groupDiscount: null
        },
        
        // 6. ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…
        coupon: {
            code: null,
            applied: false,
            discount: null
        }
    };
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø¨Ø§Ù„ØªÙØµÙŠÙ„
    if (document.getElementById('calcTimeDiscountRow').style.display !== 'none') {
        const timeDiscountLabel = document.getElementById('calcTimeDiscountLabel')?.innerText || '';
        const timeDiscountValue = document.getElementById('calcTimeDiscount')?.innerText || '';
        
        fullData.discounts.push({
            type: 'time',
            label: timeDiscountLabel,
            value: timeDiscountValue,
            amount: parseInt(timeDiscountValue.replace(/[^\d]/g, '')) || 0
        });
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø²Ù…Ù†ÙŠ
        const activeOfferEl = document.getElementById('activeOfferName');
        const activeDiscountEl = document.getElementById('activeOfferDiscount');
        if (activeOfferEl) {
            fullData.activeOffer = {
                name: activeOfferEl.innerText,
                discount: activeDiscountEl?.innerText || '',
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                endDate: window.currentCourseData?.discounts?.find(d => d.name === activeOfferEl.innerText)?.endDate || null
            };
        }
    }
    
    if (document.getElementById('calcGroupDiscountRow').style.display !== 'none') {
        const groupValue = document.getElementById('calcGroupDiscount')?.innerText || '';
        fullData.discounts.push({
            type: 'group',
            label: 'Ø®ØµÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
            value: groupValue,
            amount: parseInt(groupValue.replace(/[^\d]/g, '')) || 0
        });
        
        // Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        const activeGroupCard = document.querySelector('.group-card.active');
        if (activeGroupCard) {
            fullData.journey.groupName = activeGroupCard.querySelector('h5')?.innerText || '';
            fullData.journey.groupSize = activeGroupCard.querySelector('.size')?.innerText || '';
            fullData.journey.groupDiscount = activeGroupCard.querySelector('.discount')?.innerText || '';
        }
    }
    
    if (document.getElementById('calcCashDiscountRow').style.display !== 'none') {
        const cashValue = document.getElementById('calcCashDiscount')?.innerText || '';
        fullData.discounts.push({
            type: 'cash',
            label: 'Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙƒØ§Ù…Ù„',
            value: cashValue,
            amount: parseInt(cashValue.replace(/[^\d]/g, '')) || 0
        });
    }
    
    if (document.getElementById('calcCouponDiscountRow').style.display !== 'none') {
        const couponValue = document.getElementById('calcCouponDiscount')?.innerText || '';
        const couponCode = document.getElementById('calcCoupon')?.value || '';
        
        fullData.discounts.push({
            type: 'coupon',
            label: `ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… (${couponCode})`,
            value: couponValue,
            amount: parseInt(couponValue.replace(/[^\d]/g, '')) || 0
        });
        
        fullData.coupon = {
            code: couponCode,
            applied: true,
            discount: couponValue
        };
    }
    
    // Ø¬Ù…Ø¹ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„ØªÙØµÙŠÙ„
    const activePayment = document.querySelector('.payment-card.active');
    if (activePayment) {
        fullData.payment.method = activePayment.querySelector('h6')?.innerText || '';
        fullData.payment.code = activePayment.dataset.payment || '';
        
        // Ø¬Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        const installmentSection = document.getElementById('calcInstallmentDetails');
        if (installmentSection && installmentSection.style.display !== 'none') {
            const installmentPlan = document.getElementById('calcInstallmentPlan');
            fullData.payment.installmentDetails = installmentPlan?.innerText || '';
            fullData.payment.installmentHTML = installmentPlan?.innerHTML || '';
        }
    }
    
    // Ø¬Ù…Ø¹ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©
    const activeJourney = document.querySelector('.journey-option.active');
    if (activeJourney) {
        fullData.journey.type = activeJourney.dataset.journey || '';
        fullData.journey.text = activeJourney.querySelector('span')?.innerText || '';
    }
    
   // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆÙÙŠØ± Ø¨Ø·Ø±ÙŠÙ‚Ø© ØµØ­ÙŠØ­Ø©
// Ø£ÙˆÙ„Ø§Ù‹: Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµØ­ÙŠØ­Ø©
// Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆÙÙŠØ± - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
let baseNumber = 0;
let finalNumber = 0;

// Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
function convertArabicNumbers(str) {
    const arabicNumbers = ['Ù ','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©'];
    const englishNumbers = ['0','1','2','3','4','5','6','7','8','9'];
    
    let result = str;
    for (let i = 0; i < arabicNumbers.length; i++) {
        result = result.replace(new RegExp(arabicNumbers[i], 'g'), englishNumbers[i]);
    }
    return result;
}

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
const baseText = document.getElementById('calcBase')?.innerText || '0';
const baseTextEnglish = convertArabicNumbers(baseText);
const baseNumbers = baseTextEnglish.replace(/[^\d]/g, '');
baseNumber = parseInt(baseNumbers) || 0;

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
const finalText = document.getElementById('calcTotal')?.innerText || '0';
const finalTextEnglish = convertArabicNumbers(finalText);
const finalNumbers = finalTextEnglish.replace(/[^\d]/g, '');
finalNumber = parseInt(finalNumbers) || 0;

// Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙÙŠØ±
fullData.totalSavings = baseNumber - finalNumber;
fullData.totalSavingsText = fullData.totalSavings > 0 ? 
    fullData.totalSavings.toLocaleString('ar-EG') + ' Ø¬.Ù…' : 
    '0 Ø¬.Ù…';

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
fullData.pricing.basePriceNumber = baseNumber;
fullData.pricing.finalPriceNumber = finalNumber;

console.log('ğŸ’° Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙÙŠØ± Ø§Ù„ØµØ­ÙŠØ­:', {
    'Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ': baseText,
    'Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ': finalText,
    'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ': baseNumber,
    'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ': finalNumber,
    'Ø§Ù„ØªÙˆÙÙŠØ±': fullData.totalSavings
});
    return fullData;
};
        
        
       window.showAllData = function() {
        // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø£ÙˆÙ„Ø§Ù‹
    if (!document.getElementById('dataDisplayBox')) {
        createDataDisplay();
    }

        const data = collectCompleteData();
    
    // Ø§Ù„Ø¢Ù† Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const displayBox = document.getElementById('dataDisplayBox');
    const content = document.getElementById('dataContent');
    
    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    if (!displayBox || !content) {
        console.error('âŒ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø£Ùˆ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        // Ø£Ù†Ø´Ø¦ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
        createDataDisplay();
        setTimeout(() => showAllData(), 100);
        return;
    }
    
    
    // HTML Ù…Ø­Ø³Ù‘Ù† Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡
    let htmlContent = '';

        // Ù‚Ø³Ù… Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø© - Ø¬Ø¯ÙŠØ¯
    htmlContent += `
        <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #FFD700, #FFA500); border-radius: 10px;">
            <h3 style="color: #0A1628; margin: 0;">
                <i class="fas fa-book"></i> Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            </h3>
            <p style="color: #152238; margin: 10px 0 0 0; font-size: 1.3rem; font-weight: bold;">
                ${data.courseName || getCurrentCourseName()}
            </p>
        </div>
    `;
    

// Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    htmlContent += `
        <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 10px;">
            <h3 style="color: #FFD700;">ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:</h3>
            <p><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</strong> ${data.pricing.basePrice}</p>
            <p><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> <span style="color: #22C55E; font-size: 1.2em;">${data.pricing.finalPrice}</span></p>
            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆÙÙŠØ±:</strong> <span style="color: #E11D48;">${data.totalSavingsText || (data.totalSavings + ' Ø¬.Ù…')}</span></p>
        </div>
    `;
    
    // Ù‚Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø²Ù…Ù†ÙŠ
    if (data.activeOffer) {
        htmlContent += `
            <div style="margin-bottom: 20px; padding: 15px; background: #FFF3CD; border-radius: 10px;">
                <h3 style="color: #F97316;">â° Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù†Ø´Ø·:</h3>
                <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶:</strong> ${data.activeOffer.name}</p>
                <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…:</strong> ${data.activeOffer.discount}</p>
                ${data.activeOffer.endDate ? '<p><strong>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ:</strong> ' + new Date(data.activeOffer.endDate).toLocaleDateString('ar-EG') + '</p>' : ''}
            </div>
        `;
    }
    
    // Ù‚Ø³Ù… Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
    htmlContent += `
        <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 10px;">
            <h3 style="color: #22C55E;">ğŸ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙØ¹Ù„Ø© (${data.discounts.length}):</h3>
    `;
    
    if (data.discounts.length > 0) {
        data.discounts.forEach(d => {
            htmlContent += `
                <div style="border-right: 3px solid #22C55E; padding-right: 10px; margin: 10px 0;">
                    <p><strong>${d.label}:</strong> ${d.value}</p>
                </div>
            `;
        });
    } else {
        htmlContent += '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ØµÙˆÙ…Ø§Øª Ù…ÙØ¹Ù„Ø©</p>';
    }
    htmlContent += '</div>';
    
    // Ù‚Ø³Ù… Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
    htmlContent += `
        <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 10px;">
            <h3 style="color: #3B82F6;">ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</h3>
            <p><strong>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©:</strong> ${data.payment.method || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
    `;
    
    if (data.payment.installmentDetails) {
        htmlContent += `
            <div style="background: #E0F2FE; padding: 10px; border-radius: 5px; margin-top: 10px;">
                <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</strong><br>
                ${data.payment.installmentHTML}
            </div>
        `;
    }
    htmlContent += '</div>';
    
    // Ù‚Ø³Ù… Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©
    htmlContent += `
        <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 10px;">
            <h3 style="color: #9333EA;">ğŸš€ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©:</h3>
            <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${data.journey.text || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
    `;
    
    if (data.journey.groupName) {
        htmlContent += `
            <div style="background: #F3E8FF; padding: 10px; border-radius: 5px; margin-top: 10px;">
                <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</strong> ${data.journey.groupName}</p>
                <p><strong>Ø­Ø¬Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</strong> ${data.journey.groupSize}</p>
                <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…:</strong> ${data.journey.groupDiscount}</p>
            </div>
        `;
    }
    htmlContent += '</div>';
    
    // Ù‚Ø³Ù… ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…
    if (data.coupon.code) {
        htmlContent += `
            <div style="margin-bottom: 20px; padding: 15px; background: #FEF2F2; border-radius: 10px;">
                <h3 style="color: #EC4899;">ğŸŸï¸ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…:</h3>
                <p><strong>Ø§Ù„ÙƒÙˆØ¯:</strong> <code style="background: #333; color: #FFD700; padding: 5px 10px; border-radius: 5px;">${data.coupon.code}</code></p>
                <p><strong>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…:</strong> ${data.coupon.discount}</p>
            </div>
        `;
    }
    
    // Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    htmlContent += `
        <div style="background: #D1FAE5; padding: 15px; border-radius: 10px; margin-top: 20px;">
            <h4>âœ… ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù†Ù‚Ù„</h4>
            <p style="margin: 10px 0;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©: <strong>${data.discounts.length + 3}</strong> Ø¹Ù†ØµØ±</p>
        </div>
    `;
    
    // ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
    content.innerHTML = htmlContent;
    
    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
    displayBox.style.display = 'block';
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    window.fullBookingData = data;
    localStorage.setItem('fullBookingData', JSON.stringify(data));
    
    console.log('âœ… ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©:', data);
    
    return data;
};

        
        window.proceedToBooking = async function(event) {
    console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase...');
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©
    const data = window.fullBookingData || collectCompleteData();
    
    if (!data) {
        alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ù‚Ù„');
        return;
    }
    
    // Ø­ÙØ¸ Ù…Ø±Ø¬Ø¹ Ù„Ù„Ø²Ø±
    const proceedBtn = event?.target;
    if (proceedBtn) {
        proceedBtn.disabled = true;
        proceedBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
    }
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
    const dataDisplayBox = document.getElementById('dataDisplayBox');
    if (dataDisplayBox) {
        dataDisplayBox.style.display = 'none';
    }
    
    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø¶Ù…Ø§Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙˆÙ„
    setTimeout(() => {
        // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©
        const journeyType = smartCalculator.selectedJourney;
        
        // Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©ØŒ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
        if (journeyType === 'individual') {
            // Ø­Ø¬Ø² ÙØ±Ø¯ÙŠ - Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            showIndividualDataForm(data, proceedBtn);
        } else if (journeyType === 'group') {
            // Ø­Ø¬Ø² Ø¬Ù…Ø§Ø¹ÙŠ - Ø§Ø·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
            showGroupDataForm(data, proceedBtn);
        } else if (journeyType === 'gift') {
            // Ø¥Ù‡Ø¯Ø§Ø¡ - Ø§Ø·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡
            showGiftDataForm(data, proceedBtn);
        } else {
            // Ø­ÙØ¸ Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
            saveToFirebaseDirectly(data, proceedBtn);
        }
    }, 300); // ØªØ£Ø®ÙŠØ± 300 Ù…ÙŠÙ„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
};


// 4. Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        createDataDisplay();
        console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²');
    }, 1000);
});

window.proceedToBooking = function() {
    const data = window.fullBookingData;
    if (!data) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ù‚Ù„');
        return;
    }
    
    console.log('ğŸš€ Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    localStorage.setItem('finalBookingData', JSON.stringify(data));
    
    // Ø£ØºÙ„Ù‚ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
    document.getElementById('dataDisplayBox').style.display = 'none';
    
    // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ØµÙØ­Ø©
    setTimeout(() => {
        window.location.href = 'booking-page.html';
    }, 1000);
};
            // Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadCourseData();
            setTimeout(() => {
                smartCalculator.init();
            }, 1000);
        });

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø¥Ù‡Ø¯Ø§Ø¡
function showGiftDataForm(existingData, proceedBtn) {
    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡
    const giftType = smartCalculator.selectedGift;
    
    if (giftType === 'specific') {
        // Ø¥Ù‡Ø¯Ø§Ø¡ Ù„Ø´Ø®Øµ Ù…Ø­Ø¯Ø¯
        showSpecificGiftForm(existingData, proceedBtn);
    } else if (giftType === 'anonymous') {
        // Ø¥Ù‡Ø¯Ø§Ø¡ Ù„Ø´Ø®Øµ Ù…Ø³ØªØ­Ù‚
        showAnonymousGiftForm(existingData, proceedBtn);
    } else {
        // Ø­Ø§Ù„Ø© Ø£Ø®Ø±Ù‰ - Ø­ÙØ¸ Ù…Ø¨Ø§Ø´Ø±
        saveToFirebaseDirectly(existingData, proceedBtn);
    }
}
        // Ø¯Ø§Ù„Ø© Ø¥Ù‡Ø¯Ø§Ø¡ Ù„Ø´Ø®Øµ Ù…Ø­Ø¯Ø¯
function showSpecificGiftForm(existingData, proceedBtn) {
    const courseName = existingData.courseName || getCurrentCourseName();
    const finalPrice = existingData.pricing?.finalPrice || '0';
    
    Swal.fire({
        title: 'ğŸ Ø¥Ù‡Ø¯Ø§Ø¡ Ø±Ø­Ù„Ø© Ù„Ø´Ø®Øµ ØªØ¹Ø±ÙÙ‡',
        html: `
            <div style="text-align: right; direction: rtl; max-height: 500px; overflow-y: auto;">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© -->
                <div style="background: linear-gradient(135deg, #EC4899, #F97316); 
                            padding: 15px; border-radius: 10px; margin-bottom: 20px; color: white;">
                    <h4 style="margin: 0;">
                        <i class="fas fa-gift"></i> ${courseName}
                    </h4>
                    <p style="margin: 10px 0 5px 0;">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‡Ø¯ÙŠØ©: <strong style="font-size: 1.3rem;">${finalPrice}</strong></p>
                </div>
                
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‡Ø¯ÙŠ -->
                <div style="background: #FFF5F5; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #BE123C; margin-bottom: 15px;">
                        <i class="fas fa-user-heart"></i> Ø¨ÙŠØ§Ù†Ø§ØªÙƒ (Ø§Ù„Ù…ÙÙ‡Ø¯ÙŠ)
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #881337; font-weight: bold;">
                            Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="gifterName" placeholder="Ø§Ø³Ù…Ùƒ ÙƒÙ…Ø§ ØªØ­Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø±"
                               style="width: 100%; padding: 12px; border: 2px solid #FECDD3; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #881337; font-weight: bold;">
                            Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨Ùƒ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="gifterWhatsapp" placeholder="Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ"
                               style="width: 100%; padding: 12px; border: 2px solid #FECDD3; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #881337;">
                            Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="email" id="gifterEmail" placeholder="example@email.com"
                               style="width: 100%; padding: 12px; border: 2px solid #FECDD3; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px; padding: 15px; background: #FEF2F2; border-radius: 8px;">
                        <label style="display: flex; align-items: center; cursor: pointer; color: #881337;">
                            <input type="checkbox" id="revealGifterName" checked
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <span><strong>Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø³Ù…ÙŠ Ù„Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡</strong></span>
                        </label>
                        <small style="color: #BE123C; display: block; margin-top: 5px; margin-right: 28px;">
                            Ø¥Ø°Ø§ Ø£Ù„ØºÙŠØª Ø§Ù„ØªØ­Ø¯ÙŠØ¯ØŒ Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù‡Ø¯ÙŠØ© ÙƒÙ€ "Ù‡Ø¯ÙŠØ© Ù…Ù† Ù…Ø­Ø¨ Ù„Ù„Ø®ÙŠØ±"
                        </small>
                    </div>
                </div>
                
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡ -->
                <div style="background: #F0FDF4; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #14532D; margin-bottom: 15px;">
                        <i class="fas fa-user-check"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #166534; font-weight: bold;">
                            Ø§Ø³Ù… Ø§Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="recipientName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
                               style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #166534; font-weight: bold;">
                            Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="recipientWhatsapp" placeholder="Ø³Ù†Ø±Ø³Ù„ Ù„Ù‡ Ø§Ù„Ù‡Ø¯ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨"
                               style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                        <small style="color: #059669; display: block; margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> Ø³Ù†Ø±Ø³Ù„ Ø¨Ø·Ø§Ù‚Ø© Ù‡Ø¯ÙŠØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¬Ù…ÙŠÙ„Ø©
                        </small>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #166534;">
                            Ø¨Ø±ÙŠØ¯Ù‡ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="email" id="recipientEmail" placeholder="example@email.com"
                               style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #166534;">
                            Ø¹Ù„Ø§Ù‚ØªÙƒ Ø¨Ø§Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="relationship" placeholder="ØµØ¯ÙŠÙ‚ØŒ Ø£Ø®ØŒ Ø²Ù…ÙŠÙ„ØŒ Ø§Ø¨Ù†..."
                               style="width: 100%; padding: 12px; border: 2px solid #BBF7D0; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ -->
                <div style="background: #FFF7ED; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #7C2D12; margin-bottom: 15px;">
                        <i class="fas fa-envelope-open-heart"></i> Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #9A3412; font-weight: bold;">
                            Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡ <span style="color: red;">*</span>
                        </label>
                        <textarea id="giftMessage" rows="4" 
                                  placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø¬Ù…ÙŠÙ„Ø© ØªØ¹Ø¨Ø± Ø¹Ù† Ù…Ø´Ø§Ø¹Ø±Ùƒ..."
                                  style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #9A3412;">
                            Ù…Ù†Ø§Ø³Ø¨Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="giftOccasion" placeholder="Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ØŒ Ù†Ø¬Ø§Ø­ØŒ ØªØ®Ø±Ø¬ØŒ Ø¨Ø¯ÙˆÙ† Ù…Ù†Ø§Ø³Ø¨Ø©..."
                               style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #9A3412; font-weight: bold;">
                            Ù…ØªÙ‰ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯ÙŠØ©ØŸ <span style="color: red;">*</span>
                        </label>
                        <div style="display: grid; gap: 10px;">
                            <label style="display: flex; align-items: center; padding: 12px; 
                                          background: white; border: 2px solid #FED7AA; 
                                          border-radius: 8px; cursor: pointer;">
                                <input type="radio" name="sendTime" value="now" checked
                                       style="margin-left: 10px;">
                                <span>ÙÙˆØ±Ø§Ù‹ Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹</span>
                            </label>
                            
                            <label style="display: flex; align-items: center; padding: 12px; 
                                          background: white; border: 2px solid #FED7AA; 
                                          border-radius: 8px; cursor: pointer;">
                                <input type="radio" name="sendTime" value="scheduled"
                                       style="margin-left: 10px;"
                                       onchange="document.getElementById('scheduleDateDiv').style.display = this.checked ? 'block' : 'none'">
                                <span>ÙÙŠ ØªØ§Ø±ÙŠØ® Ù…Ø­Ø¯Ø¯</span>
                            </label>
                        </div>
                        
                        <div id="scheduleDateDiv" style="display: none; margin-top: 10px;">
                            <input type="datetime-local" id="scheduleDate" 
                                   style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                          border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                </div>
                
                <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
                <div style="background: #FEF3C7; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #92400E; margin-bottom: 15px;">
                        <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ <span style="color: red;">*</span>
                    </h4>
                    
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="vodafone" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="instapay" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="bank" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="card" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†ÙƒÙŠØ©</strong>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ -->
                <div style="background: #EFF6FF; padding: 15px; border-radius: 10px; 
                            border-right: 3px solid #3B82F6;">
                    <p style="color: #1E40AF; margin: 0; text-align: center;">
                        <i class="fas fa-gift"></i>
                        Ø³Ù†Ø±Ø³Ù„ Ø¨Ø·Ø§Ù‚Ø© Ù‡Ø¯ÙŠØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø±Ø§Ø¦Ø¹Ø© Ù…Ø¹ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©
                    </p>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#EC4899',
        cancelButtonColor: '#6B7280',
        width: '850px',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
            document.getElementById('gifterName')?.focus();
        },
        preConfirm: () => {
            const gifterName = document.getElementById('gifterName').value.trim();
            const gifterWhatsapp = document.getElementById('gifterWhatsapp').value.trim();
            const recipientName = document.getElementById('recipientName').value.trim();
            const recipientWhatsapp = document.getElementById('recipientWhatsapp').value.trim();
            const giftMessage = document.getElementById('giftMessage').value.trim();
            const selectedPayments = document.querySelectorAll('input[name="paymentMethod"]:checked');
            
            if (!gifterName) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');
                return false;
            }
            
            if (!gifterWhatsapp) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨Ùƒ');
                return false;
            }
            
            if (!recipientName) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡');
                return false;
            }
            
            if (!recipientWhatsapp) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡');
                return false;
            }
            
            if (!giftMessage) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…ÙÙ‡Ø¯Ù‰ Ø¥Ù„ÙŠÙ‡');
                return false;
            }
            
            if (selectedPayments.length === 0) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return false;
            }
            
            return true;
        }
    }).then(async (result) => {
        if (result.isConfirmed) {
            // Ø¬Ù…Ø¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
            const selectedPayments = [];
            document.querySelectorAll('input[name="paymentMethod"]:checked').forEach(checkbox => {
                selectedPayments.push(checkbox.value);
            });
            
            // ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            const sendTime = document.querySelector('input[name="sendTime"]:checked').value;
            const scheduleDate = sendTime === 'scheduled' ? document.getElementById('scheduleDate').value : null;
            
            // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            existingData.giftInfo = {
                type: 'specific',
                gifter: {
                    name: document.getElementById('gifterName').value.trim(),
                    whatsapp: document.getElementById('gifterWhatsapp').value.trim(),
                    email: document.getElementById('gifterEmail').value.trim() || '',
                    revealName: document.getElementById('revealGifterName').checked
                },
                recipient: {
                    name: document.getElementById('recipientName').value.trim(),
                    whatsapp: document.getElementById('recipientWhatsapp').value.trim(),
                    email: document.getElementById('recipientEmail').value.trim() || '',
                    relationship: document.getElementById('relationship').value.trim() || ''
                },
                message: document.getElementById('giftMessage').value.trim(),
                occasion: document.getElementById('giftOccasion').value.trim() || '',
                sendTime: sendTime,
                scheduleDate: scheduleDate,
                paymentMethods: selectedPayments
            };
            
            if (!existingData.courseName) {
                existingData.courseName = courseName;
            }
            
            existingData.bookingType = 'gift_specific';
            existingData.bookingDate = new Date().toISOString();
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            await saveToFirebaseDirectly(existingData, proceedBtn);
            
        } else {
            const dataDisplayBox = document.getElementById('dataDisplayBox');
            if (dataDisplayBox) {
                dataDisplayBox.style.display = 'block';
            }
            
            if (proceedBtn) {
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'âœ… Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
            }
        }
    });
}
        // Ø¯Ø§Ù„Ø© Ø¥Ù‡Ø¯Ø§Ø¡ Ù„Ø´Ø®Øµ Ù…Ø³ØªØ­Ù‚ (Ù…Ø¬Ù‡ÙˆÙ„)
function showAnonymousGiftForm(existingData, proceedBtn) {
    const courseName = existingData.courseName || getCurrentCourseName();
    const finalPrice = existingData.pricing?.finalPrice || '0';
    
    Swal.fire({
        title: 'ğŸ’ Ø¥Ù‡Ø¯Ø§Ø¡ Ø±Ø­Ù„Ø© Ù„Ø´Ø®Øµ ÙŠØ³ØªØ­Ù‚',
        html: `
            <div style="text-align: right; direction: rtl; max-height: 500px; overflow-y: auto;">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© -->
                <div style="background: linear-gradient(135deg, #22C55E, #14B8A6); 
                            padding: 15px; border-radius: 10px; margin-bottom: 20px; color: white;">
                    <h4 style="margin: 0;">
                        <i class="fas fa-heart"></i> ${courseName}
                    </h4>
                    <p style="margin: 10px 0 5px 0;">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‡Ø¯ÙŠØ©: <strong style="font-size: 1.3rem;">${finalPrice}</strong></p>
                </div>
                
                <!-- Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ± -->
                <div style="background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(20,184,166,0.1)); 
                            padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                    <i class="fas fa-hands-helping" style="font-size: 3rem; color: #22C55E; margin-bottom: 10px;"></i>
                    <h3 style="color: #065F46; margin-bottom: 10px;">Ø£Ù†Øª ØªØµÙ†Ø¹ Ø§Ù„ÙØ±Ù‚!</h3>
                    <p style="color: #047857; margin: 0;">
                        Ø³Ù†Ø®ØªØ§Ø± Ø£Ø­Ø¯ Ø§Ù„Ù…Ø­ØªØ§Ø¬ÙŠÙ† Ù…Ù† Ù…Ø¬ØªÙ…Ø¹Ù†Ø§ ÙˆÙ†Ø±Ø³Ù„ Ù„Ùƒ ØªÙ‚Ø±ÙŠØ± Ø¹Ù† Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ ÙˆØ£Ø«Ø± Ù‡Ø¯ÙŠØªÙƒ Ø§Ù„ÙƒØ±ÙŠÙ…Ø©
                    </p>
                </div>
                
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‡Ø¯ÙŠ -->
                <div style="background: #F9FAFB; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #1F2937; margin-bottom: 15px;">
                        <i class="fas fa-user-heart"></i> Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„ÙƒØ±ÙŠÙ…Ø©
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="donorName" placeholder="Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨Ùƒ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="donorWhatsapp" placeholder="Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                        <small style="color: #6B7280; display: block; margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ ØªÙ‚Ø±ÙŠØ± Ø¨ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ ÙˆØ´ÙƒØ±Ù‡ Ø§Ù„Ø®Ø§Øµ
                        </small>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="email" id="donorEmail" placeholder="example@email.com"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ù„Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="donorCountry" placeholder="Ø¨Ù„Ø¯Ùƒ"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="donorCity" placeholder="Ù…Ø¯ÙŠÙ†ØªÙƒ"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 15px; padding: 15px; background: #F0FDF4; border-radius: 8px;">
                        <label style="display: flex; align-items: center; cursor: pointer; color: #065F46;">
                            <input type="checkbox" id="remainAnonymous" checked
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <span><strong>Ø£Ø±ÙŠØ¯ Ø£Ù† ØªØ¨Ù‚Ù‰ Ù‡Ø¯ÙŠØªÙŠ Ù…Ø¬Ù‡ÙˆÙ„Ø© Ù„Ù„Ù…Ø³ØªÙÙŠØ¯</strong></span>
                        </label>
                        <small style="color: #047857; display: block; margin-top: 5px; margin-right: 28px;">
                            Ø³ÙŠØ¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø£Ù†Ù‡Ø§ "Ù‡Ø¯ÙŠØ© Ù…Ù† Ù…Ø­Ø¨ Ù„Ù„Ø®ÙŠØ±" ÙÙ‚Ø·
                        </small>
                    </div>
                </div>
                
                <!-- ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ -->
                <div style="background: #F3E8FF; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #581C87; margin-bottom: 15px;">
                        <i class="fas fa-hand-holding-heart"></i> ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #6B21A8;">
                            Ù‡Ù„ Ù„Ø¯ÙŠÙƒ ØªÙØ¶ÙŠÙ„ Ù…Ø¹ÙŠÙ† Ù„Ù„Ù…Ø³ØªÙÙŠØ¯ØŸ
                        </label>
                        <textarea id="recipientPreference" rows="3" 
                                  placeholder="Ù…Ø«Ø§Ù„: Ø£ÙØ¶Ù„ Ø·Ø§Ù„Ø¨ Ø¬Ø§Ù…Ø¹ÙŠØŒ Ø£Ù… Ø¹Ø²Ø¨Ø§Ø¡ØŒ Ø´Ø§Ø¨ ÙŠØ¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„..."
                                  style="width: 100%; padding: 12px; border: 2px solid #E9D5FF; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #6B21A8;">
                            Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªÙÙŠØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="messageToRecipient" rows="3" 
                                  placeholder="Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø£Ùˆ Ø¯Ø¹Ø§Ø¡..."
                                  style="width: 100%; padding: 12px; border: 2px solid #E9D5FF; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <p style="color: #6B21A8; margin: 0;">
                            <i class="fas fa-info-circle"></i>
                            Ø³Ù†Ø®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø¨Ø¹Ù†Ø§ÙŠØ© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙ†Ø§ Ù„Ù„Ù…Ø­ØªØ§Ø¬ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
                        </p>
                    </div>
                </div>
                
                <!-- Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡ -->
                <div style="background: #FFF7ED; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #7C2D12; margin-bottom: 15px;">
                        <i class="fas fa-heart"></i> Ø¯Ø§ÙØ¹Ùƒ Ù„Ù„Ø¥Ù‡Ø¯Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #9A3412;">
                            Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø¯ÙØ¹Ùƒ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø®ÙŠØ±ÙŠØŸ
                        </label>
                        <textarea id="donationReason" rows="3" 
                                  placeholder="ØµØ¯Ù‚Ø©ØŒ Ø²ÙƒØ§Ø©ØŒ Ø´ÙƒØ± Ù„Ù„Ù‡ØŒ Ø°ÙƒØ±Ù‰ Ø¹Ø²ÙŠØ²..."
                                  style="width: 100%; padding: 12px; border: 2px solid #FED7AA; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; cursor: pointer; color: #9A3412;">
                            <input type="checkbox" id="shareStory"
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <span>Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ù‚ØµØªÙŠ (Ø¨Ø¯ÙˆÙ† Ø°ÙƒØ± Ø§Ù„Ø§Ø³Ù…) Ù„Ø¥Ù„Ù‡Ø§Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</span>
                        </label>
                    </div>
                </div>
                
                <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
                <div style="background: #FEF3C7; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #92400E; margin-bottom: 15px;">
                        <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ <span style="color: red;">*</span>
                    </h4>
                    
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="vodafone" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="instapay" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="bank" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="card" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†ÙƒÙŠØ©</strong>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ -->
                <div style="background: #DCFCE7; padding: 15px; border-radius: 10px; 
                            border-right: 3px solid #22C55E;">
                    <p style="color: #14532D; margin: 0; text-align: center;">
                        <i class="fas fa-certificate"></i>
                        Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© Ø´ÙƒØ± ÙˆØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ø¹Ù† Ø§Ù„Ù…Ø³ØªÙÙŠØ¯
                    </p>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„ÙƒØ±ÙŠÙ…Ø©',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#22C55E',
        cancelButtonColor: '#6B7280',
        width: '850px',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
            document.getElementById('donorName')?.focus();
        },
        preConfirm: () => {
            const donorName = document.getElementById('donorName').value.trim();
            const donorWhatsapp = document.getElementById('donorWhatsapp').value.trim();
            const selectedPayments = document.querySelectorAll('input[name="paymentMethod"]:checked');
            
            if (!donorName) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');
                return false;
            }
            
            if (!donorWhatsapp) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨Ùƒ');
                return false;
            }
            
            if (selectedPayments.length === 0) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return false;
            }
            
            return true;
        }
    }).then(async (result) => {
        if (result.isConfirmed) {
            // Ø¬Ù…Ø¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
            const selectedPayments = [];
            document.querySelectorAll('input[name="paymentMethod"]:checked').forEach(checkbox => {
                selectedPayments.push(checkbox.value);
            });
            
            // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            existingData.giftInfo = {
                type: 'anonymous',
                donor: {
                    name: document.getElementById('donorName').value.trim(),
                    whatsapp: document.getElementById('donorWhatsapp').value.trim(),
                    email: document.getElementById('donorEmail').value.trim() || '',
                    country: document.getElementById('donorCountry').value.trim() || '',
                    city: document.getElementById('donorCity').value.trim() || '',
                    remainAnonymous: document.getElementById('remainAnonymous').checked
                },
                recipientPreference: document.getElementById('recipientPreference').value.trim() || '',
                messageToRecipient: document.getElementById('messageToRecipient').value.trim() || '',
                donationReason: document.getElementById('donationReason').value.trim() || '',
                shareStory: document.getElementById('shareStory').checked,
                paymentMethods: selectedPayments,
                recipientStatus: 'Ø³ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ù…Ù† Ø§Ù„Ù…Ø­ØªØ§Ø¬ÙŠÙ†'
            };
            
            if (!existingData.courseName) {
                existingData.courseName = courseName;
            }
            
            existingData.bookingType = 'gift_anonymous';
            existingData.bookingDate = new Date().toISOString();
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            await saveToFirebaseDirectly(existingData, proceedBtn);
            
        } else {
            const dataDisplayBox = document.getElementById('dataDisplayBox');
            if (dataDisplayBox) {
                dataDisplayBox.style.display = 'block';
            }
            
            if (proceedBtn) {
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'âœ… Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
            }
        }
    });
}

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙÙŠ Firebase
async function saveToFirebaseDirectly(data, proceedBtn) {
    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø±
    Swal.fire({
        title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...',
        html: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
    
    try {
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
        data.bookingId = 'BK_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        data.timestamp = new Date().toISOString();
        data.status = 'pending';
        
        console.log('ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', data);
        
        // Ø­ÙØ¸ ÙÙŠ Firebase
        const docRef = await db.collection('tempBookings').add(data);
        console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø§Ù„Ù…Ø¹Ø±Ù:', docRef.id);
        
        // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù…Ø¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
await Swal.fire({
    icon: 'success',
    title: 'ğŸ‰ ØªÙ… Ø­Ø¬Ø² Ù…Ù‚Ø¹Ø¯Ùƒ Ø¨Ù†Ø¬Ø§Ø­!',
    html: `
        <div style="text-align: center;">
            <div style="background: linear-gradient(135deg, #D1FAE5, #DBEAFE); 
                        padding: 20px; border-radius: 15px; margin: 20px 0;">
                <p style="color: #065F46; font-size: 1.2rem; margin: 10px 0;">
                    <strong>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²:</strong> 
                    <span style="color: #22C55E; font-size: 1.3rem;">
                        #${docRef.id.slice(-8).toUpperCase()}
                    </span>
                </p>
                <p style="color: #374151; margin: 10px 0;">
                    ØªÙ… Ø­ÙØ¸ ÙƒØ§ÙØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹
                </p>
            </div>
            
            <div style="background: #FEF2F2; padding: 15px; border-radius: 10px; 
                        margin: 20px 0; border-right: 3px solid #E11D48;">
                <p style="color: #991B1B; margin: 0;">
                    <i class="fas fa-info-circle"></i>
                    Ø§Ø­ØªÙØ¸ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø² Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                </p>
            </div>
            
            <p style="color: #64748b; margin-top: 20px;">
                Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†ØŸ
            </p>
        </div>
    `,
    showCancelButton: true,
    confirmButtonText: 'ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø©',
    cancelButtonText: 'ğŸ“š ØªØµÙØ­ Ø¯ÙˆØ±Ø§Øª Ø£Ø®Ø±Ù‰',
    confirmButtonColor: '#3B82F6',
    cancelButtonColor: '#9333EA',
    width: '600px',
    allowOutsideClick: false,
    allowEscapeKey: false
}).then((result) => {
    if (result.isConfirmed) {
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø©
        const courseName = window.courseName || 'Ø§Ù„Ø¯ÙˆØ±Ø©';
        const courseUrl = `course-discover.html?course=${courseName}`;
        window.location.href = courseUrl;
    } else if (result.dismiss === Swal.DismissReason.cancel) {
        // Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª
        window.location.href = 'master.html';
    }
});
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', error);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        Swal.fire({
            icon: 'error',
            title: 'Ø®Ø·Ø£!',
            text: 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.',
            confirmButtonColor: '#E11D48'
        });
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙˆÙ„
        const dataDisplayBox = document.getElementById('dataDisplayBox');
        if (dataDisplayBox) {
            dataDisplayBox.style.display = 'block';
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
        if (proceedBtn) {
            proceedBtn.disabled = false;
            proceedBtn.textContent = 'âœ… Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
        }
    }
}

        
        // Ø¯Ø§Ù„Ø© Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ø§Ù„ÙØ±Ø¯ÙŠ
// Ø¯Ø§Ù„Ø© Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ø§Ù„ÙØ±Ø¯ÙŠ
function showIndividualDataForm(existingData, proceedBtn) {
    const courseName = existingData.courseName || getCurrentCourseName();
    const finalPrice = existingData.pricing?.finalPrice || '0';
    
    Swal.fire({
        title: 'ğŸ“‹ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­Ø¬Ø² Ø§Ù„ÙØ±Ø¯ÙŠ',
        html: `
            <div style="text-align: right; direction: rtl; max-height: 500px; overflow-y: auto;">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© -->
                <div style="background: linear-gradient(135deg, #3B82F6, #1E40AF); 
                            padding: 15px; border-radius: 10px; margin-bottom: 20px; color: white;">
                    <h4 style="margin: 0;">
                        <i class="fas fa-book"></i> ${courseName}
                    </h4>
                    <p style="margin: 10px 0 5px 0;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <strong style="font-size: 1.3rem;">${finalPrice}</strong></p>
                </div>
                
                <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© -->
                <div style="background: #F9FAFB; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #1F2937; margin-bottom: 15px;">
                        <i class="fas fa-user"></i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                    </h4>
                    
                    <!-- Ø§Ù„Ø§Ø³Ù… -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="customerName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ ÙƒÙ…Ø§ ØªØ­Ø¨ Ø£Ù† Ù†Ù†Ø§Ø¯ÙŠÙƒ"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="customerWhatsapp" placeholder="Ù…Ø«Ø§Ù„: 01234567890 Ø£Ùˆ +201234567890"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                        <small style="color: #6B7280; display: block; margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
                        </small>
                    </div>
                    
                    <!-- Ø§Ù„Ù„Ù‚Ø¨ Ø§Ù„Ù…ÙØ¶Ù„ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ù„Ù‚Ø¨ Ø§Ù„Ù…ÙØ¶Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="customerTitle" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø³ØªØ§Ø°ØŒ Ù…Ù‡Ù†Ø¯Ø³ØŒ Ø¯ÙƒØªÙˆØ±..."
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø§Ù„Ø¹Ù…Ø± -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¹Ù…Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="number" id="customerAge" placeholder="Ø¹Ù…Ø±Ùƒ Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª"
                               min="10" max="100"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø§Ù„Ø¨Ù„Ø¯ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ù„Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="customerCountry" placeholder="Ù…Ø«Ø§Ù„: Ù…ØµØ±ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŒ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª..."
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="customerCity" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="email" id="customerEmail" placeholder="example@email.com"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <!-- Ø§Ù„ÙˆØ¸ÙŠÙØ©/Ø§Ù„Ø¯Ø±Ø§Ø³Ø© -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„ÙˆØ¸ÙŠÙØ©/Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="customerJob" placeholder="Ù…Ø§Ø°Ø§ ØªØ¹Ù…Ù„ Ø£Ùˆ ØªØ¯Ø±Ø³ØŸ"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- ÙƒÙŠÙ Ø¹Ø±ÙØª Ø¹Ù†Ø§ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            ÙƒÙŠÙ Ø¹Ø±ÙØª Ø¹Ù† Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="customerSource" placeholder="ÙÙŠØ³Ø¨ÙˆÙƒØŒ ØµØ¯ÙŠÙ‚ØŒ ÙŠÙˆØªÙŠÙˆØ¨..."
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <!-- Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
                <div style="background: #F0FDF4; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #065F46; margin-bottom: 15px;">
                        <i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                    </h4>
                    
                    <!-- Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #047857;">
                            Ù…Ø§ ØªÙˆÙ‚Ø¹Ø§ØªÙƒ Ù…Ù† Ø§Ù„Ø¯ÙˆØ±Ø©ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="customerExpectations" rows="3" 
                                  placeholder="Ø´Ø§Ø±ÙƒÙ†Ø§ ØªÙˆÙ‚Ø¹Ø§ØªÙƒ ÙˆÙ…Ø§ ØªØ±ÙŠØ¯ ØªØ­Ù‚ÙŠÙ‚Ù‡..."
                                  style="width: 100%; padding: 12px; border: 2px solid #D1FAE5; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                    
                    <!-- Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #047857;">
                            Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø®Ø¨Ø±Ø© Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="customerExperience" placeholder="Ù„Ø§ ÙŠÙˆØ¬Ø¯ØŒ Ù…Ø¨ØªØ¯Ø¦ØŒ Ù…ØªÙˆØ³Ø·ØŒ Ù…ØªÙ‚Ø¯Ù…..."
                               style="width: 100%; padding: 12px; border: 2px solid #D1FAE5; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #047857;">
                            ÙƒÙŠÙ ØªØ®Ø·Ø· Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø§ Ø³ØªØªØ¹Ù„Ù…Ù‡ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="customerApplication" rows="3" 
                                  placeholder="Ø®Ø·Ø·Ùƒ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø§ Ø³ØªØªØ¹Ù„Ù…Ù‡..."
                                  style="width: 100%; padding: 12px; border: 2px solid #D1FAE5; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                    
                    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #047857;">
                            Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="customerNotes" rows="2" 
                                  placeholder="Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø± ØªÙˆØ¯ Ø¥Ø®Ø¨Ø§Ø±Ù†Ø§ Ø¨Ù‡..."
                                  style="width: 100%; padding: 12px; border: 2px solid #D1FAE5; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                </div>
                
                <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
                <div style="background: #FEF3C7; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #92400E; margin-bottom: 15px;">
                        <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ <span style="color: red;">*</span>
                    </h4>
                    <p style="color: #78350F; margin-bottom: 15px; font-size: 0.9rem;">
                        ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ Ù…ØªØ§Ø­Ø© Ù„Ø¯ÙŠÙƒ
                    </p>
                    
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="vodafone" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</strong>
                                <span style="color: #6B7280; margin-right: 10px;">01224938330</span>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="instapay" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</strong>
                                <span style="color: #6B7280; margin-right: 10px;">ØªØ­ÙˆÙŠÙ„ ÙÙˆØ±ÙŠ</span>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="bank" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</strong>
                                <span style="color: #6B7280; margin-right: 10px;">CIB - QNB</span>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="card" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†ÙƒÙŠØ©</strong>
                                <span style="color: #6B7280; margin-right: 10px;">Visa/MasterCard</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Ø±Ø³Ø§Ù„Ø© Ø£Ù…Ø§Ù† -->
                <div style="background: #EFF6FF; padding: 15px; border-radius: 10px; 
                            border-right: 3px solid #3B82F6;">
                    <p style="color: #1E40AF; margin: 0; text-align: center;">
                        <i class="fas fa-lock"></i>
                        Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¢Ù…Ù†Ø© ÙˆÙ…Ø­Ù…ÙŠØ© ÙˆÙ„Ù† ØªÙØ´Ø§Ø±Ùƒ Ù…Ø¹ Ø£ÙŠ Ø¬Ù‡Ø© Ø®Ø§Ø±Ø¬ÙŠØ©
                    </p>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#22C55E',
        cancelButtonColor: '#6B7280',
        width: '800px',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø­Ù‚Ù„
            document.getElementById('customerName')?.focus();
        },
        preConfirm: () => {
            const name = document.getElementById('customerName').value.trim();
            const whatsapp = document.getElementById('customerWhatsapp').value.trim();
            const selectedPayments = document.querySelectorAll('input[name="paymentMethod"]:checked');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙ‚Ø·
            if (!name) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');
                return false;
            }
            
            if (!whatsapp) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨');
                return false;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø±Ù† Ø¬Ø¯Ø§Ù‹)
            const phoneRegex = /^(\+?\d{1,4}[\s-]?)?(\(?\d{1,4}\)?[\s-]?)?\d{6,14}$/;
            const cleanPhone = whatsapp.replace(/[\s\-\(\)]/g, '');
            
            if (!phoneRegex.test(cleanPhone)) {
                Swal.showValidationMessage('Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­');
                return false;
            }
            
            if (selectedPayments.length === 0) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return false;
            }
            
            return true;
        }
    }).then(async (result) => {
        if (result.isConfirmed) {
            // Ø¬Ù…Ø¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            const selectedPayments = [];
            document.querySelectorAll('input[name="paymentMethod"]:checked').forEach(checkbox => {
                selectedPayments.push(checkbox.value);
            });
            
            // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            existingData.customer = {
                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                name: document.getElementById('customerName').value.trim(),
                whatsapp: document.getElementById('customerWhatsapp').value.trim(),
                
                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©
                title: document.getElementById('customerTitle').value.trim() || '',
                age: document.getElementById('customerAge').value || '',
                country: document.getElementById('customerCountry').value.trim() || '',
                city: document.getElementById('customerCity').value.trim() || '',
                email: document.getElementById('customerEmail').value.trim() || '',
                job: document.getElementById('customerJob').value.trim() || '',
                source: document.getElementById('customerSource').value.trim() || '',
                
                // Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                expectations: document.getElementById('customerExpectations').value.trim() || '',
                experience: document.getElementById('customerExperience').value.trim() || '',
                applicationPlan: document.getElementById('customerApplication').value.trim() || '',
                notes: document.getElementById('customerNotes').value.trim() || '',
                
                // Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
                paymentMethods: selectedPayments
            };
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©
            if (!existingData.courseName) {
                existingData.courseName = courseName;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø²
            existingData.bookingType = 'individual';
            existingData.bookingDate = new Date().toISOString();
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            await saveToFirebaseDirectly(existingData, proceedBtn);
            
        } else {
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙˆÙ„
            const dataDisplayBox = document.getElementById('dataDisplayBox');
            if (dataDisplayBox) {
                dataDisplayBox.style.display = 'block';
            }
            
            if (proceedBtn) {
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'âœ… Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
            }
        }
    });
}

// Ø¯Ø§Ù„Ø© Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
// Ø¯Ø§Ù„Ø© Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
function showGroupDataForm(existingData, proceedBtn) {
    const courseName = existingData.courseName || getCurrentCourseName();
    const finalPrice = existingData.pricing?.finalPrice || '0';
    const groupDiscount = existingData.discounts?.find(d => d.type === 'group')?.label || 'Ø®ØµÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©';
    
    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯
    window.addMemberRow = function() {
        const container = document.getElementById('membersContainer');
        const newRow = document.createElement('div');
        newRow.className = 'member-row';
        newRow.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
        
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.className = 'member-name';
        nameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ';
        nameInput.style.cssText = 'flex: 1; padding: 10px; border: 2px solid #E9D5FF; border-radius: 8px;';
        
        const phoneInput = document.createElement('input');
        phoneInput.type = 'text';
        phoneInput.className = 'member-phone';
        phoneInput.placeholder = 'Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)';
        phoneInput.style.cssText = 'flex: 1; padding: 10px; border: 2px solid #E9D5FF; border-radius: 8px; direction: ltr;';
        
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.innerHTML = '<i class="fas fa-times"></i>';
        removeBtn.style.cssText = 'background: #EF4444; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer;';
        removeBtn.onclick = function() { newRow.remove(); };
        
        newRow.appendChild(nameInput);
        newRow.appendChild(phoneInput);
        newRow.appendChild(removeBtn);
        container.appendChild(newRow);
    };
    
    Swal.fire({
        title: 'ğŸ‘¥ Ø­Ø¬Ø² Ø¬Ù…Ø§Ø¹ÙŠ',
        html: `
            <div style="text-align: right; direction: rtl; max-height: 500px; overflow-y: auto;">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© -->
                <div style="background: linear-gradient(135deg, #9333EA, #EC4899); 
                            padding: 15px; border-radius: 10px; margin-bottom: 20px; color: white;">
                    <h4 style="margin: 0;">
                        <i class="fas fa-book"></i> ${courseName}
                    </h4>
                    <p style="margin: 10px 0 5px 0;">
                        ${groupDiscount} | Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ÙØ±Ø¯: <strong style="font-size: 1.3rem;">${finalPrice}</strong>
                    </p>
                </div>
                
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© -->
                <div style="background: #F9FAFB; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #1F2937; margin-bottom: 15px;">
                        <i class="fas fa-user-tie"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                    </h4>
                    
                    <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø³Ù‚ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø§Ø³Ù… Ù…Ù†Ø³Ù‚ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="coordinatorName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø³Ù‚ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151; font-weight: bold;">
                            Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø³Ù‚ <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="coordinatorWhatsapp" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                        <small style="color: #6B7280; display: block; margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> Ø§Ù„Ù…Ù†Ø³Ù‚ Ø³ÙŠÙƒÙˆÙ† Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
                        </small>
                    </div>
                    
                    <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="email" id="coordinatorEmail" placeholder="example@email.com"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem; direction: ltr;">
                    </div>
                    
                    <!-- Ø§Ù„Ø¨Ù„Ø¯ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ø¨Ù„Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="coordinatorCountry" placeholder="Ø§Ù„Ø¨Ù„Ø¯"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #374151;">
                            Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="coordinatorCity" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©"
                               style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                </div>
                
                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© -->
                <div style="background: #F3E8FF; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #581C87; margin-bottom: 15px;">
                        <i class="fas fa-users"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                    </h4>
                    
                    <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #6B21A8; font-weight: bold;">
                            Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© <span style="color: red;">*</span>
                        </label>
                        <input type="text" id="groupName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ØŒ ÙØ±ÙŠÙ‚ Ø§Ù„Ø´Ø±ÙƒØ©..."
                               style="width: 100%; padding: 12px; border: 2px solid #E9D5FF; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #6B21A8; font-weight: bold;">
                            Ø¹Ø¯Ø¯ Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© <span style="color: red;">*</span>
                        </label>
                        <input type="number" id="groupSize" min="2" placeholder="Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø£ÙØ±Ø§Ø¯"
                               style="width: 100%; padding: 12px; border: 2px solid #E9D5FF; 
                                      border-radius: 8px; font-size: 1rem;">
                        <small style="color: #6B7280; display: block; margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> ÙŠØ´Ù…Ù„ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø³Ù‚ Ø£ÙŠØ¶Ø§Ù‹
                        </small>
                    </div>
                    
                    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #6B21A8;">
                            Ø£Ø³Ù…Ø§Ø¡ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <div id="membersContainer" style="margin-bottom: 10px;">
                            <div class="member-row" style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="text" class="member-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ"
                                       style="flex: 1; padding: 10px; border: 2px solid #E9D5FF; 
                                              border-radius: 8px;">
                                <input type="text" class="member-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                                       style="flex: 1; padding: 10px; border: 2px solid #E9D5FF; 
                                              border-radius: 8px; direction: ltr;">
                            </div>
                        </div>
                        <button type="button" onclick="addMemberRow()" 
                                style="background: #9333EA; color: white; border: none; 
                                       padding: 8px 15px; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¢Ø®Ø±
                        </button>
                    </div>
                    
                    <!-- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #6B21A8;">
                            Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="groupType" placeholder="Ø¹Ø§Ø¦Ù„Ø©ØŒ Ø£ØµØ¯Ù‚Ø§Ø¡ØŒ Ø²Ù…Ù„Ø§Ø¡ Ø¹Ù…Ù„ØŒ Ø·Ù„Ø§Ø¨..."
                               style="width: 100%; padding: 12px; border: 2px solid #E9D5FF; 
                                      border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #6B21A8;">
                            Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="groupNotes" rows="3" 
                                  placeholder="Ø£ÙŠ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©..."
                                  style="width: 100%; padding: 12px; border: 2px solid #E9D5FF; 
                                         border-radius: 8px; font-size: 1rem; resize: none;"></textarea>
                    </div>
                </div>
                
                <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
                <div style="background: #FEF3C7; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="color: #92400E; margin-bottom: 15px;">
                        <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ <span style="color: red;">*</span>
                    </h4>
                    <p style="color: #78350F; margin-bottom: 15px; font-size: 0.9rem;">
                        ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ø±ÙŠÙ‚Ø© Ù„Ù„Ø¯ÙØ¹
                    </p>
                    
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="vodafone" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="instapay" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="bank" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</strong>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 12px; 
                                      background: white; border: 2px solid #E5E7EB; 
                                      border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="paymentMethod" value="card" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <div style="flex: 1;">
                                <strong>Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†ÙƒÙŠØ©</strong>
                            </div>
                        </label>
                    </div>
                    
                    <!-- Ø®ÙŠØ§Ø± ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¯ÙØ¹ -->
                    <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 8px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="splitPayment" 
                                   style="margin-left: 10px; width: 18px; height: 18px;">
                            <span>ÙƒÙ„ Ø¹Ø¶Ùˆ Ø³ÙŠØ¯ÙØ¹ Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„</span>
                        </label>
                    </div>
                </div>
                
                <!-- Ø±Ø³Ø§Ù„Ø© Ø£Ù…Ø§Ù† -->
                <div style="background: #EFF6FF; padding: 15px; border-radius: 10px; 
                            border-right: 3px solid #3B82F6;">
                    <p style="color: #1E40AF; margin: 0; text-align: center;">
                        <i class="fas fa-shield-alt"></i>
                        Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„Ù„ØªØ£ÙƒÙŠØ¯
                    </p>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø² Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
        cancelButtonText: 'Ø±Ø¬ÙˆØ¹',
        confirmButtonColor: '#9333EA',
        cancelButtonColor: '#6B7280',
        width: '850px',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
            document.getElementById('coordinatorName')?.focus();
        },
        preConfirm: () => {
            const coordinatorName = document.getElementById('coordinatorName').value.trim();
            const coordinatorWhatsapp = document.getElementById('coordinatorWhatsapp').value.trim();
            const groupName = document.getElementById('groupName').value.trim();
            const groupSize = document.getElementById('groupSize').value;
            const selectedPayments = document.querySelectorAll('input[name="paymentMethod"]:checked');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (!coordinatorName) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ù†Ø³Ù‚ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©');
                return false;
            }
            
            if (!coordinatorWhatsapp) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø³Ù‚');
                return false;
            }
            
            if (!groupName) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©');
                return false;
            }
            
            if (!groupSize || groupSize < 2) {
                Swal.showValidationMessage('Ø¹Ø¯Ø¯ Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 2 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return false;
            }
            
            if (selectedPayments.length === 0) {
                Swal.showValidationMessage('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return false;
            }
            
            return true;
        }
    }).then(async (result) => {
        if (result.isConfirmed) {
            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
            const members = [];
            document.querySelectorAll('.member-row').forEach(row => {
                const name = row.querySelector('.member-name')?.value.trim();
                const phone = row.querySelector('.member-phone')?.value.trim();
                if (name) {
                    members.push({ name, phone });
                }
            });
            
            // Ø¬Ù…Ø¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
            const selectedPayments = [];
            document.querySelectorAll('input[name="paymentMethod"]:checked').forEach(checkbox => {
                selectedPayments.push(checkbox.value);
            });
            
            // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            existingData.groupInfo = {
                coordinator: {
                    name: document.getElementById('coordinatorName').value.trim(),
                    whatsapp: document.getElementById('coordinatorWhatsapp').value.trim(),
                    email: document.getElementById('coordinatorEmail').value.trim() || '',
                    country: document.getElementById('coordinatorCountry').value.trim() || '',
                    city: document.getElementById('coordinatorCity').value.trim() || ''
                },
                group: {
                    name: document.getElementById('groupName').value.trim(),
                    size: document.getElementById('groupSize').value,
                    type: document.getElementById('groupType').value.trim() || '',
                    members: members,
                    notes: document.getElementById('groupNotes').value.trim() || '',
                    splitPayment: document.getElementById('splitPayment').checked
                },
                paymentMethods: selectedPayments
            };
            
            if (!existingData.courseName) {
                existingData.courseName = courseName;
            }
            
            existingData.bookingType = 'group';
            existingData.bookingDate = new Date().toISOString();
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            await saveToFirebaseDirectly(existingData, proceedBtn);
            
        } else {
            const dataDisplayBox = document.getElementById('dataDisplayBox');
            if (dataDisplayBox) {
                dataDisplayBox.style.display = 'block';
            }
            
            if (proceedBtn) {
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'âœ… Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
            }
        }
    });
}
        function getCurrentCourseName() {
    // Ù…Ø­Ø§ÙˆÙ„Ø© 1: Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
    if (window.courseName) {
        return window.courseName;
    }
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© 2: Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø©
    if (window.currentCourseData && window.currentCourseData.title) {
        return window.currentCourseData.title;
    }
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© 3: Ù…Ù† Firebase Ù…Ø¨Ø§Ø´Ø±Ø©
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('course');
    if (courseId && window.db) {
        // Ø³Ù†Ø­Ø§ÙˆÙ„ Ø¬Ù„Ø¨Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
        console.log('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©...');
    }
    
    // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    return 'Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©';
}
        
    </script>
</body>
</html>
