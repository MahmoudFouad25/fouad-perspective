<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯">
    <meta name="keywords" content="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†, Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯, Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…">
    <meta name="author" content="Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯">
    
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ - Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/MahmoudFouad25/fouad-perspective/main/media/images/favicon.png">
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts - Noto Kufi Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- SweetAlert2 Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Sortable.js Ù„Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    
    <!-- Chart.js Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <style>
        /* ==================== Ù…ØªØºÙŠØ±Ø§Øª CSS Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==================== */
        :root {
            /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
            --primary: #f4c430;
            --primary-dark: #e6b429;
            --primary-light: #ffd54f;
            --primary-rgb: 244, 196, 48;
            
            --secondary: #2196f3;
            --secondary-dark: #1976d2;
            --secondary-light: #64b5f6;
            --secondary-rgb: 33, 150, 243;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª */
            --success: #4caf50;
            --success-dark: #388e3c;
            --success-light: #81c784;
            
            --danger: #f44336;
            --danger-dark: #d32f2f;
            --danger-light: #ef5350;
            
            --warning: #ff9800;
            --warning-dark: #f57c00;
            --warning-light: #ffb74d;
            
            --info: #00bcd4;
            --info-dark: #0097a7;
            --info-light: #4dd0e1;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ§Øª */
            --dark: #1a1a1a;
            --darker: #0f0f0f;
            --light: #2a2a2a;
            --lighter: #3a3a3a;
            --lightest: #4a4a4a;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†ØµÙˆØµ */
            --text: #e0e0e0;
            --text-muted: #999;
            --text-light: #bbb;
            --text-dark: #666;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø¥Ø¶Ø§ÙÙŠØ© */
            --border: rgba(255, 255, 255, 0.1);
            --border-light: rgba(255, 255, 255, 0.2);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.3);
            
            /* Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª */
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            /* Ø§Ù„Ø­Ø±ÙƒØ§Øª */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease-in-out;
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ· */
            --font-xs: 0.75rem;
            --font-sm: 0.875rem;
            --font-base: 1rem;
            --font-lg: 1.125rem;
            --font-xl: 1.25rem;
            --font-2xl: 1.5rem;
            --font-3xl: 1.875rem;
            --font-4xl: 2.25rem;
            
            /* Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --spacing-3xl: 4rem;
            
            /* Z-Index */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
        }
        
        /* ==================== Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø© ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Kufi Arabic', sans-serif;
            background: var(--darker);
            color: var(--text);
            line-height: 1.6;
            font-size: var(--font-base);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
        ::selection {
            background: var(--primary);
            color: var(--dark);
        }
        
        /* Scrollbar Ù…Ø®ØµØµ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--dark);
            border-radius: var(--radius-sm);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--lighter);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        /* Firefox Scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--lighter) var(--dark);
        }
        
        /* ==================== Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==================== */
        
        /* Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
        a {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }
        
        a:hover {
            color: var(--primary-light);
        }
        
        /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: var(--spacing-md);
        }
        
        h1 { font-size: var(--font-4xl); }
        h2 { font-size: var(--font-3xl); }
        h3 { font-size: var(--font-2xl); }
        h4 { font-size: var(--font-xl); }
        h5 { font-size: var(--font-lg); }
        h6 { font-size: var(--font-base); }
        
        /* Ø§Ù„ÙÙ‚Ø±Ø§Øª */
        p {
            margin-bottom: var(--spacing-md);
        }
        
        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        ul, ol {
            margin-bottom: var(--spacing-md);
            padding-right: var(--spacing-xl);
        }
        
        /* Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        :focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* Ø¥Ø®ÙØ§Ø¡ outline Ù„Ù„Ù…Ø§ÙˆØ³ØŒ Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ù„Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ */
        :focus:not(:focus-visible) {
            outline: none;
        }
        
        /* ==================== ÙØ¦Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==================== */
        
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .hidden { display: none !important; }
        .invisible { visibility: hidden !important; }
        
        /* Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© */
        .text-center { text-align: center !important; }
        .text-right { text-align: right !important; }
        .text-left { text-align: left !important; }
        
        /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        .text-primary { color: var(--primary) !important; }
        .text-secondary { color: var(--secondary) !important; }
        .text-success { color: var(--success) !important; }
        .text-danger { color: var(--danger) !important; }
        .text-warning { color: var(--warning) !important; }
        .text-info { color: var(--info) !important; }
        .text-muted { color: var(--text-muted) !important; }
        
        /* Ø§Ù„Ø®Ù„ÙÙŠØ§Øª */
        .bg-primary { background-color: var(--primary) !important; }
        .bg-secondary { background-color: var(--secondary) !important; }
        .bg-success { background-color: var(--success) !important; }
        .bg-danger { background-color: var(--danger) !important; }
        .bg-warning { background-color: var(--warning) !important; }
        .bg-info { background-color: var(--info) !important; }
        .bg-dark { background-color: var(--dark) !important; }
        .bg-light { background-color: var(--light) !important; }
        
        /* Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */
        .mt-0 { margin-top: 0 !important; }
        .mt-1 { margin-top: var(--spacing-xs) !important; }
        .mt-2 { margin-top: var(--spacing-sm) !important; }
        .mt-3 { margin-top: var(--spacing-md) !important; }
        .mt-4 { margin-top: var(--spacing-lg) !important; }
        .mt-5 { margin-top: var(--spacing-xl) !important; }
        
        .mb-0 { margin-bottom: 0 !important; }
        .mb-1 { margin-bottom: var(--spacing-xs) !important; }
        .mb-2 { margin-bottom: var(--spacing-sm) !important; }
        .mb-3 { margin-bottom: var(--spacing-md) !important; }
        .mb-4 { margin-bottom: var(--spacing-lg) !important; }
        .mb-5 { margin-bottom: var(--spacing-xl) !important; }
        
        .p-0 { padding: 0 !important; }
        .p-1 { padding: var(--spacing-xs) !important; }
        .p-2 { padding: var(--spacing-sm) !important; }
        .p-3 { padding: var(--spacing-md) !important; }
        .p-4 { padding: var(--spacing-lg) !important; }
        .p-5 { padding: var(--spacing-xl) !important; }
        
        /* Ø§Ù„Ø¸Ù„Ø§Ù„ */
        .shadow { box-shadow: var(--shadow) !important; }
        .shadow-sm { box-shadow: var(--shadow-sm) !important; }
        .shadow-none { box-shadow: none !important; }
        
        /* Ø§Ù„Ø­Ø¯ÙˆØ¯ */
        .border { border: 1px solid var(--border) !important; }
        .border-0 { border: 0 !important; }
        .rounded { border-radius: var(--radius) !important; }
        .rounded-sm { border-radius: var(--radius-sm) !important; }
        .rounded-lg { border-radius: var(--radius-lg) !important; }
        .rounded-xl { border-radius: var(--radius-xl) !important; }
        .rounded-circle { border-radius: 50% !important; }
        
        /* Flexbox */
        .d-flex { display: flex !important; }
        .flex-column { flex-direction: column !important; }
        .flex-row { flex-direction: row !important; }
        .justify-content-center { justify-content: center !important; }
        .justify-content-between { justify-content: space-between !important; }
        .justify-content-around { justify-content: space-around !important; }
        .align-items-center { align-items: center !important; }
        .align-items-start { align-items: flex-start !important; }
        .align-items-end { align-items: flex-end !important; }
        .flex-wrap { flex-wrap: wrap !important; }
        .flex-1 { flex: 1 !important; }
        .gap-1 { gap: var(--spacing-xs) !important; }
        .gap-2 { gap: var(--spacing-sm) !important; }
        .gap-3 { gap: var(--spacing-md) !important; }
        .gap-4 { gap: var(--spacing-lg) !important; }
        .gap-5 { gap: var(--spacing-xl) !important; }
        
        /* Grid */
        .d-grid { display: grid !important; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr) !important; }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr) !important; }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr) !important; }
        
        /* Ø§Ù„Ø¹Ø±Ø¶ */
        .w-100 { width: 100% !important; }
        .w-auto { width: auto !important; }
        .h-100 { height: 100% !important; }
        .h-auto { height: auto !important; }
        
        /* Ø§Ù„Ù…ÙˆØ¶Ø¹ */
        .position-relative { position: relative !important; }
        .position-absolute { position: absolute !important; }
        .position-fixed { position: fixed !important; }
        .position-sticky { position: sticky !important; }
        
        /* ==================== Animations ==================== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .animate-fadeIn { animation: fadeIn 0.3s ease-in-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-in-out; }
        .animate-pulse { animation: pulse 2s infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        
    </style>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- ==================== Loading Overlay ==================== -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <h3 class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
            <p class="loading-subtext">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
        </div>
    </div>

    <!-- ==================== Auto Save Indicator ==================== -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        <i class="fas fa-check-circle"></i>
        <span>ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span>
    </div>

    <!-- ==================== Header ==================== -->
    <header class="main-header">
        <div class="header-container">
            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠØ³Ø± -->
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="/admin/dashboard.html" class="header-logo">
                    <img src="https://raw.githubusercontent.com/MahmoudFouad25/fouad-perspective/main/media/images/logo.png" alt="Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯">
                    <span class="logo-text">Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯</span>
                </a>
            </div>

            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆØ³Ø· -->
            <div class="header-center">
                <nav class="breadcrumb" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„">
                    <ol class="breadcrumb-list">
                        <li class="breadcrumb-item">
                            <a href="/admin/dashboard.html">
                                <i class="fas fa-home"></i>
                                Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                            </a>
                        </li>
                        <li class="breadcrumb-separator">
                            <i class="fas fa-chevron-left"></i>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/admin/users.html">
                                <i class="fas fa-users"></i>
                                Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†
                            </a>
                        </li>
                        <li class="breadcrumb-separator">
                            <i class="fas fa-chevron-left"></i>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            <i class="fas fa-user-plus"></i>
                            <span id="pageMode">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</span>
                        </li>
                    </ol>
                </nav>
            </div>

            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù† -->
            <div class="header-right">
                <button class="icon-btn" id="themeToggle" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="icon-btn" id="notificationBtn" aria-label="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                <div class="user-menu">
                    <button class="user-menu-toggle" id="userMenuToggle">
                        <img src="https://raw.githubusercontent.com/MahmoudFouad25/fouad-perspective/main/media/avatars/admin.jpg" alt="Admin" class="user-avatar">
                        <span class="user-name">Ø§Ù„Ø£Ø¯Ù…Ù†</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ==================== Main Container ==================== -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="/admin/dashboard.html" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a href="/admin/users.html" class="nav-link">
                            <i class="fas fa-users"></i>
                            <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin/courses.html" class="nav-link">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Ø§Ù„Ø¯ÙˆØ±Ø§Øª</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin/groups.html" class="nav-link">
                            <i class="fas fa-users-cog"></i>
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin/reports.html" class="nav-link">
                            <i class="fas fa-chart-bar"></i>
                            <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin/settings.html" class="nav-link">
                            <i class="fas fa-cog"></i>
                            <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <div class="page-header-left">
                        <h1 class="page-title">
                            <i class="fas fa-user-plus"></i>
                            <span id="pageTitleText">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</span>
                        </h1>
                        <p class="page-subtitle">Ø£Ø¶Ù Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ù†ØµØ© ÙˆØ­Ø¯Ø¯ ØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡ ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù‡</p>
                    </div>
                    <div class="page-header-right">
                        <button class="btn btn-secondary" onclick="window.history.back()">
                            <i class="fas fa-arrow-right"></i>
                            Ø±Ø¬ÙˆØ¹
                        </button>
                        <button class="btn btn-primary" id="quickSaveBtn">
                            <i class="fas fa-save"></i>
                            Ø­ÙØ¸ Ø³Ø±ÙŠØ¹
                        </button>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 25%"></div>
                </div>
                <div class="progress-steps">
                    <div class="progress-step active" data-step="1">
                        <div class="step-circle">1</div>
                        <span class="step-label">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
                    </div>
                    <div class="progress-step" data-step="2">
                        <div class="step-circle">2</div>
                        <span class="step-label">Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</span>
                    </div>
                    <div class="progress-step" data-step="3">
                        <div class="step-circle">3</div>
                        <span class="step-label">Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª</span>
                    </div>
                    <div class="progress-step" data-step="4">
                        <div class="step-circle">4</div>
                        <span class="step-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</span>
                    </div>
                    <div class="progress-step" data-step="5">
    <div class="step-circle">5</div>
    <span class="step-label">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
</div>
                </div>
            </div>

            <!-- Tabs Container -->
            <div class="tabs-container">
                <!-- Tab Navigation -->
                <nav class="tabs-nav">
                    <ul class="tabs-list" role="tablist">
                        <li class="tab-item" role="presentation">
                            <button class="tab-link active" id="basicTab" data-tab="basic" role="tab" aria-selected="true" aria-controls="basicPanel">
                                <i class="fas fa-user"></i>
                                <span>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
                            </button>
                        </li>
                        <li class="tab-item" role="presentation">
                            <button class="tab-link" id="rolesTab" data-tab="roles" role="tab" aria-selected="false" aria-controls="rolesPanel">
                                <i class="fas fa-user-shield"></i>
                                <span>Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</span>
                            </button>
                        </li>
                        <li class="tab-item" role="presentation">
                            <button class="tab-link" id="coursesTab" data-tab="courses" role="tab" aria-selected="false" aria-controls="coursesPanel">
                                <i class="fas fa-book"></i>
                                <span>Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª</span>
                            </button>
                        </li>
                        <li class="tab-item" role="presentation">
                            <button class="tab-link" id="advancedTab" data-tab="advanced" role="tab" aria-selected="false" aria-controls="advancedPanel">
                                <i class="fas fa-cogs"></i>
                                <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</span>
                            </button>
                        </li>
                        <li class="tab-item" role="presentation">
    <button class="tab-link" id="financialTab" data-tab="financial" role="tab" aria-selected="false" aria-controls="financialPanel">
        <i class="fas fa-wallet"></i>
        <span>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
    </button>
</li>
                    </ul>
                </nav>

                <!-- Tab Panels Container -->
                <div class="tab-panels">
                    
<!-- ==================== Basic Info Tab Panel ==================== -->
<div class="tab-panel active" id="basicPanel" role="tabpanel" aria-labelledby="basicTab">
    <div class="panel-header">
        <h2 class="panel-title">
            <i class="fas fa-user-circle"></i>
            Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        </h2>
        <p class="panel-description">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
    </div>

    <div class="panel-content">
        <div class="form-grid">
            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠØ³Ø± - Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© -->
            <div class="form-section avatar-section">
                <h3 class="section-title">
                    <i class="fas fa-camera"></i>
                    Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
                </h3>
                
                <div class="avatar-upload-container">
                    <div class="avatar-preview" id="avatarPreview">
                        <img src="" alt="Avatar" id="avatarImg" style="display: none;">
                        <div class="avatar-placeholder" id="avatarPlaceholder">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="avatar-overlay">
                            <i class="fas fa-camera"></i>
                            <span>ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</span>
                        </div>
                    </div>
                    
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    
                    <div class="avatar-actions">
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('avatarInput').click()">
                            <i class="fas fa-upload"></i>
                            Ø±ÙØ¹ ØµÙˆØ±Ø©
                        </button>
                        <button type="button" class="btn btn-outline" id="removeAvatarBtn" style="display: none;">
                            <i class="fas fa-trash"></i>
                            Ø­Ø°Ù
                        </button>
                    </div>
                    
                    <div class="avatar-info">
                        <p class="text-muted text-sm">
                            <i class="fas fa-info-circle"></i>
                            Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©: JPG, PNG, GIF
                        </p>
                        <p class="text-muted text-sm">
                            <i class="fas fa-exclamation-triangle"></i>
                            Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª
                        </p>
                    </div>
                </div>

                <!-- GitHub Upload Instructions -->
                <div class="github-upload-note" id="githubUploadNote" style="display: none;">
                    <div class="note-header">
                        <i class="fas fa-github"></i>
                        ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
                    </div>
                    <div class="note-content">
                        <p>Ù‚Ù… Ø¨Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ GitHub:</p>
                        <code id="githubPath">/media/avatars/</code>
                        <button class="btn btn-sm btn-primary" onclick="copyGithubPath()">
                            <i class="fas fa-copy"></i>
                            Ù†Ø³Ø® Ø§Ù„Ù…Ø³Ø§Ø±
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù† - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-id-card"></i>
                    Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
                </h3>

                <!-- Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required" for="firstName">
                            <i class="fas fa-user"></i>
                            Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="firstName" 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„"
                               required
                               autocomplete="given-name">
                        <div class="form-feedback" id="firstNameFeedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label required" for="lastName">
                            <i class="fas fa-user"></i>
                            Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="lastName" 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©"
                               required
                               autocomplete="family-name">
                        <div class="form-feedback" id="lastNameFeedback"></div>
                    </div>
                </div>
<!-- Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯ -->
<div class="form-group">
    <label class="form-label" for="userId">
        <i class="fas fa-fingerprint"></i>
        Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (User ID)
    </label>
    <div class="d-flex gap-2">
        <input type="text" 
               class="form-control" 
               id="userId" 
               placeholder="ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø§Ø³Ù…">
        <button class="btn btn-primary" 
                type="button" 
                onclick="generateAndSaveUserId()"
                id="saveUserIdBtn"
                style="min-width: 150px;">
            <i class="fas fa-save"></i> ØªÙˆÙ„ÙŠØ¯ ÙˆØ­ÙØ¸ ID
        </button>
    </div>
    <div class="form-text text-danger mt-2">
        <i class="fas fa-exclamation-triangle"></i>
        Ù…Ù‡Ù…: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù„ØªÙˆÙ„ÙŠØ¯ ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ø¹Ø±Ù
    </div>
</div>
                <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
                <div class="form-group">
                    <label class="form-label required" for="email">
                        <i class="fas fa-envelope"></i>
                        Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                    </label>
                    <div class="input-group">
                        <input type="email" 
                               class="form-control" 
                               id="email" 
                               placeholder="example@domain.com"
                               required
                               autocomplete="email">
                        <button type="button" class="input-addon" id="checkEmailBtn">
                            <i class="fas fa-check-circle"></i>
                            ØªØ­Ù‚Ù‚
                        </button>
                    </div>
                    <div class="form-hint">Ø³ÙŠØ³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
                    <div class="form-feedback" id="emailFeedback"></div>
                </div>

                <!-- ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
                <div class="form-group" id="passwordGroup">
                    <label class="form-label required" for="password">
                        <i class="fas fa-lock"></i>
                        ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                    </label>
                    <div class="input-group">
                        <input type="password" 
                               class="form-control" 
                               id="password" 
                               placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©"
                               required
                               autocomplete="new-password">
                        <button type="button" class="input-addon" onclick="togglePassword()">
                            <i class="fas fa-eye" id="passwordToggleIcon"></i>
                        </button>
                        <button type="button" class="input-addon btn-primary" onclick="generatePassword()">
                            <i class="fas fa-key"></i>
                            ØªÙˆÙ„ÙŠØ¯
                        </button>
                    </div>
                    
                    <!-- Ù…Ø¤Ø´Ø± Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <div class="strength-text" id="strengthText">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
                    </div>
                    
                    <!-- Ù…Ø¹Ø§ÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
                    <div class="password-criteria">
                        <div class="criteria-item" id="lengthCriteria">
                            <i class="fas fa-times-circle"></i>
                            <span>8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</span>
                        </div>
                        <div class="criteria-item" id="uppercaseCriteria">
                            <i class="fas fa-times-circle"></i>
                            <span>Ø­Ø±Ù ÙƒØ¨ÙŠØ± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</span>
                        </div>
                        <div class="criteria-item" id="lowercaseCriteria">
                            <i class="fas fa-times-circle"></i>
                            <span>Ø­Ø±Ù ØµØºÙŠØ± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</span>
                        </div>
                        <div class="criteria-item" id="numberCriteria">
                            <i class="fas fa-times-circle"></i>
                            <span>Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</span>
                        </div>
                        <div class="criteria-item" id="specialCriteria">
                            <i class="fas fa-times-circle"></i>
                            <span>Ø±Ù…Ø² Ø®Ø§Øµ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (!@#$%^&*)</span>
                        </div>
                    </div>
                </div>

                <!-- ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
                <div class="form-group" id="confirmPasswordGroup">
                    <label class="form-label required" for="confirmPassword">
                        <i class="fas fa-lock"></i>
                        ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                    </label>
                    <input type="password" 
                           class="form-control" 
                           id="confirmPassword" 
                           placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                           required
                           autocomplete="new-password">
                    <div class="form-feedback" id="confirmPasswordFeedback"></div>
                </div>

                <!-- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ/WhatsApp -->
                <div class="form-group">
                    <label class="form-label required" for="whatsapp">
                        <i class="fab fa-whatsapp"></i>
                        Ø±Ù‚Ù… WhatsApp
                    </label>
                    <div class="phone-input-group">
                        <select class="country-code" id="countryCode">
                            <option value="+20" data-flag="ğŸ‡ªğŸ‡¬">+20 (Ù…ØµØ±)</option>
                            <option value="+966" data-flag="ğŸ‡¸ğŸ‡¦">+966 (Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©)</option>
                            <option value="+971" data-flag="ğŸ‡¦ğŸ‡ª">+971 (Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª)</option>
                            <option value="+965" data-flag="ğŸ‡°ğŸ‡¼">+965 (Ø§Ù„ÙƒÙˆÙŠØª)</option>
                            <option value="+974" data-flag="ğŸ‡¶ğŸ‡¦">+974 (Ù‚Ø·Ø±)</option>
                            <option value="+968" data-flag="ğŸ‡´ğŸ‡²">+968 (Ø¹Ù…Ø§Ù†)</option>
                            <option value="+973" data-flag="ğŸ‡§ğŸ‡­">+973 (Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†)</option>
                            <option value="+962" data-flag="ğŸ‡¯ğŸ‡´">+962 (Ø§Ù„Ø£Ø±Ø¯Ù†)</option>
                            <option value="+961" data-flag="ğŸ‡±ğŸ‡§">+961 (Ù„Ø¨Ù†Ø§Ù†)</option>
                            <option value="+970" data-flag="ğŸ‡µğŸ‡¸">+970 (ÙÙ„Ø³Ø·ÙŠÙ†)</option>
                            <option value="+963" data-flag="ğŸ‡¸ğŸ‡¾">+963 (Ø³ÙˆØ±ÙŠØ§)</option>
                            <option value="+964" data-flag="ğŸ‡®ğŸ‡¶">+964 (Ø§Ù„Ø¹Ø±Ø§Ù‚)</option>
                            <option value="+212" data-flag="ğŸ‡²ğŸ‡¦">+212 (Ø§Ù„Ù…ØºØ±Ø¨)</option>
                            <option value="+213" data-flag="ğŸ‡©ğŸ‡¿">+213 (Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±)</option>
                            <option value="+216" data-flag="ğŸ‡¹ğŸ‡³">+216 (ØªÙˆÙ†Ø³)</option>
                            <option value="+218" data-flag="ğŸ‡±ğŸ‡¾">+218 (Ù„ÙŠØ¨ÙŠØ§)</option>
                            <option value="+249" data-flag="ğŸ‡¸ğŸ‡©">+249 (Ø§Ù„Ø³ÙˆØ¯Ø§Ù†)</option>
                        </select>
                        <input type="tel" 
                               class="form-control" 
                               id="phoneNumber" 
                               placeholder="123456789"
                               pattern="[0-9]*"
                               required>
                    </div>
                    <div class="form-hint">Ø³ÙŠØ³ØªØ®Ø¯Ù… Ù„Ù„ØªÙˆØ§ØµÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
                    <div class="form-feedback" id="phoneFeedback"></div>
                </div>

                <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-toggle-on"></i>
                        Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
                    </label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="accountStatus" value="active" checked>
                            <span class="radio-mark"></span>
                            <span>Ù†Ø´Ø·</span>
                            <small class="text-muted">ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙˆØ±Ø§Ù‹</small>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="accountStatus" value="pending">
                            <span class="radio-mark"></span>
                            <span>Ù…Ø¹Ù„Ù‚</span>
                            <small class="text-muted">ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</small>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="accountStatus" value="inactive">
                            <span class="radio-mark"></span>
                            <span>ØºÙŠØ± Ù†Ø´Ø·</span>
                            <small class="text-muted">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹</small>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Additional CSS for Basic Tab ==================== -->
<style>
    /* ==================== Panel Styles ==================== */
    .tab-panel {
        display: none;
        animation: fadeIn 0.3s ease-in-out;
    }

    .tab-panel.active {
        display: block;
    }

    .panel-header {
        margin-bottom: var(--spacing-2xl);
        padding-bottom: var(--spacing-lg);
        border-bottom: 1px solid var(--border);
    }

    .panel-title {
        color: var(--primary);
        font-size: var(--font-2xl);
        margin-bottom: var(--spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .panel-description {
        color: var(--text-muted);
        font-size: var(--font-base);
        margin: 0;
    }

    /* ==================== Form Grid ==================== */
    .form-grid {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: var(--spacing-2xl);
    }

    .form-section {
        background: var(--lighter);
        padding: var(--spacing-xl);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
    }

    .section-title {
        font-size: var(--font-lg);
        color: var(--text);
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    /* ==================== Avatar Section ==================== */
    .avatar-section {
        text-align: center;
    }

    .avatar-upload-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-lg);
    }

    .avatar-preview {
        width: 180px;
        height: 180px;
        position: relative;
        border-radius: 50%;
        overflow: hidden;
        background: var(--dark);
        border: 4px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }

    .avatar-preview:hover {
        border-color: var(--primary);
        transform: scale(1.05);
    }

    .avatar-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .avatar-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 4rem;
        color: var(--text-dark);
    }

    .avatar-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
        padding: var(--spacing-lg) var(--spacing-md) var(--spacing-md);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-xs);
        color: white;
        opacity: 0;
        transition: var(--transition);
    }

    .avatar-preview:hover .avatar-overlay {
        opacity: 1;
    }

    .avatar-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    .avatar-info {
        text-align: center;
    }

    .avatar-info p {
        margin: var(--spacing-xs) 0;
    }

    /* ==================== GitHub Upload Note ==================== */
    .github-upload-note {
        background: rgba(var(--info-rgb), 0.1);
        border: 1px solid var(--info);
        border-radius: var(--radius-sm);
        padding: var(--spacing-md);
        margin-top: var(--spacing-lg);
    }

    .note-header {
        font-weight: 600;
        color: var(--info);
        margin-bottom: var(--spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .note-content {
        font-size: var(--font-sm);
    }

    .note-content code {
        background: var(--dark);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        font-family: monospace;
        display: block;
        margin: var(--spacing-sm) 0;
    }

    /* ==================== Form Elements ==================== */
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-lg);
    }

    .form-group {
        margin-bottom: var(--spacing-lg);
    }

    .form-group:last-child {
        margin-bottom: 0;
    }

    .form-label {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
        font-weight: 500;
        color: var(--text);
    }

    .form-label.required::after {
        content: '*';
        color: var(--danger);
        margin-right: var(--spacing-xs);
    }

    .form-control {
        width: 100%;
        padding: var(--spacing-md);
        background: var(--dark);
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-base);
        font-family: inherit;
        transition: var(--transition);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        background: rgba(var(--primary-rgb), 0.05);
    }

    .form-control:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .form-control.error {
        border-color: var(--danger);
    }

    .form-control.success {
        border-color: var(--success);
    }

    /* ==================== Input Groups ==================== */
    .input-group {
        display: flex;
        align-items: stretch;
    }

    .input-group .form-control {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        border-left: none;
    }

    .input-addon {
        padding: var(--spacing-md);
        background: var(--lightest);
        border: 2px solid var(--border);
        border-right: none;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .input-addon:first-child {
        border-top-right-radius: var(--radius-sm);
        border-bottom-right-radius: var(--radius-sm);
    }

    .input-addon:last-child {
        border-top-left-radius: var(--radius-sm);
        border-bottom-left-radius: var(--radius-sm);
        border-right: 2px solid var(--border);
        border-left: none;
    }

    .input-addon:hover {
        background: var(--primary);
        color: var(--dark);
        border-color: var(--primary);
    }

    .input-addon.btn-primary {
        background: var(--primary);
        color: var(--dark);
        border-color: var(--primary);
    }

    /* ==================== Phone Input ==================== */
    .phone-input-group {
        display: flex;
        gap: var(--spacing-sm);
    }

    .country-code {
        width: 140px;
        padding: var(--spacing-md);
        background: var(--dark);
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-base);
        cursor: pointer;
    }

    /* ==================== Password Strength ==================== */
    .password-strength {
        margin-top: var(--spacing-sm);
    }

    .strength-bar {
        height: 6px;
        background: var(--dark);
        border-radius: var(--radius-sm);
        overflow: hidden;
        margin-bottom: var(--spacing-xs);
    }

    .strength-fill {
        height: 100%;
        width: 0;
        transition: width 0.3s ease, background 0.3s ease;
    }

    .strength-fill.weak {
        width: 25%;
        background: var(--danger);
    }

    .strength-fill.fair {
        width: 50%;
        background: var(--warning);
    }

    .strength-fill.good {
        width: 75%;
        background: var(--info);
    }

    .strength-fill.strong {
        width: 100%;
        background: var(--success);
    }

    .strength-text {
        font-size: var(--font-sm);
        color: var(--text-muted);
    }

    /* ==================== Password Criteria ==================== */
    .password-criteria {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-md);
        padding: var(--spacing-md);
        background: var(--dark);
        border-radius: var(--radius-sm);
        font-size: var(--font-sm);
    }

    .criteria-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        color: var(--text-muted);
    }

    .criteria-item i {
        color: var(--danger);
        transition: var(--transition);
    }

    .criteria-item.valid i {
        color: var(--success);
    }

    /* ==================== Radio Groups ==================== */
    .radio-group {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .radio-item {
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-sm);
        padding: var(--spacing-md);
        background: var(--dark);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        position: relative;
    }

    .radio-item:hover {
        background: rgba(var(--primary-rgb), 0.05);
        border: 1px solid var(--primary);
    }

    .radio-item input[type="radio"] {
        position: absolute;
        opacity: 0;
    }

    .radio-mark {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border);
        border-radius: 50%;
        position: relative;
        transition: var(--transition);
        flex-shrink: 0;
        margin-top: 2px;
    }

    .radio-mark::after {
        content: '';
        width: 10px;
        height: 10px;
        background: var(--primary);
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        transition: var(--transition);
    }

    .radio-item input[type="radio"]:checked ~ .radio-mark {
        border-color: var(--primary);
    }

    .radio-item input[type="radio"]:checked ~ .radio-mark::after {
        transform: translate(-50%, -50%) scale(1);
    }

    .radio-item small {
        display: block;
        margin-top: var(--spacing-xs);
    }

    /* ==================== Form Feedback ==================== */
    .form-hint {
        font-size: var(--font-sm);
        color: var(--text-muted);
        margin-top: var(--spacing-xs);
    }

    .form-feedback {
        font-size: var(--font-sm);
        margin-top: var(--spacing-xs);
        display: none;
    }

    .form-feedback.show {
        display: block;
    }

    .form-feedback.error {
        color: var(--danger);
    }

    .form-feedback.success {
        color: var(--success);
    }

    /* ==================== Utilities ==================== */
    .text-sm {
        font-size: var(--font-sm);
    }

    .btn-sm {
        padding: var(--spacing-xs) var(--spacing-sm);
        font-size: var(--font-sm);
    }

    /* ==================== Responsive ==================== */
    @media (max-width: 992px) {
        .form-grid {
            grid-template-columns: 1fr;
        }

        .avatar-section {
            order: -1;
        }
    }

    @media (max-width: 576px) {
        .form-row {
            grid-template-columns: 1fr;
        }

        .password-criteria {
            grid-template-columns: 1fr;
        }

        .phone-input-group {
            flex-direction: column;
        }

        .country-code {
            width: 100%;
        }
    }
</style>
<!-- ==================== Roles & Permissions Tab Panel ==================== -->
<div class="tab-panel" id="rolesPanel" role="tabpanel" aria-labelledby="rolesTab">
    <div class="panel-header">
        <h2 class="panel-title">
            <i class="fas fa-user-shield"></i>
            Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        </h2>
        <p class="panel-description">Ø­Ø¯Ø¯ Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©</p>
    </div>

    <div class="panel-content">
        <!-- Role Selection -->
        <div class="role-selection-section">
            <h3 class="section-title">
                <i class="fas fa-crown"></i>
                Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            </h3>
            
            <div class="roles-grid">
                <!-- Ø·Ø§Ù„Ø¨ -->
                <div class="role-card" data-role="student">
                    <input type="radio" name="primaryRole" id="roleStudent" value="student" checked>
                    <label for="roleStudent">
                        <div class="role-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="role-info">
                            <h4 class="role-name">Ø·Ø§Ù„Ø¨</h4>
                            <p class="role-description">Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¨Ù‡Ø§ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</p>
                        </div>
                        <div class="role-badge">
                            <span class="badge badge-info">Ø§ÙØªØ±Ø§Ø¶ÙŠ</span>
                        </div>
                    </label>
                </div>

                <!-- Ù…Ø¯Ø±Ø¨ Ù…Ø³Ø§Ø¹Ø¯ -->
                <div class="role-card" data-role="assistant">
                    <input type="radio" name="primaryRole" id="roleAssistant" value="assistant">
                    <label for="roleAssistant">
                        <div class="role-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="role-info">
                            <h4 class="role-name">Ù…Ø¯Ø±Ø¨ Ù…Ø³Ø§Ø¹Ø¯</h4>
                            <p class="role-description">Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª</p>
                        </div>
                        <div class="role-badge">
                            <span class="badge badge-warning">Ù…ØªÙ‚Ø¯Ù…</span>
                        </div>
                    </label>
                </div>

                <!-- Ù…Ø´Ø±Ù Ù…Ø¬Ù…ÙˆØ¹Ø© -->
                <div class="role-card" data-role="group-leader">
                    <input type="radio" name="primaryRole" id="roleGroupLeader" value="group-leader">
                    <label for="roleGroupLeader">
                        <div class="role-icon">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <div class="role-info">
                            <h4 class="role-name">Ù…Ø´Ø±Ù Ù…Ø¬Ù…ÙˆØ¹Ø©</h4>
                            <p class="role-description">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù…Ù‡Ù…</p>
                        </div>
                        <div class="role-badge">
                            <span class="badge badge-primary">Ø¥Ø¯Ø§Ø±ÙŠ</span>
                        </div>
                    </label>
                </div>

                <!-- Ù…Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª -->
                <div class="role-card" data-role="analyst">
                    <input type="radio" name="primaryRole" id="roleAnalyst" value="analyst">
                    <label for="roleAnalyst">
                        <div class="role-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="role-info">
                            <h4 class="role-name">Ù…Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                            <p class="role-description">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¯ÙˆÙ† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</p>
                        </div>
                        <div class="role-badge">
                            <span class="badge badge-success">ØªØ­Ù„ÙŠÙ„ÙŠ</span>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Permissions Matrix -->
        <div class="permissions-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-key"></i>
                    Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                </h3>
                <div class="section-actions">
                    <button class="btn btn-sm btn-outline" onclick="selectAllPermissions()">
                        <i class="fas fa-check-square"></i>
                        ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                    </button>
                    <button class="btn btn-sm btn-outline" onclick="deselectAllPermissions()">
                        <i class="fas fa-square"></i>
                        Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„
                    </button>
                </div>
            </div>

            <div class="permissions-categories">
                <!-- ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ -->
                <div class="permission-category">
                    <div class="category-header" onclick="toggleCategory('content')">
                        <i class="fas fa-chevron-down category-toggle"></i>
                        <i class="fas fa-book"></i>
                        <span>Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</span>
                        <span class="category-count" id="contentCount">0/5</span>
                    </div>
                    <div class="category-permissions" id="contentPermissions">
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="view_courses" checked>
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª</span>
                                <small class="permission-desc">Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¨Ù‡Ø§</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="download_materials">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯</span>
                                <small class="permission-desc">ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª PDF ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø§Øª</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="submit_assignments">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</span>
                                <small class="permission-desc">Ø±ÙØ¹ ÙˆØªØ³Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="take_quizzes">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</span>
                                <small class="permission-desc">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="view_certificates">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</span>
                                <small class="permission-desc">Ø¹Ø±Ø¶ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</small>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ -->
                <div class="permission-category">
                    <div class="category-header" onclick="toggleCategory('communication')">
                        <i class="fas fa-chevron-down category-toggle"></i>
                        <i class="fas fa-comments"></i>
                        <span>Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ù…Ù†Ø§Ù‚Ø´Ø§Øª</span>
                        <span class="category-count" id="communicationCount">0/4</span>
                    </div>
                    <div class="category-permissions" id="communicationPermissions">
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="post_discussions">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø§Øª</span>
                                <small class="permission-desc">Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¯Ù‰</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="comment_discussions">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</span>
                                <small class="permission-desc">Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="send_messages">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø§ØµØ©</span>
                                <small class="permission-desc">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ† ÙˆØ§Ù„Ø·Ù„Ø§Ø¨</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="rate_courses">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¯ÙˆØ±Ø§Øª</span>
                                <small class="permission-desc">Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø§Øª</small>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© -->
                <div class="permission-category">
                    <div class="category-header" onclick="toggleCategory('admin')">
                        <i class="fas fa-chevron-down category-toggle"></i>
                        <i class="fas fa-cogs"></i>
                        <span>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</span>
                        <span class="category-count" id="adminCount">0/6</span>
                    </div>
                    <div class="category-permissions" id="adminPermissions">
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="manage_users">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                                <small class="permission-desc">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="manage_groups">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
                                <small class="permission-desc">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="view_reports">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                                <small class="permission-desc">Ø§Ù„ÙˆØµÙˆÙ„ Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="export_data">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                                <small class="permission-desc">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="send_notifications">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
                                <small class="permission-desc">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="manage_content">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
                                <small class="permission-desc">ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙˆØ±Ø§Øª</small>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª -->
                <div class="permission-category">
                    <div class="category-header" onclick="toggleCategory('analytics')">
                        <i class="fas fa-chevron-down category-toggle"></i>
                        <i class="fas fa-chart-bar"></i>
                        <span>Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                        <span class="category-count" id="analyticsCount">0/4</span>
                    </div>
                    <div class="category-permissions" id="analyticsPermissions">
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="view_analytics">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</span>
                                <small class="permission-desc">Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="view_progress_reports">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                                <small class="permission-desc">Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø§Ø¨</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="view_financial_reports">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
                                <small class="permission-desc">Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</small>
                            </div>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="permissions" value="create_custom_reports">
                            <span class="permission-checkbox"></span>
                            <div class="permission-info">
                                <span class="permission-name">ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø®ØµØµØ©</span>
                                <small class="permission-desc">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø®ØµØµØ©</small>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Role Builder -->
        <div class="custom-role-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-magic"></i>
                    Ø¯ÙˆØ± Ù…Ø®ØµØµ
                </h3>
                <div class="toggle-switch">
                    <input type="checkbox" id="enableCustomRole">
                    <label for="enableCustomRole">ØªÙØ¹ÙŠÙ„ Ø¯ÙˆØ± Ù…Ø®ØµØµ</label>
                </div>
            </div>

            <div class="custom-role-builder" id="customRoleBuilder" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="customRoleName">
                            <i class="fas fa-tag"></i>
                            Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="customRoleName" 
                               placeholder="Ù…Ø«Ø§Ù„: Ù…Ù†Ø³Ù‚ Ø§Ù„Ø¯ÙˆØ±Ø§Øª">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="customRoleColor">
                            <i class="fas fa-palette"></i>
                            Ù„ÙˆÙ† Ø§Ù„Ø¯ÙˆØ±
                        </label>
                        <div class="color-picker">
                            <input type="color" id="customRoleColor" value="#f4c430">
                            <div class="color-presets">
                                <button type="button" class="color-preset" style="background: #f4c430" data-color="#f4c430"></button>
                                <button type="button" class="color-preset" style="background: #2196f3" data-color="#2196f3"></button>
                                <button type="button" class="color-preset" style="background: #4caf50" data-color="#4caf50"></button>
                                <button type="button" class="color-preset" style="background: #ff9800" data-color="#ff9800"></button>
                                <button type="button" class="color-preset" style="background: #9c27b0" data-color="#9c27b0"></button>
                                <button type="button" class="color-preset" style="background: #f44336" data-color="#f44336"></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="customRoleDescription">
                        <i class="fas fa-align-left"></i>
                        ÙˆØµÙ Ø§Ù„Ø¯ÙˆØ±
                    </label>
                    <textarea class="form-control" 
                              id="customRoleDescription" 
                              rows="3" 
                              placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ± ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØ§ØªÙ‡..."></textarea>
                </div>
            </div>
        </div>

        <!-- Role Preview -->
        <div class="role-preview">
            <h3 class="section-title">
                <i class="fas fa-eye"></i>
                Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            </h3>
            <div class="preview-card">
                <div class="preview-header">
                    <div class="preview-role">
                        <i class="fas fa-user-graduate"></i>
                        <span id="previewRoleName">Ø·Ø§Ù„Ø¨</span>
                    </div>
                    <div class="preview-stats">
                        <span class="stat">
                            <i class="fas fa-check-circle text-success"></i>
                            <span id="activePermissionsCount">1</span> ØµÙ„Ø§Ø­ÙŠØ© Ù†Ø´Ø·Ø©
                        </span>
                        <span class="stat">
                            <i class="fas fa-times-circle text-danger"></i>
                            <span id="inactivePermissionsCount">18</span> ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø¹Ø·Ù„Ø©
                        </span>
                    </div>
                </div>
                <div class="preview-summary" id="previewSummary">
                    <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø³ÙŠØªÙ…ÙƒÙ† Ù…Ù†:</p>
                    <ul id="permissionsSummary">
                        <li>Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¨Ù‡Ø§</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Additional CSS for Roles Tab ==================== -->
<style>
    /* ==================== Role Selection ==================== */
    .role-selection-section {
        margin-bottom: var(--spacing-2xl);
    }

    .roles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: var(--spacing-lg);
        margin-top: var(--spacing-lg);
    }

    .role-card {
        position: relative;
        transition: var(--transition);
    }

    .role-card input[type="radio"] {
        position: absolute;
        opacity: 0;
    }

    .role-card label {
        display: flex;
        flex-direction: column;
        padding: var(--spacing-lg);
        background: var(--lighter);
        border: 2px solid var(--border);
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: var(--transition);
        height: 100%;
    }

    .role-card:hover label {
        border-color: var(--primary);
        background: rgba(var(--primary-rgb), 0.05);
    }

    .role-card input[type="radio"]:checked + label {
        border-color: var(--primary);
        background: rgba(var(--primary-rgb), 0.1);
        box-shadow: 0 0 0 4px rgba(var(--primary-rgb), 0.2);
    }

    .role-icon {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: var(--spacing-md);
    }

    .role-name {
        font-size: var(--font-xl);
        margin-bottom: var(--spacing-sm);
        color: var(--text);
    }

    .role-description {
        font-size: var(--font-sm);
        color: var(--text-muted);
        margin: 0;
        flex: 1;
    }

    .role-badge {
        margin-top: var(--spacing-md);
    }

    .badge {
        display: inline-block;
        padding: var(--spacing-xs) var(--spacing-sm);
        font-size: var(--font-xs);
        font-weight: 600;
        border-radius: var(--radius-sm);
        text-transform: uppercase;
    }

    .badge-info {
        background: rgba(var(--info-rgb), 0.2);
        color: var(--info);
    }

    .badge-warning {
        background: rgba(var(--warning-rgb), 0.2);
        color: var(--warning);
    }

    .badge-primary {
        background: rgba(var(--primary-rgb), 0.2);
        color: var(--primary);
    }

    .badge-success {
        background: rgba(var(--success-rgb), 0.2);
        color: var(--success);
    }

    /* ==================== Permissions Section ==================== */
    .permissions-section {
        background: var(--lighter);
        padding: var(--spacing-xl);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        margin-bottom: var(--spacing-2xl);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .section-actions {
        display: flex;
        gap: var(--spacing-sm);
    }

    /* ==================== Permission Categories ==================== */
    .permissions-categories {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .permission-category {
        background: var(--dark);
        border-radius: var(--radius-sm);
        overflow: hidden;
    }

    .category-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md) var(--spacing-lg);
        cursor: pointer;
        user-select: none;
        transition: var(--transition);
    }

    .category-header:hover {
        background: rgba(var(--primary-rgb), 0.05);
    }

    .category-toggle {
        transition: var(--transition);
    }

    .category-header.collapsed .category-toggle {
        transform: rotate(-90deg);
    }

    .category-count {
        margin-right: auto;
        font-size: var(--font-sm);
        color: var(--text-muted);
        background: var(--lighter);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
    }

    .category-permissions {
        padding: var(--spacing-md);
        border-top: 1px solid var(--border);
        display: grid;
        gap: var(--spacing-sm);
    }

    .category-header.collapsed + .category-permissions {
        display: none;
    }

    /* ==================== Permission Items ==================== */
    .permission-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        background: var(--lighter);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
        position: relative;
    }

    .permission-item:hover {
        background: rgba(var(--primary-rgb), 0.05);
    }

    .permission-item input[type="checkbox"] {
        position: absolute;
        opacity: 0;
    }

    .permission-checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        position: relative;
        transition: var(--transition);
        flex-shrink: 0;
    }

    .permission-checkbox::after {
        content: '\f00c';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        color: white;
        font-size: 12px;
        transition: var(--transition);
    }

    .permission-item input[type="checkbox"]:checked ~ .permission-checkbox {
        background: var(--primary);
        border-color: var(--primary);
    }

    .permission-item input[type="checkbox"]:checked ~ .permission-checkbox::after {
        transform: translate(-50%, -50%) scale(1);
    }

    .permission-info {
        flex: 1;
    }

    .permission-name {
        display: block;
        font-weight: 500;
        color: var(--text);
        margin-bottom: var(--spacing-xs);
    }

    .permission-desc {
        display: block;
        font-size: var(--font-sm);
        color: var(--text-muted);
    }

    /* ==================== Custom Role Section ==================== */
    .custom-role-section {
        background: var(--lighter);
        padding: var(--spacing-xl);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        margin-bottom: var(--spacing-2xl);
    }

    .toggle-switch {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .toggle-switch input[type="checkbox"] {
        width: 50px;
        height: 26px;
        appearance: none;
        background: var(--dark);
        border-radius: 26px;
        position: relative;
        cursor: pointer;
        transition: var(--transition);
    }

    .toggle-switch input[type="checkbox"]::after {
        content: '';
        position: absolute;
        width: 22px;
        height: 22px;
        background: var(--text-muted);
        border-radius: 50%;
        top: 2px;
        right: 26px;
        transition: var(--transition);
    }

    .toggle-switch input[type="checkbox"]:checked {
        background: var(--primary);
    }

    .toggle-switch input[type="checkbox"]:checked::after {
        right: 2px;
        background: white;
    }

    .custom-role-builder {
        margin-top: var(--spacing-lg);
        padding-top: var(--spacing-lg);
        border-top: 1px solid var(--border);
    }

    /* ==================== Color Picker ==================== */
    .color-picker {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    input[type="color"] {
        width: 50px;
        height: 50px;
        border: none;
        border-radius: var(--radius-sm);
        cursor: pointer;
    }

    .color-presets {
        display: flex;
        gap: var(--spacing-sm);
    }

    .color-preset {
        width: 30px;
        height: 30px;
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
    }

    .color-preset:hover {
        transform: scale(1.1);
        border-color: var(--text);
    }

    /* ==================== Role Preview ==================== */
    .role-preview {
        background: var(--lighter);
        padding: var(--spacing-xl);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
    }

    .preview-card {
        background: var(--dark);
        border-radius: var(--radius-sm);
        padding: var(--spacing-lg);
        margin-top: var(--spacing-lg);
    }

    .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-lg);
        border-bottom: 1px solid var(--border);
    }

    .preview-role {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-size: var(--font-xl);
        font-weight: 600;
        color: var(--primary);
    }

    .preview-stats {
        display: flex;
        gap: var(--spacing-lg);
    }

    .stat {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        font-size: var(--font-sm);
    }

    .preview-summary ul {
        list-style: none;
        padding: 0;
        margin: var(--spacing-md) 0 0 0;
    }

    .preview-summary li {
        padding: var(--spacing-sm) 0;
        padding-right: var(--spacing-lg);
        position: relative;
    }

    .preview-summary li::before {
        content: '\f00c';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        right: 0;
        color: var(--success);
    }

    /* ==================== Responsive ==================== */
    @media (max-width: 768px) {
        .roles-grid {
            grid-template-columns: 1fr;
        }

        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .section-actions {
            width: 100%;
        }

        .section-actions .btn {
            flex: 1;
        }

        .preview-header {
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .preview-stats {
            width: 100%;
            justify-content: space-around;
        }
    }
</style>
<!-- ==================== Courses & Paths Tab Panel ==================== -->
<div class="tab-panel" id="coursesPanel" role="tabpanel" aria-labelledby="coursesTab">
    <div class="panel-header">
        <h2 class="panel-title">
            <i class="fas fa-book"></i>
            Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª
        </h2>
        <p class="panel-description">Ø­Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
    </div>

    <div class="panel-content">
        <!-- Search and Filter Section -->
        <div class="search-filter-section">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                       class="search-input" 
                       id="courseSearchInput" 
                       placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆØ±Ø© Ø£Ùˆ Ù…Ø³Ø§Ø±...">
                <button class="search-clear" id="clearSearch" style="display: none;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-th"></i>
                    Ø§Ù„ÙƒÙ„
                    <span class="filter-count" id="allCount">0</span>
                </button>
                <button class="filter-btn" data-filter="courses">
                    <i class="fas fa-graduation-cap"></i>
                    Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                    <span class="filter-count" id="coursesCount">0</span>
                </button>
                <button class="filter-btn" data-filter="paths">
                    <i class="fas fa-route"></i>
                    Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
                    <span class="filter-count" id="pathsCount">0</span>
                </button>
                <button class="filter-btn" data-filter="selected">
                    <i class="fas fa-check-circle"></i>
                    Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    <span class="filter-count" id="selectedCount">0</span>
                </button>
            </div>
        </div>

        <!-- Course Assignment Container -->
        <div class="course-assignment-container">
            <!-- Available Courses/Paths -->
            <div class="assignment-column">
                <div class="column-header">
                    <h3 class="column-title">
                        <i class="fas fa-list"></i>
                        Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
                    </h3>
                    <div class="column-actions">
                        <select class="sort-select" id="sortSelect">
                            <option value="name">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…</option>
                            <option value="date">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
                            <option value="price">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±</option>
                            <option value="students">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                        </select>
                    </div>
                </div>
                
                <div class="items-container" id="availableItems">
                    <!-- Loading State -->
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª...</p>
                    </div>
                    
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>
            </div>

            <!-- Drag & Drop Area -->
            <div class="drag-drop-area">
                <div class="drop-zone" id="dropZone">
                    <i class="fas fa-hand-point-left"></i>
                    <p>Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù‡Ù†Ø§</p>
                    <span>Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ±Ø© Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§</span>
                </div>
            </div>

            <!-- Assigned Courses/Paths -->
            <div class="assignment-column">
                <div class="column-header">
                    <h3 class="column-title">
                        <i class="fas fa-user-check"></i>
                        Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©
                    </h3>
                    <div class="column-stats">
                        <span class="stat-item">
                            <i class="fas fa-book-open"></i>
                            <span id="assignedCoursesCount">0</span> Ø¯ÙˆØ±Ø©
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-layer-group"></i>
                            <span id="assignedPathsCount">0</span> Ù…Ø³Ø§Ø±
                        </span>
                    </div>
                </div>
                
                <div class="items-container assigned-items" id="assignedItems">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>Ù„Ù… ÙŠØªÙ… ØªØ®ØµÙŠØµ Ø£ÙŠ Ø¯ÙˆØ±Ø§Øª Ø¨Ø¹Ø¯</p>
                        <span>Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ø§ÙˆØ±Ø©</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions">
            <div class="bulk-actions-left">
                <button class="btn btn-outline" onclick="assignAllVisible()">
                    <i class="fas fa-plus-circle"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
                </button>
                <button class="btn btn-outline" onclick="removeAllAssigned()">
                    <i class="fas fa-minus-circle"></i>
                    Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„
                </button>
            </div>
            <div class="bulk-actions-right">
                <button class="btn btn-secondary" onclick="applyBulkSettings()">
                    <i class="fas fa-cog"></i>
                    Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ©
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Course Item Template (ÙŠØ³ØªØ®Ø¯Ù… ÙÙŠ JavaScript) ==================== -->
<template id="courseItemTemplate">
    <div class="course-item" draggable="true">
        <div class="item-header">
            <div class="item-type-badge">
                <i class="fas fa-graduation-cap"></i>
                <span>Ø¯ÙˆØ±Ø©</span>
            </div>
            <button class="item-action-btn add-btn">
                <i class="fas fa-plus"></i>
            </button>
        </div>
        
        <div class="item-thumbnail">
            <img src="" alt="">
            <div class="item-price">
                <span class="price-value">0</span>
                <span class="price-currency">Ø±ÙŠØ§Ù„</span>
            </div>
        </div>
        
        <div class="item-content">
            <h4 class="item-title"></h4>
            <p class="item-instructor">
                <i class="fas fa-user-tie"></i>
                <span></span>
            </p>
            <div class="item-meta">
                <span class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span class="duration"></span>
                </span>
                <span class="meta-item">
                    <i class="fas fa-users"></i>
                    <span class="students-count"></span>
                </span>
            </div>
        </div>
    </div>
</template>

<!-- ==================== Assigned Item Template ==================== -->
<template id="assignedItemTemplate">
    <div class="assigned-item">
        <div class="assigned-item-header">
            <div class="assigned-item-info">
                <div class="item-type-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <h4 class="assigned-item-title"></h4>
                    <p class="assigned-item-type"></p>
                </div>
            </div>
            <button class="remove-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="assigned-item-settings">
            <!-- ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ÙˆØµÙˆÙ„ -->
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-calendar-alt"></i>
                    ÙØªØ±Ø© Ø§Ù„ÙˆØµÙˆÙ„
                </label>
                <div class="date-inputs">
                    <input type="date" class="date-input start-date" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©">
                    <span class="date-separator">Ø¥Ù„Ù‰</span>
                    <input type="date" class="date-input end-date" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©">
                </div>
            </div>
            
            <!-- Ù†ÙˆØ¹ Ø§Ù„ÙˆØµÙˆÙ„ -->
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-key"></i>
                    Ù†ÙˆØ¹ Ø§Ù„ÙˆØµÙˆÙ„
                </label>
                <select class="setting-select access-type">
                    <option value="full">ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„</option>
                    <option value="limited">ÙˆØµÙˆÙ„ Ù…Ø­Ø¯ÙˆØ¯</option>
                    <option value="preview">Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø·</option>
                </select>
            </div>
            
            <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ØµØµ -->
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-tag"></i>
                    Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ØµØµ
                </label>
                <div class="price-input-group">
                    <input type="number" class="price-input" placeholder="0" min="0">
                    <select class="currency-select">
                        <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
                        <option value="EGP">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</option>
                        <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                    </select>
                    <label class="checkbox-label">
                        <input type="checkbox" class="free-checkbox">
                        <span>Ù…Ø¬Ø§Ù†ÙŠ</span>
                    </label>
                </div>
            </div>
            
            <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-sticky-note"></i>
                    Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                </label>
                <textarea class="setting-textarea" rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµÙŠØµ..."></textarea>
            </div>
        </div>
    </div>
</template>

<!-- ==================== Bulk Settings Modal ==================== -->
<div class="modal" id="bulkSettingsModal" style="display: none;">
    <div class="modal-backdrop" onclick="closeBulkSettings()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-cogs"></i>
                Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ©
            </h3>
            <button class="modal-close" onclick="closeBulkSettings()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <p class="modal-description">Ø³ØªØ·Ø¨Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©</p>
            
            <div class="bulk-settings-form">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-calendar-alt"></i>
                        ÙØªØ±Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    </label>
                    <div class="duration-input">
                        <input type="number" id="bulkDuration" value="90" min="1">
                        <select id="bulkDurationUnit">
                            <option value="days">ÙŠÙˆÙ…</option>
                            <option value="weeks">Ø£Ø³Ø¨ÙˆØ¹</option>
                            <option value="months" selected>Ø´Ù‡Ø±</option>
                            <option value="years">Ø³Ù†Ø©</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-key"></i>
                        Ù†ÙˆØ¹ Ø§Ù„ÙˆØµÙˆÙ„
                    </label>
                    <select class="form-control" id="bulkAccessType">
                        <option value="full">ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„</option>
                        <option value="limited">ÙˆØµÙˆÙ„ Ù…Ø­Ø¯ÙˆØ¯</option>
                        <option value="preview">Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø·</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-percent"></i>
                        Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…
                    </label>
                    <div class="discount-input">
                        <input type="number" id="bulkDiscount" placeholder="0" min="0" max="100">
                        <span class="discount-symbol">%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeBulkSettings()">
                Ø¥Ù„ØºØ§Ø¡
            </button>
            <button class="btn btn-primary" onclick="applyBulkSettingsConfirm()">
                <i class="fas fa-check"></i>
                ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„
            </button>
        </div>
    </div>
</div>

<!-- ==================== Additional CSS for Courses Tab ==================== -->
<style>
    /* ==================== Search & Filter Section ==================== */
    .search-filter-section {
        display: flex;
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
    }

    .search-box {
        flex: 1;
        position: relative;
        min-width: 300px;
    }

    .search-icon {
        position: absolute;
        right: var(--spacing-md);
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
        pointer-events: none;
    }

    .search-input {
        width: 100%;
        padding: var(--spacing-md) var(--spacing-3xl);
        background: var(--lighter);
        border: 2px solid var(--border);
        border-radius: var(--radius-xl);
        color: var(--text);
        font-size: var(--font-base);
        transition: var(--transition);
    }

    .search-input:focus {
        border-color: var(--primary);
        background: rgba(var(--primary-rgb), 0.05);
    }

    .search-clear {
        position: absolute;
        left: var(--spacing-md);
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        transition: var(--transition);
    }

    .search-clear:hover {
        background: var(--dark);
        color: var(--text);
    }

    /* ==================== Filter Buttons ==================== */
    .filter-buttons {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
    }

    .filter-btn {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        background: var(--lighter);
        border: 2px solid var(--border);
        border-radius: var(--radius-xl);
        color: var(--text-muted);
        cursor: pointer;
        transition: var(--transition);
        white-space: nowrap;
    }

    .filter-btn:hover {
        border-color: var(--primary);
        color: var(--text);
    }

    .filter-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: var(--dark);
    }

    .filter-count {
        background: var(--dark);
        color: var(--text);
        padding: 2px 8px;
        border-radius: var(--radius-xl);
        font-size: var(--font-sm);
        font-weight: 600;
    }

    .filter-btn.active .filter-count {
        background: var(--dark);
        color: var(--primary);
    }

    /* ==================== Assignment Container ==================== */
    .course-assignment-container {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        min-height: 600px;
    }

    .assignment-column {
        background: var(--lighter);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
    }

    .column-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }

    .column-title {
        font-size: var(--font-lg);
        color: var(--text);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .column-actions,
    .column-stats {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .sort-select {
        padding: var(--spacing-xs) var(--spacing-sm);
        background: var(--dark);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-sm);
        cursor: pointer;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        font-size: var(--font-sm);
        color: var(--text-muted);
    }

    /* ==================== Items Container ==================== */
    .items-container {
        flex: 1;
        overflow-y: auto;
        padding: var(--spacing-lg);
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: var(--spacing-lg);
        align-content: start;
    }

    .assigned-items {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
        grid-template-columns: 1fr;
    }

    /* ==================== Loading & Empty States ==================== */
    .loading-state,
    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: var(--spacing-3xl);
        color: var(--text-muted);
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 3px solid var(--border);
        border-top-color: var(--primary);
        border-radius: 50%;
        margin: 0 auto var(--spacing-lg);
        animation: spin 1s linear infinite;
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
    }

    .empty-state p {
        font-size: var(--font-lg);
        margin-bottom: var(--spacing-sm);
    }

    .empty-state span {
        font-size: var(--font-sm);
    }

    /* ==================== Course Item ==================== */
    .course-item {
        background: var(--dark);
        border-radius: var(--radius-lg);
        overflow: hidden;
        cursor: move;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
    }

    .course-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .course-item.dragging {
        opacity: 0.5;
        transform: rotate(2deg);
    }

    .item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-sm) var(--spacing-md);
        background: rgba(0, 0, 0, 0.2);
    }

    .item-type-badge {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        font-size: var(--font-sm);
        color: var(--text-muted);
    }

    .item-type-badge.path {
        color: var(--secondary);
    }

    .item-action-btn {
        background: var(--primary);
        border: none;
        color: var(--dark);
        width: 28px;
        height: 28px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .item-action-btn:hover {
        transform: scale(1.1);
    }

    .item-action-btn.remove-btn {
        background: var(--danger);
        color: white;
    }

    .item-thumbnail {
        position: relative;
        height: 140px;
        overflow: hidden;
        background: var(--lighter);
    }

    .item-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .item-price {
        position: absolute;
        top: var(--spacing-sm);
        left: var(--spacing-sm);
        background: var(--primary);
        color: var(--dark);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: var(--font-sm);
    }

    .item-content {
        padding: var(--spacing-md);
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .item-title {
        font-size: var(--font-base);
        font-weight: 600;
        margin-bottom: var(--spacing-sm);
        color: var(--text);
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .item-instructor {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        font-size: var(--font-sm);
        color: var(--text-muted);
        margin-bottom: var(--spacing-md);
    }

    .item-meta {
        display: flex;
        justify-content: space-between;
        margin-top: auto;
        padding-top: var(--spacing-sm);
        border-top: 1px solid var(--border);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        font-size: var(--font-sm);
        color: var(--text-muted);
    }

    /* ==================== Drag & Drop Area ==================== */
    .drag-drop-area {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .drop-zone {
        padding: var(--spacing-xl);
        border: 3px dashed var(--border);
        border-radius: var(--radius-lg);
        text-align: center;
        color: var(--text-muted);
        transition: var(--transition);
    }

    .drop-zone i {
        font-size: 2rem;
        margin-bottom: var(--spacing-sm);
        display: block;
    }

    .drop-zone p {
        margin-bottom: var(--spacing-xs);
        font-weight: 500;
    }

    .drop-zone span {
        font-size: var(--font-sm);
    }

    .drop-zone.drag-over {
        border-color: var(--primary);
        background: rgba(var(--primary-rgb), 0.1);
        color: var(--primary);
    }

    /* ==================== Assigned Item ==================== */
    .assigned-item {
        background: var(--dark);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        border: 1px solid var(--border);
        transition: var(--transition);
    }

    .assigned-item:hover {
        border-color: var(--primary);
    }

    .assigned-item-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: var(--spacing-lg);
    }

    .assigned-item-info {
        display: flex;
        gap: var(--spacing-md);
        align-items: start;
    }

    .item-type-icon {
        width: 40px;
        height: 40px;
        background: var(--lighter);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-size: var(--font-lg);
        flex-shrink: 0;
    }

    .assigned-item-title {
        font-size: var(--font-base);
        font-weight: 600;
        margin-bottom: var(--spacing-xs);
        color: var(--text);
    }

    .assigned-item-type {
        font-size: var(--font-sm);
        color: var(--text-muted);
        margin: 0;
    }

    .remove-btn {
        background: var(--danger);
        color: white;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .remove-btn:hover {
        background: var(--danger-dark);
        transform: scale(1.1);
    }

    /* ==================== Assigned Item Settings ==================== */
    .assigned-item-settings {
        display: grid;
        gap: var(--spacing-md);
    }

    .setting-group {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .setting-label {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-size: var(--font-sm);
        font-weight: 500;
        color: var(--text);
    }

    .date-inputs {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .date-input {
        flex: 1;
        padding: var(--spacing-sm);
        background: var(--lighter);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-sm);
    }

    .date-separator {
        color: var(--text-muted);
        font-size: var(--font-sm);
    }

    .setting-select {
        padding: var(--spacing-sm);
        background: var(--lighter);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-sm);
        cursor: pointer;
    }

    .price-input-group {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .price-input {
        flex: 1;
        padding: var(--spacing-sm);
        background: var(--lighter);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-sm);
    }

    .currency-select {
        padding: var(--spacing-sm);
        background: var(--lighter);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-sm);
        cursor: pointer;
    }

    .checkbox-label {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        cursor: pointer;
        user-select: none;
        white-space: nowrap;
    }

    .setting-textarea {
        padding: var(--spacing-sm);
        background: var(--lighter);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: var(--font-sm);
        font-family: inherit;
        resize: vertical;
    }

    /* ==================== Bulk Actions ==================== */
    .bulk-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-lg);
        background: var(--lighter);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
    }

    .bulk-actions-left,
    .bulk-actions-right {
        display: flex;
        gap: var(--spacing-md);
    }

    /* ==================== Modal ==================== */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: var(--z-modal);
        animation: fadeIn 0.3s ease;
    }

    .modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--dark);
        border-radius: var(--radius-lg);
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        animation: slideIn 0.3s ease;
    }

    .modal-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: var(--font-xl);
        color: var(--primary);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .modal-close {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: var(--font-xl);
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        transition: var(--transition);
    }

    .modal-close:hover {
        background: var(--lighter);
        color: var(--text);
    }

    .modal-body {
        padding: var(--spacing-lg);
        overflow-y: auto;
        flex: 1;
    }

    .modal-description {
        color: var(--text-muted);
        margin-bottom: var(--spacing-lg);
    }

    .modal-footer {
        padding: var(--spacing-lg);
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-md);
    }

    /* ==================== Bulk Settings Form ==================== */
    .duration-input {
        display: flex;
        gap: var(--spacing-sm);
    }

    .duration-input input {
        flex: 1;
    }

    .discount-input {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .discount-symbol {
        font-size: var(--font-lg);
        color: var(--text-muted);
    }

    /* ==================== Responsive ==================== */
    @media (max-width: 1200px) {
        .course-assignment-container {
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
        }

        .drag-drop-area {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .search-filter-section {
            flex-direction: column;
        }

        .search-box {
            min-width: 100%;
        }

        .filter-buttons {
            justify-content: center;
        }

        .items-container {
            grid-template-columns: 1fr;
        }

        .bulk-actions {
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .bulk-actions-left,
        .bulk-actions-right {
            width: 100%;
            justify-content: center;
        }
    }
</style>
<!-- ==================== Advanced Info Tab Panel ==================== -->
<div class="tab-panel" id="advancedPanel" role="tabpanel" aria-labelledby="advancedTab">
    <div class="panel-header">
        <h2 class="panel-title">
            <i class="fas fa-cogs"></i>
            Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
        </h2>
        <p class="panel-description">Ø£Ø¶Ù Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ÙˆØ­Ù‚ÙˆÙ„ Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
    </div>

    <div class="panel-content">
        <!-- Personal Information Section -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-user-circle"></i>
                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                </h3>
                <button class="section-toggle" onclick="toggleSection('personal')">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            
            <div class="section-content" id="personalContent">
                <div class="form-grid-3">
                    <div class="form-group">
                        <label class="form-label" for="birthDate">
                            <i class="fas fa-birthday-cake"></i>
                            ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
                        </label>
                        <input type="date" class="form-control" id="birthDate">
                        <div class="form-hint">Ø³ÙŠØ³ØªØ®Ø¯Ù… Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‡Ù†Ø¦Ø©</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="gender">
                            <i class="fas fa-venus-mars"></i>
                            Ø§Ù„Ø¬Ù†Ø³
                        </label>
                        <select class="form-control" id="gender">
                            <option value="">-- Ø§Ø®ØªØ± --</option>
                            <option value="male">Ø°ÙƒØ±</option>
                            <option value="female">Ø£Ù†Ø«Ù‰</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="nationality">
                            <i class="fas fa-flag"></i>
                            Ø§Ù„Ø¬Ù†Ø³ÙŠØ©
                        </label>
                        <select class="form-control" id="nationality">
                            <option value="">-- Ø§Ø®ØªØ± --</option>
                            <option value="EG">Ù…ØµØ±ÙŠ</option>
                            <option value="SA">Ø³Ø¹ÙˆØ¯ÙŠ</option>
                            <option value="AE">Ø¥Ù…Ø§Ø±Ø§ØªÙŠ</option>
                            <option value="KW">ÙƒÙˆÙŠØªÙŠ</option>
                            <option value="QA">Ù‚Ø·Ø±ÙŠ</option>
                            <option value="OM">Ø¹Ù…Ø§Ù†ÙŠ</option>
                            <option value="BH">Ø¨Ø­Ø±ÙŠÙ†ÙŠ</option>
                            <option value="JO">Ø£Ø±Ø¯Ù†ÙŠ</option>
                            <option value="LB">Ù„Ø¨Ù†Ø§Ù†ÙŠ</option>
                            <option value="PS">ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ</option>
                            <option value="SY">Ø³ÙˆØ±ÙŠ</option>
                            <option value="IQ">Ø¹Ø±Ø§Ù‚ÙŠ</option>
                            <option value="MA">Ù…ØºØ±Ø¨ÙŠ</option>
                            <option value="DZ">Ø¬Ø²Ø§Ø¦Ø±ÙŠ</option>
                            <option value="TN">ØªÙˆÙ†Ø³ÙŠ</option>
                            <option value="LY">Ù„ÙŠØ¨ÙŠ</option>
                            <option value="SD">Ø³ÙˆØ¯Ø§Ù†ÙŠ</option>
                            <option value="YE">ÙŠÙ…Ù†ÙŠ</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-address-card"></i>
                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„
                </h3>
                <button class="section-toggle" onclick="toggleSection('contact')">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            
            <div class="section-content" id="contactContent">
                <div class="form-grid-2">
                    <div class="form-group">
                        <label class="form-label" for="country">
                            <i class="fas fa-globe"></i>
                            Ø§Ù„Ø¯ÙˆÙ„Ø©
                        </label>
                        <select class="form-control" id="country">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø© --</option>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="city">
                            <i class="fas fa-city"></i>
                            Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
                        </label>
                        <input type="text" class="form-control" id="city" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="timezone">
                            <i class="fas fa-clock"></i>
                            Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
                        </label>
                        <select class="form-control" id="timezone">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© --</option>
                            <option value="Africa/Cairo">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (GMT+2)</option>
                            <option value="Asia/Riyadh">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø±ÙŠØ§Ø¶ (GMT+3)</option>
                            <option value="Asia/Dubai">ØªÙˆÙ‚ÙŠØª Ø¯Ø¨ÙŠ (GMT+4)</option>
                            <option value="Asia/Kuwait">ØªÙˆÙ‚ÙŠØª Ø§Ù„ÙƒÙˆÙŠØª (GMT+3)</option>
                            <option value="Asia/Qatar">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¯ÙˆØ­Ø© (GMT+3)</option>
                            <option value="Asia/Muscat">ØªÙˆÙ‚ÙŠØª Ù…Ø³Ù‚Ø· (GMT+4)</option>
                            <option value="Asia/Bahrain">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ù†Ø§Ù…Ø© (GMT+3)</option>
                            <option value="Asia/Amman">ØªÙˆÙ‚ÙŠØª Ø¹Ù…Ù‘Ø§Ù† (GMT+2)</option>
                            <option value="Asia/Beirut">ØªÙˆÙ‚ÙŠØª Ø¨ÙŠØ±ÙˆØª (GMT+2)</option>
                            <option value="Asia/Jerusalem">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‚Ø¯Ø³ (GMT+2)</option>
                            <option value="Asia/Damascus">ØªÙˆÙ‚ÙŠØª Ø¯Ù…Ø´Ù‚ (GMT+2)</option>
                            <option value="Asia/Baghdad">ØªÙˆÙ‚ÙŠØª Ø¨ØºØ¯Ø§Ø¯ (GMT+3)</option>
                            <option value="Africa/Casablanca">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (GMT+1)</option>
                            <option value="Africa/Algiers">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± (GMT+1)</option>
                            <option value="Africa/Tunis">ØªÙˆÙ‚ÙŠØª ØªÙˆÙ†Ø³ (GMT+1)</option>
                            <option value="Africa/Tripoli">ØªÙˆÙ‚ÙŠØª Ø·Ø±Ø§Ø¨Ù„Ø³ (GMT+2)</option>
                            <option value="Africa/Khartoum">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ø±Ø·ÙˆÙ… (GMT+2)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="language">
                            <i class="fas fa-language"></i>
                            Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙØ¶Ù„Ø©
                        </label>
                        <select class="form-control" id="language">
                            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="address">
                        <i class="fas fa-map-marker-alt"></i>
                        Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
                    </label>
                    <textarea class="form-control" id="address" rows="2" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„..."></textarea>
                </div>
            </div>
        </div>

        <!-- Professional Information Section -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-briefcase"></i>
                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©
                </h3>
                <button class="section-toggle" onclick="toggleSection('professional')">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            
            <div class="section-content" id="professionalContent">
                <div class="form-grid-2">
                    <div class="form-group">
                        <label class="form-label" for="occupation">
                            <i class="fas fa-user-tie"></i>
                            Ø§Ù„Ù…Ù‡Ù†Ø©/Ø§Ù„ÙˆØ¸ÙŠÙØ©
                        </label>
                        <input type="text" class="form-control" id="occupation" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¯ÙŠØ± ØªØ³ÙˆÙŠÙ‚">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="company">
                            <i class="fas fa-building"></i>
                            Ø§Ù„Ø´Ø±ÙƒØ©/Ø§Ù„Ù…Ø¤Ø³Ø³Ø©
                        </label>
                        <input type="text" class="form-control" id="company" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="education">
                            <i class="fas fa-graduation-cap"></i>
                            Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ
                        </label>
                        <select class="form-control" id="education">
                            <option value="">-- Ø§Ø®ØªØ± --</option>
                            <option value="high-school">Ø«Ø§Ù†ÙˆÙŠØ© Ø¹Ø§Ù…Ø©</option>
                            <option value="diploma">Ø¯Ø¨Ù„ÙˆÙ…</option>
                            <option value="bachelor">Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³</option>
                            <option value="master">Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                            <option value="phd">Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="experience">
                            <i class="fas fa-award"></i>
                            Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø©
                        </label>
                        <select class="form-control" id="experience">
                            <option value="">-- Ø§Ø®ØªØ± --</option>
                            <option value="0-1">Ø£Ù‚Ù„ Ù…Ù† Ø³Ù†Ø©</option>
                            <option value="1-3">1-3 Ø³Ù†ÙˆØ§Øª</option>
                            <option value="3-5">3-5 Ø³Ù†ÙˆØ§Øª</option>
                            <option value="5-10">5-10 Ø³Ù†ÙˆØ§Øª</option>
                            <option value="10+">Ø£ÙƒØ«Ø± Ù…Ù† 10 Ø³Ù†ÙˆØ§Øª</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="interests">
                        <i class="fas fa-heart"></i>
                        Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª
                    </label>
                    <div class="tags-input" id="interestsContainer">
                        <input type="text" 
                               class="tag-input" 
                               id="interestsInput" 
                               placeholder="Ø§ÙƒØªØ¨ Ø§Ù‡ØªÙ…Ø§Ù… ÙˆØ§Ø¶ØºØ· Enter">
                        <div class="tags-list" id="interestsTags"></div>
                    </div>
                    <div class="form-hint">Ù…Ø«Ø§Ù„: Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠØŒ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø´Ø®ØµÙŠØŒ Ø±ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>
                </div>
            </div>
        </div>

        <!-- Notification Preferences Section -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-bell"></i>
                    ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                </h3>
                <button class="section-toggle" onclick="toggleSection('notifications')">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            
            <div class="section-content" id="notificationsContent">
                <div class="notification-preferences">
                    <div class="notification-group">
                        <h4 class="notification-title">
                            <i class="fas fa-envelope"></i>
                            Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                        </h4>
                        <div class="notification-options">
                            <label class="switch-item">
                                <input type="checkbox" id="emailNewCourse" checked>
                                <span class="switch-slider"></span>
                                <span class="switch-label">Ø¯ÙˆØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</span>
                            </label>
                            <label class="switch-item">
                                <input type="checkbox" id="emailReminders" checked>
                                <span class="switch-slider"></span>
                                <span class="switch-label">ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ø¯Ø±ÙˆØ³</span>
                            </label>
                            <label class="switch-item">
                                <input type="checkbox" id="emailPromotions">
                                <span class="switch-slider"></span>
                                <span class="switch-label">Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª</span>
                            </label>
                            <label class="switch-item">
                                <input type="checkbox" id="emailNewsletter">
                                <span class="switch-slider"></span>
                                <span class="switch-label">Ø§Ù„Ù†Ø´Ø±Ø© Ø§Ù„Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="notification-group">
                        <h4 class="notification-title">
                            <i class="fab fa-whatsapp"></i>
                            WhatsApp
                        </h4>
                        <div class="notification-options">
                            <label class="switch-item">
                                <input type="checkbox" id="whatsappReminders" checked>
                                <span class="switch-slider"></span>
                                <span class="switch-label">ØªØ°ÙƒÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø©</span>
                            </label>
                            <label class="switch-item">
                                <input type="checkbox" id="whatsappSupport" checked>
                                <span class="switch-slider"></span>
                                <span class="switch-label">Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø¹Ù…</span>
                            </label>
                            <label class="switch-item">
                                <input type="checkbox" id="whatsappProgress">
                                <span class="switch-slider"></span>
                                <span class="switch-label">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Fields Section -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-plus-circle"></i>
                    Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ©
                </h3>
                <button class="btn btn-sm btn-primary" onclick="addCustomField()">
                    <i class="fas fa-plus"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„
                </button>
            </div>
            
            <div class="section-content">
                <div class="custom-fields-container" id="customFieldsContainer">
                    <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ© Ù‡Ù†Ø§ -->
                </div>
                
                <div class="empty-custom-fields" id="emptyCustomFields">
                    <i class="fas fa-folder-open"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù‚ÙˆÙ„ Ù…Ø®ØµØµØ©</p>
                    <span>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù‚Ù„ Ø¬Ø¯ÙŠØ¯</span>
                </div>
            </div>
        </div>

        <!-- Admin Notes Section -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-sticky-note"></i>
                    Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                </h3>
                <button class="section-toggle" onclick="toggleSection('adminNotes')">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            
            <div class="section-content" id="adminNotesContent">
                <div class="admin-notes-editor">
                    <div class="editor-toolbar">
                        <button class="editor-btn" onclick="formatText('bold')">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="editor-btn" onclick="formatText('italic')">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button class="editor-btn" onclick="formatText('underline')">
                            <i class="fas fa-underline"></i>
                        </button>
                        <div class="editor-separator"></div>
                        <button class="editor-btn" onclick="formatText('insertUnorderedList')">
                            <i class="fas fa-list-ul"></i>
                        </button>
                        <button class="editor-btn" onclick="formatText('insertOrderedList')">
                            <i class="fas fa-list-ol"></i>
                        </button>
                        <div class="editor-separator"></div>
                        <button class="editor-btn" onclick="insertLink()">
                            <i class="fas fa-link"></i>
                        </button>
                        <button class="editor-btn" onclick="insertHighlight()">
                            <i class="fas fa-highlighter"></i>
                        </button>
                    </div>
                    <div class="editor-content" id="adminNotesEditor" contenteditable="true" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></div>
                </div>
                
                <div class="notes-metadata">
                    <div class="metadata-item">
                        <i class="fas fa-user"></i>
                        <span>Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙˆØ§Ø³Ø·Ø©: <strong id="lastEditedBy">-</strong></span>
                    </div>
                    <div class="metadata-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: <strong id="lastEditedDate">-</strong></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Timeline Section -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-history"></i>
                    Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                </h3>
                <button class="section-toggle" onclick="toggleSection('activity')">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            
            <div class="section-content" id="activityContent">
                <div class="activity-timeline">
                    <div class="timeline-item">
                        <div class="timeline-icon" style="background: var(--success);">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="timeline-content">
                            <h5 class="timeline-title">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</h5>
                            <p class="timeline-description">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
                            <span class="timeline-date">
                                <i class="fas fa-clock"></i>
                                Ø§Ù„Ø¢Ù†
                            </span>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-outline w-100 mt-3" onclick="loadMoreActivity()">
                    <i class="fas fa-sync"></i>
                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Custom Field Modal ==================== -->
<div class="modal" id="customFieldModal" style="display: none;">
    <div class="modal-backdrop" onclick="closeCustomFieldModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-plus-circle"></i>
                Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù…Ø®ØµØµ
            </h3>
            <button class="modal-close" onclick="closeCustomFieldModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label required" for="fieldLabel">
                    <i class="fas fa-tag"></i>
                    Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„
                </label>
                <input type="text" class="form-control" id="fieldLabel" placeholder="Ù…Ø«Ø§Ù„: Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="fieldType">
                    <i class="fas fa-list"></i>
                    Ù†ÙˆØ¹ Ø§Ù„Ø­Ù‚Ù„
                </label>
                <select class="form-control" id="fieldType">
                    <option value="text">Ù†Øµ</option>
                    <option value="number">Ø±Ù‚Ù…</option>
                    <option value="email">Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option>
                    <option value="date">ØªØ§Ø±ÙŠØ®</option>
                    <option value="select">Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø©</option>
                    <option value="textarea">Ù†Øµ Ø·ÙˆÙŠÙ„</option>
                    <option value="checkbox">Ù…Ø±Ø¨Ø¹ Ø§Ø®ØªÙŠØ§Ø±</option>
                </select>
            </div>
            
            <div class="form-group" id="fieldOptionsGroup" style="display: none;">
                <label class="form-label" for="fieldOptions">
                    <i class="fas fa-list-ul"></i>
                    Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                </label>
                <textarea class="form-control" id="fieldOptions" rows="4" placeholder="Ø®ÙŠØ§Ø± 1&#10;Ø®ÙŠØ§Ø± 2&#10;Ø®ÙŠØ§Ø± 3"></textarea>
                <div class="form-hint">Ø§ÙƒØªØ¨ ÙƒÙ„ Ø®ÙŠØ§Ø± ÙÙŠ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„</div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="fieldRequired">
                    <span>Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨</span>
                </label>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeCustomFieldModal()">
                Ø¥Ù„ØºØ§Ø¡
            </button>
            <button class="btn btn-primary" onclick="saveCustomField()">
                <i class="fas fa-check"></i>
                Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚Ù„
            </button>
        </div>
    </div>
</div>
<!-- ==================== Financial Tab Panel ==================== -->
<div class="tab-panel" id="financialPanel" role="tabpanel" aria-labelledby="financialTab">
    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„: Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
    <div class="financial-summary">
        <h3 class="section-title">
            <i class="fas fa-chart-line"></i>
            Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠ
        </h3>
        
        <div class="summary-cards">
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="summary-content">
                    <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h4>
                    <p class="amount" id="totalPaid">0 Ø¬Ù†ÙŠÙ‡</p>
                </div>
            </div>
            
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="summary-content">
                    <h4>Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</h4>
                    <p class="amount" id="totalPending">0 Ø¬Ù†ÙŠÙ‡</p>
                </div>
            </div>
            
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="summary-content">
                    <h4>Ø§Ù„Ù…Ù†Ø­ ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª</h4>
                    <p class="amount" id="totalGrants">0 Ø¬Ù†ÙŠÙ‡</p>
                </div>
            </div>
            
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="summary-content">
                    <h4>Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡</h4>
                    <p class="amount" id="loyaltyPoints">0 Ù†Ù‚Ø·Ø©</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
    <div class="add-transaction-section">
        <h3 class="section-title">
            <i class="fas fa-plus-circle"></i>
            Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ø§Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
        </h3>
        
        <form id="transactionForm" class="transaction-form">
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                    <select class="form-control" id="transactionType" onchange="updateTransactionForm()">
                        <option value="payment">Ø¯ÙØ¹Ø© Ù…Ø§Ù„ÙŠØ©</option>
                        <option value="grant">Ù…Ù†Ø­Ø© Ø¯Ø±Ø§Ø³ÙŠØ©</option>
                        <option value="gift">Ù‡Ø¯ÙŠØ©/Ù…ÙƒØ§ÙØ£Ø©</option>
                        <option value="compensation">ØªØ¹ÙˆÙŠØ¶</option>
                        <option value="refund">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</option>
                    </select>
                </div>
                
                <div class="form-group col-md-4">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="transactionAmount" 
                               placeholder="0" min="0" step="0.01">
                        <div class="input-group-append">
                            <span class="input-group-text">Ø¬Ù†ÙŠÙ‡</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group col-md-4">
                    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                    <input type="datetime-local" class="form-control" id="transactionDate">
                </div>
            </div>

            <div class="form-row" id="paymentDetailsRow">
                <div class="form-group col-md-4">
                    <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select class="form-control" id="paymentMethod">
                        <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="vodafone">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
                        <option value="instapay">InstaPay</option>
                        <option value="bank">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                        <option value="western">ÙˆÙŠØ³ØªØ±Ù† ÙŠÙˆÙ†ÙŠÙˆÙ†</option>
                        <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
                    </select>
                </div>
                
                <div class="form-group col-md-4">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©/Ø§Ù„Ù…Ø±Ø¬Ø¹</label>
                    <input type="text" class="form-control" id="transactionReference" 
                           placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø£Ùˆ Ø§Ù„Ù…Ø±Ø¬Ø¹">
                </div>
                
                <div class="form-group col-md-4">
                    <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                    <select class="form-control" id="transactionStatus">
                        <option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option>
                        <option value="pending">Ù…Ø¹Ù„Ù‚Ø©</option>
                        <option value="failed">ÙØ´Ù„Øª</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label>Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€</label>
                    <select class="form-control" id="relatedType" onchange="updateRelatedOptions()">
                        <option value="">ØºÙŠØ± Ù…Ø±ØªØ¨Ø·Ø©</option>
                        <option value="course">Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©</option>
                        <option value="path">Ù…Ø³Ø§Ø± ØªØ¯Ø±ÙŠØ¨ÙŠ</option>
                        <option value="subscription">Ø§Ø´ØªØ±Ø§Ùƒ</option>
                        <option value="other">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                
                <div class="form-group col-md-6" id="relatedItemGroup" style="display: none;">
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù†ØµØ±</label>
                    <select class="form-control" id="relatedItem">
                        <option value="">Ø§Ø®ØªØ±...</option>
                    </select>
                </div>
            </div>

            <div class="form-row" id="installmentRow" style="display: none;">
                <div class="form-group col-md-3">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹</label>
                    <select class="form-control" id="paymentPlanType" onchange="toggleInstallmentDetails()">
                        <option value="full">Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                        <option value="installment">Ø£Ù‚Ø³Ø§Ø·</option>
                    </select>
                </div>
                
                <div class="installment-details" style="display: none;">
                    <div class="form-group col-md-3">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</label>
                        <input type="number" class="form-control" id="totalInstallments" 
                               min="2" max="12" placeholder="2">
                    </div>
                    
                    <div class="form-group col-md-3">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                        <input type="number" class="form-control" id="currentInstallment" 
                               min="1" placeholder="1">
                    </div>
                    
                    <div class="form-group col-md-3">
                        <label>ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</label>
                        <select class="form-control" id="installmentFrequency">
                            <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                            <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                            <option value="custom">Ù…Ø®ØµØµ</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea class="form-control" id="transactionNotes" rows="2" 
                          placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="addTransaction()">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetTransactionForm()">
                    <i class="fas fa-undo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>
        </form>
    </div>

    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«: Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª -->
    <div class="transactions-history">
        <h3 class="section-title">
            <i class="fas fa-history"></i>
            Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
        </h3>
        
        <div class="filters-row">
            <div class="filter-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:</label>
                <select class="form-control form-control-sm" id="filterType">
                    <option value="">Ø§Ù„ÙƒÙ„</option>
                    <option value="payment">Ø¯ÙØ¹Ø§Øª</option>
                    <option value="grant">Ù…Ù†Ø­</option>
                    <option value="gift">Ù‡Ø¯Ø§ÙŠØ§</option>
                    <option value="compensation">ØªØ¹ÙˆÙŠØ¶Ø§Øª</option>
                    <option value="refund">Ù…Ø³ØªØ±Ø¬Ø¹Ø§Øª</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                <select class="form-control form-control-sm" id="filterStatus">
                    <option value="">Ø§Ù„ÙƒÙ„</option>
                    <option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option>
                    <option value="pending">Ù…Ø¹Ù„Ù‚Ø©</option>
                    <option value="failed">ÙØ§Ø´Ù„Ø©</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Ø§Ù„ÙØªØ±Ø©:</label>
                <select class="form-control form-control-sm" id="filterPeriod">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</option>
                    <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
                    <option value="week">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                    <option value="month">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
                    <option value="year">Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©</option>
                </select>
            </div>
            
            <button class="btn btn-sm btn-primary" onclick="applyFilters()">
                <i class="fas fa-filter"></i> ØªØ·Ø¨ÙŠÙ‚
            </button>
        </div>

        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                        <th>Ø§Ù„Ù…Ø±Ø¬Ø¹</th>
                        <th>Ù…Ø±ØªØ¨Ø· Ø¨Ù€</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="transactionsTableBody">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="noTransactions" class="text-center text-muted py-4" style="display: none;">
            <i class="fas fa-inbox fa-3x mb-3"></i>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø§Ù„ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
        </div>
    </div>

    <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© -->
    <div class="upcoming-payments">
        <h3 class="section-title">
            <i class="fas fa-calendar-check"></i>
            Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©
        </h3>
        
        <div id="upcomingPaymentsList">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
        </div>
        
        <div id="noUpcomingPayments" class="text-center text-muted py-4">
            <i class="fas fa-calendar-times fa-3x mb-3"></i>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ø· Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</p>
        </div>
    </div>
</div>
<!-- ==================== Additional CSS for Advanced Tab ==================== -->
<style>
    /* ==================== Info Sections ==================== */
    .info-section {
        background: var(--lighter);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        margin-bottom: var(--spacing-xl);
        overflow: hidden;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-lg);
        background: var(--dark);
        border-bottom: 1px solid var(--border);
    }

    .section-toggle {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: var(--font-lg);
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: var(--radius-sm);
        transition: var(--transition);
    }

    .section-toggle:hover {
        background: var(--lighter);
        color: var(--primary);
    }

    .section-toggle i {
        transition: var(--transition);
    }

    .section-content {
        padding: var(--spacing-lg);
    }

    .section-content.collapsed {
        display: none;
    }

    .section-header.collapsed .section-toggle i {
        transform: rotate(180deg);
    }

    /* ==================== Form Grids ==================== */
    .form-grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-lg);
    }

    .form-grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-lg);
    }

    /* ==================== Tags Input ==================== */
    .tags-input {
        background: var(--dark);
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        padding: var(--spacing-sm);
        min-height: 120px;
        position: relative;
    }

    .tag-input {
        background: none;
        border: none;
        color: var(--text);
        font-size: var(--font-base);
        width: 100%;
        padding: var(--spacing-sm);
    }

    .tag-input:focus {
        outline: none;
    }

    .tags-list {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-sm);
    }

    .tag-item {
        background: var(--primary);
        color: var(--dark);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-xl);
        font-size: var(--font-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        animation: fadeIn 0.3s ease;
    }

    .tag-item button {
        background: none;
        border: none;
        color: var(--dark);
        cursor: pointer;
        padding: 0;
        margin-right: var(--spacing-xs);
        font-size: var(--font-sm);
    }

    .tag-item button:hover {
        color: var(--danger);
    }

    /* ==================== Notification Preferences ==================== */
    .notification-preferences {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: var(--spacing-xl);
    }

    .notification-group {
        background: var(--dark);
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
    }

    .notification-title {
        font-size: var(--font-lg);
        margin-bottom: var(--spacing-lg);
        color: var(--text);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    .notification-options {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    /* ==================== Switch Item ==================== */
    .switch-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        cursor: pointer;
        user-select: none;
    }

    .switch-item input[type="checkbox"] {
        position: absolute;
        opacity: 0;
    }

    .switch-slider {
        width: 44px;
        height: 24px;
        background: var(--lighter);
        border-radius: 24px;
        position: relative;
        transition: var(--transition);
    }

    .switch-slider::after {
        content: '';
        position: absolute;
        width: 18px;
        height: 18px;
        background: var(--text-muted);
        border-radius: 50%;
        top: 3px;
        right: 23px;
        transition: var(--transition);
    }

    .switch-item input[type="checkbox"]:checked ~ .switch-slider {
        background: var(--primary);
    }

    .switch-item input[type="checkbox"]:checked ~ .switch-slider::after {
        right: 3px;
        background: white;
    }

    .switch-label {
        color: var(--text);
        font-size: var(--font-base);
    }

    /* ==================== Custom Fields ==================== */
    .custom-fields-container {
        display: grid;
        gap: var(--spacing-md);
    }

    .custom-field-item {
        background: var(--dark);
        padding: var(--spacing-md);
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        animation: slideIn 0.3s ease;
    }

    .custom-field-icon {
        width: 40px;
        height: 40px;
        background: var(--lighter);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        flex-shrink: 0;
    }

    .custom-field-content {
        flex: 1;
    }

    .custom-field-label {
        font-weight: 500;
        color: var(--text);
        margin-bottom: var(--spacing-xs);
    }

    .custom-field-type {
        font-size: var(--font-sm);
        color: var(--text-muted);
    }

    .custom-field-remove {
        background: var(--danger);
        color: white;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .custom-field-remove:hover {
        background: var(--danger-dark);
        transform: scale(1.1);
    }

    .empty-custom-fields {
        text-align: center;
        padding: var(--spacing-2xl);
        color: var(--text-muted);
    }

    .empty-custom-fields i {
        font-size: 3rem;
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
    }

    .empty-custom-fields p {
        font-size: var(--font-lg);
        margin-bottom: var(--spacing-sm);
    }

    /* ==================== Admin Notes Editor ==================== */
    .admin-notes-editor {
        background: var(--dark);
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        overflow: hidden;
    }

    .editor-toolbar {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        padding: var(--spacing-sm);
        background: var(--lighter);
        border-bottom: 1px solid var(--border);
    }

    .editor-btn {
        background: none;
        border: none;
        color: var(--text-muted);
        width: 32px;
        height: 32px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .editor-btn:hover {
        background: var(--dark);
        color: var(--primary);
    }

    .editor-btn.active {
        background: var(--primary);
        color: var(--dark);
    }

    .editor-separator {
        width: 1px;
        height: 20px;
        background: var(--border);
        margin: 0 var(--spacing-xs);
    }

    .editor-content {
        padding: var(--spacing-lg);
        min-height: 150px;
        max-height: 300px;
        overflow-y: auto;
        color: var(--text);
        line-height: 1.6;
    }

    .editor-content:focus {
        outline: none;
    }

    .editor-content[contenteditable="true"]:empty::before {
        content: attr(placeholder);
        color: var(--text-muted);
        pointer-events: none;
    }

    .notes-metadata {
        display: flex;
        justify-content: space-between;
        margin-top: var(--spacing-md);
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--border);
        font-size: var(--font-sm);
        color: var(--text-muted);
    }

    .metadata-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    /* ==================== Activity Timeline ==================== */
    .activity-timeline {
        position: relative;
        padding-right: var(--spacing-xl);
    }

    .activity-timeline::before {
        content: '';
        position: absolute;
        right: 16px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: var(--border);
    }

    .timeline-item {
        position: relative;
        margin-bottom: var(--spacing-xl);
        animation: slideIn 0.3s ease;
    }

    .timeline-icon {
        position: absolute;
        right: 0;
        width: 32px;
        height: 32px;
        background: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        border: 3px solid var(--lighter);
    }

    .timeline-content {
        background: var(--dark);
        padding: var(--spacing-md);
        border-radius: var(--radius-sm);
        margin-right: var(--spacing-3xl);
        border: 1px solid var(--border);
    }

    .timeline-title {
        font-size: var(--font-base);
        font-weight: 600;
        color: var(--text);
        margin-bottom: var(--spacing-xs);
    }

    .timeline-description {
        font-size: var(--font-sm);
        color: var(--text-muted);
        margin-bottom: var(--spacing-sm);
    }

    .timeline-date {
        font-size: var(--font-xs);
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
    }

    /* ==================== Utilities ==================== */
    .w-100 {
        width: 100%;
    }

    /* ==================== Responsive ==================== */
    @media (max-width: 992px) {
        .form-grid-3 {
            grid-template-columns: 1fr;
        }

        .form-grid-2 {
            grid-template-columns: 1fr;
        }

        .notification-preferences {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .section-header {
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .notes-metadata {
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .editor-toolbar {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
    }
</style>
                    

                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <div class="actions-left">
                    <button class="btn btn-outline" id="cancelBtn">
                        <i class="fas fa-times"></i>
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button class="btn btn-outline" id="resetBtn">
                        <i class="fas fa-redo"></i>
                        Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                    </button>
                </div>
                <div class="actions-right">
                    <button class="btn btn-secondary" id="saveDraftBtn">
                        <i class="fas fa-file-alt"></i>
                        Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©
                    </button>
                    <button class="btn btn-primary" id="saveBtn">
                        <i class="fas fa-check"></i>
                        <span id="saveBtnText">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- ==================== Additional CSS for Structure ==================== -->
    <style>
        /* ==================== Loading Overlay ==================== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-lg);
            position: relative;
        }

        .spinner-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }

        .spinner-ring:nth-child(2) {
            width: 60px;
            height: 60px;
            top: 10px;
            left: 10px;
            border-top-color: var(--secondary);
            animation-duration: 1s;
        }

        .spinner-ring:nth-child(3) {
            width: 40px;
            height: 40px;
            top: 20px;
            left: 20px;
            border-top-color: var(--success);
            animation-duration: 0.5s;
        }

        .loading-text {
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
        }

        .loading-subtext {
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        /* ==================== Auto Save Indicator ==================== */
        .auto-save-indicator {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--success);
            color: white;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: var(--z-fixed);
        }

        .auto-save-indicator.show {
            transform: translateX(-50%) translateY(0);
        }

        /* ==================== Header ==================== */
        .main-header {
            background: var(--dark);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            box-shadow: var(--shadow-sm);
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-xl);
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-left,
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .menu-toggle {
            background: none;
            border: none;
            color: var(--text);
            font-size: var(--font-xl);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background: var(--lighter);
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .header-logo img {
            height: 40px;
            width: auto;
        }

        .logo-text {
            font-size: var(--font-xl);
            font-weight: 600;
            color: var(--primary);
        }

        /* ==================== Breadcrumb ==================== */
        .breadcrumb {
            flex: 1;
        }

        .breadcrumb-list {
            display: flex;
            align-items: center;
            list-style: none;
            padding: 0;
            margin: 0;
            flex-wrap: wrap;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
        }

        .breadcrumb-item a {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            color: var(--text-muted);
            transition: var(--transition);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
        }

        .breadcrumb-item a:hover {
            color: var(--primary);
            background: rgba(var(--primary-rgb), 0.1);
        }

        .breadcrumb-item.active {
            color: var(--text);
            font-weight: 500;
        }

        .breadcrumb-separator {
            color: var(--text-dark);
            margin: 0 var(--spacing-xs);
            font-size: var(--font-sm);
        }

        /* ==================== Header Icons ==================== */
        .icon-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: var(--font-lg);
            padding: var(--spacing-sm);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .icon-btn:hover {
            background: var(--lighter);
            color: var(--primary);
        }

        .notification-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--danger);
            color: white;
            font-size: var(--font-xs);
            padding: 2px 6px;
            border-radius: var(--radius-xl);
            font-weight: 600;
        }

        /* ==================== User Menu ==================== */
        .user-menu-toggle {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--lighter);
            border: none;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-xl);
            cursor: pointer;
            transition: var(--transition);
        }

        .user-menu-toggle:hover {
            background: rgba(var(--primary-rgb), 0.1);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-name {
            color: var(--text);
            font-weight: 500;
        }

        /* ==================== Main Container ==================== */
        .main-container {
            display: flex;
            min-height: calc(100vh - 65px);
        }
        /* Ø£ÙƒÙˆØ§Ø¯ User ID Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
/* ==================== User ID Field Styles ==================== */
#userId {
    font-family: monospace;
    letter-spacing: 1px;
    background-color: rgba(255, 255, 255, 0.05);
    border: 2px solid var(--border);
    border-top-left-radius: var(--radius-sm) !important;
    border-bottom-left-radius: var(--radius-sm) !important;
    border-top-right-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
}

#saveUserIdBtn {
    min-width: 150px;
    white-space: nowrap;
    border-top-right-radius: var(--radius-sm) !important;
    border-bottom-right-radius: var(--radius-sm) !important;
    border-top-left-radius: 0 !important;
    border-bottom-left-radius: 0 !important;
    margin-right: -1px;
}

#saveUserIdBtn.btn-success {
    background: var(--success);
    border-color: var(--success);
}

.input-group {
    display: flex;
    align-items: stretch;
}

.input-group .form-control {
    flex: 1;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
}

.input-group .btn {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
}

        /* ==================== Sidebar ==================== */
        .sidebar {
            width: 260px;
            background: var(--dark);
            border-left: 1px solid var(--border);
            overflow-y: auto;
            transition: var(--transition);
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .nav-list {
            list-style: none;
            padding: var(--spacing-md) 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-lg);
            color: var(--text-light);
            transition: var(--transition);
            position: relative;
        }

        .nav-link:hover {
            background: var(--lighter);
            color: var(--primary);
        }

        .nav-item.active .nav-link {
            background: rgba(var(--primary-rgb), 0.1);
            color: var(--primary);
        }

        .nav-item.active .nav-link::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
        }

        .sidebar.collapsed .nav-link span {
            display: none;
        }

        /* ==================== Main Content ==================== */
        .main-content {
            flex: 1;
            background: var(--darker);
            overflow-y: auto;
            padding: var(--spacing-xl);
        }

        /* ==================== Page Header ==================== */
        .page-header {
            background: var(--dark);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
        }

        .page-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-lg);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
        }

        .page-subtitle {
            color: var(--text-muted);
            margin: 0;
        }

        .page-header-right {
            display: flex;
            gap: var(--spacing-md);
        }

        /* ==================== Progress Bar ==================== */
        .progress-container {
            background: var(--dark);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .progress-bar {
            height: 8px;
            background: var(--lighter);
            border-radius: var(--radius-xl);
            overflow: hidden;
            margin-bottom: var(--spacing-xl);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
        }

        .progress-step {
            text-align: center;
            position: relative;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            background: var(--lighter);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-sm);
            font-weight: 600;
            transition: var(--transition);
        }

        .progress-step.active .step-circle {
            background: var(--primary);
            color: var(--dark);
        }

        .progress-step.completed .step-circle {
            background: var(--success);
            color: white;
        }

        .step-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .progress-step.active .step-label {
            color: var(--primary);
            font-weight: 500;
        }

        /* ==================== Tabs ==================== */
        .tabs-container {
            background: var(--dark);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
        }

        .tabs-nav {
            background: var(--lighter);
            padding: var(--spacing-sm);
        }

        .tabs-list {
            display: flex;
            list-style: none;
            gap: var(--spacing-sm);
            margin: 0;
            padding: 0;
        }

        .tab-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-base);
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        .tab-link.active {
            background: var(--dark);
            color: var(--primary);
        }

        .tab-panels {
            padding: var(--spacing-xl);
            min-height: 400px;
        }

        /* ==================== Form Actions ==================== */
        .form-actions {
            background: var(--dark);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-lg);
            position: sticky;
            bottom: var(--spacing-xl);
            box-shadow: var(--shadow);
        }

        .actions-left,
        .actions-right {
            display: flex;
            gap: var(--spacing-md);
        }

        /* ==================== Buttons ==================== */
        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-sm);
            font-size: var(--font-base);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-family: inherit;
            white-space: nowrap;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--dark);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(var(--primary-rgb), 0.4);
        }

        .btn-secondary {
            background: var(--lighter);
            color: var(--text);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--lightest);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .btn-outline:hover:not(:disabled) {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(var(--primary-rgb), 0.1);
        }

        /* ==================== Responsive Design ==================== */
        @media (max-width: 1200px) {
            .header-center {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -260px;
                height: 100%;
                z-index: var(--z-modal-backdrop);
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                padding: var(--spacing-md);
            }

            .page-header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .tabs-list {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .progress-steps {
                display: none;
            }

            .form-actions {
                flex-direction: column;
                gap: var(--spacing-md);
                bottom: 0;
                left: 0;
                right: 0;
                border-radius: 0;
                border-top: 1px solid var(--border);
            }

            .actions-left,
            .actions-right {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
    <!-- Ø£Ø¶Ù Ù‡Ø°Ø§ CSS ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ù…Ù„Ù user-builder.html Ø¨Ø¹Ø¯ Ø§Ù„Ù€ CSS Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ -->

<style>
/* ==================== Financial Tab Styles ==================== */
.financial-summary {
    background: var(--lighter);
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-xl);
    border: 1px solid var(--border);
}

.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-lg);
    margin-top: var(--spacing-lg);
}

.summary-card {
    background: var(--dark);
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    transition: var(--transition);
}

.summary-card:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
}

.summary-icon {
    width: 50px;
    height: 50px;
    background: rgba(var(--primary-rgb), 0.1);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-size: var(--font-xl);
}

.summary-content h4 {
    font-size: var(--font-sm);
    color: var(--text-muted);
    margin-bottom: var(--spacing-xs);
}

.summary-content .amount {
    font-size: var(--font-xl);
    font-weight: 700;
    color: var(--text);
}

/* ==================== Transaction Form ==================== */
.add-transaction-section {
    background: var(--lighter);
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-xl);
    border: 1px solid var(--border);
}

.transaction-form {
    margin-top: var(--spacing-lg);
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    font-weight: 500;
    color: var(--text);
    margin-bottom: var(--spacing-sm);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.form-control {
    padding: var(--spacing-md);
    background: var(--dark);
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    font-size: var(--font-base);
    transition: var(--transition);
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
    background: rgba(var(--primary-rgb), 0.05);
}

.input-group {
    display: flex;
    align-items: stretch;
}

.input-group .form-control {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
    border-left: none;
}

.input-group-append {
    display: flex;
}

.input-group-text {
    padding: var(--spacing-md);
    background: var(--lightest);
    border: 2px solid var(--border);
    border-right: none;
    color: var(--text);
    display: flex;
    align-items: center;
    border-top-right-radius: var(--radius-sm);
    border-bottom-right-radius: var(--radius-sm);
}

.duration-input {
    display: flex;
    gap: var(--spacing-sm);
}

.duration-input input {
    flex: 2;
}

.duration-input select {
    flex: 1;
}

.discount-input {
    position: relative;
    display: flex;
    align-items: center;
}

.discount-symbol {
    position: absolute;
    left: var(--spacing-md);
    color: var(--text-muted);
    pointer-events: none;
}

.form-actions {
    display: flex;
    gap: var(--spacing-md);
    justify-content: flex-end;
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--border);
}

/* ==================== Transactions History ==================== */
.transactions-history {
    background: var(--lighter);
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-xl);
    border: 1px solid var(--border);
}

.filters-row {
    display: flex;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
    flex-wrap: wrap;
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
    min-width: 150px;
}

.filter-group label {
    font-size: var(--font-sm);
    color: var(--text-muted);
    margin-bottom: var(--spacing-xs);
}

.form-control-sm {
    padding: var(--spacing-sm);
    font-size: var(--font-sm);
}

.table-responsive {
    overflow-x: auto;
    margin-top: var(--spacing-lg);
}

.table {
    width: 100%;
    border-collapse: collapse;
    background: var(--dark);
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.table th,
.table td {
    padding: var(--spacing-md);
    text-align: right;
    border-bottom: 1px solid var(--border);
}

.table th {
    background: var(--lighter);
    font-weight: 600;
    color: var(--text);
    font-size: var(--font-sm);
}

.table td {
    color: var(--text-light);
}

.table-hover tbody tr:hover {
    background: rgba(var(--primary-rgb), 0.05);
}

/* Transaction Status Badges */
.transaction-type {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: var(--font-sm);
    font-weight: 500;
}

.transaction-type.payment {
    background: rgba(var(--success-rgb), 0.2);
    color: var(--success);
}

.transaction-type.grant {
    background: rgba(var(--info-rgb), 0.2);
    color: var(--info);
}

.transaction-type.gift {
    background: rgba(var(--warning-rgb), 0.2);
    color: var(--warning);
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: var(--font-sm);
    font-weight: 500;
}

.status-badge.completed {
    background: rgba(var(--success-rgb), 0.2);
    color: var(--success);
}

.status-badge.pending {
    background: rgba(var(--warning-rgb), 0.2);
    color: var(--warning);
}

.status-badge.failed {
    background: rgba(var(--danger-rgb), 0.2);
    color: var(--danger);
}

.action-buttons {
    display: flex;
    gap: var(--spacing-xs);
}

.btn-sm {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-sm);
}

.btn-outline-primary {
    background: transparent;
    color: var(--primary);
    border: 1px solid var(--primary);
}

.btn-outline-primary:hover {
    background: var(--primary);
    color: var(--dark);
}

.btn-outline-danger {
    background: transparent;
    color: var(--danger);
    border: 1px solid var(--danger);
}

.btn-outline-danger:hover {
    background: var(--danger);
    color: white;
}

/* ==================== Upcoming Payments ==================== */
.upcoming-payments {
    background: var(--lighter);
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
}

/* ==================== Empty States ==================== */
.text-center {
    text-align: center;
}

.text-muted {
    color: var(--text-muted);
}

.py-4 {
    padding: var(--spacing-2xl) 0;
}

.fa-3x {
    font-size: 3rem;
}

.mb-3 {
    margin-bottom: var(--spacing-lg);
}

/* ==================== Responsive Design ==================== */
@media (max-width: 768px) {
    .summary-cards {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .filters-row {
        flex-direction: column;
    }
    
    .filter-group {
        min-width: 100%;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .table-responsive {
        font-size: var(--font-sm);
    }
    
    .table th,
    .table td {
        padding: var(--spacing-sm);
    }
}

/* ==================== Installment Details ==================== */
.installment-details {
    display: none;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-lg);
    margin-top: var(--spacing-md);
}

.installment-details.show {
    display: grid;
}

/* ==================== Colors for different currencies ==================== */
.summary-card[data-currency="EGP"] .summary-icon {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
}

.summary-card[data-currency="SAR"] .summary-icon {
    background: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
}

.summary-card[data-currency="USD"] .summary-icon {
    background: rgba(168, 85, 247, 0.1);
    color: #a855f7;
}
</style>
<script>
// ==================== Firebase Configuration ====================
const firebaseConfig = {
    apiKey: "AIzaSyDj0bV5gsyRbqpxzW0Zd9wjYmq53-Xdj3w",
    authDomain: "fouad-perspective.firebaseapp.com",
    projectId: "fouad-perspective",
    storageBucket: "fouad-perspective.firebasestorage.app",
    messagingSenderId: "1068763865336",
    appId: "1:1068763865336:web:b791abcd22d536aedd5b0d",
    measurementId: "G-RY1FYVB3Q9"
};

// Initialize Firebase
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.firestore();

// ==================== Global Variables ====================
let currentUser = null;
let editMode = false;
let autoSaveTimer = null;
let formData = {
    basic: {},
    roles: {},
    courses: [],
    advanced: {}
};
let customFields = [];
let availableCourses = [];
let availablePaths = [];
// Firebase initialization check
let db;
if (window.firebase && window.firebase.firestore) {
    db = window.firebase.firestore();
} else {
    console.error('Firebase Firestore not initialized!');
}
// ==================== Page Initialization ====================
document.addEventListener('DOMContentLoaded', async function() {
    // Initialize Firebase Firestore
    const db = firebase.firestore();
    window.db = db; // Make it globally accessible
    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        await checkAuth();
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±
        checkEditMode();
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        await initializePage();
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
        setupEventListeners();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await loadInitialData();
        
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        hideLoading();
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©:', error);
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©');
    }
});

// ==================== Authentication Functions ====================
async function checkAuth() {
    return new Promise((resolve, reject) => {
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†
                if (user.email === 'admin@fouad-academy.com') {
                    resolve();
                } else {
                    window.location.href = '/admin/login.html';
                    reject('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„');
                }
            } else {
                window.location.href = '/admin/login.html';
                reject('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            }
        });
    });
}

// ==================== Edit Mode Functions ====================
function checkEditMode() {
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('id');
    
    if (userId) {
        editMode = true;
        currentUserId = userId;
        updatePageForEditMode();
    }
    if (userId) {
    currentUserId = userId;
}
    if (userId) {
    currentUserId = userId;
}
}

function updatePageForEditMode() {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    document.getElementById('pageMode').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
    document.getElementById('pageTitleText').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
    document.getElementById('saveBtnText').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
    
    // Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    document.getElementById('passwordGroup').style.display = 'none';
    document.getElementById('confirmPasswordGroup').style.display = 'none';
    
    // Ø¬Ø¹Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·
    document.getElementById('email').readOnly = true;
    document.getElementById('emailFeedback').textContent = 'Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ';
    document.getElementById('emailFeedback').classList.add('show', 'error');
}

// ==================== Page Initialization ====================
async function initializePage() {
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù†ØµÙŠ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    initializeNotesEditor();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„
    await loadCountries();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    initializeTabs();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
    initializeDragAndDrop();
}

// ==================== Load Initial Data ====================
async function loadInitialData() {
    try {
        showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        await loadAvailableContent();
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (editMode && currentUserId) {
            await loadUserData(currentUserId);
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
}

// ==================== Load User Data for Edit ====================
async function loadUserData(userId) {
    try {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© users
        let userData = null;
        const userDoc = await db.collection('users').doc(userId).get();
        
        if (userDoc.exists) {
            userData = { id: userDoc.id, ...userDoc.data() };
            currentUserId = userDoc.id; // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
        } else {
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            const usersQuery = await db.collection('users').where('email', '==', userId).limit(1).get();
            if (!usersQuery.empty) {
                userData = { id: usersQuery.docs[0].id, ...usersQuery.docs[0].data() };
                currentUserId = usersQuery.docs[0].id;
            }
        }
        
        if (!userData) {
            throw new Error('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        fillFormWithUserData(userData);
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø±Ù ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
if (document.getElementById('userId')) {
    document.getElementById('userId').value = currentUserId || userData.id;
    
    // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„ØªÙˆÙ„ÙŠØ¯ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    const saveIdBtn = document.getElementById('saveUserIdBtn');
    if (saveIdBtn) {
        saveIdBtn.disabled = true;
        saveIdBtn.innerHTML = '<i class="fas fa-lock"></i> Ù…Ø­ÙÙˆØ¸';
        saveIdBtn.classList.remove('btn-primary');
        saveIdBtn.classList.add('btn-secondary');
    }
}
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
        await loadUserTransactions();
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        setTimeout(() => {
            window.location.href = '/admin/users.html';
        }, 2000);
    }
}


// ==================== Fill Form with User Data ====================
function fillFormWithUserData(userData) {
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    if (userData.name) {
        const nameParts = userData.name.split(' ');
        document.getElementById('firstName').value = nameParts[0] || '';
        document.getElementById('lastName').value = nameParts.slice(1).join(' ') || '';
    }
    document.getElementById('email').value = userData.email || '';
    
    // Ø±Ù‚Ù… WhatsApp
    if (userData.whatsapp || userData.phone) {
        const phoneNumber = userData.whatsapp || userData.phone;
        const phoneMatch = phoneNumber.match(/^(\+\d{1,4})?(\d+)$/);
        if (phoneMatch) {
            if (phoneMatch[1]) {
                document.getElementById('countryCode').value = phoneMatch[1];
            }
            document.getElementById('phoneNumber').value = phoneMatch[2] || '';
        }
    }
    
    // Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
    const accountStatus = userData.isActive === false ? 'inactive' : 
                         userData.status === 'pending' ? 'pending' : 'active';
    document.querySelector(`input[name="accountStatus"][value="${accountStatus}"]`).checked = true;
    
    // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
    if (userData.avatar) {
        displayAvatar(userData.avatar);
    }
    
    // Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    if (userData.role) {
        document.querySelector(`input[name="primaryRole"][value="${userData.role}"]`).checked = true;
        updatePermissionsForRole(userData.role);
    }
    
    if (userData.permissions) {
        userData.permissions.forEach(permission => {
            const checkbox = document.querySelector(`input[name="permissions"][value="${permission}"]`);
            if (checkbox) checkbox.checked = true;
        });
        updatePermissionsCounts();
    }
    
    // Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©
    if (userData.enrollments) {
        userData.enrollments.forEach(enrollment => {
            const course = availableCourses.find(c => c.id === enrollment.id) || 
                          availablePaths.find(p => p.id === enrollment.id);
            if (course) {
                assignCourse(course, enrollment);
            }
        });
    }
    
    // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    fillAdvancedInfo(userData);
}

// ==================== Fill Advanced Information ====================
function fillAdvancedInfo(userData) {
    // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
    if (userData.birthDate) document.getElementById('birthDate').value = userData.birthDate;
    if (userData.gender) document.getElementById('gender').value = userData.gender;
    if (userData.nationality) document.getElementById('nationality').value = userData.nationality;
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„
    if (userData.country) document.getElementById('country').value = userData.country;
    if (userData.city) document.getElementById('city').value = userData.city;
    if (userData.timezone) document.getElementById('timezone').value = userData.timezone;
    if (userData.language) document.getElementById('language').value = userData.language;
    if (userData.address) document.getElementById('address').value = userData.address;
    
    // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©
    if (userData.occupation) document.getElementById('occupation').value = userData.occupation;
    if (userData.company) document.getElementById('company').value = userData.company;
    if (userData.education) document.getElementById('education').value = userData.education;
    if (userData.experience) document.getElementById('experience').value = userData.experience;
    
    // Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª
    if (userData.interests && Array.isArray(userData.interests)) {
        userData.interests.forEach(interest => addInterestTag(interest));
    }
    
    // ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    if (userData.notifications) {
        Object.keys(userData.notifications).forEach(key => {
            const checkbox = document.getElementById(key);
            if (checkbox) checkbox.checked = userData.notifications[key];
        });
    }
    
    // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ©
    if (userData.customFields && Array.isArray(userData.customFields)) {
        userData.customFields.forEach(field => addCustomFieldToForm(field));
    }
    
    // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    if (userData.adminNotes) {
        document.getElementById('adminNotesEditor').innerHTML = userData.adminNotes;
    }
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„
    if (userData.lastUpdated) {
        document.getElementById('lastEditedBy').textContent = userData.lastUpdatedBy || 'Ø§Ù„Ù†Ø¸Ø§Ù…';
        document.getElementById('lastEditedDate').textContent = formatDate(userData.lastUpdated.toDate());
    }
}

// ==================== Tab Navigation ====================
function initializeTabs() {
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabPanels = document.querySelectorAll('.tab-panel');
    
    tabLinks.forEach(link => {
        link.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            tabLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            tabPanels.forEach(panel => panel.classList.remove('active'));
            document.getElementById(targetTab + 'Panel').classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            updateProgressBar(targetTab);
            
            // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            autoSave();
        });
    });
}

// ==================== Progress Bar ====================
function updateProgressBar(currentTab) {
    const tabs = ['basic', 'roles', 'courses', 'advanced', 'financial'];
    const currentIndex = tabs.indexOf(currentTab);
    const progress = ((currentIndex + 1) / tabs.length) * 100;
    
    document.getElementById('progressFill').style.width = progress + '%';
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·ÙˆØ§Øª
    const steps = document.querySelectorAll('.progress-step');
    steps.forEach((step, index) => {
        if (index <= currentIndex) {
            step.classList.add('active');
        } else {
            step.classList.remove('active');
        }
        
        if (index < currentIndex) {
            step.classList.add('completed');
        } else {
            step.classList.remove('completed');
        }
    });
}


// ==================== Form Validation ====================
function validateBasicInfo() {
    let isValid = true;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„
    const firstName = document.getElementById('firstName').value.trim();
    if (!firstName) {
        showFieldError('firstName', 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨');
        isValid = false;
    } else {
        clearFieldError('firstName');
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
    const lastName = document.getElementById('lastName').value.trim();
    if (!lastName) {
        showFieldError('lastName', 'Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ù…Ø·Ù„ÙˆØ¨');
        isValid = false;
    } else {
        clearFieldError('lastName');
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    const email = document.getElementById('email').value.trim();
    if (!email || !isValidEmail(email)) {
        showFieldError('email', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');
        isValid = false;
    } else {
        clearFieldError('email');
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙ‚Ø·)
    if (!editMode) {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (!password || password.length < 8) {
            showFieldError('password', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
            isValid = false;
        } else {
            clearFieldError('password');
        }
        
        if (password !== confirmPassword) {
            showFieldError('confirmPassword', 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
            isValid = false;
        } else {
            clearFieldError('confirmPassword');
        }
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… WhatsApp
    const phoneNumber = document.getElementById('phoneNumber').value.trim();
    if (!phoneNumber || !isValidPhone(phoneNumber)) {
        showFieldError('phoneNumber', 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­');
        isValid = false;
    } else {
        clearFieldError('phoneNumber');
    }
    
    return isValid;
}

// ==================== Helper Functions ====================
function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function isValidPhone(phone) {
    return /^\d{6,15}$/.test(phone);
}

function showFieldError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const feedback = document.getElementById(fieldId + 'Feedback');
    
    field.classList.add('error');
    if (feedback) {
        feedback.textContent = message;
        feedback.classList.add('show', 'error');
    }
}

function clearFieldError(fieldId) {
    const field = document.getElementById(fieldId);
    const feedback = document.getElementById(fieldId + 'Feedback');
    
    field.classList.remove('error');
    if (feedback) {
        feedback.classList.remove('show', 'error');
    }
}

// ==================== Password Functions ====================
function generatePassword() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    let password = '';
    
    // Ø¶Ù…Ø§Ù† ØªØ¶Ù…ÙŠÙ† Ø­Ø±Ù ÙƒØ¨ÙŠØ± ÙˆØµØºÙŠØ± ÙˆØ±Ù‚Ù… ÙˆØ±Ù…Ø² Ø®Ø§Øµ
    password += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)];
    password += 'abcdefghijklmnopqrstuvwxyz'[Math.floor(Math.random() * 26)];
    password += '0123456789'[Math.floor(Math.random() * 10)];
    password += '!@#$%^&*'[Math.floor(Math.random() * 8)];
    
    // Ù…Ù„Ø¡ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø­Ø±Ù
    for (let i = 4; i < 12; i++) {
        password += chars[Math.floor(Math.random() * chars.length)];
    }
    
    // Ø®Ù„Ø· Ø§Ù„Ø£Ø­Ø±Ù
    password = password.split('').sort(() => Math.random() - 0.5).join('');
    
    // ÙˆØ¶Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
    document.getElementById('password').value = password;
    document.getElementById('password').type = 'text';
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚ÙˆØ©
    checkPasswordStrength(password);
    
    // Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    navigator.clipboard.writeText(password).then(() => {
        showSuccess('ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙˆÙ†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
    });
}

function togglePassword() {
    const passwordInput = document.getElementById('password');
    const toggleIcon = document.getElementById('passwordToggleIcon');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    }
}

// ==================== Password Strength Checker ====================
document.getElementById('password')?.addEventListener('input', function() {
    checkPasswordStrength(this.value);
});

function checkPasswordStrength(password) {
    let strength = 0;
    const criteria = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /[0-9]/.test(password),
        special: /[!@#$%^&*]/.test(password)
    };
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    Object.keys(criteria).forEach(key => {
        const element = document.getElementById(key + 'Criteria');
        if (element) {
            if (criteria[key]) {
                element.classList.add('valid');
                element.querySelector('i').classList.remove('fa-times-circle');
                element.querySelector('i').classList.add('fa-check-circle');
                strength++;
            } else {
                element.classList.remove('valid');
                element.querySelector('i').classList.remove('fa-check-circle');
                element.querySelector('i').classList.add('fa-times-circle');
            }
        }
    });
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚ÙˆØ©
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');
    
    strengthFill.className = 'strength-fill';
    
    if (strength === 0) {
        strengthText.textContent = 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
    } else if (strength <= 2) {
        strengthFill.classList.add('weak');
        strengthText.textContent = 'Ø¶Ø¹ÙŠÙØ©';
    } else if (strength === 3) {
        strengthFill.classList.add('fair');
        strengthText.textContent = 'Ù…ØªÙˆØ³Ø·Ø©';
    } else if (strength === 4) {
        strengthFill.classList.add('good');
        strengthText.textContent = 'Ø¬ÙŠØ¯Ø©';
    } else {
        strengthFill.classList.add('strong');
        strengthText.textContent = 'Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹';
    }
}

// ==================== Avatar Functions ====================
function displayAvatar(src) {
    const avatarImg = document.getElementById('avatarImg');
    const avatarPlaceholder = document.getElementById('avatarPlaceholder');
    const removeBtn = document.getElementById('removeAvatarBtn');
    
    avatarImg.src = src;
    avatarImg.style.display = 'block';
    avatarPlaceholder.style.display = 'none';
    removeBtn.style.display = 'inline-flex';
}

function removeAvatar() {
    const avatarImg = document.getElementById('avatarImg');
    const avatarPlaceholder = document.getElementById('avatarPlaceholder');
    const removeBtn = document.getElementById('removeAvatarBtn');
    const avatarInput = document.getElementById('avatarInput');
    
    avatarImg.src = '';
    avatarImg.style.display = 'none';
    avatarPlaceholder.style.display = 'flex';
    removeBtn.style.display = 'none';
    avatarInput.value = '';
    
    // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    if (formData.basic) {
        delete formData.basic.avatar;
    }
}

// ==================== Loading Functions ====================
function showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
    const overlay = document.getElementById('loadingOverlay');
    const loadingText = overlay.querySelector('.loading-text');
    
    loadingText.textContent = message;
    overlay.classList.add('active');
}

function hideLoading() {
    const overlay = document.getElementById('loadingOverlay');
    overlay.classList.remove('active');
}

// ==================== Notification Functions ====================
function showSuccess(message) {
    Swal.fire({
        icon: 'success',
        title: 'Ù†Ø¬Ø­',
        text: message,
        timer: 2000,
        showConfirmButton: false,
        toast: true,
        position: 'top-end'
    });
}

function showError(message) {
    Swal.fire({
        icon: 'error',
        title: 'Ø®Ø·Ø£',
        text: message,
        confirmButtonColor: 'var(--primary)',
        confirmButtonText: 'Ù…ÙˆØ§ÙÙ‚'
    });
}

function showWarning(message) {
    Swal.fire({
        icon: 'warning',
        title: 'ØªÙ†Ø¨ÙŠÙ‡',
        text: message,
        confirmButtonColor: 'var(--primary)',
        confirmButtonText: 'Ù…ÙˆØ§ÙÙ‚'
    });
}

    // ==================== User ID/Slug Generation ====================

    function updateUserIdSuggestion() {
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const email = document.getElementById('email').value.trim();
    const userIdInput = document.getElementById('userId');
    
    if (userIdInput && !userIdInput.value && !editMode) {
        if (firstName || lastName) {
            const suggestion = generateUserId(firstName, lastName, email);
            userIdInput.placeholder = suggestion;
        }
    }
}
// ==================== Utility Functions ====================
function formatDate(date) {
    if (!date) return '-';
    
    const options = {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    };
    
    return new Intl.DateTimeFormat('ar-SA', options).format(date);
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
    // ==================== Financial Management Functions ====================
let userTransactions = [];
let userWallet = {
    balance: {
        total: 0,
        paid: 0,
        pending: 0,
        points: 0
    },
    upcomingPayments: []
};

// ØªØ­Ø¯ÙŠØ« Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
function updateTransactionForm() {
    const type = document.getElementById('transactionType').value;
    const paymentDetailsRow = document.getElementById('paymentDetailsRow');
    const installmentRow = document.getElementById('installmentRow');
    
    if (type === 'payment') {
        paymentDetailsRow.style.display = 'flex';
        installmentRow.style.display = 'flex';
    } else {
        paymentDetailsRow.style.display = 'none';
        installmentRow.style.display = 'none';
    }
}

// ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
function updateRelatedOptions() {
    const relatedType = document.getElementById('relatedType').value;
    const relatedItemGroup = document.getElementById('relatedItemGroup');
    const relatedItem = document.getElementById('relatedItem');
    
    if (relatedType) {
        relatedItemGroup.style.display = 'block';
        relatedItem.innerHTML = '<option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>';
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù…Ù† Firebase Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        loadRelatedItems(relatedType);
    } else {
        relatedItemGroup.style.display = 'none';
    }
}


// ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
function updateRelatedOptions() {
    const relatedType = document.getElementById('relatedType').value;
    const relatedItemGroup = document.getElementById('relatedItemGroup');
    const relatedItem = document.getElementById('relatedItem');
    
    if (relatedType) {
        relatedItemGroup.style.display = 'block';
        relatedItem.innerHTML = '<option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>';
        
        // Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù…Ù† Firebase Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        loadRelatedItems(relatedType);
    } else {
        relatedItemGroup.style.display = 'none';
    }
}

// ØªØ¨Ø¯ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
function toggleInstallmentDetails() {
    const paymentPlanType = document.getElementById('paymentPlanType').value;
    const installmentDetails = document.querySelector('.installment-details');
    
    if (paymentPlanType === 'installment') {
        installmentDetails.classList.add('show');
    } else {
        installmentDetails.classList.remove('show');
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ù…Ù† Firebase
async function loadRelatedItems(type) {
    const relatedItem = document.getElementById('relatedItem');
    
    try {
        let items = [];
        
        if (type === 'course') {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ù† availableCourses (Ù…Ø­Ù…Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹)
            items = availableCourses || [];
        } else if (type === 'path') {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ù…Ù† availablePaths (Ù…Ø­Ù…Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹)
            items = availablePaths || [];
        } else if (type === 'subscription') {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹
            items = [];
        }
        
        relatedItem.innerHTML = '<option value="">Ø§Ø®ØªØ±...</option>';
        items.forEach(item => {
            const option = document.createElement('option');
            option.value = item.id;
            option.textContent = item.title;
            relatedItem.appendChild(option);
        });
        
        if (items.length === 0) {
            relatedItem.innerHTML = '<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…ØªØ§Ø­Ø©</option>';
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±:', error);
        relatedItem.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';
    }
}


// Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
async function addTransaction() {
    if (!currentUserId && !editMode) {
        showError('ÙŠØ¬Ø¨ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    const transactionData = {
        userId: currentUserId || 'temp',
        type: document.getElementById('transactionType').value,
        amount: parseFloat(document.getElementById('transactionAmount').value) || 0,
        date: document.getElementById('transactionDate').value || new Date().toISOString(),
        status: document.getElementById('transactionStatus')?.value || 'completed',
        notes: document.getElementById('transactionNotes').value,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        createdBy: currentUser.email
    };
    
    // Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø¹Ø§Ù…Ù„Ø© Ø¯ÙØ¹
    if (transactionData.type === 'payment') {
        transactionData.paymentMethod = document.getElementById('paymentMethod').value;
        transactionData.reference = document.getElementById('transactionReference').value;
        
        // Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
        const paymentPlanType = document.getElementById('paymentPlanType').value;
        if (paymentPlanType === 'installment') {
            transactionData.paymentPlan = {
                type: 'installment',
                totalInstallments: parseInt(document.getElementById('totalInstallments').value) || 2,
                currentInstallment: parseInt(document.getElementById('currentInstallment').value) || 1,
                frequency: document.getElementById('installmentFrequency').value
            };
        }
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¥Ø°Ø§ ÙˆØ¬Ø¯
    const relatedType = document.getElementById('relatedType').value;
    if (relatedType) {
        const relatedItemId = document.getElementById('relatedItem').value;
        if (relatedItemId) {
            transactionData.relatedTo = {
                type: relatedType,
                id: relatedItemId
            };
        }
    }
    
    try {
        showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©...');
        
        if (editMode && currentUserId) {
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¥Ù„Ù‰ Firebase
            await window.firebaseDB.transactions.createTransaction(transactionData);
        } else {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ù‚ØªØ© Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
            userTransactions.push({
                ...transactionData,
                id: 'temp_' + Date.now()
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        await loadUserTransactions();
        resetTransactionForm();
        
        hideLoading();
        showSuccess('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:', error);
        hideLoading();
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
    }
}


// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
function resetTransactionForm() {
    document.getElementById('transactionForm').reset();
    document.getElementById('transactionDate').value = new Date().toISOString().slice(0, 16);
    updateTransactionForm();
    updateRelatedOptions();
}


// ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
async function loadUserTransactions() {
    if (!editMode || !currentUserId) {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø¥Ù† ÙˆØ¬Ø¯Øª
        updateTransactionsDisplay();
        updateFinancialSummary();
        return;
    }
    
    try {
        console.log('ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:', currentUserId);
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ù† Firebase
        const transactions = await window.firebaseDB.transactions.getUserTransactions(currentUserId);
        userTransactions = transactions;
        
        // Ø¬Ù„Ø¨ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const wallet = await window.firebaseDB.transactions.getUserWallet(currentUserId);
        userWallet = wallet;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        updateFinancialSummary();
        updateTransactionsDisplay();
        updateUpcomingPayments();
        
        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©:', {
            transactions: userTransactions.length,
            wallet: userWallet
        });
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:', error);
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©');
    }
}

    // ==================== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ====================
function updateUpcomingPayments() {
    const container = document.getElementById('upcomingPaymentsList');
    const noUpcoming = document.getElementById('noUpcomingPayments');
    
    if (!userWallet || !userWallet.upcomingPayments || userWallet.upcomingPayments.length === 0) {
        container.innerHTML = '';
        noUpcoming.style.display = 'block';
        return;
    }
    
    noUpcoming.style.display = 'none';
    
    container.innerHTML = userWallet.upcomingPayments.map(payment => {
        const dueDate = new Date(payment.dueDate).toLocaleDateString('ar-EG');
        const isOverdue = new Date(payment.dueDate) < new Date();
        
        return `
            <div class="upcoming-payment-item ${isOverdue ? 'overdue' : ''}">
                <div class="payment-info">
                    <h5>${payment.relatedTo?.title || 'Ø¯ÙØ¹Ø©'}</h5>
                    <p>Ø§Ù„Ù‚Ø³Ø· ${payment.installmentNumber} Ù…Ù† ${payment.totalInstallments}</p>
                </div>
                <div class="payment-details">
                    <div class="payment-amount">${payment.amount} Ø¬Ù†ÙŠÙ‡</div>
                    <div class="payment-date ${isOverdue ? 'overdue' : ''}">${dueDate}</div>
                </div>
                <div class="payment-actions">
                    <button class="btn btn-sm btn-primary" onclick="markPaymentAsPaid('${payment.transactionId}')">
                        <i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ø¯ÙØ¹
                    </button>
                </div>
            </div>
        `;
    }).join('');
}
    
function updateFinancialSummary() {
    if (!userWallet || !userWallet.balance) {
        // Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        document.getElementById('totalPaid').textContent = '0 Ø¬Ù†ÙŠÙ‡';
        document.getElementById('totalPending').textContent = '0 Ø¬Ù†ÙŠÙ‡';
        document.getElementById('totalGrants').textContent = '0 Ø¬Ù†ÙŠÙ‡';
        document.getElementById('loyaltyPoints').textContent = '0 Ù†Ù‚Ø·Ø©';
        return;
    }
    
    const balance = userWallet.balance;
    
    document.getElementById('totalPaid').textContent = `${balance.paid?.toFixed(2) || 0} Ø¬Ù†ÙŠÙ‡`;
    document.getElementById('totalPending').textContent = `${balance.pending?.toFixed(2) || 0} Ø¬Ù†ÙŠÙ‡`;
    document.getElementById('totalGrants').textContent = `${balance.grants?.toFixed(2) || 0} Ø¬Ù†ÙŠÙ‡`;
    document.getElementById('loyaltyPoints').textContent = `${balance.points || 0} Ù†Ù‚Ø·Ø©`;
}


// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
function updateTransactionsDisplay(transactionsToShow = null) {
    const transactions = transactionsToShow || userTransactions || [];
    const tbody = document.getElementById('transactionsTableBody');
    const noTransactions = document.getElementById('noTransactions');
    
    if (transactions.length === 0) {
        tbody.innerHTML = '';
        noTransactions.style.display = 'block';
        return;
    }
    
    noTransactions.style.display = 'none';
    tbody.innerHTML = transactions.map(transaction => {
        const date = transaction.date ? new Date(transaction.date).toLocaleDateString('ar-EG') : '-';
        const typeClass = `transaction-type ${transaction.type}`;
        const statusClass = `status-badge ${transaction.status}`;
        
        const typeLabels = {
            payment: '<i class="fas fa-money-bill"></i> Ø¯ÙØ¹Ø©',
            grant: '<i class="fas fa-graduation-cap"></i> Ù…Ù†Ø­Ø©',
            gift: '<i class="fas fa-gift"></i> Ù‡Ø¯ÙŠØ©',
            compensation: '<i class="fas fa-hand-holding-usd"></i> ØªØ¹ÙˆÙŠØ¶',
            refund: '<i class="fas fa-undo"></i> Ø§Ø³ØªØ±Ø¬Ø§Ø¹'
        };
        
        const statusLabels = {
            completed: '<i class="fas fa-check"></i> Ù…ÙƒØªÙ…Ù„Ø©',
            pending: '<i class="fas fa-clock"></i> Ù…Ø¹Ù„Ù‚Ø©',
            failed: '<i class="fas fa-times"></i> ÙØ§Ø´Ù„Ø©'
        };
        
        return `
            <tr>
                <td>${date}</td>
                <td><span class="${typeClass}">${typeLabels[transaction.type] || transaction.type}</span></td>
                <td><strong>${transaction.amount?.toFixed(2) || 0} Ø¬Ù†ÙŠÙ‡</strong></td>
                <td>${transaction.paymentMethod || '-'}</td>
                <td>${transaction.reference || '-'}</td>
                <td>${transaction.relatedTo ? getTransactionTypeLabel(transaction.relatedTo.type) : '-'}</td>
                <td><span class="${statusClass}">${statusLabels[transaction.status] || transaction.status}</span></td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="viewTransaction('${transaction.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteTransaction('${transaction.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
    }).join('');
}



// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
function viewTransaction(transactionId) {
    const transaction = userTransactions.find(t => t.id === transactionId);
    if (!transaction) return;
    
    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
    Swal.fire({
        title: 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©',
        html: `
            <div style="text-align: right; direction: rtl;">
                <div class="mb-3">
                    <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${getTransactionTypeLabel(transaction.type)}
                </div>
                <div class="mb-3">
                    <strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> ${transaction.amount} ${transaction.currency || 'Ø¬Ù†ÙŠÙ‡'}
                </div>
                <div class="mb-3">
                    <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(transaction.date).toLocaleDateString('ar-EG')}
                </div>
                <div class="mb-3">
                    <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${getTransactionStatusLabel(transaction.status)}
                </div>
                ${transaction.paymentMethod ? `
                    <div class="mb-3">
                        <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ${getPaymentMethodLabel(transaction.paymentMethod)}
                    </div>
                ` : ''}
                ${transaction.reference ? `
                    <div class="mb-3">
                        <strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹:</strong> ${transaction.reference}
                    </div>
                ` : ''}
                ${transaction.notes ? `
                    <div class="mb-3">
                        <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong><br>
                        ${transaction.notes}
                    </div>
                ` : ''}
            </div>
        `,
        confirmButtonColor: 'var(--primary)',
        confirmButtonText: 'Ø¥ØºÙ„Ø§Ù‚'
    });
}

// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ³Ù…ÙŠØ§Øª
function getTransactionTypeLabel(type) {
    const labels = {
        payment: 'Ø¯ÙØ¹Ø© Ù…Ø§Ù„ÙŠØ©',
        grant: 'Ù…Ù†Ø­Ø© Ø¯Ø±Ø§Ø³ÙŠØ©',
        gift: 'Ù‡Ø¯ÙŠØ©/Ù…ÙƒØ§ÙØ£Ø©',
        compensation: 'ØªØ¹ÙˆÙŠØ¶',
        refund: 'Ø§Ø³ØªØ±Ø¬Ø§Ø¹'
    };
    return labels[type] || type;
}

function getTransactionStatusLabel(status) {
    const labels = {
        completed: 'Ù…ÙƒØªÙ…Ù„Ø©',
        pending: 'Ù…Ø¹Ù„Ù‚Ø©',
        failed: 'ÙØ§Ø´Ù„Ø©',
        cancelled: 'Ù…Ù„ØºØ§Ø©'
    };
    return labels[status] || status;
}

function getPaymentMethodLabel(method) {
    const labels = {
        vodafone: 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
        instapay: 'InstaPay',
        bank: 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ',
        western: 'ÙˆÙŠØ³ØªØ±Ù† ÙŠÙˆÙ†ÙŠÙˆÙ†',
        cash: 'Ù†Ù‚Ø¯ÙŠ'
    };
    return labels[method] || method;
}
// Ø­Ø°Ù Ù…Ø¹Ø§Ù…Ù„Ø©
async function deleteTransaction(transactionId) {
    const result = await Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    });
    
    if (result.isConfirmed) {
        try {
            showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...');
            
            if (transactionId.startsWith('temp_')) {
                // Ø­Ø°Ù Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ø¤Ù‚ØªØ©
                userTransactions = userTransactions.filter(t => t.id !== transactionId);
            } else {
                // Ø­Ø°Ù Ù…Ù† Firebase
                await window.firebaseDB.transactions.deleteTransaction(transactionId);
            }
            
            await loadUserTransactions();
            hideLoading();
            showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:', error);
            hideLoading();
            showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
        }
    }
}


// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
function applyFilters() {
    const typeFilter = document.getElementById('filterType').value;
    const statusFilter = document.getElementById('filterStatus').value;
    const periodFilter = document.getElementById('filterPeriod').value;
    
    let filteredTransactions = [...userTransactions];
    
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    if (typeFilter) {
        filteredTransactions = filteredTransactions.filter(t => t.type === typeFilter);
    }
    
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©  
    if (statusFilter) {
        filteredTransactions = filteredTransactions.filter(t => t.status === statusFilter);
    }
    
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø©
    if (periodFilter) {
        const now = new Date();
        const startDate = new Date();
        
        switch (periodFilter) {
            case 'today':
                startDate.setHours(0, 0, 0, 0);
                break;
            case 'week':
                startDate.setDate(now.getDate() - 7);
                break;
            case 'month':
                startDate.setMonth(now.getMonth() - 1);
                break;
            case 'year':
                startDate.setFullYear(now.getFullYear() - 1);
                break;
        }
        
        if (periodFilter !== '') {
            filteredTransactions = filteredTransactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate >= startDate;
            });
        }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
    updateTransactionsDisplay(filteredTransactions);
}

// ==================== User ID/Slug Generation Functions ====================
let currentUserId = null;

function generateUserId(firstName, lastName, email) {
    const fullName = `${firstName} ${lastName}`.trim();
    
    if (!fullName || fullName === ' ') {
        const emailPart = email ? email.split('@')[0] : 'user';
        const now = new Date();
        return `${emailPart}-${now.getTime()}`;
    }
    
    let slug = fullName
        .toLowerCase()
        .trim()
        .replace(/[\u0600-\u06FF\u0750-\u077F]/g, (match) => {
            const arabicToEnglish = {
                'Ø§': 'a', 'Ø¨': 'b', 'Øª': 't', 'Ø«': 'th', 'Ø¬': 'j', 'Ø­': 'h',
                'Ø®': 'kh', 'Ø¯': 'd', 'Ø°': 'th', 'Ø±': 'r', 'Ø²': 'z', 'Ø³': 's',
                'Ø´': 'sh', 'Øµ': 's', 'Ø¶': 'd', 'Ø·': 't', 'Ø¸': 'z', 'Ø¹': 'a',
                'Øº': 'gh', 'Ù': 'f', 'Ù‚': 'q', 'Ùƒ': 'k', 'Ù„': 'l', 'Ù…': 'm',
                'Ù†': 'n', 'Ù‡': 'h', 'Ùˆ': 'w', 'ÙŠ': 'y'
            };
            return arabicToEnglish[match] || match;
        })
        .replace(/\s+/g, '-')
        .replace(/[^a-z0-9-]/g, '')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '');
    
    if (!slug) {
        const now = new Date();
        return `user-${now.getTime()}`;
    }
    
    return slug;
}

async function checkUserIdAvailability(userId) {
    try {
        const doc = await db.collection('users').doc(userId).get();
        return !doc.exists;
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚:', error);
        return false;
    }
}

async function generateAndSaveUserId() {
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const email = document.getElementById('email').value.trim();
    const userIdInput = document.getElementById('userId');
    const saveBtn = document.getElementById('saveUserIdBtn');
    
    if (!firstName || !email) {
        showError('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    showLoading();
    saveBtn.disabled = true;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...';
    
    try {
        let baseUserId = generateUserId(firstName, lastName, email);
        let finalUserId = baseUserId;
        let counter = 1;
        
        while (!(await checkUserIdAvailability(finalUserId))) {
            finalUserId = `${baseUserId}-${counter}`;
            counter++;
        }
        
        userIdInput.value = finalUserId;
        currentUserId = finalUserId;
        
        saveBtn.classList.remove('btn-primary');
        saveBtn.classList.add('btn-success');
        saveBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ø­ÙØ¸';
        saveBtn.disabled = true;
        
        hideLoading();
        showSuccess('ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙˆØ­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
        
    } catch (error) {
        hideLoading();
        saveBtn.disabled = false;
        saveBtn.innerHTML = '<i class="fas fa-save"></i> ØªÙˆÙ„ÙŠØ¯ ÙˆØ­ÙØ¸ ID';
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø±Ù');
        console.error(error);
    }
}

// ==================== Export Functions for Use in Other Parts ====================
window.UserBuilder = {
    showLoading,
    hideLoading,
    showSuccess,
    showError,
    showWarning,
    validateBasicInfo,
    generatePassword,
    togglePassword,
    displayAvatar,
    removeAvatar,
    formatDate,
    debounce
};
</script>
<script>
// ==================== Event Listeners Setup ====================
function setupEventListeners() {
    // Event Listeners Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)...
    
    // Avatar Upload
    document.getElementById('avatarInput').addEventListener('change', handleAvatarUpload);
    document.getElementById('avatarPreview').addEventListener('click', () => {
        document.getElementById('avatarInput').click();
    });
    
    // Email Check
    document.getElementById('checkEmailBtn').addEventListener('click', checkEmailAvailability);
    
    // Password Confirmation
    document.getElementById('confirmPassword').addEventListener('input', function() {
        const password = document.getElementById('password').value;
        if (this.value !== password) {
            showFieldError('confirmPassword', 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
        } else {
            clearFieldError('confirmPassword');
        }
    });
    
    // Role Selection
    document.querySelectorAll('input[name="primaryRole"]').forEach(radio => {
        radio.addEventListener('change', function() {
            updatePermissionsForRole(this.value);
        });
    });
    
    // Permissions Toggle
    document.querySelectorAll('input[name="permissions"]').forEach(checkbox => {
        checkbox.addEventListener('change', updatePermissionsCounts);
    });
    
    // Custom Role Toggle
    document.getElementById('enableCustomRole').addEventListener('change', function() {
        const builder = document.getElementById('customRoleBuilder');
        builder.style.display = this.checked ? 'block' : 'none';
    });
    
    // Course Search
    document.getElementById('courseSearchInput').addEventListener('input', 
        debounce(filterCourses, 300)
    );
    
    // Clear Search
    document.getElementById('clearSearch').addEventListener('click', function() {
        document.getElementById('courseSearchInput').value = '';
        filterCourses('');
        this.style.display = 'none';
    });
    
    // Filter Buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            filterByType(this.getAttribute('data-filter'));
        });
    });
    
    // Sort Select
    document.getElementById('sortSelect').addEventListener('change', function() {
        sortCourses(this.value);
    });
    
    // Field Type Change (for custom fields)
    document.getElementById('fieldType').addEventListener('change', function() {
        const optionsGroup = document.getElementById('fieldOptionsGroup');
        optionsGroup.style.display = this.value === 'select' ? 'block' : 'none';
    });
    
    // Interests Input
    document.getElementById('interestsInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const value = this.value.trim();
            if (value) {
                addInterestTag(value);
                this.value = '';
            }
        }
    });
    
    // Color Presets
    document.querySelectorAll('.color-preset').forEach(preset => {
        preset.addEventListener('click', function() {
            const color = this.getAttribute('data-color');
            document.getElementById('customRoleColor').value = color;
        });
    });
    
    // ==================== Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ====================
    
    // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
    const transactionType = document.getElementById('transactionType');
    if (transactionType) {
        transactionType.addEventListener('change', updateTransactionForm);
    }
    
    // Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·
    const relatedType = document.getElementById('relatedType');
    if (relatedType) {
        relatedType.addEventListener('change', updateRelatedOptions);
    }
    
    // Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹
    const paymentPlanType = document.getElementById('paymentPlanType');
    if (paymentPlanType) {
        paymentPlanType.addEventListener('change', toggleInstallmentDetails);
    }
    
    // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    const transactionDate = document.getElementById('transactionDate');
    if (transactionDate && !transactionDate.value) {
        transactionDate.value = new Date().toISOString().slice(0, 16);
    }
    
    // Form Actions
    document.getElementById('cancelBtn').addEventListener('click', handleCancel);
    document.getElementById('resetBtn').addEventListener('click', handleReset);
    document.getElementById('saveDraftBtn').addEventListener('click', () => saveUser(true));
    document.getElementById('saveBtn').addEventListener('click', () => saveUser(false));
    document.getElementById('quickSaveBtn').addEventListener('click', quickSave);
    
    // Auto-save every 30 seconds
    setInterval(autoSave, 30000);
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø§Ù„ÙŠ
    const financialTab = document.getElementById('financialTab');
    if (financialTab) {
        financialTab.addEventListener('click', function() {
            if (editMode && currentUserId) {
                loadUserTransactions();
            }
        });
    }
    // User ID field events
const firstNameInput = document.getElementById('firstName');
const lastNameInput = document.getElementById('lastName');

if (firstNameInput) {
    firstNameInput.addEventListener('input', function() {
        updateUserIdSuggestion();
    });
}

if (lastNameInput) {
    lastNameInput.addEventListener('input', function() {
        updateUserIdSuggestion();
    });
}
}

// ==================== Avatar Upload to GitHub ====================
async function handleAvatarUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
    if (file.size > 5 * 1024 * 1024) {
        showError('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
    if (!file.type.startsWith('image/')) {
        showError('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù ØµÙˆØ±Ø©');
        return;
    }
    
    try {
        showLoading('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...');
        
        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù
        const reader = new FileReader();
        reader.onload = async function(e) {
            const imageData = e.target.result;
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¤Ù‚ØªØ©
            displayAvatar(imageData);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… ÙØ±ÙŠØ¯ Ù„Ù„Ù…Ù„Ù
            const timestamp = Date.now();
            const fileName = `avatar_${timestamp}_${file.name}`;
            const githubPath = `/media/avatars/${fileName}`;
            
            // Ø¥Ø¸Ù‡Ø§Ø± ØªØ¹Ù„ÙŠÙ…Ø§Øª GitHub
            const githubNote = document.getElementById('githubUploadNote');
            const pathElement = document.getElementById('githubPath');
            
            pathElement.textContent = githubPath;
            githubNote.style.display = 'block';
            
            // Ø­ÙØ¸ Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
            formData.basic.avatarPath = `https://raw.githubusercontent.com/MahmoudFouad25/fouad-perspective/main${githubPath}`;
            formData.basic.avatarData = imageData;
            
            hideLoading();
            
            // ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            await Swal.fire({
                icon: 'info',
                title: 'ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©',
                html: `
                    <div style="text-align: right;">
                        <p>ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø±ÙØ¹. ÙŠØ±Ø¬Ù‰ Ø§ØªØ¨Ø§Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
                        <ol style="text-align: right; padding-right: 20px;">
                            <li>Ø§ÙØªØ­ Ù…Ø³ØªÙˆØ¯Ø¹ GitHub Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</li>
                            <li>Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ <code>/media/avatars/</code></li>
                            <li>Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³Ù…: <code>${fileName}</code></li>
                            <li>Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹ØŒ Ø³ØªÙƒÙˆÙ† Ø§Ù„ØµÙˆØ±Ø© Ù…ØªØ§Ø­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
                        </ol>
                    </div>
                `,
                confirmButtonText: 'ÙÙ‡Ù…Øª',
                confirmButtonColor: 'var(--primary)'
            });
        };
        
        reader.readAsDataURL(file);
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©:', error);
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©');
        hideLoading();
    }
}

// ==================== Copy GitHub Path ====================
window.copyGithubPath = async function() {
    const path = document.getElementById('githubPath').textContent;
    try {
        await navigator.clipboard.writeText(path);
        showSuccess('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø³Ø§Ø±');
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', error);
    }
};

// ==================== Email Availability Check ====================
// Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© checkEmailAvailability ÙÙŠ user-builder.html Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø«

async function checkEmailAvailability() {
    const email = document.getElementById('email').value.trim();
    
    if (!email || !isValidEmail(email)) {
        showFieldError('email', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');
        return;
    }
    
    if (editMode) {
        showWarning('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
        return;
    }
    
    try {
        showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ...');
        
        // ÙØ­Øµ ÙÙŠ Firebase Auth Ø£ÙˆÙ„Ø§Ù‹
        let authUserExists = false;
        try {
            await auth.fetchSignInMethodsForEmail(email);
            authUserExists = true;
        } catch (authError) {
            if (authError.code !== 'auth/user-not-found') {
                console.warn('Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Firebase Auth:', authError);
            }
        }
        
        // ÙØ­Øµ ÙÙŠ users collection
        const usersQuery = await db.collection('users')
            .where('email', '==', email)
            .limit(1)
            .get();
        
        // ÙØ­Øµ ÙÙŠ userCredentials (Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±)
        const credDoc = await db.collection('userCredentials').doc(email).get();
        
        // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        if (authUserExists || !usersQuery.empty || credDoc.exists) {
            showFieldError('email', 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
            document.getElementById('email').classList.add('error');
            
            // ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
            let details = [];
            if (authUserExists) details.push('Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…');
            if (!usersQuery.empty) details.push('Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø´Ø·');
            if (credDoc.exists) details.push('ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±');
            
            const feedback = document.getElementById('emailFeedback');
            feedback.innerHTML = `Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ (${details.join(', ')})`;
            
        } else {
            clearFieldError('email');
            document.getElementById('email').classList.add('success');
            document.getElementById('emailFeedback').textContent = 'âœ… Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªØ§Ø­';
            document.getElementById('emailFeedback').classList.add('show', 'success');
        }
        
        hideLoading();
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯:', error);
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
        hideLoading();
    }
}

// ==================== Role & Permissions Management ====================
function updatePermissionsForRole(role) {
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    document.querySelectorAll('input[name="permissions"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
    const rolePermissions = {
        student: ['view_courses', 'download_materials', 'submit_assignments', 'take_quizzes', 'view_certificates'],
        assistant: ['view_courses', 'download_materials', 'post_discussions', 'comment_discussions', 'send_messages'],
        'group-leader': ['view_courses', 'manage_groups', 'view_reports', 'send_notifications'],
        analyst: ['view_reports', 'view_analytics', 'view_progress_reports', 'export_data']
    };
    
    if (rolePermissions[role]) {
        rolePermissions[role].forEach(permission => {
            const checkbox = document.querySelector(`input[name="permissions"][value="${permission}"]`);
            if (checkbox) checkbox.checked = true;
        });
    }
    
    updatePermissionsCounts();
    updateRolePreview(role);
}

function updatePermissionsCounts() {
    const categories = ['content', 'communication', 'admin', 'analytics'];
    
    categories.forEach(category => {
        const container = document.getElementById(category + 'Permissions');
        const checkboxes = container.querySelectorAll('input[type="checkbox"]');
        const checked = container.querySelectorAll('input[type="checkbox"]:checked');
        
        document.getElementById(category + 'Count').textContent = `${checked.length}/${checkboxes.length}`;
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    updatePermissionsPreview();
}

// ==================== Permission Selection Functions ====================
window.selectAllPermissions = function() {
    document.querySelectorAll('input[name="permissions"]').forEach(checkbox => {
        checkbox.checked = true;
    });
    updatePermissionsCounts();
};

window.deselectAllPermissions = function() {
    document.querySelectorAll('input[name="permissions"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    updatePermissionsCounts();
};

window.toggleCategory = function(category) {
    const header = event.currentTarget;
    const permissions = document.getElementById(category + 'Permissions');
    
    header.classList.toggle('collapsed');
    permissions.style.display = header.classList.contains('collapsed') ? 'none' : 'grid';
};

// ==================== Role Preview ====================
function updateRolePreview(role) {
    const roleNames = {
        student: 'Ø·Ø§Ù„Ø¨',
        assistant: 'Ù…Ø¯Ø±Ø¨ Ù…Ø³Ø§Ø¹Ø¯',
        'group-leader': 'Ù…Ø´Ø±Ù Ù…Ø¬Ù…ÙˆØ¹Ø©',
        analyst: 'Ù…Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª'
    };
    
    const roleIcons = {
        student: 'fa-user-graduate',
        assistant: 'fa-chalkboard-teacher',
        'group-leader': 'fa-users-cog',
        analyst: 'fa-chart-line'
    };
    
    document.getElementById('previewRoleName').textContent = roleNames[role] || 'Ù…Ø®ØµØµ';
    const icon = document.querySelector('.preview-role i');
    icon.className = `fas ${roleIcons[role] || 'fa-user'}`;
}

function updatePermissionsPreview() {
    const checkedPermissions = document.querySelectorAll('input[name="permissions"]:checked');
    const totalPermissions = document.querySelectorAll('input[name="permissions"]').length;
    
    document.getElementById('activePermissionsCount').textContent = checkedPermissions.length;
    document.getElementById('inactivePermissionsCount').textContent = totalPermissions - checkedPermissions.length;
    
    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    const permissionsList = document.getElementById('permissionsSummary');
    permissionsList.innerHTML = '';
    
    checkedPermissions.forEach(checkbox => {
        const permissionName = checkbox.nextElementSibling.nextElementSibling.querySelector('.permission-name').textContent;
        const li = document.createElement('li');
        li.textContent = permissionName;
        permissionsList.appendChild(li);
    });
}

// ==================== Courses & Paths Management ====================
async function loadAvailableContent() {
    try {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
        const coursesSnapshot = await db.collection('courses')
            .where('status', '==', 'published')
            .get();
        
        availableCourses = [];
        coursesSnapshot.forEach(doc => {
            availableCourses.push({ id: doc.id, type: 'course', ...doc.data() });
        });
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
        try {
            const pathsSnapshot = await db.collection('bundles')
                .where('status', '==', 'published')
                .get();
            
            availablePaths = [];
            pathsSnapshot.forEach(doc => {
                availablePaths.push({ id: doc.id, type: 'path', ...doc.data() });
            });
        } catch (error) {
            console.warn('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ø±Ø§Øª Ø£Ùˆ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„Ù‡Ø§:', error);
            availablePaths = [];
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        renderAvailableCourses();
        updateCounts();
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰:', error);
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª');
    }
}

function renderAvailableCourses() {
    const container = document.getElementById('availableItems');
    const allItems = [...availableCourses, ...availablePaths];
    
    if (allItems.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ø£Ùˆ Ù…Ø³Ø§Ø±Ø§Øª Ù…ØªØ§Ø­Ø©</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    
    allItems.forEach(item => {
        const itemElement = createCourseElement(item);
        container.appendChild(itemElement);
    });
}

function createCourseElement(item) {
    const div = document.createElement('div');
    div.className = 'course-item';
    div.draggable = true;
    div.dataset.id = item.id;
    div.dataset.type = item.type;
    
    const isAssigned = formData.courses.some(c => c.id === item.id);
    
    div.innerHTML = `
        <div class="item-header">
            <div class="item-type-badge ${item.type === 'path' ? 'path' : ''}">
                <i class="fas fa-${item.type === 'path' ? 'route' : 'graduation-cap'}"></i>
                <span>${item.type === 'path' ? 'Ù…Ø³Ø§Ø±' : 'Ø¯ÙˆØ±Ø©'}</span>
            </div>
            <button class="item-action-btn ${isAssigned ? 'remove-btn' : 'add-btn'}" 
                    onclick="toggleCourseAssignment('${item.id}')">
                <i class="fas fa-${isAssigned ? 'minus' : 'plus'}"></i>
            </button>
        </div>
        
        <div class="item-thumbnail">
            <img src="${item.thumbnail || '/assets/course-placeholder.jpg'}" alt="${item.title}">
            ${item.price ? `
                <div class="item-price">
                    <span class="price-value">${item.price}</span>
                    <span class="price-currency">Ø±ÙŠØ§Ù„</span>
                </div>
            ` : ''}
        </div>
        
        <div class="item-content">
            <h4 class="item-title">${item.title}</h4>
            <p class="item-instructor">
                <i class="fas fa-user-tie"></i>
                <span>${item.instructor || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
            </p>
            <div class="item-meta">
                <span class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span class="duration">${item.duration || '0'} Ø³Ø§Ø¹Ø©</span>
                </span>
                <span class="meta-item">
                    <i class="fas fa-users"></i>
                    <span class="students-count">${item.studentsCount || 0}</span>
                </span>
            </div>
        </div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
    div.addEventListener('dragstart', handleDragStart);
    div.addEventListener('dragend', handleDragEnd);
    
    return div;
}

// ==================== Course Assignment ====================
window.toggleCourseAssignment = function(courseId) {
    const course = [...availableCourses, ...availablePaths].find(c => c.id === courseId);
    if (!course) return;
    
    const index = formData.courses.findIndex(c => c.id === courseId);
    
    if (index > -1) {
        // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø®ØµØµ
        formData.courses.splice(index, 1);
        showSuccess(`ØªÙ… Ø¥Ø²Ø§Ù„Ø© "${course.title}"`);
    } else {
        // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®ØµØµ
        assignCourse(course);
        showSuccess(`ØªÙ… Ø¥Ø¶Ø§ÙØ© "${course.title}"`);
    }
    
    renderAvailableCourses();
    renderAssignedCourses();
    updateCounts();
};

function assignCourse(course, settings = {}) {
    const assignment = {
        id: course.id,
        type: course.type,
        title: course.title,
        thumbnail: course.thumbnail,
        startDate: settings.startDate || new Date().toISOString().split('T')[0],
        endDate: settings.endDate || '',
        accessType: settings.accessType || 'full',
        customPrice: settings.customPrice || course.price || 0,
        currency: settings.currency || 'SAR',
        isFree: settings.isFree || false,
        notes: settings.notes || ''
    };
    
    formData.courses.push(assignment);
}

function renderAssignedCourses() {
    const container = document.getElementById('assignedItems');
    
    if (formData.courses.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Ù„Ù… ÙŠØªÙ… ØªØ®ØµÙŠØµ Ø£ÙŠ Ø¯ÙˆØ±Ø§Øª Ø¨Ø¹Ø¯</p>
                <span>Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ø§ÙˆØ±Ø©</span>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    
    formData.courses.forEach((assignment, index) => {
        const element = createAssignedCourseElement(assignment, index);
        container.appendChild(element);
    });
}

function createAssignedCourseElement(assignment, index) {
    const div = document.createElement('div');
    div.className = 'assigned-item';
    
    div.innerHTML = `
        <div class="assigned-item-header">
            <div class="assigned-item-info">
                <div class="item-type-icon">
                    <i class="fas fa-${assignment.type === 'path' ? 'route' : 'graduation-cap'}"></i>
                </div>
                <div>
                    <h4 class="assigned-item-title">${assignment.title}</h4>
                    <p class="assigned-item-type">${assignment.type === 'path' ? 'Ù…Ø³Ø§Ø± ØªØ¹Ù„ÙŠÙ…ÙŠ' : 'Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©'}</p>
                </div>
            </div>
            <button class="remove-btn" onclick="toggleCourseAssignment('${assignment.id}')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="assigned-item-settings">
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-calendar-alt"></i>
                    ÙØªØ±Ø© Ø§Ù„ÙˆØµÙˆÙ„
                </label>
                <div class="date-inputs">
                    <input type="date" class="date-input start-date" 
                           value="${assignment.startDate}"
                           onchange="updateCourseAssignment(${index}, 'startDate', this.value)">
                    <span class="date-separator">Ø¥Ù„Ù‰</span>
                    <input type="date" class="date-input end-date" 
                           value="${assignment.endDate}"
                           onchange="updateCourseAssignment(${index}, 'endDate', this.value)">
                </div>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-key"></i>
                    Ù†ÙˆØ¹ Ø§Ù„ÙˆØµÙˆÙ„
                </label>
                <select class="setting-select access-type" 
                        value="${assignment.accessType}"
                        onchange="updateCourseAssignment(${index}, 'accessType', this.value)">
                    <option value="full" ${assignment.accessType === 'full' ? 'selected' : ''}>ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„</option>
                    <option value="limited" ${assignment.accessType === 'limited' ? 'selected' : ''}>ÙˆØµÙˆÙ„ Ù…Ø­Ø¯ÙˆØ¯</option>
                    <option value="preview" ${assignment.accessType === 'preview' ? 'selected' : ''}>Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø·</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-tag"></i>
                    Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ØµØµ
                </label>
                <div class="price-input-group">
                    <input type="number" class="price-input" 
                           value="${assignment.isFree ? 0 : assignment.customPrice}" 
                           ${assignment.isFree ? 'disabled' : ''}
                           onchange="updateCourseAssignment(${index}, 'customPrice', this.value)">
                    <select class="currency-select" 
                            value="${assignment.currency}"
                            onchange="updateCourseAssignment(${index}, 'currency', this.value)">
                        <option value="SAR" ${assignment.currency === 'SAR' ? 'selected' : ''}>Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
                        <option value="EGP" ${assignment.currency === 'EGP' ? 'selected' : ''}>Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</option>
                        <option value="USD" ${assignment.currency === 'USD' ? 'selected' : ''}>Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                    </select>
                    <label class="checkbox-label">
                        <input type="checkbox" class="free-checkbox" 
                               ${assignment.isFree ? 'checked' : ''}
                               onchange="toggleFreeAccess(${index}, this.checked)">
                        <span>Ù…Ø¬Ø§Ù†ÙŠ</span>
                    </label>
                </div>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">
                    <i class="fas fa-sticky-note"></i>
                    Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                </label>
                <textarea class="setting-textarea" rows="2" 
                          placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµÙŠØµ..."
                          onchange="updateCourseAssignment(${index}, 'notes', this.value)">${assignment.notes}</textarea>
            </div>
        </div>
    `;
    
    return div;
}

// ==================== Update Course Assignment ====================
window.updateCourseAssignment = function(index, field, value) {
    if (formData.courses[index]) {
        formData.courses[index][field] = value;
        autoSave();
    }
};

window.toggleFreeAccess = function(index, isFree) {
    if (formData.courses[index]) {
        formData.courses[index].isFree = isFree;
        // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ± Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø±
        renderAssignedCourses();
        autoSave();
    }
};

// ==================== Drag and Drop ====================
function initializeDragAndDrop() {
    const dropZone = document.getElementById('dropZone');
    
    dropZone.addEventListener('dragover', handleDragOver);
    dropZone.addEventListener('drop', handleDrop);
    dropZone.addEventListener('dragleave', handleDragLeave);
}

let draggedElement = null;

function handleDragStart(e) {
    draggedElement = e.target;
    e.target.classList.add('dragging');
}

function handleDragEnd(e) {
    e.target.classList.remove('dragging');
}

function handleDragOver(e) {
    e.preventDefault();
    const dropZone = document.getElementById('dropZone');
    dropZone.classList.add('drag-over');
}

function handleDragLeave(e) {
    const dropZone = document.getElementById('dropZone');
    dropZone.classList.remove('drag-over');
}

function handleDrop(e) {
    e.preventDefault();
    const dropZone = document.getElementById('dropZone');
    dropZone.classList.remove('drag-over');
    
    if (draggedElement) {
        const courseId = draggedElement.dataset.id;
        const isAssigned = formData.courses.some(c => c.id === courseId);
        
        if (!isAssigned) {
            toggleCourseAssignment(courseId);
        }
    }
}

// ==================== Filter & Sort Functions ====================
function filterCourses(searchTerm) {
    const items = document.querySelectorAll('#availableItems .course-item');
    const clearBtn = document.getElementById('clearSearch');
    
    clearBtn.style.display = searchTerm ? 'block' : 'none';
    
    items.forEach(item => {
        const title = item.querySelector('.item-title').textContent.toLowerCase();
        const instructor = item.querySelector('.item-instructor span').textContent.toLowerCase();
        const search = searchTerm.toLowerCase();
        
        if (title.includes(search) || instructor.includes(search)) {
            item.style.display = '';
        } else {
            item.style.display = 'none';
        }
    });
}

function filterByType(type) {
    const items = document.querySelectorAll('#availableItems .course-item');
    
    items.forEach(item => {
        const itemType = item.dataset.type;
        const isAssigned = formData.courses.some(c => c.id === item.dataset.id);
        
        if (type === 'all') {
            item.style.display = '';
        } else if (type === 'courses' && itemType === 'course') {
            item.style.display = '';
        } else if (type === 'paths' && itemType === 'path') {
            item.style.display = '';
        } else if (type === 'selected' && isAssigned) {
            item.style.display = '';
        } else {
            item.style.display = 'none';
        }
    });
}

function sortCourses(sortBy) {
    const container = document.getElementById('availableItems');
    const items = Array.from(container.querySelectorAll('.course-item'));
    
    items.sort((a, b) => {
        switch (sortBy) {
            case 'name':
                const titleA = a.querySelector('.item-title').textContent;
                const titleB = b.querySelector('.item-title').textContent;
                return titleA.localeCompare(titleB, 'ar');
                
            case 'date':
                // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                return 0;
                
            case 'price':
                const priceA = parseFloat(a.querySelector('.price-value')?.textContent || 0);
                const priceB = parseFloat(b.querySelector('.price-value')?.textContent || 0);
                return priceB - priceA;
                
            case 'students':
                const studentsA = parseInt(a.querySelector('.students-count').textContent);
                const studentsB = parseInt(b.querySelector('.students-count').textContent);
                return studentsB - studentsA;
                
            default:
                return 0;
        }
    });
    
    container.innerHTML = '';
    items.forEach(item => container.appendChild(item));
}

function updateCounts() {
    const courses = availableCourses.length;
    const paths = availablePaths.length;
    const assigned = formData.courses.length;
    const all = courses + paths;
    
    document.getElementById('allCount').textContent = all;
    document.getElementById('coursesCount').textContent = courses;
    document.getElementById('pathsCount').textContent = paths;
    document.getElementById('selectedCount').textContent = assigned;
    
    document.getElementById('assignedCoursesCount').textContent = 
        formData.courses.filter(c => c.type === 'course').length;
    document.getElementById('assignedPathsCount').textContent = 
        formData.courses.filter(c => c.type === 'path').length;
}

// ==================== Bulk Actions ====================
window.assignAllVisible = function() {
    const visibleItems = document.querySelectorAll('#availableItems .course-item:not([style*="display: none"])');
    
    visibleItems.forEach(item => {
        const courseId = item.dataset.id;
        const isAssigned = formData.courses.some(c => c.id === courseId);
        
        if (!isAssigned) {
            const course = [...availableCourses, ...availablePaths].find(c => c.id === courseId);
            if (course) {
                assignCourse(course);
            }
        }
    });
    
    renderAvailableCourses();
    renderAssignedCourses();
    updateCounts();
    showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±Ø¦ÙŠØ©');
};

window.removeAllAssigned = function() {
    if (formData.courses.length === 0) {
        showWarning('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù…Ø®ØµØµØ© Ù„Ù„Ø¥Ø²Ø§Ù„Ø©');
        return;
    }
    
    Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: 'var(--danger)',
        cancelButtonColor: 'var(--secondary)',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„ÙƒÙ„',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    }).then((result) => {
        if (result.isConfirmed) {
            formData.courses = [];
            renderAvailableCourses();
            renderAssignedCourses();
            updateCounts();
            showSuccess('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµÙŠØµØ§Øª');
        }
    });
};

window.applyBulkSettings = function() {
    if (formData.courses.length === 0) {
        showWarning('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù…Ø®ØµØµØ© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„ÙŠÙ‡Ø§');
        return;
    }
    
    document.getElementById('bulkSettingsModal').style.display = 'block';
};

window.applyBulkSettingsConfirm = function() {
    const duration = parseInt(document.getElementById('bulkDuration').value);
    const durationUnit = document.getElementById('bulkDurationUnit').value;
    const accessType = document.getElementById('bulkAccessType').value;
    const discount = parseInt(document.getElementById('bulkDiscount').value) || 0;
    
    // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
    const today = new Date();
    let endDate = new Date(today);
    
    switch (durationUnit) {
        case 'days':
            endDate.setDate(endDate.getDate() + duration);
            break;
        case 'weeks':
            endDate.setDate(endDate.getDate() + (duration * 7));
            break;
        case 'months':
            endDate.setMonth(endDate.getMonth() + duration);
            break;
        case 'years':
            endDate.setFullYear(endDate.getFullYear() + duration);
            break;
    }
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
    formData.courses.forEach(course => {
        course.startDate = today.toISOString().split('T')[0];
        course.endDate = endDate.toISOString().split('T')[0];
        course.accessType = accessType;
        
        if (discount > 0 && !course.isFree) {
            course.customPrice = course.customPrice * (1 - discount / 100);
        }
    });
    
    renderAssignedCourses();
    closeBulkSettings();
    showSuccess('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©');
};

// ==================== Advanced Information Functions ====================

// Load Countries
async function loadCountries() {
    const countries = [
        { code: 'EG', name: 'Ù…ØµØ±' },
        { code: 'SA', name: 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' },
        { code: 'AE', name: 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª' },
        { code: 'KW', name: 'Ø§Ù„ÙƒÙˆÙŠØª' },
        { code: 'QA', name: 'Ù‚Ø·Ø±' },
        { code: 'OM', name: 'Ø¹Ù…Ø§Ù†' },
        { code: 'BH', name: 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†' },
        { code: 'JO', name: 'Ø§Ù„Ø£Ø±Ø¯Ù†' },
        { code: 'LB', name: 'Ù„Ø¨Ù†Ø§Ù†' },
        { code: 'PS', name: 'ÙÙ„Ø³Ø·ÙŠÙ†' },
        { code: 'SY', name: 'Ø³ÙˆØ±ÙŠØ§' },
        { code: 'IQ', name: 'Ø§Ù„Ø¹Ø±Ø§Ù‚' },
        { code: 'MA', name: 'Ø§Ù„Ù…ØºØ±Ø¨' },
        { code: 'DZ', name: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±' },
        { code: 'TN', name: 'ØªÙˆÙ†Ø³' },
        { code: 'LY', name: 'Ù„ÙŠØ¨ÙŠØ§' },
        { code: 'SD', name: 'Ø§Ù„Ø³ÙˆØ¯Ø§Ù†' },
        { code: 'YE', name: 'Ø§Ù„ÙŠÙ…Ù†' }
    ];
    
    const select = document.getElementById('country');
    select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø© --</option>';
    
    countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.code;
        option.textContent = country.name;
        select.appendChild(option);
    });
}

// Interests Tags
function addInterestTag(interest) {
    if (!formData.advanced.interests) {
        formData.advanced.interests = [];
    }
    
    if (formData.advanced.interests.includes(interest)) {
        showWarning('Ù‡Ø°Ø§ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
        return;
    }
    
    formData.advanced.interests.push(interest);
    
    const tagsList = document.getElementById('interestsTags');
    const tag = document.createElement('div');
    tag.className = 'tag-item';
    tag.innerHTML = `
        ${interest}
        <button onclick="removeInterestTag('${interest}')">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    tagsList.appendChild(tag);
}

window.removeInterestTag = function(interest) {
    const index = formData.advanced.interests.indexOf(interest);
    if (index > -1) {
        formData.advanced.interests.splice(index, 1);
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    const tagsList = document.getElementById('interestsTags');
    tagsList.innerHTML = '';
    formData.advanced.interests.forEach(tag => addInterestTag(tag));
};

// Custom Fields
window.addCustomField = function() {
    document.getElementById('customFieldModal').style.display = 'block';
};

window.saveCustomField = function() {
    const label = document.getElementById('fieldLabel').value.trim();
    const type = document.getElementById('fieldType').value;
    const required = document.getElementById('fieldRequired').checked;
    const options = document.getElementById('fieldOptions').value
        .split('\n')
        .filter(opt => opt.trim())
        .map(opt => opt.trim());
    
    if (!label) {
        showError('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„');
        return;
    }
    
    const field = {
        id: 'field_' + Date.now(),
        label,
        type,
        required,
        options: type === 'select' ? options : [],
        value: ''
    };
    
    customFields.push(field);
    addCustomFieldToForm(field);
    
    closeCustomFieldModal();
    showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ØµØµ');
};

function addCustomFieldToForm(field) {
    const container = document.getElementById('customFieldsContainer');
    const emptyState = document.getElementById('emptyCustomFields');
    
    emptyState.style.display = 'none';
    
    const fieldElement = document.createElement('div');
    fieldElement.className = 'custom-field-item';
    fieldElement.dataset.fieldId = field.id;
    
    let inputHtml = '';
    
    switch (field.type) {
        case 'text':
        case 'email':
        case 'number':
            inputHtml = `<input type="${field.type}" class="form-control" 
                         id="${field.id}" ${field.required ? 'required' : ''}>`;
            break;
            
        case 'date':
            inputHtml = `<input type="date" class="form-control" 
                         id="${field.id}" ${field.required ? 'required' : ''}>`;
            break;
            
        case 'textarea':
            inputHtml = `<textarea class="form-control" id="${field.id}" 
                         rows="3" ${field.required ? 'required' : ''}></textarea>`;
            break;
            
        case 'select':
            inputHtml = `
                <select class="form-control" id="${field.id}" ${field.required ? 'required' : ''}>
                    <option value="">-- Ø§Ø®ØªØ± --</option>
                    ${field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                </select>
            `;
            break;
            
        case 'checkbox':
            inputHtml = `
                <label class="checkbox-label">
                    <input type="checkbox" id="${field.id}">
                    <span>${field.label}</span>
                </label>
            `;
            break;
    }
    
    fieldElement.innerHTML = `
        <div class="custom-field-icon">
            <i class="fas fa-${getFieldIcon(field.type)}"></i>
        </div>
        <div class="custom-field-content">
            ${field.type !== 'checkbox' ? `
                <label class="custom-field-label ${field.required ? 'required' : ''}">
                    ${field.label}
                </label>
                ${inputHtml}
            ` : inputHtml}
        </div>
        <button class="custom-field-remove" onclick="removeCustomField('${field.id}')">
            <i class="fas fa-trash"></i>
        </button>
    `;
    
    container.appendChild(fieldElement);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
    const input = fieldElement.querySelector('input, select, textarea');
    if (input) {
        input.addEventListener('change', function() {
            const fieldData = customFields.find(f => f.id === field.id);
            if (fieldData) {
                fieldData.value = field.type === 'checkbox' ? this.checked : this.value;
            }
        });
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù‚ÙŠÙ…Ø© Ù…Ø­ÙÙˆØ¸Ø©
        if (field.value !== undefined && field.value !== '') {
            if (field.type === 'checkbox') {
                input.checked = field.value;
            } else {
                input.value = field.value;
            }
        }
    }
}

window.removeCustomField = function(fieldId) {
    Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ØµØµ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: 'var(--danger)',
        cancelButtonColor: 'var(--secondary)',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    }).then((result) => {
        if (result.isConfirmed) {
            // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
            const index = customFields.findIndex(f => f.id === fieldId);
            if (index > -1) {
                customFields.splice(index, 1);
            }
            
            // Ø­Ø°Ù Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            const element = document.querySelector(`[data-field-id="${fieldId}"]`);
            if (element) {
                element.remove();
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            if (customFields.length === 0) {
                document.getElementById('emptyCustomFields').style.display = 'block';
            }
            
            showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ØµØµ');
        }
    });
};

function getFieldIcon(type) {
    const icons = {
        text: 'font',
        email: 'envelope',
        number: 'hashtag',
        date: 'calendar',
        textarea: 'align-left',
        select: 'list',
        checkbox: 'check-square'
    };
    
    return icons[type] || 'tag';
}

// Notes Editor
function initializeNotesEditor() {
    const editor = document.getElementById('adminNotesEditor');
    
    // Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø±ÙˆØ§Ø¨Ø·
    editor.addEventListener('click', function(e) {
        if (e.target.tagName === 'A') {
            e.preventDefault();
            window.open(e.target.href, '_blank');
        }
    });
}

window.formatText = function(command) {
    document.execCommand(command, false, null);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø·Ø©
    const button = event.currentTarget;
    button.classList.toggle('active');
};

window.insertLink = function() {
    const url = prompt('Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· URL:');
    if (url) {
        document.execCommand('createLink', false, url);
    }
};

window.insertHighlight = function() {
    document.execCommand('hiliteColor', false, 'yellow');
};

// Activity Timeline
window.loadMoreActivity = function() {
    // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    showWarning('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ø¥Ø¶Ø§ÙÙŠØ©');
};

// ==================== Auto Save Functions ====================
function autoSave() {
    clearTimeout(autoSaveTimer);
    
    autoSaveTimer = setTimeout(async () => {
        try {
            await saveFormData(true);
            showAutoSaveIndicator();
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error);
        }
    }, 2000);
}

function showAutoSaveIndicator() {
    const indicator = document.getElementById('autoSaveIndicator');
    indicator.classList.add('show');
    
    setTimeout(() => {
        indicator.classList.remove('show');
    }, 3000);
}

async function saveFormData(isDraft = false) {
    // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    collectFormData();
    
    // Ø­ÙØ¸ ÙÙŠ localStorage
    localStorage.setItem('userBuilderDraft', JSON.stringify({
        formData,
        customFields,
        savedAt: new Date().toISOString()
    }));
    
    if (!isDraft) {
        // ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ ÙÙŠ Firestore Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        console.log('Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', formData);
    }
}

// Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© collectFormData ÙÙŠ user-builder.html Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø«

function collectFormData() {
    try {
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„)
        formData.basic = {
            firstName: document.getElementById('firstName')?.value || '',
            lastName: document.getElementById('lastName')?.value || '',
            email: document.getElementById('email')?.value || '',
            countryCode: document.getElementById('countryCode')?.value || '+20',
            phoneNumber: document.getElementById('phoneNumber')?.value || '',
            accountStatus: document.querySelector('input[name="accountStatus"]:checked')?.value || 'active',
            avatar: formData.basic?.avatarPath || null
        };
        
        // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙ‚Ø·)
        if (!editMode) {
            const passwordField = document.getElementById('password');
            formData.basic.password = passwordField?.value || '';
        }
        
        // Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„)
        const primaryRoleElement = document.querySelector('input[name="primaryRole"]:checked');
        const permissionElements = document.querySelectorAll('input[name="permissions"]:checked');
        const customRoleEnabled = document.getElementById('enableCustomRole')?.checked || false;
        
        formData.roles = {
            primaryRole: primaryRoleElement?.value || 'student',
            permissions: Array.from(permissionElements).map(cb => cb.value),
            customRole: customRoleEnabled ? {
                name: document.getElementById('customRoleName')?.value || '',
                color: document.getElementById('customRoleColor')?.value || '#f4c430',
                description: document.getElementById('customRoleDescription')?.value || ''
            } : null
        };
        
        // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„)
        formData.advanced = {
            // Ø§Ù„Ø´Ø®ØµÙŠØ©
            birthDate: document.getElementById('birthDate')?.value || null,
            gender: document.getElementById('gender')?.value || null,
            nationality: document.getElementById('nationality')?.value || null,
            
            // Ø§Ù„ØªÙˆØ§ØµÙ„
            country: document.getElementById('country')?.value || null,
            city: document.getElementById('city')?.value || null,
            timezone: document.getElementById('timezone')?.value || null,
            language: document.getElementById('language')?.value || 'ar',
            address: document.getElementById('address')?.value || null,
            
            // Ø§Ù„Ù…Ù‡Ù†ÙŠØ©
            occupation: document.getElementById('occupation')?.value || null,
            company: document.getElementById('company')?.value || null,
            education: document.getElementById('education')?.value || null,
            experience: document.getElementById('experience')?.value || null,
            interests: formData.advanced?.interests || [],
            
            // Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            notifications: {
                emailNewCourse: document.getElementById('emailNewCourse')?.checked || false,
                emailReminders: document.getElementById('emailReminders')?.checked || false,
                emailPromotions: document.getElementById('emailPromotions')?.checked || false,
                emailNewsletter: document.getElementById('emailNewsletter')?.checked || false,
                whatsappReminders: document.getElementById('whatsappReminders')?.checked || false,
                whatsappSupport: document.getElementById('whatsappSupport')?.checked || false,
                whatsappProgress: document.getElementById('whatsappProgress')?.checked || false
            },
            
            // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            adminNotes: document.getElementById('adminNotesEditor')?.innerHTML || null,
            
            // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ©
            customFields: customFields || []
        };
        
        // ==================== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ====================
        formData.financial = {
            transactions: userTransactions || [],
            wallet: userWallet || {
                balance: {
                    total: 0,
                    paid: 0,
                    pending: 0,
                    points: 0
                },
                upcomingPayments: []
            }
        };
        
        console.log('âœ… ØªÙ… Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', formData);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', error);
        
        // Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        formData = {
            basic: {
                firstName: '',
                lastName: '',
                email: '',
                countryCode: '+20',
                phoneNumber: '',
                accountStatus: 'active',
                avatar: null,
                password: ''
            },
            roles: {
                primaryRole: 'student',
                permissions: ['view_courses'],
                customRole: null
            },
            courses: formData.courses || [],
            advanced: {
                notifications: {
                    emailNewCourse: true,
                    emailReminders: true,
                    whatsappReminders: true,
                    whatsappSupport: true
                },
                customFields: []
            },
            financial: {
                transactions: [],
                wallet: {
                    balance: { total: 0, paid: 0, pending: 0, points: 0 },
                    upcomingPayments: []
                }
            }
        };
        
        throw error;
    }
}



// ==================== Save User Functions ====================
// Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© saveUser ÙÙŠ user-builder.html Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø«

async function saveUser(isDraft = false) {
     try {
         // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ù ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø·
if (!editMode && !currentUserId) {
    showError('ÙŠØ¬Ø¨ ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹');
    document.getElementById('basicTab').click();
    document.getElementById('saveUserIdBtn').focus();
    return;
}
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ù
        if (!currentUserId) {
            showError('ÙŠØ¬Ø¨ ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹ - Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªÙˆÙ„ÙŠØ¯ ÙˆØ­ÙØ¸ ID"');
            document.getElementById('basicTab').click();
            document.getElementById('saveUserIdBtn').focus();
            return;
        }
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!validateBasicInfo()) {
            showError('ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©');
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„
            document.getElementById('basicTab').click();
            return;
        }
        
        showLoading(isDraft ? 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©...' : 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        
        // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        collectFormData();
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const userData = {
            name: `${formData.basic.firstName} ${formData.basic.lastName}`.trim(),
            email: formData.basic.email,
            whatsapp: `${formData.basic.countryCode}${formData.basic.phoneNumber}`,
            phone: `${formData.basic.countryCode}${formData.basic.phoneNumber}`,
            avatar: formData.basic.avatar,
            
            isActive: formData.basic.accountStatus === 'active',
            status: formData.basic.accountStatus,
            
            role: formData.roles.primaryRole,
            permissions: formData.roles.permissions,
            customRole: formData.roles.customRole,
            
            enrollments: formData.courses.map(course => ({
                id: course.id,
                type: course.type,
                title: course.title,
                startDate: course.startDate,
                endDate: course.endDate,
                accessType: course.accessType,
                price: course.isFree ? 0 : course.customPrice,
                currency: course.currency,
                isFree: course.isFree,
                notes: course.notes,
                enrolledAt: new Date().toISOString()
            })),
            
            // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
            birthDate: formData.advanced.birthDate || null,
            gender: formData.advanced.gender || null,
            nationality: formData.advanced.nationality || null,
            country: formData.advanced.country || null,
            city: formData.advanced.city || null,
            timezone: formData.advanced.timezone || null,
            language: formData.advanced.language || 'ar',
            address: formData.advanced.address || null,
            occupation: formData.advanced.occupation || null,
            company: formData.advanced.company || null,
            education: formData.advanced.education || null,
            experience: formData.advanced.experience || null,
            interests: formData.advanced.interests || [],
            notifications: formData.advanced.notifications || {},
            adminNotes: formData.advanced.adminNotes || null,
            customFields: formData.advanced.customFields || [],
            
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
            lastUpdatedBy: currentUser.email
        };
        
        if (editMode) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
            await db.collection('users').doc(currentUserId).update(userData);
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (userTransactions && userTransactions.length > 0) {
                const batch = db.batch();
                
                // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ© ÙÙŠ Firebase
                for (const transaction of userTransactions) {
                    if (transaction.id.startsWith('temp_')) {
                        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                        const transactionRef = db.collection('transactions').doc();
                        const transactionData = { ...transaction };
                        delete transactionData.id; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ ID Ø§Ù„Ù…Ø¤Ù‚Øª
                        transactionData.userId = currentUserId;
                        transactionData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        
                        batch.set(transactionRef, transactionData);
                    }
                }
                
                // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙØ¹Ø©
                if (batch._mutations.length > 0) {
                    await batch.commit();
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©');
                }
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await window.firebaseDB.transactions.updateUserWallet(currentUserId);
            }
            
            hideLoading();
            showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            
            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
            setTimeout(() => {
                window.location.href = '/admin/users.html';
            }, 2000);
            
        } else {
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
            userData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            userData.createdBy = currentUser.email;
            userData.accountType = formData.basic.accountStatus === 'active' ? 'premium' : 'free';
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¤Ù‚ØªØ©
            const tempCredentials = {
                // Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                ...userData,
                
                // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                password: formData.basic.password,
                
                // Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                status: 'waiting_first_login',
                tempUser: true,
                
                // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            console.log('ğŸ”„ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...');
            
            // Ø­ÙØ¸ ÙÙŠ userCredentials Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±
            // Ø­ÙØ¸ ÙÙŠ userCredentials Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„ÙØ±ÙŠØ¯
// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø±Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯ØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
const docId = currentUserId || userData.email;
const newUserRef = await db.collection('userCredentials').doc(docId).set({
    ...tempCredentials,
    userId: docId,
    slug: docId
});
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (userTransactions && userTransactions.length > 0) {
                console.log('ğŸ’° Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯...');
                
                const batch = db.batch();
                
                for (const transaction of userTransactions) {
                    const transactionRef = db.collection('transactions').doc();
                    const transactionData = { ...transaction };
                    delete transactionData.id; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ ID Ø§Ù„Ù…Ø¤Ù‚Øª
                    transactionData.userId = userData.email; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙƒÙ…Ø¹Ø±Ù Ù…Ø¤Ù‚Øª
                    transactionData.tempUser = true; // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚ØªÙŠÙ†
                    transactionData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    
                    batch.set(transactionRef, transactionData);
                }
                
                // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙØ¹Ø©
                if (batch._mutations.length > 0) {
                    await batch.commit();
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯');
                }
            }
            
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±');
            
            hideLoading();
            
            // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
            await showSuccessWithCredentials(userData.email, formData.basic.password, userData.whatsapp);
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        hideLoading();
        
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
        if (error.code === 'auth/email-already-in-use') {
            errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
        } else if (error.code === 'permission-denied') {
            errorMessage = 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©';
        } else if (error.message) {
            errorMessage = error.message;
        }
        
        showError(errorMessage);
    }
}

async function quickSave() {
    await saveFormData(false);
    showSuccess('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø±ÙŠØ¹');
}

// ==================== Success with Credentials ====================
async function showSuccessWithCredentials(email, password, whatsapp) {
    const result = await Swal.fire({
        icon: 'success',
        title: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!',
        html: `
            <div style="text-align: right; direction: rtl;">
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                    <h4 style="color: var(--primary); margin-bottom: 1rem;">
                        <i class="fas fa-key"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </h4>
                    <div style="margin-bottom: 0.8rem;">
                        <strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong><br>
                        <code style="background: white; padding: 0.5rem; display: block; margin-top: 0.3rem;">${email}</code>
                    </div>
                    <div>
                        <strong>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</strong><br>
                        <code style="background: white; padding: 0.5rem; display: block; margin-top: 0.3rem;">${password}</code>
                    </div>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: '<i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        cancelButtonText: '<i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ WhatsApp',
        confirmButtonColor: 'var(--primary)',
        cancelButtonColor: 'var(--success)',
        reverseButtons: true
    });
    
    if (result.isConfirmed) {
        // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const text = `Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${email}\nÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${password}`;
        await navigator.clipboard.writeText(text);
        showSuccess('ØªÙ… Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„');
        
    } else if (result.dismiss === Swal.DismissReason.cancel) {
        // Ø¥Ø±Ø³Ø§Ù„ WhatsApp
        const message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ\n\nØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù„Ùƒ ÙÙŠ Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯\n\nØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„:\nğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${email}\nğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${password}\n\nğŸ”— Ø±Ø§Ø¨Ø· ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:\n${window.location.origin}/login.html\n\nÙ…Ø¹ ØªØ­ÙŠØ§Øª ÙØ±ÙŠÙ‚ Ù…Ù†Ø¸ÙˆØ± Ø§Ù„ÙØ¤Ø§Ø¯`;
        
        const whatsappUrl = `https://wa.me/${whatsapp.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }
    
    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    setTimeout(() => {
        window.location.href = '/admin/users.html';
    }, 1000);
}

// ==================== Form Actions ====================
function handleCancel() {
    Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: 'var(--danger)',
        cancelButtonColor: 'var(--secondary)',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø¥Ù„ØºØ§Ø¡',
        cancelButtonText: 'Ù„Ø§ØŒ Ø§Ù„Ø¨Ù‚Ø§Ø¡'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = '/admin/users.html';
        }
    });
}

function handleReset() {
    Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: 'var(--warning)',
        cancelButtonColor: 'var(--secondary)',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    }).then((result) => {
        if (result.isConfirmed) {
            if (editMode) {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
                loadUserData(currentUserId);
            } else {
                // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.querySelector('form').reset();
                formData = {
                    basic: {},
                    roles: {},
                    courses: [],
                    advanced: {}
                };
                customFields = [];
                renderAssignedCourses();
                updateCounts();
            }
            showSuccess('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
        }
    });
}

// ==================== Initialize on Load ====================
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
window.addEventListener('load', function() {
    const draft = localStorage.getItem('userBuilderDraft');
    if (draft && !editMode) {
        const draftData = JSON.parse(draft);
        const savedDate = new Date(draftData.savedAt);
        const timeDiff = (new Date() - savedDate) / 1000 / 60; // Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
        
        if (timeDiff < 60) { // Ø£Ù‚Ù„ Ù…Ù† Ø³Ø§Ø¹Ø©
            Swal.fire({
                title: 'ØªÙˆØ¬Ø¯ Ù…Ø³ÙˆØ¯Ø© Ù…Ø­ÙÙˆØ¸Ø©',
                text: `ØªÙ… Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø© Ù…Ù†Ø° ${Math.round(timeDiff)} Ø¯Ù‚ÙŠÙ‚Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙƒÙ…Ø§Ù„Ù‡Ø§ØŸ`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø³ØªÙƒÙ…Ø§Ù„',
                cancelButtonText: 'Ù„Ø§ØŒ Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©',
                confirmButtonColor: 'var(--primary)'
            }).then((result) => {
                if (result.isConfirmed) {
                    formData = draftData.formData;
                    customFields = draftData.customFields || [];
                    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ø§Ù„Ù…Ø³ÙˆØ¯Ø©
                    showSuccess('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©');
                } else {
                    localStorage.removeItem('userBuilderDraft');
                }
            });
        }
    }
});

// Cleanup on page leave
window.addEventListener('beforeunload', function(e) {
    if (formData.basic.firstName || formData.basic.email) {
        e.preventDefault();
        e.returnValue = 'Ù„Ø¯ÙŠÙƒ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©ØŸ';
    }
});
</script>
    <script>
// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø¯Ø§Ù„Ø©
document.addEventListener('DOMContentLoaded', function() {
    const saveIdBtn = document.getElementById('saveUserIdBtn');
    if (saveIdBtn) {
        saveIdBtn.addEventListener('click', function() {
            generateAndSaveUserId();
        });
    }
});
</script>
</body>
</html>


