<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مكتبة المحتوى التعليمي - محمود فؤاد</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2C5530;
            --secondary: #8B9467;
            --accent: #D4AF37;
            --light: #F5F2E8;
            --dark: #1A1A1A;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: #f5f5f5;
            color: var(--dark);
            min-height: 100vh;
        }

        /* Navigation */
        .admin-nav {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand h2 {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-links a.active {
            color: var(--primary);
            position: relative;
        }

        /* Container */
        .content-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header h1 {
            color: var(--primary);
            font-size: 2rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* Content Types Grid */
        .content-types-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .content-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .content-type-card {
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            background: rgba(44, 85, 48, 0.05);
        }

        .content-type-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .content-type-card.active {
            border-color: var(--primary);
            background: rgba(44, 85, 48, 0.1);
        }

        .content-type-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .content-type-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.3rem;
        }

        .content-type-count {
            font-size: 0.9rem;
            color: #666;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        /* Stats Dashboard */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-title {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        /* Test Section */
        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .test-results {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
            direction: ltr;
            text-align: left;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content-container {
                padding: 1rem;
            }
            
            .page-header {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="admin-nav">
    <div class="nav-container">
        <div class="nav-brand">
            <h2>لوحة تحكم محمود فؤاد</h2>
        </div>
        <div class="nav-links">
            <a href="dashboard.html">
                <span>🏠</span> الرئيسية
            </a>
            <a href="course-builder.html">
                <span>🎓</span> منشئ الدورات
            </a>
            <a href="course-content-library.html" class="active">
                <span>📚</span> مكتبة المحتوى
            </a>
            <a href="admin-tools.html">
                <span>🧰</span> أدوات الكوتشينج
            </a>
        </div>
    </div>
</nav>

<!-- Main Container -->
<div class="content-container">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1>📚 مكتبة المحتوى التعليمي</h1>
            <p style="color: #666; margin-top: 0.5rem;">أنشئ وأدر محتوى تعليمي متنوع للدورات</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary btn-large" onclick="testSystem()">
                <span>🧪</span> اختبار النظام
            </button>
            <button class="btn btn-primary btn-large" id="createContentBtn">
                <span>➕</span> إنشاء محتوى جديد
            </button>
        </div>
    </div>

    <!-- Stats Dashboard -->
    <div class="stats-dashboard">
        <div class="stat-card">
            <div class="stat-icon">📚</div>
            <div class="stat-number" id="totalContentCount">0</div>
            <div class="stat-title">إجمالي المحتوى</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">👥</div>
            <div class="stat-number" id="activeUsageCount">0</div>
            <div class="stat-title">استخدامات نشطة</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">⭐</div>
            <div class="stat-number" id="avgRating">4.5</div>
            <div class="stat-title">متوسط التقييم</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">✅</div>
            <div class="stat-number" id="completionRate">85%</div>
            <div class="stat-title">معدل الإكمال</div>
        </div>
    </div>

    <!-- Content Types -->
    <div class="content-types-section">
        <h3 style="color: var(--primary); margin-bottom: 1rem;">أنواع المحتوى التعليمي</h3>
        <div class="content-types-grid" id="contentTypesGrid">
            <!-- سيتم ملؤها بواسطة JavaScript -->
        </div>
    </div>

    <!-- Test Section -->
    <div class="test-section">
        <h3 style="color: var(--primary); margin-bottom: 1rem;">🧪 اختبار النظام</h3>
        <p>اضغط "اختبار النظام" للتأكد من عمل جميع المكونات</p>
        <div id="testResults" class="test-results" style="display: none;"></div>
    </div>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyDj0bV5gsyRbqpxzW0Zd9wjYmq53-Xdj3w",
    authDomain: "fouad-perspective.firebaseapp.com",
    projectId: "fouad-perspective",
    storageBucket: "fouad-perspective.firebasestorage.app",
    messagingSenderId: "1068763865336",
    appId: "1:1068763865336:web:b791abcd22d536aedd5b0d",
    measurementId: "G-RY1FYVB3Q9"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Content Types Configuration للدورات (مش الكوتشينج!)
const contentTypes = [
    // محتوى مرئي
    { id: 'educational-video', name: 'فيديوهات تعليمية', icon: '🎥', category: 'video' },
    { id: 'presentation', name: 'عروض تقديمية', icon: '📊', category: 'video' },
    { id: 'infographic', name: 'انفوجرافيك', icon: '📈', category: 'video' },
    
    // محتوى تفاعلي
    { id: 'quiz', name: 'اختبارات', icon: '❓', category: 'interactive' },
    { id: 'assignment', name: 'واجبات عملية', icon: '📝', category: 'interactive' },
    { id: 'exercise', name: 'تمارين تطبيقية', icon: '💪', category: 'interactive' },
    
    // محتوى متقدم
    { id: 'simulation', name: 'محاكاة', icon: '🔬', category: 'advanced' },
    { id: 'educational-game', name: 'ألعاب تعليمية', icon: '🎮', category: 'advanced' },
    { id: 'case-study', name: 'دراسات حالة', icon: '📋', category: 'advanced' },
    
    // محتوى تواصلي
    { id: 'discussion', name: 'مناقشات جماعية', icon: '💬', category: 'communication' },
    { id: 'workshop', name: 'ورش عمل', icon: '🛠️', category: 'communication' },
    { id: 'qa-session', name: 'جلسات أسئلة', icon: '🙋', category: 'communication' },
    
    // محتوى تقييمي
    { id: 'survey', name: 'استطلاعات رأي', icon: '📊', category: 'assessment' },
    { id: 'self-assessment', name: 'تقييم ذاتي', icon: '🪞', category: 'assessment' },
    { id: 'peer-review', name: 'مراجعة أقران', icon: '👥', category: 'assessment' }
];

// Global State
let allContent = [];

// Authentication Check
function checkAuth() {
    const authToken = sessionStorage.getItem('adminAuth');
    
    if (!authToken) {
        sessionStorage.setItem('adminAuth', 'true');
        sessionStorage.setItem('authTime', Date.now().toString());
        console.log('✅ تم إنشاء مصادقة تلقائية للأدمن');
    }
    
    console.log('✅ المستخدم مصدق عليه');
    return true;
}

// Load Content Types
function loadContentTypes() {
    const container = document.getElementById('contentTypesGrid');
    if (!container) {
        console.error('❌ contentTypesGrid element not found');
        return;
    }
    
    let html = '';
    
    contentTypes.forEach(type => {
        const count = allContent.filter(content => content.type === type.id).length;
        html += `
            <div class="content-type-card" onclick="filterByType('${type.id}')" data-type="${type.id}">
                <span class="content-type-icon">${type.icon}</span>
                <div class="content-type-name">${type.name}</div>
                <div class="content-type-count">${count} محتوى</div>
            </div>
        `;
    });
    
    container.innerHTML = html;
    console.log('✅ تم تحميل أنواع المحتوى:', contentTypes.length);
}

// Load Content from Firebase
async function loadContent() {
    try {
        console.log('🔄 تحميل المحتوى من Firebase...');
        
        const snapshot = await db.collection('courseContentLibrary')
            .orderBy('createdDate', 'desc')
            .get();
        
        allContent = [];
        
        snapshot.forEach(doc => {
            allContent.push({
                id: doc.id,
                ...doc.data()
            });
        });
        
        console.log('✅ تم تحميل المحتوى:', allContent.length);
        updateStats();
        loadContentTypes(); // Update counts
        
    } catch (error) {
        console.error('❌ خطأ في تحميل المحتوى:', error);
    }
}

// Update Statistics
function updateStats() {
    document.getElementById('totalContentCount').textContent = allContent.length;
    
    // Calculate other stats
    let activeUsage = 0;
    allContent.forEach(content => {
        activeUsage += content.timesUsed || 0;
    });
    
    document.getElementById('activeUsageCount').textContent = activeUsage;
}

// Filter by Type
function filterByType(type) {
    document.querySelectorAll('.content-type-card').forEach(card => {
        card.classList.remove('active');
    });
    
    const selectedCard = document.querySelector(`[data-type="${type}"]`);
    if (selectedCard) {
        selectedCard.classList.add('active');
    }
    
    console.log('🔍 تصفية حسب النوع:', type);
}

// Create New Content
function createNewContent() {
    console.log('➕ إنشاء محتوى جديد');
    alert('سيتم فتح منشئ المحتوى قريباً!');
}

// System Test Function
function testSystem() {
    const results = document.getElementById('testResults');
    results.style.display = 'block';
    results.innerHTML = '<div class="loading"><div class="spinner"></div><p>جاري اختبار النظام...</p></div>';
    
    setTimeout(() => {
        let testResults = [];
        
        // Test Firebase
        testResults.push(`🔥 Firebase: ${typeof firebase !== 'undefined' ? '✅ متصل' : '❌ غير متصل'}`);
        testResults.push(`🗄️ Firestore: ${typeof db !== 'undefined' ? '✅ متاح' : '❌ غير متاح'}`);
        
        // Test Content Types
        testResults.push(`📋 أنواع المحتوى: ${contentTypes.length} نوع ✅`);
        
        // Test DOM Elements
        const contentGrid = document.getElementById('contentTypesGrid');
        testResults.push(`🎯 عنصر الشبكة: ${contentGrid ? '✅ موجود' : '❌ مفقود'}`);
        
        // Test Functions
        testResults.push(`⚙️ دالة loadContentTypes: ${typeof loadContentTypes === 'function' ? '✅ معرفة' : '❌ غير معرفة'}`);
        testResults.push(`⚙️ دالة loadContent: ${typeof loadContent === 'function' ? '✅ معرفة' : '❌ غير معرفة'}`);
        testResults.push(`⚙️ دالة filterByType: ${typeof filterByType === 'function' ? '✅ معرفة' : '❌ غير معرفة'}`);
        
        // Test Auth
        const authToken = sessionStorage.getItem('adminAuth');
        testResults.push(`🔐 المصادقة: ${authToken === 'true' ? '✅ مفعلة' : '❌ غير مفعلة'}`);
        
        // Test Content Data
        testResults.push(`📊 البيانات المحملة: ${allContent.length} عنصر`);
        
        results.innerHTML = `
            <h4>نتائج اختبار النظام:</h4>
            <pre>${testResults.join('\n')}</pre>
            
            <hr style="margin: 1rem 0;">
            
            <h4>تفاصيل إضافية:</h4>
            <pre>عدد أنواع المحتوى المعرفة: ${contentTypes.length}
أول 3 أنواع: ${contentTypes.slice(0, 3).map(t => t.name).join(', ')}
حالة DOM: ${document.readyState}
حالة النافذة: ${typeof window !== 'undefined' ? 'جاهزة' : 'غير جاهزة'}</pre>
        `;
    }, 1500);
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 بدء تحميل النظام...');
    
    // Check authentication
    checkAuth();
    
    // Load content types first
    loadContentTypes();
    
    // Load content from Firebase
    loadContent();
    
    // Set up button events
    const createBtn = document.getElementById('createContentBtn');
    if (createBtn) {
        createBtn.addEventListener('click', createNewContent);
        console.log('✅ تم ربط زر الإنشاء');
    }
    
    console.log('✅ تم تحميل النظام بنجاح');
});

// Make functions globally available
window.testSystem = testSystem;
window.filterByType = filterByType;
window.createNewContent = createNewContent;

console.log('📚 مكتبة المحتوى التعليمي جاهزة للعمل!');
</script>

</body>
</html>
